<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aurora-lsk.asia","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
<meta property="og:type" content="website">
<meta property="og:title" content="坤博客">
<meta property="og:url" content="https://aurora-lsk.asia/page/8/index.html">
<meta property="og:site_name" content="坤博客">
<meta property="og:description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="坤">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://aurora-lsk.asia/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>坤博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">坤博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/3.5%E5%8D%8F%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/3.5%E5%8D%8F%E7%A8%8B/" class="post-title-link" itemprop="url">3.5协程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:19:13" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>协程理论</h1>
<h1>【一】基于单线程来实现并发</h1>
<h2 id="【0】并发的本质">【0】并发的本质</h2>
<ul>
<li>
<p>本节的主题是基于单线程来实现并发</p>
</li>
<li>
<ul>
<li>即只用一个主线程（很明显可利用的cpu只有一个）情况下实现并发</li>
<li>为此我们需要先回顾下并发的本质：</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>切换+保存状态</li>
</ul>
</li>
</ul>
</li>
<li>
<p>CPU正在运行一个任务</p>
</li>
<li>
<ul>
<li>会在两种情况下切走去执行其他的任务（切换由操作系统强制控制）</li>
<li>一种情况是该任务发生了阻塞</li>
<li>另外一种情况是该任务计算的时间过长或有一个优先级更高的程序替代了它。</li>
</ul>
</li>
</ul>
<p><img src="http://zhaochunze.dream521.site/2322215-20230625082605320-1726976824.png" alt="img"></p>
<p>ps：</p>
<p>在介绍进程理论时，提及进程的三种执行状态</p>
<p>而线程才是执行单位，所以也可以将上图理解为线程的三种状态</p>
<h2 id="【1】yield关键字">【1】yield关键字</h2>
<ul>
<li>
<p>其中第二种情况并不能提升效率</p>
</li>
<li>
<p>只是为了让cpu能够雨露均沾</p>
</li>
<li>
<p>实现看起来所有任务都被“同时”执行的效果</p>
</li>
<li>
<p>如果多个任务都是纯计算的</p>
</li>
<li>
<p>这种切换反而会降低效率。</p>
</li>
<li>
<p>为此我们可以基于yield来验证</p>
</li>
<li>
<ul>
<li>yield本身就是一种在单线程下可以保存任务运行状态的方法</li>
<li>我们来简单复习一下：</li>
</ul>
</li>
</ul>
```python
1 yield可以保存状态
	yield的状态保存与操作系统的保存线程状态很像，但是yield是代码级别控制的，更轻量级
2 send可以把一个函数的结果传给另外一个函数
	以此实现单线程内程序之间的切换
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 单纯地切换反而会降低运行效率</span><br><span class="line"></span><br><span class="line">### （1）串行执行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def func1():</span><br><span class="line">    for i in range(10000000):</span><br><span class="line">        i + 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def func2():</span><br><span class="line">    for i in range(10000000):</span><br><span class="line">        i + 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">func1()</span><br><span class="line">func2()</span><br><span class="line">stop = time.time()</span><br><span class="line">print(stop - start)</span><br></pre></td></tr></table></figure>

<h3 id="（2）基于yield并发执行">（2）基于yield并发执行</h3>
```python
import time
def func1():
    while True:
        yield

def func2():
    g = func1()
    for i in range(10000000):
        i+1
        next(g)

start=time.time()
func2()
stop=time.time()
print(stop-start)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【2】实现遇到IO自动切换</span><br><span class="line"></span><br><span class="line">- 第一种情况的切换。</span><br><span class="line">- 在任务一遇到IO情况下</span><br><span class="line">- 切到任务二去执行</span><br><span class="line">- 这样就可以利用任务一阻塞的时间完成任务二的计算</span><br><span class="line">- 效率的提升就在于此。</span><br><span class="line">- yield不能检测IO </span><br><span class="line"></span><br><span class="line">- - 实现遇到IO自动切换</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def func1():</span><br><span class="line">    while True:</span><br><span class="line">        print(&#x27;func1&#x27;)</span><br><span class="line">        yield</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def func2():</span><br><span class="line">    g = func1()</span><br><span class="line">    for i in range(5):</span><br><span class="line">        i + 1</span><br><span class="line">        next(g)</span><br><span class="line">        time.sleep(3)</span><br><span class="line">        print(&#x27;func2&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">func2()</span><br><span class="line">stop = time.time()</span><br><span class="line">print(stop - start)</span><br></pre></td></tr></table></figure>

<ul>
<li>
<p><strong>对于单线程下，我们不可避免程序中出现IO操作，但如果我们能在自己的程序中（即用户程序级别，而非操作系统级别）控制单线程下的多个任务能在一个任务遇到io阻塞时就切换到另外一个任务去计算，这样就保证了该线程能够最大限度地处于就绪态，即随时都可以被cpu执行的状态，相当于我们在用户程序级别将自己的IO操作最大限度地隐藏起来，从而可以迷惑操作系统，让其看到：该线程好像是一直在计算，IO比较少，从而更多的将cpu的执行权限分配给我们的线程。</strong></p>
</li>
<li>
<p>协程的本质就是在单线程下</p>
</li>
<li>
<ul>
<li>由用户自己控制一个任务遇到io阻塞了就切换另外一个任务去执行，以此来提升效率。</li>
</ul>
</li>
<li>
<p>为了实现它，我们需要找寻一种可以同时满足以下条件的解决方案：</p>
</li>
<li>
<ul>
<li>可以控制多个任务之间的切换，切换之前将任务的状态保存下来，以便重新运行时，可以基于暂停的位置继续执行。</li>
<li>作为1的补充：可以检测IO操作，在遇到IO操作的情况下才发生切换</li>
</ul>
</li>
</ul>
<h1>【二】协程介绍</h1>
<h2 id="【1】什么是协程">【1】什么是协程</h2>
<ul>
<li>
<p>是单线程下的并发，又称微线程，纤程。英文名Coroutine。</p>
</li>
<li>
<p>一句话说明什么是线程：</p>
</li>
<li>
<ul>
<li><strong>协程是一种用户态的轻量级线程，即协程是由用户程序自己控制调度的。</strong></li>
</ul>
</li>
<li>
<p>需要强调的是：</p>
</li>
<li>
<ul>
<li>python的线程属于内核级别的，即由操作系统控制调度（如单线程遇到io或执行时间过长就会被迫交出cpu执行权限，切换其他线程运行）</li>
<li>单线程内开启协程，一旦遇到io，就会从应用程序级别（而非操作系统）控制切换，以此来提升效率（！！！非io操作的切换与效率无关）</li>
</ul>
</li>
<li>
<p>对比操作系统控制线程的切换，用户在单线程内控制协程的切换</p>
</li>
</ul>
<h2 id="【2】优点">【2】优点</h2>
<ul>
<li>协程的切换开销更小，属于程序级别的切换，操作系统完全感知不到，因而更加轻量级</li>
<li>单线程内就可以实现并发的效果，最大限度地利用cpu</li>
<li>应用程序级别速度要远远高于操作系统的切换</li>
</ul>
<h2 id="【3】缺点">【3】缺点</h2>
<ul>
<li>协程的本质是单线程下，无法利用多核，可以是一个程序开启多个进程，每个进程内开启多个线程，每个线程内开启协程</li>
<li>协程指的是单个线程，因而一旦协程出现阻塞，将会阻塞整个线程(多个任务一旦有一个阻塞没有切，整个线程都阻塞在原地,该线程内的其他的任务都不能执行了)</li>
</ul>
<h2 id="【4】总结">【4】总结</h2>
<ul>
<li><strong>1.必须在只有一个单线程里实现并发</strong></li>
<li><strong>2.修改共享数据不需加锁</strong></li>
<li><strong>3.用户程序里自己保存多个控制流的上下文栈</strong></li>
<li><strong>4.附加：一个协程遇到IO操作自动切换到其它协程（如何实现检测IO，yield、greenlet都无法实现，就用到了gevent模块（select机制））</strong></li>
</ul>
<h1>【三】Greenlet</h1>
<ul>
<li>
<p>如果我们在单个线程内有20个任务</p>
</li>
<li>
<ul>
<li>要想实现在多个任务之间切换</li>
<li>使用yield生成器的方式过于麻烦（需要先得到初始化一次的生成器，然后再调用send。。。非常麻烦</li>
<li>而使用greenlet模块可以非常简单地实现这20个任务直接的切换</li>
</ul>
</li>
</ul>
<h2 id="【1】安装">【1】安装</h2>
```shell
pip3 install greenlet
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【2】使用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from greenlet import greenlet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def eat(name):</span><br><span class="line">    print(&#x27;%s eat 1&#x27; % name)</span><br><span class="line">    g2.switch(&#x27;hope&#x27;)</span><br><span class="line">    print(&#x27;%s eat 2&#x27; % name)</span><br><span class="line">    g2.switch()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def play(name):</span><br><span class="line">    print(&#x27;%s play 1&#x27; % name)</span><br><span class="line">    g1.switch()</span><br><span class="line">    print(&#x27;%s play 2&#x27; % name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = greenlet(eat)</span><br><span class="line">g2 = greenlet(play)</span><br><span class="line"></span><br><span class="line"># 可以在第一次switch时传入参数，以后都不需要</span><br><span class="line">g1.switch(&#x27;dream&#x27;)</span><br><span class="line"></span><br><span class="line"># dream eat 1</span><br><span class="line"># hope play 1</span><br><span class="line"># dream eat 2</span><br><span class="line"># hope play 2</span><br></pre></td></tr></table></figure>

<h2 id="【3】单纯切换降低效率">【3】单纯切换降低效率</h2>
<ul>
<li>单纯的切换（在没有io的情况下或者没有重复开辟内存空间的操作），反而会降低程序的执行速度</li>
</ul>
<h3 id="（1）顺序执行">（1）顺序执行</h3>
```python
# 顺序执行
import time


def f1():
    res = 1
    for i in range(100000000):
        res += i


def f2():
    res = 1
    for i in range(100000000):
        res *= i


start = time.time()
f1()
f2()
stop = time.time()
print('run time is %s' % (stop - start))
# run time is 3.5635316371917725
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### （2）切换执行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from greenlet import greenlet</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def f1():</span><br><span class="line">    res = 1</span><br><span class="line">    for i in range(100000000):</span><br><span class="line">        res += i</span><br><span class="line">        g2.switch()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def f2():</span><br><span class="line">    res = 1</span><br><span class="line">    for i in range(100000000):</span><br><span class="line">        res *= i</span><br><span class="line">        g1.switch()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">g1 = greenlet(f1)</span><br><span class="line">g2 = greenlet(f2)</span><br><span class="line">g1.switch()</span><br><span class="line">stop = time.time()</span><br><span class="line">print(&#x27;run time is %s&#x27; % (stop - start))</span><br><span class="line"># run time is 27.30641794204712</span><br></pre></td></tr></table></figure>

<h2 id="【4】小结">【4】小结</h2>
<ul>
<li>
<p>greenlet只是提供了一种比generator更加便捷的切换方式</p>
</li>
<li>
<ul>
<li>当切到一个任务执行时如果遇到io</li>
<li>那就原地阻塞，仍然是没有解决遇到IO自动切换来提升效率的问题。</li>
</ul>
</li>
<li>
<p>单线程里的这20个任务的代码通常会既有计算操作又有阻塞操作</p>
</li>
<li>
<ul>
<li>我们完全可以在执行任务1时遇到阻塞</li>
<li>就利用阻塞的时间去执行任务2。。。。</li>
<li>如此，才能提高效率，这就用到了Gevent模块。</li>
</ul>
</li>
</ul>
<h1>【四】Gevent介绍</h1>
<h2 id="【0】介绍">【0】介绍</h2>
<ul>
<li>Gevent 是一个第三方库</li>
<li>可以轻松通过gevent实现并发同步或异步编程</li>
<li>在gevent中用到的主要模式是Greenlet</li>
<li>它是以C扩展模块形式接入Python的轻量级协程。</li>
<li>Greenlet全部运行在主程序操作系统进程的内部，但它们被协作式地调度。</li>
</ul>
<h2 id="【1】安装-2">【1】<strong>安装</strong></h2>
```plain
pip3 install gevent
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【2】使用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def func(*args, **kwargs):</span><br><span class="line">    print(args)  # (1, 2, 3)</span><br><span class="line">    print(kwargs)  # &#123;&#x27;x&#x27;: 4, &#x27;y&#x27;: 5&#125;</span><br><span class="line">    return &#x27;ok&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def func2():</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建一个协程对象g1，spawn括号内第一个参数是函数名，如eat，后面可以有多个参数，可以是位置实参或关键字实参，都是传给函数eat的</span><br><span class="line">g1 = gevent.spawn(func, 1, 2, 3, x=4, y=5)</span><br><span class="line"></span><br><span class="line"># 创建一个协程对象g2</span><br><span class="line">g2 = gevent.spawn(func2)</span><br><span class="line"></span><br><span class="line">g1.join()  # 等待g1结束</span><br><span class="line"></span><br><span class="line">g2.join()  # 等待g2结束</span><br><span class="line"></span><br><span class="line"># 或者上述两步合作一步：gevent.joinall([g1,g2])</span><br><span class="line"></span><br><span class="line"># 拿到func1的返回值</span><br><span class="line">result = g1.value</span><br><span class="line"></span><br><span class="line">print(result)</span><br><span class="line"># ok</span><br></pre></td></tr></table></figure>

<h2 id="【3】遇到IO阻塞时会自动切换任务">【3】<strong>遇到IO阻塞时会自动切换任务</strong></h2>
```python
import gevent


def eat(name):
    print('%s eat 1' % name)
    gevent.sleep(2)
    print('%s eat 2' % name)


def play(name):
    print('%s play 1' % name)
    gevent.sleep(1)
    print('%s play 2' % name)


g1 = gevent.spawn(eat, 'dream')
g2 = gevent.spawn(play, name='hope')
g1.join()
g2.join()

# 或者gevent.joinall([g1,g2])

print('主')

# dream eat 1
# hope play 1
# hope play 2
# dream eat 2
# 主
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- **上例gevent.sleep(2)模拟的是gevent可以识别的io阻塞**</span><br><span class="line"></span><br><span class="line">## 【4】兼容其他IO</span><br><span class="line"></span><br><span class="line">- **而time.sleep(2)或其他的阻塞,gevent是不能直接识别的需要用下面一行代码,打补丁,就可以识别了**</span><br><span class="line">- **from gevent import monkey;monkey.patch_all()必须放到被打补丁者的前面**</span><br><span class="line"></span><br><span class="line">- - **如time，socket模块之前**</span><br><span class="line"></span><br><span class="line">- **或者我们干脆记忆成：要用gevent，需要将from gevent import monkey; monkey.patch_all()放到文件的开头**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from gevent import monkey</span><br><span class="line"></span><br><span class="line">monkey.patch_all()</span><br><span class="line"></span><br><span class="line">import gevent</span><br><span class="line">import time</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def eat():</span><br><span class="line">    print(&#x27;eat food 1&#x27;)</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    print(f&quot;eat 中的 :&gt;&gt;&gt;&gt; &#123;threading.current_thread()&#125;&quot;)</span><br><span class="line">    print(&#x27;eat food 2&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def play():</span><br><span class="line">    print(&#x27;play 1&#x27;)</span><br><span class="line">    time.sleep(1)</span><br><span class="line">    print(f&quot;play 中的 :&gt;&gt;&gt;&gt; &#123;threading.current_thread()&#125;&quot;)</span><br><span class="line">    print(&#x27;play 2&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = gevent.spawn(eat)</span><br><span class="line">g2 = gevent.spawn(play)</span><br><span class="line">gevent.joinall([g1, g2])</span><br><span class="line"></span><br><span class="line">print(threading.current_thread())</span><br><span class="line"></span><br><span class="line">print(&#x27;主&#x27;)</span><br><span class="line"></span><br><span class="line"># eat food 1</span><br><span class="line"># play 1</span><br><span class="line"># play 中的 :&gt;&gt;&gt;&gt; &lt;_DummyThread(Dummy-1, started daemon 5168389856)&gt;</span><br><span class="line"># play 2</span><br><span class="line"># eat 中的 :&gt;&gt;&gt;&gt; &lt;_DummyThread(Dummy-2, started daemon 5168390016)&gt;</span><br><span class="line"># eat food 2</span><br><span class="line"># &lt;_MainThread(MainThread, started 5168107712)&gt;</span><br><span class="line"># 主</span><br></pre></td></tr></table></figure>

<ul>
<li>我们可以用threading.current_thread()来查看每个g1和g2，查看的结果为DummyThread-n，即假线程</li>
</ul>
<h1>【五】Gevent之同步与异步</h1>
```python
from gevent import spawn, joinall, monkey

monkey.patch_all()

import time


def timer(func):
    def inner(*args, **kwargs):
        start = time.time()
        res = func(*args, **kwargs)
        print(f'当前程序 {func.__name__} 总耗时 :>>>> {time.time() - start} s')
        return res

    return inner


def task(pid):
    """
    Some non-deterministic task
    """
    time.sleep(0.5)
    print('Task %s done' % pid)


@timer
def synchronous():
    for i in range(10):
        task(i)


@timer
def asynchronous():
    g_l = [spawn(task, i) for i in range(10)]
    joinall(g_l)


if __name__ == '__main__':
    print('Synchronous:')
    synchronous()

    print('Asynchronous:')
    asynchronous()

    # Synchronous:
    # Task 0 done
    # Task 1 done
    # Task 2 done
    # Task 3 done
    # Task 4 done
    # Task 5 done
    # Task 6 done
    # Task 7 done
    # Task 8 done
    # Task 9 done
    # 当前程序 synchronous 总耗时 :>>>> 5.034381151199341 s
    # Asynchronous:
    # Task 0 done
    # Task 1 done
    # Task 2 done
    # Task 3 done
    # Task 4 done
    # Task 5 done
    # Task 6 done
    # Task 7 done
    # Task 8 done
    # Task 9 done
    # 当前程序 asynchronous 总耗时 :>>>> 0.504889726638794 s

# 上面程序的重要部分是将task函数封装到Greenlet内部线程的gevent.spawn。
# 初始化的greenlet列表存放在数组threads中，此数组被传给gevent.joinall 函数，后者阻塞当前流程，并执行所有给定的greenlet。
# 执行流程只会在 所有greenlet执行完后才会继续向下走。
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 【六】Gevent之应用举例一</span><br><span class="line"></span><br><span class="line">- 协程应用：爬虫</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from gevent import monkey</span><br><span class="line"></span><br><span class="line">monkey.patch_all()</span><br><span class="line">import gevent</span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_page(url):</span><br><span class="line">    print(f&quot;当前正在获取 :&gt;&gt;&gt;&gt; &#123;url&#125;&quot;)</span><br><span class="line">    response = requests.get(url=url)</span><br><span class="line">    if response.status_code == 200:</span><br><span class="line">        print(f&#x27;当前响应数据总长度 :&gt;&gt;&gt;&gt; &#123;len(response.text)&#125; 当前链接 :&gt;&gt;&gt;&gt; &#123;url&#125;&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start_time = time.time()</span><br><span class="line">gevent.joinall([</span><br><span class="line">    gevent.spawn(get_page, &#x27;https://www.python.org/&#x27;),</span><br><span class="line">    gevent.spawn(get_page, &#x27;https://www.jd.com/&#x27;),</span><br><span class="line">    gevent.spawn(get_page, &#x27;https://www.baidu.com/&#x27;),</span><br><span class="line">])</span><br><span class="line">stop_time = time.time()</span><br><span class="line">print(f&#x27;总耗时 :&gt;&gt;&gt;&gt; &#123;stop_time - start_time&#125;s&#x27;)</span><br><span class="line"></span><br><span class="line"># 当前正在获取 :&gt;&gt;&gt;&gt; https://www.python.org/</span><br><span class="line"># 当前正在获取 :&gt;&gt;&gt;&gt; https://www.jd.com/</span><br><span class="line"># 当前正在获取 :&gt;&gt;&gt;&gt; https://www.baidu.com/</span><br><span class="line"># 当前响应数据总长度 :&gt;&gt;&gt;&gt; 227 当前链接 :&gt;&gt;&gt;&gt; https://www.baidu.com/</span><br><span class="line"># 当前响应数据总长度 :&gt;&gt;&gt;&gt; 182756 当前链接 :&gt;&gt;&gt;&gt; https://www.jd.com/</span><br><span class="line"># 当前响应数据总长度 :&gt;&gt;&gt;&gt; 50995 当前链接 :&gt;&gt;&gt;&gt; https://www.python.org/</span><br><span class="line"># 总耗时 :&gt;&gt;&gt;&gt; 15.546293020248413s</span><br></pre></td></tr></table></figure>

<h1>【七】Gevent之应用举例二</h1>
<ul>
<li>通过gevent实现单线程下的socket并发</li>
</ul>
```python
from gevent import monkey;
monkey.patch_all()

# 一定要放到导入socket模块之前，否则gevent无法识别socket的阻塞）
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【1】服务端</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from gevent import monkey</span><br><span class="line"></span><br><span class="line">monkey.patch_all()</span><br><span class="line">from socket import *</span><br><span class="line">import gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 如果不想用money.patch_all()打补丁,可以用gevent自带的socket</span><br><span class="line"># from gevent import socket</span><br><span class="line"># s=socket.socket()</span><br><span class="line"></span><br><span class="line">def server(server_ip, port):</span><br><span class="line">    s = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">    s.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)</span><br><span class="line">    s.bind((server_ip, port))</span><br><span class="line">    s.listen(5)</span><br><span class="line">    while True:</span><br><span class="line">        conn, addr = s.accept()</span><br><span class="line">        gevent.spawn(talk, conn, addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def talk(conn, addr):</span><br><span class="line">    try:</span><br><span class="line">        while True:</span><br><span class="line">            res = conn.recv(1024)</span><br><span class="line">            print(&#x27;client %s:%s msg: %s&#x27; % (addr[0], addr[1], res))</span><br><span class="line">            conn.send(res.upper())</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(e)</span><br><span class="line">    finally:</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    server(&#x27;127.0.0.1&#x27;, 8080)</span><br></pre></td></tr></table></figure>

<h2 id="【2】客户端">【2】客户端</h2>
```python
from socket import *

client = socket(AF_INET, SOCK_STREAM)
client.connect(('127.0.0.1', 8080))

while True:
    msg = input('>>: ').strip()
    if not msg: continue

    client.send(msg.encode('utf-8'))
    msg = client.recv(1024)
    print(msg.decode('utf-8'))
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【3】多线程并发多个客户端</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from threading import Thread</span><br><span class="line">from socket import *</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def client(server_ip, port):</span><br><span class="line">    # 套接字对象一定要加到函数内，即局部名称空间内</span><br><span class="line">    # 放在函数外则被所有线程共享，则大家公用一个套接字对象，那么客户端端口永远一样了</span><br><span class="line">    c = socket(AF_INET, SOCK_STREAM)  </span><br><span class="line">    c.connect((server_ip, port))</span><br><span class="line"></span><br><span class="line">    count = 0</span><br><span class="line">    while True:</span><br><span class="line">        c.send((&#x27;%s say hello %s&#x27; % (threading.current_thread().getName(), count)).encode(&#x27;utf-8&#x27;))</span><br><span class="line">        msg = c.recv(1024)</span><br><span class="line">        print(msg.decode(&#x27;utf-8&#x27;))</span><br><span class="line">        count += 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    for i in range(500):</span><br><span class="line">        t = Thread(target=client, args=(&#x27;127.0.0.1&#x27;, 8080))</span><br><span class="line">        t.start()</span><br></pre></td></tr></table></figure>

<h1>协程操作</h1>
<ul>
<li>基于 async 和 await 关键字的协程可以实现异步编程，这也是目前 Python 异步相关的主流技术。在这里我们主要介绍一下实现异步的模块：asyncio 模块</li>
</ul>
<h1>【一】asyncio 模块</h1>
<ul>
<li>asyncio 模块是 Python 中实现异步的一个模块，该模块在 Python3.4 的时候发布</li>
<li>async 和 await 关键字在 Python3.5 中引入。</li>
<li>因此，想要使用asyncio模块，建议 Python 解释器的版本不要低于 Python3.5 。</li>
</ul>
<h1>【二】事件循环</h1>
<ul>
<li>所谓的事件循环，我们可以把它当作是一个 while 循环，这个 while 循环在循环生命周期内运行并执行一些任务，在特定的条件下结束循环。</li>
<li>在编写程序的时候可以通过如下代码来获取和创建事件循环：</li>
</ul>
```python
import asyncio

loop = asyncio.get_event_loop()
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 【三】协程函数和协程对象</span><br><span class="line"></span><br><span class="line">## 【1】什么是协程函数</span><br><span class="line"></span><br><span class="line">- 首先我们来看一下协程函数 </span><br><span class="line"></span><br><span class="line">- - 什么是协程函数呢？</span><br><span class="line"></span><br><span class="line">- 直白的讲，定义为如下形式的函数</span><br><span class="line">- 我们可以称之为协程函数，如下代码所示：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 使用 async 声明的函数就是协程函数</span><br><span class="line">async def fn():</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>

<h2 id="【2】什么是协程对象">【2】什么是协程对象</h2>
<ul>
<li>
<p>知道了什么是协程函数</p>
</li>
<li>
<ul>
<li>接下来我们再来看一下什么是协程对象</li>
<li>所谓的协程对象就是调用协程函数之后返回的对象</li>
<li>我们称之为 <strong>协程对象</strong>，如下代码所示：</li>
</ul>
</li>
</ul>
```python
# 使用 async 声明的函数就是协程函数
async def fn():
    pass


# 调用携程函数得到的对象就是协程对象
res = fn()
print(res) # <coroutine object fn at 0x1029684a0>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 注意事项：调用协程函数时，函数内部的代码不会执行，只是会返回一个协程对象！</span><br><span class="line"></span><br><span class="line"># 【四】协程函数应用</span><br><span class="line"></span><br><span class="line">## 【1】基本应用</span><br><span class="line"></span><br><span class="line">- 在编写程序的时候，如果想要执行协程函数内部的代码，通过 **函数名()** 调用函数是不可以的，需要 **事件循环** 和 **协程对象** 配合才能实现，如下代码所示：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">async def fn():</span><br><span class="line">    print(&#x27;协程函数内部的代码&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 执行协程代码的方式一</span><br><span class="line">def main_first():</span><br><span class="line">    # 调用协程函数，返回一个协程对象</span><br><span class="line">    res = fn()</span><br><span class="line"></span><br><span class="line">    # todo：1、创建一个事件循环</span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line"></span><br><span class="line">    # todo：2、将协程当作任务提交到事件循环的任务列表中，协程执行完成之后终止</span><br><span class="line">    loop.run_until_complete(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 执行协程代码的方式二</span><br><span class="line">def main_second():</span><br><span class="line">    # 调用协程函数，返回一个协程对象</span><br><span class="line">    res = fn()</span><br><span class="line">    # 解析：第二种方式在本质上和第一种方式是相同的，其内部先创建事件循环，然后执行 run_until_complete</span><br><span class="line">    # 但是要注意：该方式只支持 Python3.7+ 的解释器，因为该方式在 Python3.7 加入的。</span><br><span class="line">    asyncio.run(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main_first()</span><br><span class="line"></span><br><span class="line">    main_second()</span><br></pre></td></tr></table></figure>

<ul>
<li>
<p>这个过程可以简单理解为：</p>
</li>
<li>
<ul>
<li>将 <strong>协程函数</strong> 当做任务添加到 <strong>事件循环</strong> 的任务列表</li>
<li>然后事件循环检测列表中的<strong>协程函数</strong> 是否已准备就绪（默认可理解为就绪状态）</li>
<li>如果准备就绪则执行其内部代码。</li>
</ul>
</li>
</ul>
<h2 id="【2】await关键字">【2】await关键字</h2>
<ul>
<li>await 是一个 只能 在协程函数中使用的关键字，用于当协程函数遇到IO操作的时候挂起当前协程（任务），</li>
<li>当前协程挂起过程中，事件循环可以去执行其他的协程（任务）</li>
<li>当前协程IO处理完成时，可以再次切换回来执行 await 之后的代码</li>
<li>怎么理解呢？请看如下代码：</li>
</ul>
<h3 id="（1）实例1">（1）<strong>实例1</strong></h3>
```python
import asyncio


async def fn():
    print('协程函数内部的代码')

    # 遇到IO操作之后挂起当前协程（任务），等IO操作完成之后再继续往下执行。
    # 当前协程挂起时，事件循环可以去执行其他协程（任务）
    response = await asyncio.sleep(2)  # 模拟遇到了IO操作

    print(f'IO请求结束，结果为：{response}')


def main():
    # 调用协程函数，返回一个协程对象
    res = fn()

    # 执行协程函数
    asyncio.run(res)


if __name__ == '__main__':
    main()

    '''
    运行结果：
    协程函数内部的代码
    IO请求结束，结果为：None
    '''
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### （2）**实例2**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">async def other_tasks():</span><br><span class="line">    print(&#x27;start&#x27;)</span><br><span class="line">    await asyncio.sleep(2)  # 模拟遇到了IO操作</span><br><span class="line">    print(&#x27;end&#x27;)</span><br><span class="line">    return &#x27;返回值&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">async def fn():</span><br><span class="line">    print(&#x27;协程函数内部的代码&#x27;)</span><br><span class="line"></span><br><span class="line">    # 遇到IO操作之后挂起当前协程（任务），等IO操作完成之后再继续往下执行。</span><br><span class="line">    # 当前协程挂起时，事件循环可以去执行其他协程（任务）</span><br><span class="line">    response = await other_tasks()  # 模拟执行其他协程任务</span><br><span class="line"></span><br><span class="line">    print(f&#x27;IO请求结束，结果为：&#123;response&#125;&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    # 调用协程函数，返回一个协程对象</span><br><span class="line">    res = fn()</span><br><span class="line"></span><br><span class="line">    # 执行协程函数</span><br><span class="line">    asyncio.run(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    运行结果：</span><br><span class="line">    协程函数内部的代码</span><br><span class="line">    start</span><br><span class="line">    end</span><br><span class="line">    IO请求结束，结果为：返回值</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="（3）实例3">（3）实例3</h3>
```python
import asyncio


async def other_tasks():
    print('start')
    await asyncio.sleep(2)  # 模拟遇到了IO操作
    print('end')
    return '返回值'


async def fn():
    print('协程函数内部的代码')

    # 遇到IO操作之后挂起当前协程（任务），等IO操作完成之后再继续往下执行。
    # 当前协程挂起时，事件循环可以去执行其他协程（任务）
    respnse1 = await other_tasks()
    print(f'IO请求结束，结果为：{respnse1}')

    respnse2 = await other_tasks()
    print(f'IO请求结束，结果为：{respnse2}')


def main():
    # 调用协程函数，返回一个协程对象
    cor_obj = fn()

    # 执行协程函数
    asyncio.run(cor_obj)


if __name__ == '__main__':
    main()
    
    '''
    运行结果：
    协程函数内部的代码
    start
    end
    IO请求结束，结果为：返回值
    start
    end
    IO请求结束，结果为：返回值
    '''
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### （4）小结</span><br><span class="line"></span><br><span class="line">- 上述的所有实例都只是创建了一个任务 </span><br><span class="line"></span><br><span class="line">- - 即：事件循环的任务列表中只有一个任务</span><br><span class="line">  - 所以在IO等待时无法演示切换到其他任务效果。</span><br><span class="line"></span><br><span class="line">- 在程序中想要创建多个任务对象 </span><br><span class="line"></span><br><span class="line">- - 需要使用Task对象来实现。</span><br><span class="line"></span><br><span class="line">## 【3】Task 对象</span><br><span class="line"></span><br><span class="line">- Tasks 用于并发调度协程</span><br><span class="line">- 通过 asyncio.create_task(协程对象) 的方式创建 Task 对象</span><br><span class="line">- 这样可以让协程加入事件循环中等待被调度执行。</span><br><span class="line">- 除了使用 asyncio.create_task() 函数以外</span><br><span class="line">- 还可以用低层级的loop.create_task() 或 ensure_future() 函数。并且不建议手动实例化 Task 对象。</span><br><span class="line">- 本质上是将协程对象封装成 Task 对象</span><br><span class="line">- 并将协程立即加入事件循环，同时追踪协程的状态。</span><br><span class="line">- 注意事项： </span><br><span class="line"></span><br><span class="line">- - asyncio.create_task() 函数在 Python3.7 中被加入。</span><br><span class="line">  - 在 Python3.7 之前，可以改用低层级的</span><br><span class="line">  - asyncio.ensure_future() 函数。</span><br><span class="line"></span><br><span class="line">### （1）协程运行方式一</span><br><span class="line"></span><br><span class="line">- async.run() 运行协程</span><br><span class="line">- async.create_task()创建task</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">async def other_tasks():</span><br><span class="line">    print(&#x27;start&#x27;)</span><br><span class="line">    await asyncio.sleep(2)  # 模拟遇到了IO操作</span><br><span class="line">    print(&#x27;end&#x27;)</span><br><span class="line">    return &#x27;返回值&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">async def fn():</span><br><span class="line">    print(&#x27;fn开始&#x27;)</span><br><span class="line"></span><br><span class="line">    # 创建协程，将协程封装到一个Task对象中并立即添加到事件循环的任务列表中，等待事件循环去执行（默认是就绪状态）。</span><br><span class="line">    task1 = asyncio.create_task(other_tasks())</span><br><span class="line"></span><br><span class="line">    # 创建协程，将协程封装到一个Task对象中并立即添加到事件循环的任务列表中，等待事件循环去执行（默认是就绪状态）。</span><br><span class="line">    task2 = asyncio.create_task(other_tasks())</span><br><span class="line"></span><br><span class="line">    print(&#x27;fn结束&#x27;)</span><br><span class="line"></span><br><span class="line">    # 当执行某协程遇到IO操作时，会自动化切换执行其他任务。</span><br><span class="line">    # 此处的await是等待相对应的协程全都执行完毕并获取结果</span><br><span class="line">    response1 = await task1</span><br><span class="line">    response2 = await task2</span><br><span class="line">    print(response1, response2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    asyncio.run(fn())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    运行结果：</span><br><span class="line">    fn开始</span><br><span class="line">    fn结束</span><br><span class="line">    start</span><br><span class="line">    start</span><br><span class="line">    end</span><br><span class="line">    end</span><br><span class="line">    返回值 返回值</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="（2）协程运行方式二">（2）协程运行方式二</h3>
```python
import asyncio


async def other_tasks():
    print('start')
    await asyncio.sleep(2)  # 模拟遇到了IO操作
    print('end')
    return '返回值'


async def fn():
    print('fn开始')

    # 创建协程，将协程封装到一个Task对象中并立即添加到事件循环的任务列表中，等待事件循环去执行（默认是就绪状态）。
    task_lis = [
        asyncio.create_task(other_tasks()),
        asyncio.create_task(other_tasks()),
    ]

    print('fn结束')
    # 当执行某协程遇到IO操作时，会自动化切换执行其他任务。
    # 此处的await是等待所有协程执行完毕，并将所有协程的返回值保存到done
    # 如果设置了timeout值，则意味着此处最多等待的秒，完成的协程返回值写入到done中，未完成则写到pending中。
    done, pending = await asyncio.wait(task_lis, timeout=None)

    print(f"done :>>>> {done}")
    print(f"pending :>>>> {pending}")


def main():
    asyncio.run(fn())


if __name__ == '__main__':
    main()

    '''
    fn开始
    fn结束
    start
    start
    end
    end
    done :>>>> {<Task finished name='Task-2' coro=<other_tasks() done, defined at /Users/dream/Desktop/PythonProjects/12并发编程/02协程/01.py:4> result='返回值'>, <Task finished name='Task-3' coro=<other_tasks() done, defined at /Users/dream/Desktop/PythonProjects/12并发编程/02协程/01.py:4> result='返回值'>}
    pending :>>>> set()
    '''
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### （3）获取协程返回值</span><br><span class="line"></span><br><span class="line">- async.gather()获取返回值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">async def other_tasks():</span><br><span class="line">    print(&#x27;start&#x27;)</span><br><span class="line">    await asyncio.sleep(2)  # 模拟遇到了IO操作</span><br><span class="line">    print(&#x27;end&#x27;)</span><br><span class="line">    return &#x27;返回值&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">async def fn():</span><br><span class="line">    print(&#x27;fn开始&#x27;)</span><br><span class="line"></span><br><span class="line">    # 创建协程，将协程封装到一个Task对象中并立即添加到事件循环的任务列表中，等待事件循环去执行（默认是就绪状态）。</span><br><span class="line">    task_lis = [</span><br><span class="line">        asyncio.create_task(other_tasks()),</span><br><span class="line">        asyncio.create_task(other_tasks()),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    print(&#x27;fn结束&#x27;)</span><br><span class="line">    # 当执行某协程遇到IO操作时，会自动化切换执行其他任务。</span><br><span class="line">    # 此处的await是等待所有协程执行完毕，并将所有协程的返回值保存到done</span><br><span class="line">    # 如果设置了timeout值，则意味着此处最多等待的秒，完成的协程返回值写入到done中，未完成则写到pending中。</span><br><span class="line">    await asyncio.wait(task_lis, timeout=None)</span><br><span class="line"></span><br><span class="line">    response = await asyncio.gather(task_lis[0], task_lis[1])  # 将task_lis作为参数传入gather，等异步任务都结束后返回结果列表</span><br><span class="line"></span><br><span class="line">    print(f&#x27;response :&gt;&gt;&gt;&gt; &#123;response&#125;&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    asyncio.run(fn())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    fn开始</span><br><span class="line">    fn结束</span><br><span class="line">    start</span><br><span class="line">    start</span><br><span class="line">    end</span><br><span class="line">    end</span><br><span class="line">    response :&gt;&gt;&gt;&gt; [&#x27;返回值&#x27;, &#x27;返回值&#x27;]</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="【4】aiohtpp对象">【4】aiohtpp对象</h2>
<ul>
<li>
<p>我们之前学习过爬虫最重要的模块requests，但它是阻塞式的发起请求，每次请求发起后需阻塞等待其返回响应，不能做其他的事情。</p>
</li>
<li>
<ul>
<li>本文要介绍的aiohttp可以理解成是和requests对应Python异步网络请求库，它是基于 asyncio 的异步模块，可用于实现异步爬虫，有点就是更快于 requests 的同步爬虫。</li>
<li>安装方式，pip install aiohttp。</li>
</ul>
</li>
<li>
<p>aiohttp是一个为Python提供异步HTTP 客户端/服务端编程，基于asyncio的异步库。</p>
</li>
<li>
<ul>
<li>asyncio可以实现单线程并发IO操作，其实现了TCP、UDP、SSL等协议，</li>
<li>aiohttp就是基于asyncio实现的http框架。</li>
</ul>
</li>
</ul>
```python
import aiohttp
import asyncio

async def main():
    async with aiohttp.ClientSession() as session:
        async with session.get("http://httpbin.org/headers") as response:
            print(await response.text())

asyncio.run(main())
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 【五】异步迭代器</span><br><span class="line"></span><br><span class="line">## 【1】什么是异步迭代器？</span><br><span class="line"></span><br><span class="line">- 实现了 **aiter**() 和 **anext**()方法的对象。</span><br><span class="line">- **anext** 必须返回一个 awaitable 对象。</span><br><span class="line">- async for会处理异步迭代器的 **anext**()方法所返回的可等待对象，直到其引发一个 StopAsyncIteration异常。</span><br><span class="line"></span><br><span class="line">## 【2】什么是异步可迭代对象？</span><br><span class="line"></span><br><span class="line">- 可在 async for语句中被使用的对象。</span><br><span class="line">- 必须通过它的 **aiter**()方法返回一个 asynchronous iterator 。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Reader:</span><br><span class="line">    &quot;&quot;&quot; 自定义异步迭代器（同时也是异步可迭代对象） &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.count = 0</span><br><span class="line"></span><br><span class="line">    async def readline(self):</span><br><span class="line">        self.count += 1</span><br><span class="line">        if self.count == 100:</span><br><span class="line">            return None</span><br><span class="line">        return self.count</span><br><span class="line"></span><br><span class="line">    def __aiter__(self):</span><br><span class="line">        return self</span><br><span class="line"></span><br><span class="line">    async def __anext__(self):</span><br><span class="line">        val = await self.readline()</span><br><span class="line">        if val is None:</span><br><span class="line">            raise StopAsyncIteration</span><br><span class="line">        return val</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">async def fn():</span><br><span class="line">    # 创建异步可迭代对象</span><br><span class="line"></span><br><span class="line">    async_iter = Reader()</span><br><span class="line">    # async for 必须放在async def 函数内，否则语法错误。</span><br><span class="line">    async for item in async_iter:</span><br><span class="line">        print(item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">asyncio.run((fn()))</span><br></pre></td></tr></table></figure>

<h1>【六】异步上下文管理器</h1>
<ul>
<li>此种对象通过定义 <strong>aenter</strong>() 和 <strong>aexit</strong>() 方法来对 <em>async with</em> 语句中的环境进行控制。</li>
</ul>
```python
import asyncio


class AsyncContextManager:

    def __init__(self):
        self.conn = None

    async def do_something(self):
        # 异步操作数据库
        return 123

    async def __aenter__(self):
        # 异步链接数据库
        self.conn = await asyncio.sleep(1)
        return self

    async def __aexit__(self, exc_type, exc_val, exc_tb):
        # 异步关闭数据库链接
        await asyncio.sleep(1)


async def fn():
    async with AsyncContextManager() as f:
        res = await f.do_something()
        print(res)


asyncio.run(fn())
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 【七】小结</span><br><span class="line"></span><br><span class="line">- 在程序中只要看到 *async* 和 *await* 关键字</span><br><span class="line">- 其内部就是基于协程实现的异步编程</span><br><span class="line">- 这种异步编程是通过一个线程在IO等待时间去执行其他任务，从而实现并发。</span><br><span class="line"></span><br><span class="line">以上就是异步编程的常见操作，更多内容请参考 Python 官方文档：[https://docs.python.org/zh-cn/3.8/library/asyncio.html](d2dbc46621cc5538ec739f56976641e3)</span><br><span class="line"></span><br><span class="line"># 【八】小试牛刀</span><br><span class="line"></span><br><span class="line">- 需求：访问苹果官网 50 次，测试其总访问时间。</span><br><span class="line"></span><br><span class="line">## 【1】**同步版本**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def calc_visit_time(url):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    计算程序的执行时间**</span><br><span class="line">    :param url:</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    for times in range(1, 51):</span><br><span class="line">        response = requests.get(url=url)</span><br><span class="line">        if response.status_code == 200:</span><br><span class="line">            print(f&#x27;第【&#123;times&#125;】次链接成功！&#x27;)</span><br><span class="line">    else:</span><br><span class="line">        print(f&#x27;链接失败！&#x27;.center(50, &#x27;-&#x27;))</span><br><span class="line"></span><br><span class="line">    end_time = time.time()</span><br><span class="line">    print(f&#x27;任务消耗了&#123;end_time - start_time&#125;秒的时间！&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    calc_visit_time(&#x27;https://www.baidu.com&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    运行结果：</span><br><span class="line">    第【1】次链接成功！</span><br><span class="line">    第【2】次链接成功！</span><br><span class="line">    第【3】次链接成功！</span><br><span class="line">    第【4】次链接成功！</span><br><span class="line">    第【5】次链接成功！</span><br><span class="line">    ...</span><br><span class="line">    第【46】次链接成功！</span><br><span class="line">    第【47】次链接成功！</span><br><span class="line">    第【48】次链接成功！</span><br><span class="line">    第【49】次链接成功！</span><br><span class="line">    第【50】次链接成功！</span><br><span class="line">    任务消耗了5.65秒的时间！</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="【2】异步版本">【2】异步版本</h2>
```python
# 异步版本

import asyncio
import time
import aiohttp


async def fetch_async(url):
    """
    异步的aiohttp模块，替代了之前的同步的requests模块
    :param url:
    :return:
    """
    async with aiohttp.ClientSession() as session:
        # 跳过证书验证 :>>>> ssl=False
        async with session.get(url=url, ssl=False) as response:
            if response.status == 200:
                print(f'链接成功！')
            else:
                print(f'链接失败！'.center(50, '-'))
        return True


async def calc_visit_time(url):
    """
    计算程序的执行时间
    :param url:
    :return:
    """

    start_time = time.time()
    task_lis = []
    for _ in range(50):
        task_lis.append(fetch_async(url))
    await asyncio.gather(*task_lis)
    end_time = time.time()
    print(f'任务消耗了{end_time - start_time}秒的时间！')


def main():
    asyncio.run(calc_visit_time('https://www.baidu.com'))


if __name__ == '__main__':
    main()

    '''
    运行结果：
    链接成功！
    链接成功！
    链接成功！
    链接成功！
    链接成功！
    ...
    链接成功！
    链接成功！
    链接成功！
    链接成功！
    链接成功！
    任务消耗了0.31秒的时间！
    '''
```

<ul>
<li>通过上述两个实例的运行结果，我们可以看到，使用了异步之后，其效率提升18倍。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/4.0css%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/4.0css%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">4.0css基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:19:13" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>css基础</h1>
<ul>
<li>文件类型显示stylesheet，后缀为css</li>
</ul>
<h2 id="【一】什么是css">【一】什么是css</h2>
<ul>
<li>层级样式：就是给HTML标签添加样式，让它变的好看</li>
</ul>
<h2 id="【二】注释语法">【二】注释语法</h2>
```css
/*这是注释语法*/
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【三】css的语法结构</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```CSS</span><br><span class="line">选择符 &#123;</span><br><span class="line">    样式属性: 样式属性值;</span><br><span class="line">    样式属性: 样式属性值;</span><br><span class="line">    样式属性: 样式属性值, 样式属性值, 样式属性值;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>一个正常的网页css样式是非常多的就算专门开设css文件存储也很乱</li>
<li>这个时候就可以在css文件中通过注释来辅助辨别与查找</li>
</ul>
<h2 id="【四】css的三种引入方式">【四】css的三种引入方式</h2>
<h3 id="【1】style标签内部直接书写">【1】style标签内部直接书写</h3>
<ul>
<li>在head内style标签直接编写css代码</li>
</ul>
```html
    <style>
        h2{
color:black;
}
    </style>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】引入外部css文件</span><br><span class="line"></span><br><span class="line">- head内link标签引入外部css文件</span><br><span class="line">- 用link形式符合标准</span><br><span class="line">- 0.1.css是css文件夹</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```html</span><br><span class="line">&lt;!--HTML文件--&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;01.css&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;</span><br><span class="line">    这是一级标题</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="【3】行内式">【3】行内式</h3>
<ul>
<li>标签内部通过style属性直接编写</li>
<li>第三种也称之为&quot;行内式&quot;是最不推荐使用的一种方式</li>
<li>因为它会将HTML和CSS柔和到一起</li>
<li>增加了耦合度</li>
</ul>
```css
<h1 style="color:black;">id是black</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【五】基本选择器</span><br><span class="line"></span><br><span class="line">- 在CSS中，选择器用于选取HTML文档中的元素。</span><br><span class="line">- 根据选择器的类型和语法的不同，可以选择不同的元素。</span><br><span class="line">- 常用的有id选择器、类选择器、元素/标签选择器和通用选择器。</span><br><span class="line"></span><br><span class="line">### 【1】id选择器</span><br><span class="line"></span><br><span class="line">- 每个页面的id值是唯一的，所以在css中不能重复使用同一个id选择器</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    #p&#123;</span><br><span class="line">        color: blue;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 id=&quot;p&quot;&gt;蓝色&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="【2】类选择器-》class">【2】类选择器----》class</h3>
<ul>
<li>多个元素可以共享一个class</li>
</ul>
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
<style>
    #p{
        color: blue;
    }
    .h{
        color:red;
    }
</style>
</head>
<body>
<h1 id="p">id蓝色</h1>
<h1 class="h">class红色</h1>
</body>
</html>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【3】元素/标签选择器</span><br><span class="line"></span><br><span class="line">- 通过元素的标签名进行选取</span><br><span class="line">- 比如段落、列表等</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    span&#123;</span><br><span class="line">        color: royalblue;</span><br><span class="line">    &#125;</span><br><span class="line">    p&#123;</span><br><span class="line">        color: blueviolet;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;span&gt;指定颜色&lt;/span&gt;</span><br><span class="line">&lt;p&gt;指定颜色&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="【4】通用选择器">【4】通用选择器</h3>
<ul>
<li>*标识所有的元素都会改变</li>
</ul>
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
<style>
    *{
        color: chocolate;
    }
</style>
</head>
<body>
<h1>*代表全局颜色所有数据都会变颜色，除了被定义的</h1>
</body>
</html>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【5】综合</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    #p&#123;</span><br><span class="line">        color: blue;</span><br><span class="line">    &#125;</span><br><span class="line">    .h&#123;</span><br><span class="line">        color:red;</span><br><span class="line">    &#125;</span><br><span class="line">    *&#123;</span><br><span class="line">        color: chocolate;</span><br><span class="line">    &#125;</span><br><span class="line">    span&#123;</span><br><span class="line">        color: royalblue;</span><br><span class="line">    &#125;</span><br><span class="line">    p&#123;</span><br><span class="line">        color: blueviolet;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 id=&quot;p&quot;&gt;id蓝色&lt;/h1&gt;</span><br><span class="line">&lt;h1 class=&quot;h&quot;&gt;class红色&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;*代表全局颜色所有数据都会变颜色，除了被定义的&lt;/h1&gt;</span><br><span class="line">&lt;span&gt;指定颜色&lt;/span&gt;</span><br><span class="line">&lt;p&gt;指定颜色&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240605232203850.png" alt="image-20240605232203850"></p>
<h2 id="【六】关系选择器">【六】关系选择器</h2>
<table>
<thead>
<tr>
<th>选择符</th>
<th>名称</th>
<th>版本</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>E F</td>
<td>包含选择符(Descendant combinator)</td>
<td>CSS1</td>
<td>选择所有被E元素包含的F元素。</td>
</tr>
<tr>
<td>E&gt;F</td>
<td>子选择符(Child combinator)</td>
<td>CSS2</td>
<td>选择所有作为E元素的子元素F。</td>
</tr>
<tr>
<td>E+F</td>
<td>相邻选择符(Adjacent sibling combinator)</td>
<td>CSS2</td>
<td>选择紧贴在E元素之后F元素。</td>
</tr>
<tr>
<td>E~F</td>
<td>兄弟选择符(General sibling combinator)</td>
<td>CSS3</td>
<td>选择E元素所有兄弟元素F。</td>
</tr>
</tbody>
</table>
<h3 id="【1】四种">【1】四种</h3>
<ul>
<li>后代选择器</li>
<li>儿子选择器</li>
<li>毗邻选择器</li>
<li>弟弟选择器</li>
</ul>
<h3 id="【2】标签关系">【2】标签关系</h3>
```html
<div>div1
	<div>div2
		<p>p1</p>
	</div>
	<p>p2
		<span>span1</span>
	</p>
	<span>span2</span>
</div>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 通过嵌套层级来表示亲属关系 </span><br><span class="line"></span><br><span class="line">- - 1.**对于div1来说**：div2、p2、span2都是儿子</span><br><span class="line">  - 2.**对于div2、p2、span2来说**：div1就是父亲</span><br><span class="line">  - 3.**对于p1来说**：div2是父亲 div1是爷爷(可以将div1和div2统称为祖先)</span><br><span class="line">  - 4.**对于span2来说**：div2、p2是哥哥 span2是弟弟</span><br><span class="line">  - 5.div1内部所有的标签无论层级都可以称之为是div1的后代</span><br><span class="line"></span><br><span class="line">ps:判断的时候一定要看层级关系</span><br><span class="line"></span><br><span class="line">### 【3】介绍</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```css</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">    /*后代选择器*/</span><br><span class="line">    /*div标签里面所有的p标签*/</span><br><span class="line">        div p&#123;</span><br><span class="line">            color : rosybrown;</span><br><span class="line">        &#125;</span><br><span class="line">    /*儿子选择器*/</span><br><span class="line">    /*比div标签低一级的span标签*/</span><br><span class="line">    div&gt;span&#123;</span><br><span class="line">        color:red;</span><br><span class="line">    &#125;</span><br><span class="line">    /*毗邻选择器*/</span><br><span class="line">    /*于div紧挨着的span会发生改变*/</span><br><span class="line">    div + span&#123;</span><br><span class="line">        color: darkgreen;</span><br><span class="line">    &#125;</span><br><span class="line">    /*弟弟选择器*/</span><br><span class="line">    /*div下的所有p兄弟标签就会发生改变*/</span><br><span class="line">    div~p&#123;</span><br><span class="line">        color:slateblue;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="【4】案例">【4】案例</h3>
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
    /*后代选择器*/
    /*div标签里面所有的p标签*/
        div p{
            color : rosybrown;
        }
    /*儿子选择器*/
    /*比div标签低一级的span标签*/
    div>span{
        color:red;
    }
    /*毗邻选择器*/
    /*于div紧挨着的span会发生改变*/
    div + span{
        color: darkgreen;
    }
    /*弟弟选择器*/
    /*div下的所有p兄弟标签就会发生改变*/
    div~p{
        color:slateblue;
    }
    </style>
</head>
<body>
<h1>【一】组合选择器</h1>
<!--后代选择器-->
<div>div1
    <div>div2
        <p>p1</p>
    </div>
    <p>p1
        <span>span2</span>
    </p>
    <span>span1</span>
</div>
<span>div标签外的span</span>
</body>
</html>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240606151625916](D:\pycharm\Temporary_notes\图片\image-20240606151625916.png)</span><br><span class="line"></span><br><span class="line">## 【七】属性选择器</span><br><span class="line"></span><br><span class="line">### 【1】用法</span><br><span class="line"></span><br><span class="line">- 含有某个属性</span><br><span class="line">- 含有某个属性并且有某个值</span><br><span class="line">- 含有某个属性并且有某个值的某个标签</span><br><span class="line"></span><br><span class="line">| 选择符         | 版本 | 描述                                                         |</span><br><span class="line">| -------------- | ---- | ------------------------------------------------------------ |</span><br><span class="line">| E[att]         | CSS2 | 选择具有att属性的E元素。                                     |</span><br><span class="line">| E[att=&quot;val&quot;]   | CSS2 | 选择具有att属性且属性值等于val的E元素。                      |</span><br><span class="line">| E[att~=&quot;val&quot;]  | CSS2 | 选择具有att属性且属性值为一用空格分隔的字词列表，其中一个等于val的E元素。 |</span><br><span class="line">| E[att^=&quot;val&quot;]  | CSS3 | 选择具有att属性且属性值为以val开头的字符串的E元素。          |</span><br><span class="line">| E[att$=&quot;val&quot;]  | CSS3 | 选择具有att属性且属性值为以val结尾的字符串的E元素。          |</span><br><span class="line">| E[att*=&quot;val&quot;]  | CSS3 | 选择具有att属性且属性值为包含val的字符串的E元素。            |</span><br><span class="line">| E[att\|=&quot;val&quot;] | CSS2 | 选择具有att属性且属性值为以val开头并用连接符&quot;-&quot;分隔的字符串的E元素，如果属性值仅为val，也将被选择。 |</span><br><span class="line"></span><br><span class="line">### 【2】语法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```css</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">	/*直接锁定属性名字*/</span><br><span class="line">    [name]&#123;</span><br><span class="line">      color:red;</span><br><span class="line">    &#125;</span><br><span class="line">	/*属性名=属性值*/</span><br><span class="line">    [username=&quot;tom&quot;]&#123;</span><br><span class="line">      color:chartreuse;</span><br><span class="line">    &#125;</span><br><span class="line">    /*标签[属性名=属性值]*/</span><br><span class="line">    input[name=&quot;password&quot;]&#123;</span><br><span class="line">      color:darkturquoise;</span><br><span class="line">    &#125;</span><br><span class="line"> &lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="【3】案例">【3】案例</h3>
```css
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
  <style>
/*直接锁定属性名字*/
    [name]{
      color:red;
    }
/*属性名=属性值*/
    [username="tom"]{
      color:chartreuse;
    }
    /*标签[属性名=属性值]*/
    input[name="password"]{
      color:darkturquoise;
    }
    div[name="opp"]{
      color:maroon;
    }
  </style>
</head>
<body>
<!--输入input框里的数据就是红色的-->
<input type="text" name="tom">
<p username="tom">这个是tom</p>
<input type="password" name="password">
<div name="opp">这是opp</div>
</body>
</html>
```

<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240606155633995.png" alt="image-20240606155633995"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/4.0Scrapy%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/4.0Scrapy%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E5%BC%8F/" class="post-title-link" itemprop="url">4.0Scrapy创建项目的持久化保存数据的方式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:19:13" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>用Xpath解析器语法，并保存数据</h1>
<h2 id="【一】案例：博客园的文章信息">【一】案例：博客园的文章信息</h2>
<ul>
<li>爬取数据，并的到</li>
</ul>
<p>spiders/bokeyuan.py</p>
```python
import scrapy


class BokeyuanSpider(scrapy.Spider):
    # 爬虫文件的唯一标识
    # 里面写你的爬虫的文件名字
    name = "bokeyuan"
    # 允许访问的域名
    # https://www.cnblogs.com/
    allowed_domains = ["www.cnblogs.com"]
    # 起始的url列表（很重要）
    # 列表内部的url都会被框架进行异步请求发送
    start_urls = ["https://www.cnblogs.com/"]

    # 数据解析主函数：自动调用
    # 调用的次数取决于start_urls列表内元素的个数
    def parse(self, response):
        # 得到的是你爬取的博客园的页面
         # 用Xpath语法爬取数据
        article_list = response.xpath('//*[@id="post_list"]/article')
        # 创建一个管道类对象
        item = BoKeYuanItem()
        # 创建一个列表
        article_data = {}
        for article in article_list:
            
            # 拿到头像
            head_img_url = article.xpath('./section/div/p/a[1]/img/@src').extract_first()

            # 文章的作者
            article_author = article.xpath('./section/footer/a[1]/span/text()').extract_first()

            # 文章标题
            article_title = article.xpath('./section/div/a/text()').extract_first().strip()
            
            # 拿到文章内容
            article_desc = article.xpath('./section/div/p/text()').extract_first()

            # 文章更新时间
            article_update_time = article.xpath('./section/footer/span[1]/span/text()').extract_first().strip()
            # 拿到了所有的数据并保存到了字典中
            article_data[article_author] = {
                "head_img_url": head_img_url,
                "article_author": article_author,
                "article_title": article_title,
                "article_desc": article_desc,
                "article_update_time": article_update_time
            }
        # 记得返回出去
        return article_data
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【1】将上面的数据持久化保存到本地</span><br><span class="line"></span><br><span class="line">#### （1）方式一：json格式</span><br><span class="line"></span><br><span class="line">- 终端执行下面语法</span><br><span class="line">- bokeyuan：改成自己的爬虫文件名</span><br><span class="line">- bokeyuan.json：改成自己的爬虫文件名.json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```shell</span><br><span class="line">scrapy crawl bokeyuan -o bokeyuan.json</span><br></pre></td></tr></table></figure>

<ul>
<li>就会得到json格式的数据</li>
</ul>
<h4 id="（2）方式二：csv格式—》得到的是wps表格">（2）方式二：csv格式—》得到的是wps表格</h4>
<ul>
<li>在终端输入</li>
<li>bokeyuan：改成自己的爬虫文件名</li>
<li>bokeyuan.json：改成自己的爬虫文件名.csv</li>
</ul>
```shell
scrapy crawl bokeyuan -o bokeyuan.csv -t csv
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】持久化保存到数据库</span><br><span class="line"></span><br><span class="line">#### （1）我们先了解一个概念：管道：pipelines.py</span><br><span class="line"></span><br><span class="line">- process_item(self, item, spider):</span><br><span class="line">  - 管道类中必须有的函数</span><br><span class="line">  - 实现对item数据的处理</span><br><span class="line">  - 但是最后一步必须：return item</span><br><span class="line">- 爬虫开始最先走的</span><br><span class="line">  -  open_spider(self, spider): 在爬虫开启的时候仅执行一次</span><br><span class="line">- 爬虫结束时最后走的</span><br><span class="line">  - close_spider(self, spider): 在爬虫关闭的时候仅执行一次</span><br><span class="line"></span><br><span class="line">#### （2）保存数据到数据库</span><br><span class="line"></span><br><span class="line">- 我们要先创建管道类，再：items.py文件中创建</span><br><span class="line">- 这里创建的管道类里面的字段创建是根据你pipelines文件中需要的字段</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import scrapy</span><br><span class="line"></span><br><span class="line"># 创建管道类</span><br><span class="line"># 就像你再django中创建的模型表</span><br><span class="line">class BoKeYuanItem(scrapy.Item):</span><br><span class="line">    # 就像你模型表的字段</span><br><span class="line">    # 写你，需要保存的字段</span><br><span class="line">    head_img_url = scrapy.Field()</span><br><span class="line">    article_author = scrapy.Field()</span><br><span class="line">    article_title = scrapy.Field()</span><br><span class="line">    article_desc = scrapy.Field()</span><br><span class="line">    article_update_time = scrapy.Field()</span><br></pre></td></tr></table></figure>

<ul>
<li>创建好管道类之后我们需要在settings.py文件中注册这个管道类</li>
<li>每个Item在被Spider抓取后，都会被发送到Item Pipeline进行处理。Item Pipeline的主要作用包括数据清洗、验证、去重和存储等</li>
</ul>
```python
# 管道类
ITEM_PIPELINES = {
    # 项目默认的处理类，没有任何操作
   "SpiderNews.pipelines.SpidernewsPipeline": 300,
    # 自己写的注册的处理类，后面你的数字越小优先级越高，根据优先级一次执行管道处理类
   "SpiderNews.pipelines.BoKeYuanPipeline": 300,
}

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 我们需要创建好数据库，还要需要创建好我们需要的字段</span><br><span class="line">  - 字段要与你创建的管道类字段的名一样</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 我们再pipelines.py文件中，写保存数据的程序</span><br><span class="line">- 第一步我们需要创建一个爬虫开始的函数和一个爬虫结束的函数</span><br><span class="line">  - 开始：`def open_spider(self, spider):`</span><br><span class="line">    - 在这里面写你需要的初始化操作，比如连接数据库等</span><br><span class="line">  - 结束：`def close_spider(self, spider):`</span><br><span class="line">    - 走到这里的时候，就代表程序已经执行完毕，需要做一些你在执行中的关闭操作</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from pymysql.cursors import DictCursor</span><br><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line">class BoKeYuanPipeline:</span><br><span class="line">    # 爬虫程序开始时走的</span><br><span class="line">    def open_spider(self, spider):</span><br><span class="line">        # 可以做数据库的初始操作</span><br><span class="line">        print(&quot;爬虫开始撒！！初始化数据库连接&quot;)</span><br><span class="line">        # 连接数据库</span><br><span class="line">        self.conn = pymysql.connect(</span><br><span class="line">            user=&quot;root&quot;,</span><br><span class="line">            password=&quot;1234567&quot;,</span><br><span class="line">            host=&quot;127.0.0.1&quot;,</span><br><span class="line">            port=3306,</span><br><span class="line">            database=&quot;article_scrapy&quot;,</span><br><span class="line">            charset=&quot;utf8mb4&quot;,</span><br><span class="line">            cursorclass=DictCursor,</span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line">        # 创建一个cursor对象</span><br><span class="line">        self.cursor = self.conn.cursor()</span><br><span class="line">        print(&quot;爬虫开始撒！！初始化数据库连接成功&quot;)</span><br><span class="line"></span><br><span class="line">    def process_item(self, item, spider):</span><br><span class="line">        print(item)</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        :param item: 就是你的创建的每个管道字段</span><br><span class="line">        :param spider:</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # 获取数据</span><br><span class="line">        head_img_url = item.get(&quot;head_img_url&quot;)</span><br><span class="line">        head_img_url = str(head_img_url)</span><br><span class="line">        article_author = item.get(&quot;article_author&quot;)</span><br><span class="line">        article_title = item.get(&quot;article_title&quot;)</span><br><span class="line">        article_desc = item.get(&quot;article_content&quot;)</span><br><span class="line">        article_update_time = item.get(&quot;article_update_time&quot;)</span><br><span class="line">        print(head_img_url)</span><br><span class="line">        # 向数据库插入数据</span><br><span class="line">        sql = &#x27;insert into article(head_img_url,article_author,article_title,article_desc,article_update_time) values(%s,%s,%s,%s,%s)&#x27;</span><br><span class="line"></span><br><span class="line">        # 执行spl语句</span><br><span class="line">        self.cursor.execute(sql, [head_img_url, article_author, article_title, article_desc, article_update_time])</span><br><span class="line"></span><br><span class="line">        # 提交事务</span><br><span class="line">        self.conn.commit()</span><br><span class="line">        print(f&quot;当前数据&#123;article_author&#125;插入成功&quot;)</span><br><span class="line">        # 注意每次用完item记得返回出去，不然会报错</span><br><span class="line">        return item</span><br><span class="line"></span><br><span class="line">    # 爬虫程序结束时走的</span><br><span class="line">    def close_spider(self, spider):</span><br><span class="line">        # 可以将数据库，连接关闭</span><br><span class="line">        print(&quot;爬虫结束！！！关闭数据库&quot;)</span><br><span class="line">        # 关闭连接的数据库</span><br><span class="line">        self.conn.close()</span><br><span class="line">        # 关闭连接对象</span><br><span class="line">        self.cursor.close()</span><br></pre></td></tr></table></figure>

<ul>
<li>
<p>在你创建的爬虫文件中有所改变</p>
</li>
<li>
<p>需要将你创建的管道类导入进来，然后创建一个管道类对象</p>
</li>
<li>
<p>记住了，持久化保存到数据库的时候，不用return</p>
</li>
</ul>
```python
from SpiderNews.items import BoKeYuanItem
import scrapy


class BokeyuanSpider(scrapy.Spider):
    # 爬虫文件的唯一标识
    name = "bokeyuan"
    # 允许访问的域名
    # https://www.cnblogs.com/
    allowed_domains = ["www.cnblogs.com"]
    # 起始的url列表（很重要）
    # 列表内部的url都会被框架进行异步请求发送
    start_urls = ["https://www.cnblogs.com/"]

    # 数据解析主函数：自动调用
    # 调用的次数取决于start_urls列表内元素的个数
    def parse(self, response):
        # 用Xpath语法爬取数据
        article_list = response.xpath('//*[@id="post_list"]/article')
        # 创建一个管道类对象
        item = BoKeYuanItem()

        for article in article_list:
            # 拿到头像
            head_img_url = article.xpath('./section/div/p/a[1]/img/@src').extract_first()
            
            # 文章的作者
            article_author = article.xpath('./section/footer/a[1]/span/text()').extract_first()

            # 文章标题
            article_title = article.xpath('./section/div/a/text()').extract_first().strip()

            # 拿到文章内容
            article_desc = article.xpath('./section/div/p/text()').extract_first()

            # 文章更新时间
            article_update_time = article.xpath('./section/footer/span[1]/span/text()').extract_first().strip()

            # itme是一个字典-->用字典方便，可以update()更新数据，更新的时候，更新字段要和管道类里面的字段一摸一样
            item.update({
                "head_img_url": head_img_url,
                "article_author": article_author,
                "article_title": article_title,
                "article_desc": article_desc,
                "article_update_time": article_update_time
            })
            # 将itme对象返回出去
            # return 会结束整个程序，不用它
            # 我们用yield，yield可以保存item的状态，不会终止程序的执行
            yield item
```


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/4.0Mysql%E4%B9%8B%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/4.0Mysql%E4%B9%8B%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6/" class="post-title-link" itemprop="url">4.0Mysql之约束条件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:19:13" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Mysql之约束条件</h1>
<ul>
<li>前面已经学了not null和null，unique，zerofill约束条件</li>
</ul>
<h2 id="【一】什么约束条件">【一】什么约束条件</h2>
<ul>
<li>就是创建表格时，限制表中的数据，保证添加到表中的数据准确和可靠性！
<ul>
<li>不符合就会插入失败</li>
</ul>
</li>
<li>修改表的时候也可以添加约束条件</li>
</ul>
<h2 id="【二】约束条件概括">【二】约束条件概括</h2>
<ul>
<li>
<p>null ：可以为空</p>
</li>
<li>
<p>not null : 非空约束</p>
<ul>
<li>不可以为空</li>
</ul>
</li>
<li>
<p>unique ：唯一性约束</p>
<ul>
<li>插入的数据不能和表中的数据重复（数据在表中只能出现一次），否则会报错</li>
</ul>
</li>
<li>
<p>zerofill：默认用0填充至指定长度</p>
</li>
<li>
<p>primary key : 主键约束pk</p>
<ul>
<li>增加查询效率</li>
</ul>
</li>
<li>
<p>foreign key ：外键约束fk</p>
<ul>
<li>表与另一张表之间的联系</li>
</ul>
</li>
</ul>
<ol>
<li>约束条件就是为了限制表中的数据，保证数据的准确性和可靠性而存在</li>
<li>约束条件在创建表时根据需求可加可不加</li>
</ol>
<h3 id="【0】如何查看当前表的约束条件-字段限制">【0】如何查看当前表的约束条件/字段限制</h3>
<ul>
<li>给约束条件添加名字</li>
<li>查看当前所有的库</li>
</ul>
```sql
show databases;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240529185809245](D:\pycharm\Temporary_notes\图片\image-20240529185809245.png)</span><br><span class="line"></span><br><span class="line">- 进入到information_schema库中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```sql</span><br><span class="line">use information_schema;</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529185753902.png" alt="image-20240529185753902"></p>
<ul>
<li>查看所有的表</li>
</ul>
```sql
show tables;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240529185735536](D:\pycharm\Temporary_notes\图片\image-20240529185735536.png)</span><br><span class="line"></span><br><span class="line">- table_constraints 该表专门存储约束信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```sql</span><br><span class="line">desc table_constraints;</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529185925155.png" alt="image-20240529185925155"></p>
<ul>
<li>查看某个表的约束条件</li>
</ul>
```sql
select constraint_name from table_constraints where table_name='表名';
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240529190005455](D:\pycharm\Temporary_notes\图片\image-20240529190005455.png)</span><br><span class="line"></span><br><span class="line">### 【1】null</span><br><span class="line"></span><br><span class="line">- 数据可以为空</span><br><span class="line"></span><br><span class="line">### 【2】not null</span><br><span class="line"></span><br><span class="line">- 数据不能可空，必须给值</span><br><span class="line"></span><br><span class="line">### 【3】unique</span><br><span class="line"></span><br><span class="line">- 保证数据的唯一性，确保表中无相同数据</span><br><span class="line">- 但是可以为空</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```sql</span><br><span class="line">-- 把t17这个表的id改成唯一性</span><br><span class="line">-- 前提是你要创建好的有一个他t17的这个表</span><br><span class="line">alter table t17 modify id varchar(128) unique;</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529150750729.png" alt="image-20240529150750729"></p>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529150810612.png" alt="image-20240529150810612"></p>
<h3 id="【4】主键约束PK（primary-key）">【4】主键约束PK（<code>primary key</code>）</h3>
<ul>
<li>主键约束–》不能为空，而且唯一，一张表只能有一个主键约束</li>
</ul>
<h4 id="（1）主键术语">（1）主键术语</h4>
<ul>
<li>主键约束–》给表中的某个字段添加主键约束</li>
<li>主键字段–》表中的某个字段添加了主键约束</li>
<li>主键值–》主键字段出现的每个值就是主键值</li>
</ul>
<h4 id="（2）作用">（2）作用</h4>
<ul>
<li>主键约束不能为空，不能重复出现</li>
<li>'not null，unique’的效果也是不能为空，不能重复出现</li>
<li>二者本质不同，添加主键约束之后还会自动添加‘索引–index’；</li>
<li>一张表没有主键是无效的，主键是当前行的唯一标识。</li>
<li>即使两行数据相同，但是根据主键的不同，两行数据还是不同的</li>
</ul>
<h4 id="（3）主键根据个数分类">（3）主键根据个数分类</h4>
<ul>
<li>单一主键，复合主键
<ul>
<li>单一主键：给字段添加一个主键约束</li>
<li>复合主键：给多个字段联合添加一个主键约束</li>
</ul>
</li>
</ul>
<h5 id="1-单一主键：列级约束">[1]单一主键：列级约束</h5>
<ul>
<li>if exists ：有责删除，无责什么都不发生</li>
</ul>
```sql
-- 添加表之前看一下表是否已经存在
drop table if exists 表名;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line">sql</span><br><span class="line">create table user_one(</span><br><span class="line">	id int(4)  primary key,</span><br><span class="line">    name varchar(32)</span><br><span class="line">);</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240529155222721](D:\pycharm\Temporary_notes\图片\image-20240529155222721.png)</span><br><span class="line"></span><br><span class="line">##### [2]单一主键：表级约束</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line">sql</span><br><span class="line">-- 添加表之前看一下表是否已经存在</span><br><span class="line">drop table if exists 表名;</span><br><span class="line">&#123;% raw %&#125;``````sql</span><br><span class="line">create table user_one(</span><br><span class="line">	id int(11),</span><br><span class="line">    name varchar(32),</span><br><span class="line">    primary key(id)</span><br><span class="line">);</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240529160047870](D:\pycharm\Temporary_notes\图片\image-20240529160047870.png)</span><br><span class="line"></span><br><span class="line">- 给主键重命名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```sql</span><br><span class="line">create table user_one(</span><br><span class="line">	id int(11),</span><br><span class="line">    name varchar(32),</span><br><span class="line">    constraint one_user_id_pk primary key(id)</span><br><span class="line">);</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240529160258352](D:\pycharm\Temporary_notes\图片\image-20240529160258352.png)</span><br><span class="line"></span><br><span class="line">##### [3]复合主键：只能为表级约束</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```sql</span><br><span class="line">-- 添加表之前看一下表是否已经存在</span><br><span class="line">drop table if exists 表名;</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-  复合主键，表级约束，并且给其重命名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```sql</span><br><span class="line">create table user_one(</span><br><span class="line">	id int(11),</span><br><span class="line">    name varchar(32),</span><br><span class="line">    constraint one_user_id_pk primary key(id)</span><br><span class="line">);</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240529161057598](D:\pycharm\Temporary_notes\图片\image-20240529161057598.png)</span><br><span class="line"></span><br><span class="line">#### (4)主键根据性质分类</span><br><span class="line"></span><br><span class="line">- 自然主键：主键是个自然数，这个主键与业务没有任何关系</span><br><span class="line">- 业务主键：主键值与表中的业务密切相关。这种业务发生改变时，业务主键也会跟着受影响。</span><br><span class="line"></span><br><span class="line">#### (5)自动生成主键</span><br><span class="line"></span><br><span class="line">- 使用字段auto_increment</span><br><span class="line"></span><br><span class="line">- mysql数据库系统提供一个自然自增数据，专门用来生成主键值，主键值不需要用户去维护，也不需要生成，mysql自动生成</span><br><span class="line">- 默认数字从1开始，从1开始递增</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```sql</span><br><span class="line">-- 添加表之前看一下表是否已经存在</span><br><span class="line">drop table if exists 表名;</span><br></pre></td></tr></table></figure>

<p>sql<br>
create table user_one(<br>
id int(11) primary key auto_increment,<br>
name varchar(32));</p>
```



![image-20240529162317862](D:\pycharm\Temporary_notes\图片\image-20240529162317862.png)

- 插入数据



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line">sql</span><br><span class="line">insert into user_one(name) values(&#x27;tom&#x27;),(&#x27;opp&#x27;),(&#x27;dream&#x27;);</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240529162809340](D:\pycharm\Temporary_notes\图片\image-20240529162809340.png)</span><br><span class="line"></span><br><span class="line">- 每次递增的数字只会出现一次</span><br><span class="line"></span><br><span class="line">![image-20240529164029559](D:\pycharm\Temporary_notes\图片\image-20240529164029559.png)</span><br><span class="line"></span><br><span class="line">![image-20240529164047272](D:\pycharm\Temporary_notes\图片\image-20240529164047272.png)</span><br><span class="line"></span><br><span class="line">#### (6)重置主键起始位置</span><br><span class="line"></span><br><span class="line">##### [1]清空表数据</span><br><span class="line"></span><br><span class="line">- 将原来表的数据全部清空，就重置了主键的起始位置</span><br><span class="line"></span><br><span class="line">- 不建议使用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>sql<br>
trucate 表名；</p>
```



##### [2]指定主键的起始位置

- 使用表修改语句将带有 AUTO_INCREMENT 的字段数字指定为自定义位置



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line">sql</span><br><span class="line">alter table 表名 AUTO_INCREMENT = 指定主键的起始位置</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 字段数字指定为自定义位置,指定的位置就会继续递增</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>sql<br>
alter table user_one AUTO_INCREMENT = 958;</p>
```



![image-20240529164406578](D:\pycharm\Temporary_notes\图片\image-20240529164406578.png)

### 【5】外键约束FK（foreign key）

#### （1）引入

- 某个字段依赖于另一张表中某个字段的值，而被依赖的字段必须具有主键约束或者唯一约束，被依赖的数据表称为主表（父表），设置外键约束的表称为子表或者从表。

![image-20240529165441539](D:\pycharm\Temporary_notes\图片\image-20240529165441539.png)

- 上表中
- 主表就是班级表--》班级号--》主键

- 外表就是学生表--》班级号--》外键

#### （2）外键术语

- 外键约束--》给表中的某个字段添加外键约束
- 外键字段--》某个字段添加了外键约束
- 外键值--》外键字段中的每一个数据都是外键值

#### （3）外键的关系

- 一对一--》好比：人和人的信息
- 一对多--》好比：书和印刷厂
- 多对多--》好比：书和作者

#### （4）外键语句

- 先建立需要被建立关系的表，这样才能让建立关系的表去和它建立关系
- 建立一个建立关系的表



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line">sql</span><br><span class="line">create table 表名1(</span><br><span class="line">字段名1 字段类型1 约束条件1 comment 注释1,</span><br><span class="line">	字段名2 字段类型2 约束条件2 comment 注释2</span><br><span class="line">);</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 和它建立关系的表</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>sql<br>
create table 表名2(<br>
字段名1 字段类型1 约束条件1 comment 注释1,<br>
字段名2 字段类型2 约束条件2 comment 注释2,<br>
foreign key(字段2) references 表名1(字段名1)<br>
)<br>
– foreign key后面括号里面跟着的是自己的外键字段<br>
– references后面括号里面填的是被关联的表名 需要关联的外键字段</p>
```



#### （5）一对多外键关系

- 一对多：外键关系应该健在多的一方
  - 就好比：部门只有一个，但是部门有好多个员工
- 部门表先创建



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line">sql</span><br><span class="line">-- comment给字段添加注解</span><br><span class="line">create table dep(</span><br><span class="line">	id int(11) primary key auto_increment comment &#x27;编号&#x27;,</span><br><span class="line">    dep_name varchar(32) comment&#x27;部门名称&#x27;,</span><br><span class="line">    def_desc varchar(32) comment&#x27;部门描述&#x27;</span><br><span class="line">);</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240529182821276](D:\pycharm\Temporary_notes\图片\image-20240529182821276.png)</span><br><span class="line"></span><br><span class="line">- 有了部门表在创建员工表，并且要员工和部门绑定</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>sql<br>
create table emp(<br>
id int primary key auto_increment comment ‘编号’,<br>
name varchar(32) comment ‘姓名’,<br>
age int comment ‘年龄’,<br>
dep_id int comment ‘部门编号’,<br>
– dep_id:是建部门表的id<br>
– dep:是部门表的表名<br>
foreign key(dep_id) references dep(id)<br>
);</p>
```



![image-20240529182832126](D:\pycharm\Temporary_notes\图片\image-20240529182832126.png)

- 插入数据



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line">sql</span><br><span class="line">-- 向部门表中插入数据</span><br><span class="line">insert into dep(dep_name,def_desc) values(&#x27;back&#x27;,&#x27;后勤部门&#x27;);</span><br><span class="line">insert into dep(dep_name,def_desc) values(&#x27;per&#x27;,&#x27;人事部门&#x27;);</span><br><span class="line"></span><br><span class="line">-- 向员工表中插入数据</span><br><span class="line">-- 不选部门就是null</span><br><span class="line">insert into emp(name,age) values(&#x27;tom&#x27;,&#x27;22&#x27;);</span><br><span class="line"></span><br><span class="line">-- 向员工表中插入数据</span><br><span class="line">mysql&gt; insert into emp(name,age,dep_id) values(&#x27;opp&#x27;,&#x27;23&#x27;,&#x27;2&#x27;);</span><br><span class="line"></span><br><span class="line">-- 向员工表中插入数据</span><br><span class="line">-- 这条数据是错误的因为只有两个部门，没有第三个</span><br><span class="line">insert into emp(name,age,dep_id) values(&#x27;bob&#x27;,&#x27;18&#x27;,&#x27;3&#x27;);</span><br><span class="line"></span><br><span class="line">ERROR 1452 (23000): Cannot add or update a child row: a foreign key constraint fails (`day01`.`emp`, CONSTRAINT `emp_ibfk_1` FOREIGN KEY (`dep_id`) REFERENCES `dep` (`id`))</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240529184453830](D:\pycharm\Temporary_notes\图片\image-20240529184453830.png)</span><br><span class="line"></span><br><span class="line">![image-20240529184503857](D:\pycharm\Temporary_notes\图片\image-20240529184503857.png)</span><br><span class="line"></span><br><span class="line">- 级联更新`on update cascade`，级联删除`on delete cascade`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>sql<br>
create table emp1(<br>
id int primary key auto_increment comment ‘编号’,<br>
name varchar(32) comment ‘姓名’,<br>
age int comment ‘年龄’,<br>
dep_id int comment ‘部门编号’,<br>
– 建立联系<br>
foreign key(dep_id) references dep1(id)<br>
on update cascade  # 级联更新<br>
on delete cascade  # 级联删除<br>
);</p>
``````sql
create table dep1(
	id int primary key auto_increment comment '编号',
  dep_name varchar(32) comment '部门名称',
  dep_desc varchar(32) comment '部门描述'
);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （6）外键字段的约束效果</span><br><span class="line"></span><br><span class="line">- 建表时应该先创建被关联的表（没有外键字段的表）</span><br><span class="line">- 插入数据的时候 应该先插入被关联表(没有外键字段的表) </span><br><span class="line">  - 外键字段填入的值只能是被关联表中已经存在的值</span><br><span class="line">- 修改、删除被关联表数据都会出现障碍</span><br><span class="line"></span><br><span class="line">#### （7）多对多关系</span><br><span class="line"></span><br><span class="line">- 好比书和作者</span><br><span class="line">  - 书有好几个作者</span><br><span class="line">  - 作者发出好多本书</span><br><span class="line"></span><br><span class="line">- 多对多无法判断谁先创建谁后创建</span><br><span class="line">- 需要借助第三张表专门建立关系</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```sql</span><br><span class="line">create table book(</span><br><span class="line">  id int primary key auto_increment,</span><br><span class="line">  title varchar(32),</span><br><span class="line">  price float(10,2)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table author(</span><br><span class="line">  id int primary key auto_increment,</span><br><span class="line">  name varchar(32),</span><br><span class="line">  gender enum(&#x27;male&#x27;,&#x27;female&#x27;,&#x27;others&#x27;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529193101402.png" alt="image-20240529193101402"></p>
<ul>
<li>建立第三张表来储存它们的关系</li>
</ul>
```sql
create table book2author(
  id int primary key auto_increment,
  author_id int,
  book_id int,
  foreign key(author_id) references author(id) 
  on update cascade   
  on delete cascade,  
  foreign key(book_id) references book(id) 
  on update cascade  
  on delete cascade  
);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240529193112192](D:\pycharm\Temporary_notes\图片\image-20240529193112192.png)</span><br><span class="line"></span><br><span class="line">- 两张表内的数据没有在第三张表内绑定关系的情况下随意新增修改和删除</span><br><span class="line"></span><br><span class="line">#### （8）一对一关系</span><br><span class="line"></span><br><span class="line">- 一对一关系外键字段在任意一方都可以，推荐在查询率较高的一方</span><br><span class="line"></span><br><span class="line">### 【补充】</span><br><span class="line"></span><br><span class="line">- 外键根据个数分类</span><br><span class="line">  - 单一外键【给一个字段添加外键约束】</span><br><span class="line">  - 复合外键【给多个字段联合添加成一个外键约束】</span><br><span class="line"></span><br><span class="line">- 一张表可以有多个外键字段</span><br><span class="line">- 外键字段可以为null</span><br><span class="line">- 外键字段引用一张表的某个字段时，被引用的字段必须具有unique约束</span><br><span class="line">- 有了外键引用之后，表分为父表和子表。一对多关系中，一为父表，多为子表。创建表时，先创建父表，再创建子表；插入数据时先插入父表中的数据，再插入子表中的数据；**删除数据时，需先删除子表的数据，再删除父表的数据**</span><br><span class="line"></span><br><span class="line">- 外键约束没有列级约束，只有标记约束</span><br><span class="line"></span><br><span class="line">## 【三】级联更新和级联删除</span><br><span class="line"></span><br><span class="line">- 什么是级联更新</span><br><span class="line">  - 当主表中的某条记录的值发生改变时，从表中的相应记录的值也会自动发生相应的变化，保持数据的一致性。</span><br><span class="line">- 什么是级联删除</span><br><span class="line">  - 当主表中的某条记录被删除时，从表中的相应记录也会自动被删除，确保了当主关键字段中相应的记录被删除时，会自动删除相关表中对应的记录，从而保持数据的一致性和完整性。</span><br><span class="line"></span><br><span class="line">### 【1】介绍</span><br><span class="line"></span><br><span class="line">- 添加级联更新和级联删除时需要在外键约束后面添加</span><br><span class="line">- 在删除父表中的数据时，级联删除子表中的数据 on delete cascade</span><br><span class="line">- 在更新父表中的数据时，级联更新子表中的数据 on update cascade</span><br><span class="line">- 以上的级联更新和级联删除谨慎使用，因为级联操作会将数据改变或删除【数据无价】</span><br><span class="line">- 在修改约束条件时，建议可以将原先的约束删除再重新添加约束条件</span><br><span class="line"></span><br><span class="line"># 【作业】</span><br><span class="line"></span><br><span class="line">![image-20240529204705803](D:\pycharm\Temporary_notes\图片\image-20240529204705803.png)</span><br><span class="line"></span><br><span class="line">- 基于上面的信息做一个数据库下面的多张表</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```sql</span><br><span class="line">-- 按照你理想中的方式进行分表</span><br><span class="line">-- 所有信息都放在一张表中 ，合理但是有病</span><br><span class="line">-- 按照自己的想法和思路将上述所有信息进行分表  </span><br><span class="line"></span><br><span class="line">-- 在自己的表的基础上进行插入数据</span><br><span class="line"></span><br><span class="line">-- 你的建表语句 ---&gt; 字段及字段类型的创建</span><br><span class="line"></span><br><span class="line">-- 你的数据插入语句</span><br></pre></td></tr></table></figure>

```sql


 create table class(id int primary key auto_increment,class_id int(11) not null,class varchar(32) not null);
 
  create table student(
    ->     id int primary key auto_increment,
    ->     name varchar(32) not null,
    ->     class_id int,
    ->     foreign key (class_id) references class(id)
    ->     on delete cascade
    ->     on update cascade
    -> );
    
    
insert into class(class_id,class) values(100,'北京市101中学高三一班');
insert into class(class_id,class) values(101,'北京市101中学高三二班');
insert into class(class_id,class) values(102,'北京市101中学高三三班');


insert into student(name,class_id) values('tom',1);
insert into student(name,class_id) values('opp',2);
insert into student(name,class_id) values('dream',2);
```

<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240531083035591.png" alt="image-20240531083035591"></p>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240531083106308.png" alt="image-20240531083106308"><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240531083135792.png" alt="image-20240531083135792"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/4.0vue%E9%AB%98%E7%BA%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/4.0vue%E9%AB%98%E7%BA%A7/" class="post-title-link" itemprop="url">4.0vue高级</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:19:13" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>【一】ref属性</h1>
```python
# ref也可以做组件间的通信
# ref是vue提供的属性，可以放在任意标签或组件上
	- 如果放在标签上
    	-通过  this.$refs.标签上的名字   拿到的值是 标签 对象
        -我们可以通过标签对象，修改 标签的属性。。。src属性，value属性
        
     - 如果放在组件上
    	-通过  this.$refs.标签上的名字   拿到的值是 组件 对象
        -我们可以通过 组件对象，直接修改对象中得数据，直接调用对象中得方法
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【1】使用</span><br><span class="line"></span><br><span class="line">### （1）放在普通标签上</span><br><span class="line"></span><br><span class="line">- 使用`this.$refs.ref对应的值`，就可以得到这个标签对象</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;````vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;h1&gt;ref的使用&lt;/h1&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;img :src=&quot;img&quot; ref=&quot;my_img&quot; style=&quot;height: 200px;width: 200px&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; ref=&quot;my_input&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;button @click=&quot;handleSon&quot;&gt;点击看控制台&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name:&#x27;one&#x27;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      // 这里他会检测不到这是个路径，需要一个方法require</span><br><span class="line">      img:require(&#x27;../assets/img/1.png&#x27;),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    handleSon()&#123;</span><br><span class="line">      // 获得img标签</span><br><span class="line">      console.log(this.$refs.my_img);</span><br><span class="line">      // 可以获得img的属性值</span><br><span class="line">      console.log(this.$refs.my_img.src);</span><br><span class="line">      // 还可以属性值</span><br><span class="line">      this.$refs.my_img.src=require(&#x27;../assets/logo.png&#x27;)</span><br><span class="line">      // 赋值</span><br><span class="line">      this.$refs.my_input.value=&#x27;xxxx&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line">````</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【2】ref属性之父传子</span><br><span class="line"></span><br><span class="line">- 父传子是自定义属性</span><br><span class="line"></span><br><span class="line">- 父组件：`HOMEView.vue`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">&lt;h1&gt;首页&lt;/h1&gt;</span><br><span class="line">    &lt;one :msg=&quot;my_data&quot;&gt;&lt;/one&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import one from &#x27;@/components/one&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HomeView&#x27;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      my_data:&#x27;father&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components:&#123;</span><br><span class="line">    one</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>子组件：<code>one.vue</code></li>
</ul>
````vue
<template>
<div>
  <h1>ref的使用</h1>
  <div>
    <img :src="img" ref="my_img" style="height: 200px;width: 200px">
  </div>
  <!--  使用父亲传过来的值  -->
  <h2>{{msg}}</h2>
</div>
</template>

<script>
export default {
  name:'one',
  data(){
    return{
      // 这里他会检测不到这是个路径，需要一个方法require
      img:require('../assets/img/1.png'),
    }
  },
  props:["msg"]

}
</script>

<style scoped>

</style>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">【3】ref属性之子传父</span><br><span class="line"></span><br><span class="line">- 子传父是自定义事件：子的东西传给父亲，子里面肯定要有东西触发，在可以传给父</span><br><span class="line">- 子传父：子组件中用到了，事件：`this.$emit(&quot;自定义事件名&quot;,传给父组件的值)`，父组件要接受这个值</span><br><span class="line"></span><br><span class="line">- 父组件：`HOMEView.vue`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">&lt;h1&gt;首页&lt;/h1&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;one  :msg=&quot;my_data&quot; @son=&quot;my_father&quot;&gt;&lt;/one&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;h1&gt;&#123;&#123;res&#125;&#125;&lt;/h1&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import one from &#x27;@/components/one&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HomeView&#x27;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      my_data:&#x27;father&#x27;,</span><br><span class="line">      res:&#x27;&#x27;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    // 这里接受到子传过来的username</span><br><span class="line">    my_father(username)&#123;</span><br><span class="line">      this.res=username</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components:&#123;</span><br><span class="line">    one</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 子组件：`one.vue`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;````vue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;h1&gt;ref的使用&lt;/h1&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;img :src=&quot;img&quot; ref=&quot;my_img&quot; style=&quot;height: 200px;width: 200px&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;!--  使用父亲传过来的值  --&gt;</span><br><span class="line">  &lt;h2&gt;&#123;&#123;msg&#125;&#125;&lt;/h2&gt;</span><br><span class="line">&lt;!--  子传父--&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; v-model=&quot;username&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;button @click=&quot;handleSon&quot;&gt;子传父&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name:&#x27;one&#x27;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      // 这里他会检测不到这是个路径，需要一个方法require</span><br><span class="line">      img:require(&#x27;../assets/img/1.png&#x27;),</span><br><span class="line">     username:&#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    handleSon()&#123;</span><br><span class="line">      // 子传父</span><br><span class="line">      this.$emit(&quot;son&quot;,this.username)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  props:[&quot;msg&quot;]</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="【补充】-父子通信的方式">【补充】 父子通信的方式</h2>
````python
# 子组件中拿到父组件对象
this.$parent

# 父子通信的方式
# 1 自定义属性
# 2 自定义事件
# 3 通过ref属性:this.$refs
# 4 子组件中通过 this.$parent
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 【二】props</span><br><span class="line"></span><br><span class="line">- 功能：让组件接收外部传过来的数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># props配置项是：子传父，自定义属性的时候用来接收父组件传给子组件的属性的，对应一个数组</span><br><span class="line"># 方法一：</span><br><span class="line">props=[&#x27;msg&#x27;]</span><br><span class="line"># 方法二</span><br><span class="line">	- 这个意思是尽量的接收String类型的数据，会报错，但是不影响操作</span><br><span class="line">props: &#123;myname: String&#125;,</span><br><span class="line"># 方法三</span><br><span class="line">props: &#123;</span><br><span class="line">    myname: &#123;</span><br><span class="line">        type: String, //类型</span><br><span class="line">        required: true, //必要性</span><br><span class="line">        default: &#x27;老王&#x27; //默认值</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 【三】混入`（mixin）`</span><br><span class="line"></span><br><span class="line">- 前言（js文件）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 混入的意思是：抽取公共的代码</span><br><span class="line">	- 多个组件都在用的方法和属性，抽出来，做成公共的</span><br><span class="line">    - 那个组件用，使用mixin引入即可</span><br><span class="line"># 有两种方式：我们可以叫做，局部使用和全局使用</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 使用</span><br><span class="line">- 公共的组件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;````js</span><br><span class="line">export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            username: &#x27;王一博&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleName(name) &#123;</span><br><span class="line">            this.username = name</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在其他组件中<code>局部</code>使用</li>
</ul>
```vue
<script>
// 可以使用多个
import m1 from '../mixin'
export default {
  name: 'HomeView',
    // 一定要写
  data(){
    return{
    }
  },
    //一定要写
  methods:{
  },
  mixins:[m1]
}
</script>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 全局使用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 全局使用 定义在main.js</span><br><span class="line">import m1 from &#x27;@/mixin&#x27;</span><br><span class="line">import m2 from &#x27;@/mixin2&#x27;</span><br><span class="line">Vue.mixin(m1)</span><br><span class="line">Vue.mixin(m2)</span><br></pre></td></tr></table></figure>

<h1>【四】插件</h1>
<ul>
<li>前言</li>
</ul>
```python
# 插件的功能就是增强vue

													# 插件使用者的意思就是：使用插件的时候串的值
    												Vue.user(ElementUI,'lsk')
# 本质就是：包含install方法的一个对象，install的第一个参数是Vue，第二个以后的参数是插件使用者传递的数据

# 我们使用了：vue-router插件，vuex插件，elementui插件
	- 有了这些插件，我们就可以使用：
    this.$router
    this.$store
    # 弹框
    this.$alert
    this.$message

# 使用别人写好的插件：
	- 首先记得引入
    import ElementUI from 'element-ui';
	Vue.user(ElementUI)

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 使用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 存放到原型类中:prototype</span><br><span class="line">	- 注册</span><br><span class="line">    import m1 from &#x27;@/mixin&#x27;</span><br><span class="line">    import aaa from &#x27;./pulgin&#x27;</span><br><span class="line">    Vue.use(aaa)</span><br><span class="line">	- 插件</span><br><span class="line">    export default &#123;</span><br><span class="line">    install(Vue)&#123;</span><br><span class="line">        console.log(Vue)</span><br><span class="line">        // prototype原型类：就好比，你放在了一个最底层的代码中，别人用的时候他没有，就会往下		查，就会查到你定制进去的</span><br><span class="line">        // $age：名字随便定义，但是必须带$</span><br><span class="line">        Vue.prototype.$age=&#x27;xxx&#x27;</span><br><span class="line">        // 你也可以将axios存放到原型类中</span><br><span class="line">        Vue.prototype.$ajax=&#x27;axios&#x27;</span><br><span class="line">        // 你也可以添加路由</span><br><span class="line">        Vue.prototype.$BASE_URL=&#x27;http://192.168.1.69:8080/&#x27;</span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    - 在其他组件中使用</span><br><span class="line">    methods:&#123;</span><br><span class="line">    handleName()&#123;</span><br><span class="line">      // 就可以直接使用</span><br><span class="line">      // 就会渲染上去</span><br><span class="line">      this.age=this.$age</span><br><span class="line">       // 你发送axios请求，就可以这样</span><br><span class="line">       this.$ajax.get(this.$BASE_URL+&#x27;/login&#x27;).then()</span><br><span class="line">        # 使用混入，这样我们就不用在main.js里面写了</span><br><span class="line">        Vue.mixin(m1)</span><br><span class="line">        </span><br><span class="line">        #自定义指令---》可能会有第三方插件，在项目中使用后，会有没见过的指令</span><br><span class="line">//定义全局指令：跟v-model一样，获取焦点</span><br><span class="line">        Vue.directive(&quot;fbind&quot;, &#123;</span><br><span class="line">            //指令与元素成功绑定时（一上来）</span><br><span class="line">            bind(element, binding) &#123;</span><br><span class="line">                element.value = binding.value;</span><br><span class="line">            &#125;,</span><br><span class="line">            //指令所在元素被插入页面时</span><br><span class="line">            inserted(element, binding) &#123;</span><br><span class="line">                element.focus();</span><br><span class="line">            &#125;,</span><br><span class="line">            //指令所在的模板被重新解析时</span><br><span class="line">            update(element, binding) &#123;</span><br><span class="line">                element.value = binding.value;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">        # 定义全局组件</span><br><span class="line">		- 好比elementui---》全局组件   &lt;el-button&gt;</span><br><span class="line">        - vue-router----&gt;全局组件   &lt;router-view/&gt;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">        </span><br><span class="line"># 在main.js中使用，可以传参数</span><br><span class="line"># 1 使用自定义插件</span><br><span class="line">import my from &#x27;@/plugins&#x27;</span><br><span class="line">Vue.use(my,&#x27;lsk&#x27;) // 内部本质会执行install</span><br><span class="line">	- 你一旦传了参数</span><br><span class="line">   export default &#123;</span><br><span class="line">    install(Vue,a)&#123;</span><br><span class="line">        console.log(a) # 就是lsk</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 咱们需要掌握的;</span><br><span class="line">	-有些第三方插件，用了以后，增强了vue功能</span><br><span class="line">    -this.$router</span><br><span class="line">    -全局组件 ：el-button</span><br><span class="line">    -this.$message---&gt;</span><br><span class="line">    -this.$http.get</span><br></pre></td></tr></table></figure>

<h1>【五】插槽</h1>
<ul>
<li>前言</li>
</ul>
```python
# 让父组件可以向子组件指定位置插入html结构，也是一种组件间通信的方式，适用于 父组件 ===> 子组件
# 在小组件中使用：solt来显示你传的html结构的标签
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 使用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;````vue</span><br><span class="line">##########自定义的小组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;hello&quot;&gt;</span><br><span class="line">    &lt;slot name=&#x27;one&#x27;&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;h1&gt;小组件HelloWorld&lt;/h1&gt;</span><br><span class="line">    &lt;slot name=&#x27;two&#x27;&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HelloWorld&#x27;,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">############使用</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;about&quot;&gt;</span><br><span class="line">    &lt;h1&gt;About组件&lt;/h1&gt;</span><br><span class="line">    &lt;HelloWorld&gt;</span><br><span class="line">        &lt;!-- 在小组件中使用：solt，就会显示这张图片。这个你可以看作是传给小组件的图片，但是必须放在小组件中 --&gt;</span><br><span class="line">      &lt;div name=&#x27;one&#x27;&gt;</span><br><span class="line">          &lt;img src=&quot;https://ts1.cn.mm.bing.net/th/id/R-C.987f582c510be58755c4933cda68d525?rik=C0D21hJDYvXosw&amp;riu=http%3a%2f%2fimg.pconline.com.cn%2fimages%2fupload%2fupc%2ftx%2fwallpaper%2f1305%2f16%2fc4%2f20990657_1368686545122.jpg&amp;ehk=netN2qzcCVS4ALUQfDOwxAwFcy41oxC%2b0xTFvOYy5ds%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0&quot; alt=&quot;&quot; style=&quot;height: 400px;width: 400px&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div name=&#x27;two&#x27;&gt;</span><br><span class="line">   lllll</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/HelloWorld&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import HelloWorld from &quot;@/components/HelloWorld.vue&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  template:&#x27;AboutView&#x27;,</span><br><span class="line">  components:&#123;</span><br><span class="line">    HelloWorld</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">````</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 【六】vuex</span><br><span class="line"></span><br><span class="line">- 前言</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># vuex是一个第三方插件：它叫状态管理器：统一位置管理变量---》也能实现组件间通信：页面刷新，会重置</span><br><span class="line">- vue：vuex</span><br><span class="line">- vue3：vuex，也有pina：用的多</span><br><span class="line"></span><br><span class="line"># 使用vuex---》vuex的新版本支持vue3</span><br><span class="line">	-我们在创建项目时候，已经装了</span><br><span class="line">        -项目依赖有了</span><br><span class="line">            -项目中有个 store文件夹--&gt;index.js</span><br><span class="line">            -main.js 中，引入且使用了</span><br><span class="line">    </span><br><span class="line">    - 在创建项目时，没装</span><br><span class="line">    	-我们要安装：</span><br><span class="line">        - 指定版本 cnpm install vuex@3.6.2 -S---&gt;S是安装到你这个项目中，不加S的话，就是全局，别人用的时候，就会没有</span><br><span class="line">        - 在项目中新建 store包--》index.js文件</span><br><span class="line">        - 在index.js中写入代码</span><br><span class="line">        	import Vue from &#x27;vue&#x27;</span><br><span class="line">            import Vuex from &#x27;vuex&#x27;</span><br><span class="line">            Vue.use(Vuex)</span><br><span class="line">            export default new Vuex.Store(&#123;</span><br><span class="line">                state: &#123;</span><br><span class="line">                    # 放变量</span><br><span class="line">                &#125;,</span><br><span class="line">                mutations: &#123;</span><br><span class="line">                    # 提交，修改就会触发（commit）</span><br><span class="line">                &#125;,</span><br><span class="line">                actions: &#123;</span><br><span class="line">                    # 调度就会触发（dispatch）</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">        - 在main.js中使用</span><br><span class="line">        	- 先引入</span><br><span class="line">            	- import store from &#x27;./store&#x27;</span><br><span class="line">            - 使用</span><br><span class="line">            	new Vue(&#123;</span><br><span class="line">                    store,</span><br><span class="line">                    render: h =&gt; h(App)</span><br><span class="line">                &#125;).$mount(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用</li>
</ul>
````vue
#####在组件中使用
<template>
  <div>
<h1>首页</h1>
<h2>我们在state文件中的vuex插件中的count：{{$store.state.count}}</h2>
    <button @click="handleCount">点击加1</button>

  </div>
</template>

<script>
export default {
  name: 'HomeView',
  methods:{
    handleCount(){
      // 方式一
      // 我们之间进行加1--->这样写不太安全
      // this.$store.state.count++
      // 方式二
      // 我们先通知dispatch在通知commit,进行一系列操作
      // dataAdd你定义在actions里面的方法
      this.$store.dispatch('dataAdd')
      //  this.$store.commit('dataAdd')
    }
  }
}
</script>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- vuex插件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;````js</span><br><span class="line">##############在store/index.js中代码</span><br><span class="line"></span><br><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import Vuex from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line">export default new Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    count:0</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    // 这里面做加1</span><br><span class="line">    // 定义一个函数，随便起名字</span><br><span class="line">    // 这里回传一个变量</span><br><span class="line">    add(two)&#123;</span><br><span class="line">      two.count+=1</span><br><span class="line">    &#125;</span><br><span class="line">    // 也可以在这里进行判断</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    // 定义一个函数，随便起名字</span><br><span class="line">    // 这里回传一个变量</span><br><span class="line">    dataAdd(one)&#123;</span><br><span class="line">      // 通知mutations里面的对象add加1</span><br><span class="line">      // one.commit(&#x27;add&#x27;)</span><br><span class="line"></span><br><span class="line">      // 我们还可以进行判断</span><br><span class="line">      // one也可以拿到count</span><br><span class="line">      if (one.state.count &gt;=5)&#123;</span><br><span class="line">        alert(&quot;太大了&quot;)</span><br><span class="line">      &#125;else&#123;</span><br><span class="line">          // 通知mutations里面的对象add加1</span><br><span class="line">          one.commit(&#x27;add&#x27;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="【1】重点">【1】重点</h2>
```python
# 为什么经过 actions和mutations 
	- 可以跟后端交互，可以做数据验证
#  getters
	- 可以通过getters获取数据--》对state中的数据，再做处理
    $store.getters.里面的方法
# modules
	- 分到不同模块中，不同模块有自己的state，actions
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240814104538278](D:\pycharm\Temporary_notes\图片\image-20240814104538278.png)</span><br><span class="line"></span><br><span class="line"># 【七】本地储存</span><br><span class="line"></span><br><span class="line">- 前言</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 1 能存储数据的位置，登录成功---》token存储</span><br><span class="line">	vuex: 页面重新加载--》数据会恢复</span><br><span class="line">    # 过期时间</span><br><span class="line">	cookie：登录信息放这里，有过期时间，一旦过期，就没了</span><br><span class="line">    # 会话储存</span><br><span class="line">    sessionStorage：当前浏览器生效---》关闭浏览器，数据就没了</span><br><span class="line">    # 本地储存</span><br><span class="line">    localStorage：永久生效，除非代码删除或清空浏览器缓存</span><br><span class="line">    	-未登录，加购物车</span><br><span class="line">        </span><br><span class="line">#2 vue中操作cookie 需要下载 vue-cookies</span><br><span class="line">cnpm install vue-cookies -S</span><br></pre></td></tr></table></figure>

<ul>
<li>使用</li>
</ul>
```vue
<template>
  <div>
    <h1>首页</h1>

    <h2>localStorage</h2>
    <button @click="handleSaveLocalStorage">存储到localStorage</button>
    <button @click="handleGetLocalStorage">从localStorage取出</button>
    <button @click="handleDeleteLocalStorage">删除localStorage</button>

    <h2>sessionStorage使用</h2>
    <button @click="handleSavesessionStorage">存储到sessionStorage</button>
    <button @click="handleGetsessionStorage">从sessionStorage取出</button>
    <button @click="handleDeletesessionStorage">删除sessionStorage</button>
    <h2>cookie使用</h2>
    <button @click="handleSaveCookie">存储到cookie</button>
    <button @click="handleGetCookie">从cookie取出</button>
    <button @click="handleDeleteCookie">删除cookie</button>

  </div>
</template>

<script>
export default {
  name: 'HomeView',
  methods: {
    // 存储到localStorage中
    handleSaveLocalStorage() {
      localStorage.setItem("name", 'lqz')
      let user = {
        name: 'xxx',
        age: 19
      }
      localStorage.setItem("user", JSON.stringify(user)) // 不要放对象

    },
    handleGetLocalStorage() {
      let name = localStorage.getItem("name")
      let user = localStorage.getItem('user')
      console.log(name)
      console.log(user)
      console.log(typeof user)

    },
    handleDeleteLocalStorage() {
      // 只会删除name
      // localStorage.removeItem('name')
      // 删除所有
      localStorage.clear()

    },

    // 存储到sessionStorage中
    handleSavesessionStorage() {
      sessionStorage.setItem("name", '彭于晏')
    },
    handleGetsessionStorage() {
      let name = sessionStorage.getItem('name')
      console.log(name)
    },
    handleDeletesessionStorage() {
      sessionStorage.removeItem('name')
      // sessionStorage.clear()
    },

    // 存储到cookies中
    // 必须下载 cnpm i vue-cookies -S
    // 我们必须在main.js中引入
    //import cookies from 'vue-cookies'
    // 放在原型里
    // Vue.prototype.$cookie = cookies;
    handleSaveCookie() {
      // 过期时间可以写1d，1h，1m
      this.$cookies.set('name', 'zzzz', '100s')
    },
    handleGetCookie() {
      let name = this.$cookies.get('name')
      console.log(name)
    },
    handleDeleteCookie() {
      this.$cookies.remove('name')
      // 不可以删除所有，只可以指定
      // this.$cookies.clear()
    },
  }
}
</script>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 【八】`vue-router`</span><br><span class="line"></span><br><span class="line">## 【1】router插件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 1 如果我们创建项目时，已经安装了</span><br><span class="line">	-router--》index.js</span><br><span class="line">    -main.js 引入了</span><br><span class="line">    -后期在组件中使用：</span><br><span class="line">    	-js中：</span><br><span class="line">            this.$router # 用来跳转路径</span><br><span class="line">            this.$route   # 目前没学</span><br><span class="line">        -template中：</span><br><span class="line">        	&lt;router-view/&gt;  # 当访问某个路径时，会把页面组件替换到这</span><br><span class="line">            &lt;router-link&gt;&lt;/router-link&gt;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"># 2 创建项目没有安装，自行引入</span><br><span class="line">	- 安装：cnpm install vue-router -S</span><br><span class="line">	-创建文件夹router---index.js</span><br><span class="line">    -index.js写代码</span><br><span class="line">    import Vue from &#x27;vue&#x27;</span><br><span class="line">    import VueRouter from &#x27;vue-router&#x27;</span><br><span class="line">    import HomeView from &quot;@/views/HomeView&quot;;</span><br><span class="line">    Vue.use(VueRouter)</span><br><span class="line">    const routes = [</span><br><span class="line">        &#123;</span><br><span class="line">            path: &#x27;/&#x27;,</span><br><span class="line">            name: &#x27;home&#x27;,</span><br><span class="line">            component: HomeView</span><br><span class="line">        &#125;,</span><br><span class="line">    ]</span><br><span class="line">    const router = new VueRouter(&#123;</span><br><span class="line">        mode: &#x27;history&#x27;,</span><br><span class="line">        base: process.env.BASE_URL,</span><br><span class="line">        routes</span><br><span class="line">    &#125;)</span><br><span class="line">    export default router</span><br><span class="line">    </span><br><span class="line">	-main.js中使用</span><br><span class="line">        import router from &#x27;./router&#x27;</span><br><span class="line">        new Vue(&#123;</span><br><span class="line">            router,</span><br><span class="line">            render: h =&gt; h(App)</span><br><span class="line">        &#125;).$mount(&#x27;#app&#x27;)</span><br><span class="line">        </span><br><span class="line">     -后续所有组件中</span><br><span class="line">	    -js中：</span><br><span class="line">            this.$router # 跳转路径</span><br><span class="line">            this.$route   # 目前没学</span><br><span class="line">        -template中：</span><br><span class="line">        	&lt;router-view/&gt;  # 当访问某个路径时，会把页面组件替换到这</span><br><span class="line">            &lt;router-link&gt;&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>

<h2 id="【2】路由跳转">【2】路由跳转</h2>
````python
# 1 之前学过，在App.vue中放 
  <div id="app">
    <router-view/>
  </div>

# 2 在router---index.js中--》注册路径-->routes
    const routes = [
            {
                path: '/',
                name: 'home',
                component: HomeView
            },

        ]
 
# 3 以后访问某个路径，就会显示页面组件

#4 重点：页面跳转两种方式
	## 4.1 js跳转
       # 1 传路径
        // http://192.168.1.69:8080/about/
      // this.$router.push('/about')
      # 2 传对象
        // http://192.168.1.69:8080/
        // 这个name：就是你注册的时候的别名
      // this.$router.push({'name': 'about'})
    	// path：就是你访问的路由
      // this.$router.push({'path': '/about'})

      # 3 携带参数跳转
        // 系带参数访问
      // this.$router.push('/about?name=lqz&age=19')
    	// 传对象，携带参数
      // this.$router.push({'name': 'about',query:{name:'zhangsan',age:19}})
    	// 传对象，携带参数
      this.$router.push({'path': '/about',query:{name:'zhangsan',age:19}})
    
    	# 4 template中跳转：使用：router-link组件
        <router-link to="/about">
           <button>点我跳转到about页面-router-link</button>
        </router-link>
		// 使用：router-link组件，传入对象的格式，携带的参数放在query中
        <router-link :to="{name:'about',query:{name:'xxx'}}">
           <button>点我跳转到about页面-router-link</button>
        </router-link>

#5 重点 上个页面跳转时，携带数据(查询参数)---》下一个页面中取出来
	-在下一个页面中写：AboutView.vue
    -写在created中
    created(){
        # 比如你传的是id
        this.book_id=this.$route.query['book_id']
        #this.book_id=this.$route.query.book_id
        #console.log(this.$router) // VueRouter 的对象
        #console.log(this.$route)  // 当前路由对象
    }
    
# 6 重点 上个页面跳转时，携带数据(查询参数)---》下一个页面中取出来》》》转换器
	6.1 路由写法变了
    	 {
            path: '/:pk/lqz',
            name: 'lqz',
            component: LQZView
        },
   6.2 传递数据
		-js：
    		this.$router.push("/99/lqz")
        	this.$router.push({name:'lqz',params:{pk:666}})
    	-router-link:
          <router-link to="/99/lqz">
    	  <router-link :to="{name:'lqz',params:{pk:666}}">
            
  6.3 另一个页面获取数据
	this.$route.params.pk
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【3】相关`API--》router方法`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">1 指的是：this.$router---&gt;方法</span><br><span class="line">2 常用的</span><br><span class="line">this.$router.push(path): 相当于点击路由链接(可以返回到当前路由界面)</span><br><span class="line">this.$router.replace(path): 用新路由替换当前路由(不可以返回到当前路由界面)</span><br><span class="line">this.$router.back(): 请求(返回)上一个记录路由</span><br><span class="line">this.$router.go(-1): 请求(返回)上一个记录路由</span><br><span class="line">this.$router.go(1): 请求下一个记录路由</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【4】多级路由</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 就是可以分很多层的路由</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```js</span><br><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import VueRouter from &#x27;vue-router&#x27;</span><br><span class="line"></span><br><span class="line">import HomeView from &quot;@/views/HomeView&quot;;</span><br><span class="line">import AboutView from &quot;@/views/AboutView&quot;;</span><br><span class="line">import LQZView from &quot;@/views/LQZView&quot;;</span><br><span class="line">import MulRouterView from &quot;@/views/MulRouterView&quot;;</span><br><span class="line">import IndexView from &quot;../../src_昨日/views/pages/IndexView&quot;;</span><br><span class="line">import OrderView from &quot;../../src_昨日/views/pages/OrderView&quot;;</span><br><span class="line">import GoodsView from &quot;../../src_昨日/views/pages/GoodsView&quot;;</span><br><span class="line">Vue.use(VueRouter,)</span><br><span class="line"></span><br><span class="line">const routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        path: &#x27;/&#x27;,</span><br><span class="line">        name: &#x27;home&#x27;,</span><br><span class="line">        component: HomeView</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: &#x27;/mul&#x27;,</span><br><span class="line">        name: &#x27;mul&#x27;,</span><br><span class="line">        component: MulRouterView,</span><br><span class="line">        children: [ //通过children配置子级路由</span><br><span class="line">            &#123;</span><br><span class="line">                path: &#x27;&#x27;, //此处一定不要写：/news</span><br><span class="line">                name:&#x27;index&#x27;,</span><br><span class="line">                component: IndexView</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                path: &#x27;order&#x27;,</span><br><span class="line">                name:&#x27;order&#x27;,</span><br><span class="line">                component: OrderView</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                path: &#x27;goods&#x27;,</span><br><span class="line">                component: GoodsView</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">const router = new VueRouter(&#123;</span><br><span class="line">    mode: &#x27;history&#x27;,</span><br><span class="line">    base: process.env.BASE_URL,</span><br><span class="line">    routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default router</span><br><span class="line"></span><br><span class="line">MulRouterView.vue</span><br><span class="line">    pages</span><br><span class="line">    GoodsView.vue</span><br><span class="line">    IndexView.vue</span><br><span class="line">    OrderView.vue</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- **MulRouterView.vue**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div style=&quot;height: 80px;background-color: pink&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;el-container&gt;</span><br><span class="line">      &lt;el-aside width=&quot;200px&quot;&gt;</span><br><span class="line">        &lt;div style=&quot;background-color:greenyellow;height:700px &quot;&gt;</span><br><span class="line">           &lt;!-- 多级路由--&gt; </span><br><span class="line">          &lt;p&gt;&lt;router-link to=&quot;/mul&quot;&gt;首页&lt;/router-link&gt;&lt;/p&gt;</span><br><span class="line">            &lt;!-- 多级路由---也可以指定别名--&gt; </span><br><span class="line">          &lt;p&gt;&lt;router-link :to=&quot;&#123;name:&#x27;order&#x27;&#125;&quot;&gt;订单&lt;/router-link&gt;&lt;/p&gt;</span><br><span class="line">            &lt;!-- 多级路由---直接锁定根路由--&gt; </span><br><span class="line">          &lt;p&gt;&lt;router-link to=&quot;/mul/goods&quot;&gt;商品&lt;/router-link&gt;&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/el-aside&gt;</span><br><span class="line">      &lt;el-container&gt;</span><br><span class="line">        &lt;el-header&gt;</span><br><span class="line">          &lt;div style=&quot;background-color:rebeccapurple&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/el-header&gt;</span><br><span class="line">        &lt;el-main&gt;</span><br><span class="line">          &lt;div style=&quot;height:500px;background-color: aqua&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-main&gt;</span><br><span class="line">        &lt;el-footer&gt;</span><br><span class="line">          &lt;div style=&quot;background-color: pink;height:50px&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/el-footer&gt;</span><br><span class="line">      &lt;/el-container&gt;</span><br><span class="line">    &lt;/el-container&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;MulRouterView&quot;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**pages-- GoodsView.vue**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;商品&lt;/h1&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;GoodsView&quot;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**pages-- IndexView.vue**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;h1&gt;后台首页&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;IndexView&quot;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**pages--OrderView.vue**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;h1&gt;订单&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;OrderView&quot;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【5】路由守护</span><br><span class="line"></span><br><span class="line">- 前言</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 路由守护：就是字面的意思，守护路由</span><br><span class="line"># 就比如：你需要登才可以访问的页面</span><br><span class="line"></span><br><span class="line"># 守护路由：全局守护，独享守护，组件内守护</span><br><span class="line"># 我们用到的最多的就是全局守护</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 使用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```js</span><br><span class="line">//////// router/index.js</span><br><span class="line"></span><br><span class="line">// 配置全局的路由守卫</span><br><span class="line">router.beforeEach((to, from, next) =&gt; &#123;</span><br><span class="line">    // to:要去的路由的对象，from:来自那个路由的对象，next：跳转到那个路径</span><br><span class="line">    // 要去的路径，如果不是登入路径和/根路径，要判断有没有登入，登录的token存入到localStorage中</span><br><span class="line">    // 这里的name就是你路由中的别名，path就是你路由中的真正路由地址</span><br><span class="line">    if (to.name == &#x27;login&#x27; || to.path == &#x27;/&#x27;) &#123;</span><br><span class="line">        // 直接跳转</span><br><span class="line">        next()</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        // 判断有没有登录,取token</span><br><span class="line">        let token = localStorage.getItem(&#x27;token&#x27;)</span><br><span class="line">        // 在进行判断token</span><br><span class="line">        if (token)&#123;</span><br><span class="line">            // 存在直接跳转</span><br><span class="line">            next()</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            // 使用Message需要导入Element</span><br><span class="line">            // 这是一个好看的弹框</span><br><span class="line">            Element.Message.error(&#x27;请先登录！！&#x27;)</span><br><span class="line">            // 跳转到等于页面</span><br><span class="line">            next(&#123;name:&#x27;login&#x27;&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【6】路由的两种工作模式</span><br><span class="line"></span><br><span class="line">-  Hash模式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;````js</span><br><span class="line">// URL 示例: http://192.168.1.69:8080/#/login</span><br><span class="line">//  特点: 使用 URL 的 hash (#) 部分来表示路由。浏览器不会发送 hash 部分到服务器，所以页面刷新时不会向服务器发起请求。</span><br><span class="line"></span><br><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import VueRouter from &#x27;vue-router&#x27;</span><br><span class="line">import HomeView from &#x27;../views/HomeView.vue&#x27;</span><br><span class="line">import Element from &#x27;element-ui&#x27;</span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line">// 路由配置</span><br><span class="line">const routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        path: &#x27;/&#x27;,</span><br><span class="line">        name: &#x27;home&#x27;,</span><br><span class="line">        component: HomeView</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">const router = new VueRouter(&#123;</span><br><span class="line">    mode: &#x27;hash&#x27;,   // 使用 hash 模式</span><br><span class="line">    base: process.env.BASE_URL, // 基础路径</span><br><span class="line">    routes // 路由配置</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 配置全局的路由守卫</span><br><span class="line">router.beforeEach((to, from, next) =&gt; &#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default router</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>History 模式</strong>:</li>
</ul>
```js
// URL 示例: http://192.168.1.69:8080/login

// 特点: 使用 HTML5 History API 来管理 URL，使 URL 看起来更干净和自然。需要服务器支持，通常需配置服务器以处理所有请求并返回应用的入口 HTML 文件。

// 配置方式:
import Vue from 'vue'
import VueRouter from 'vue-router'
import HomeView from '../views/HomeView.vue'
import Element from 'element-ui'

Vue.use(VueRouter)

// 路由配置
const routes = [
    {
        path: '/',
        name: 'home',
        component: HomeView
    },
]

const router = new VueRouter({
    mode: 'history',   // 使用 history 模式
    base: process.env.BASE_URL, // 基础路径
    routes // 路由配置
})

// 配置全局的路由守卫
router.beforeEach((to, from, next) => {
    ....
})

export default router
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 总结</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;````python</span><br><span class="line">选择哪一个：</span><br><span class="line"></span><br><span class="line">如果你希望 URL 更加干净和现代，并且可以配置服务器来支持此模式，则选择 history 模式。</span><br><span class="line">如果你需要兼容旧浏览器或无法配置服务器，则选择 hash 模式。</span><br><span class="line">````</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 【九】scoped样式</span><br><span class="line"></span><br><span class="line"> &#123;% raw %&#125;```python</span><br><span class="line"> # 作用：让样式在局部生效，防止冲突。</span><br><span class="line"> # 写法：&lt;style scoped&gt;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/4.0%E4%BB%80%E4%B9%88%E6%98%AF%E8%A3%85%E9%A5%B0%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/4.0%E4%BB%80%E4%B9%88%E6%98%AF%E8%A3%85%E9%A5%B0%E5%99%A8/" class="post-title-link" itemprop="url">4.0什么是装饰器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:19:13" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>【一】什么是装饰器</h1>
<ul>
<li><code>装饰</code> <strong>代指为被装饰对象添加新的功能</strong>，<code>器</code> 代指器具/<strong>工具</strong>，装饰器与被装饰的对象均可以是任意可调用对象。</li>
<li>概括地讲，装饰器的作用就是<strong>在不修改被装饰对象源代码和调用方式的前提下为被装饰对象添加额外的功能。</strong></li>
<li>装饰器经常用于有切面需求的场景
<ul>
<li>插入日志、性能测试、事务处理、缓存、权限校验等应用场景</li>
<li>装饰器是解决这类问题的绝佳设计</li>
<li>有了装饰器，就可以抽离出大量与函数功能本身无关的雷同代码并继续重用。</li>
</ul>
</li>
</ul>
<blockquote>
<p>提示：可调用对象有函数，方法或者类，此处我们单以本章主题函数为例，来介绍函数装饰器，并且被装饰的对象也是函数。</p>
</blockquote>
<h2 id="【1】装饰器的用途">【1】装饰器的用途</h2>
<ul>
<li>对上线后的程序进行新功能的添加和修改</li>
<li>给一个功能添加新的需求或者改变原来程序的运行逻辑</li>
</ul>
<h2 id="【2】装饰器的分类">【2】装饰器的分类</h2>
<ul>
<li>被分为
<ul>
<li>有参函数</li>
<li>无参函数</li>
</ul>
</li>
</ul>
<h2 id="【3】装饰器的原理">【3】装饰器的原理</h2>
<ul>
<li>闭包函数+函数对象的组合使用</li>
</ul>
<h1>【二】无参装饰器</h1>
<h2 id="【1】什么是无参装饰器">【1】什么是无参装饰器</h2>
<ul>
<li>无参就是没有参数</li>
<li>就是没有参数的装饰器</li>
</ul>
<h2 id="【2】推到装饰器的语法">【2】推到装饰器的语法</h2>
<ul>
<li>例子：要为一段代码增加计时功能</li>
</ul>
<h3 id="（1）面条版">（1）面条版</h3>
<ul>
<li>import：进口 / 输入</li>
<li>time:时间</li>
<li>.sleep（）:睡眠</li>
</ul>
```python
import time
# 记录程序运行起始时间
start_time = time.time()
# 程序运行主代码逻辑
print(f"我开始睡觉了 .... ")
time.sleep(2)
print(f"我结束睡觉了 .... ")
# 记录程序运行结束时间
end_time = time.time()
# 总结总耗时
print(f"当前程序总耗时 :>>>>  {end_time - start_time} s")

#输出
# 我开始睡觉了 .... 
# 我结束睡觉了 .... 
# 当前程序总耗时 :>>>>  2.004431962966919 s
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### （2）函数版</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import time</span><br><span class="line">#起始时间，变量名随便定start：开始</span><br><span class="line">sleep_start = time.time()</span><br><span class="line">print(&quot;我开始睡觉了！&quot;)</span><br><span class="line">#固定语法.sleep()睡觉</span><br><span class="line">time.sleep(2)</span><br><span class="line">print(&quot;我结束睡觉了&quot;)</span><br><span class="line">#time.time固定语法时间</span><br><span class="line">sleep_edd = time.time()</span><br><span class="line">print(f&quot;&#123;sleep_edd-sleep_start&#125;&quot;)#2.0138323307037354</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="C:%5CUsers%5C86177%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240416153527672.png" alt="image-20240416153527672"></p>
<h3 id="3-闭包函数">(3)闭包函数</h3>
```python
import time

def show():
    # 程序运行主代码逻辑
    print(f"我开始睡觉了 .... ")
    time.sleep(2)
    print(f"我结束睡觉了 .... ")
    
    
def show_show():
    # 程序运行主代码逻辑
    print(f"我开始睡觉了 .... ")
    time.sleep(1)
    print(f"我结束睡觉了 .... ")
    

def outer(func):
    # func = show_show
    def inner():
        func()
        print(func)

    return inner

# 本质
#运行第一个
inner = outer(show)
# 但是函数的返回值可以重新命名
#运行第二个
show_show = outer(show_show)
#共同用这个执行
show_show()
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【3】装饰器的推导</span><br><span class="line"></span><br><span class="line">### （1）需求</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 定义一个用户数据字典</span><br><span class="line"># 校验当前用户名和密码是否正确，如果正确则打印登录成功并取款</span><br><span class="line"># 要求 调用还是 withdral() </span><br><span class="line"># 但是会先验证用户名和密码</span><br></pre></td></tr></table></figure>

<ul>
<li>闭包函数-增加校验逻辑</li>
</ul>
```python
def user_psw_add(func):
    def user_psw():
        username = input("username:----").strip()
        password = input("password:----").strip()
        if username == "tom" and password == "710":
            func()
            print("cg")


        else:
            print("sb")
    #一定要对着闭包函数
    return user_psw

#存款函数
def transfer():
    print("Transfer")
#这里的func等于transfer
transfer = user_psw_add(transfer)
#传入实参
transfer()
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 普通版本-修改源代码</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">dict_data = &#123;&quot;username&quot;: &quot;tom&quot;, &quot;password&quot;: &quot;710&quot;&#125;</span><br><span class="line"></span><br><span class="line">def user_psw():</span><br><span class="line">    username_input = input(&quot;username:----&quot;).strip()</span><br><span class="line">    password_input = input(&quot;password:----&quot;).strip()</span><br><span class="line">    if username_input == dict_data.get(&quot;username&quot;) and password_input == dict_data.get(&quot;password&quot;):</span><br><span class="line">        print(&quot;登入成功！&quot;)</span><br><span class="line">        print(&quot;转账成功！&quot;)</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;登入失败！&quot;)</span><br><span class="line">user_psw()</span><br></pre></td></tr></table></figure>

<h2 id="【4】无参装饰器的模版">【4】无参装饰器的模版</h2>
```python
# 无参装饰器的模板
def outer(func):
    ''' 
    :param func: 每一次需要调用传递的函数
    :return:返回值是内嵌函数 inner 的函数内存地址 
    '''
    def inner():
        # 可以加逻辑校验
        # 当符合指定条件后，可以允许执行传递进来的函数
        # 不符合条件的时候不执行函数
        func()
        # 做逻辑校验，func 函数执行后的逻辑

    return inner
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 【三】有参装饰器</span><br><span class="line"></span><br><span class="line">## 【1】无参装饰器</span><br><span class="line"></span><br><span class="line">- 无参装饰器无法传递参数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 无参装饰器无法传递参数</span><br><span class="line">def outer(func):</span><br><span class="line">    def inner():</span><br><span class="line">        func()</span><br><span class="line"></span><br><span class="line">    return inner</span><br><span class="line"></span><br><span class="line">#无法传递参数，报错</span><br><span class="line">def transform(username, money):</span><br><span class="line">    print(f&quot;向 &#123;username&#125; 转账 &#123;money&#125;&quot;)</span><br><span class="line">#这里outer(transform)是outer(func)</span><br><span class="line">transform = outer(transform)</span><br><span class="line">transform() # 报错</span><br></pre></td></tr></table></figure>

<h3 id="（1）有参装饰器">（1）有参装饰器</h3>
<ul>
<li>根据指定的位置参数传递参数</li>
</ul>
```python
def outer(func):
    def inner(username, money):
        func(username, money)

    return inner


def transform(username, money):
    print(f"向 {username} 转账 {money}")
username = 'opp'
money= 10000
transform = outer(transform)
transform(username,money)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### （2）有参装饰器的优化</span><br><span class="line"></span><br><span class="line">- 用可变长位置参数和可变长关键字参数接收函数所需要的所有参数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">def outer(func):</span><br><span class="line">    def inner(*ages, **kwargs):</span><br><span class="line">        func(*ages, **kwargs)</span><br><span class="line"></span><br><span class="line">    return inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def transform(username, money):</span><br><span class="line">    print(f&quot;向 &#123;username&#125; 转账 &#123;money&#125;&quot;)</span><br><span class="line"></span><br><span class="line">#这里outer(transform)=outer(func)，inner接收</span><br><span class="line">transform = outer(transform)</span><br><span class="line">transform(&quot;tom&quot;,10000)</span><br></pre></td></tr></table></figure>

<h3 id="（3）有参数装饰器模版">（3）有参数装饰器模版</h3>
```python
#无参模版
def outer(func):
    def inner():
        func()

    return inner

#有参模版
def outer_yes(func):
    def inner(*args, **kwargs):
        func(*args, **kwargs)
    return inner
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 【四】装饰器语法糖</span><br><span class="line"></span><br><span class="line">- **装饰器谁在上面就先校验谁**</span><br><span class="line"></span><br><span class="line">## 【1】无参装饰器语法糖</span><br><span class="line"></span><br><span class="line">- @标志</span><br><span class="line"></span><br><span class="line">### （1）没有语法糖的时候</span><br><span class="line"></span><br><span class="line">- import意思:输入，引入</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def timer(func):</span><br><span class="line">    def inner():</span><br><span class="line">        start = time.time()</span><br><span class="line">        func()</span><br><span class="line">        end = time.time()</span><br><span class="line">        print(f&quot;总耗时 :&gt;&gt;&gt;&gt; &#123;end - start&#125; s&quot;)</span><br><span class="line"></span><br><span class="line">    return inner</span><br><span class="line"></span><br><span class="line">#相当于把这个函数调到上面函数里面去了</span><br><span class="line">def transform():</span><br><span class="line">    time.sleep(1)</span><br><span class="line">#这里 timer(transform)=timer(func)</span><br><span class="line">transform = timer(transform)</span><br><span class="line">transform()</span><br></pre></td></tr></table></figure>

<h3 id="（2）有糖语法的时候">（2）有糖语法的时候</h3>
```python
def timer(func):
    def inner():
        start = time.time()
        func()
        end = time.time()
        print(f"总耗时 :>>>> {end - start} s")

    return inner

#@函数名
@timer # 等同于transform=timer(transform)
def transform():
    time.sleep(1)
transform()
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【2】有参装饰器语法糖</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">def timer(func):</span><br><span class="line">    def inner(*args,**kwargs):</span><br><span class="line">        start = time.time()</span><br><span class="line">        func(*args,**kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        print(f&quot;总耗时 :&gt;&gt;&gt;&gt; &#123;end - start&#125; s&quot;)</span><br><span class="line"></span><br><span class="line">    return inner</span><br><span class="line">@timer</span><br><span class="line">def transform(username,money):</span><br><span class="line">    print(f&quot;&#123;username&#125; | &#123;money&#125;&quot;)</span><br><span class="line">    time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">transform(&quot;dream&quot;,188)</span><br></pre></td></tr></table></figure>

<h2 id="【3】有参语法糖">【3】有参语法糖</h2>
<h3 id="（1）单语法糖">（1）单语法糖</h3>
```python
login_dict = {'username': 'dream'}


def login_auth(func):
    def inner(*args, **kwargs):
        if login_dict.get('username'):
            func(*args, **kwargs)
        else:
            print(f"请先登录!")

    return inner


def timer(func):
    def inner(*args, **kwargs):
        start = time.time()
        func(*args, **kwargs)
        end = time.time()
        print(f"总耗时 :>>>> {end - start} s")

    return inner

#只能使用一种装饰器
@login_auth
def transform(username, money):
    print(f"{username} | {money}")
    time.sleep(1)


# transform = timer(transform)
# transform()
# 现在只能使用一种装饰器并且在装饰器中不能切换
transform("dream", 188)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### （2）多语法糖</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">login_dict = &#123;&#x27;username&#x27;: None&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def decrator(tag):</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">    :param tag: &#x27;login_auth&#x27; ---&gt; 登录认证装饰器</span><br><span class="line">    &#x27;timer&#x27; ---&gt; 返回 计时装饰器</span><br><span class="line">    :return:</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    if tag == &quot;login_auth&quot;:</span><br><span class="line">        def login_auth(func):</span><br><span class="line">            def inner(*args, **kwargs):</span><br><span class="line">                if login_dict.get(&#x27;username&#x27;):</span><br><span class="line">                    func(*args, **kwargs)</span><br><span class="line">                else:</span><br><span class="line">                    print(f&quot;请先登录!&quot;)</span><br><span class="line">            return inner</span><br><span class="line">        return login_auth</span><br><span class="line">    elif tag == &quot;timer&quot;:</span><br><span class="line">        def timer(func):</span><br><span class="line">            def inner(*args, **kwargs):</span><br><span class="line">                start = time.time()</span><br><span class="line">                func(*args, **kwargs)</span><br><span class="line">                end = time.time()</span><br><span class="line">                print(f&quot;总耗时 :&gt;&gt;&gt;&gt; &#123;end - start&#125; s&quot;)</span><br><span class="line"></span><br><span class="line">            return inner</span><br><span class="line"></span><br><span class="line">        return timer</span><br><span class="line">    else:</span><br><span class="line">        print(f&quot;无参数的&quot;,tag)</span><br><span class="line"></span><br><span class="line"># @decrator(tag=&#x27;login_auth&#x27;)</span><br><span class="line">@decrator(tag=&#x27;timer&#x27;)</span><br><span class="line">def transform(username, money):</span><br><span class="line">    print(f&quot;&#123;username&#125; | &#123;money&#125;&quot;)</span><br><span class="line">    time.sleep(1)</span><br><span class="line"></span><br><span class="line">transform(&quot;dream&quot;,999)</span><br></pre></td></tr></table></figure>

<h2 id="【4】多层语法糖案例">【4】多层语法糖案例</h2>
<h3 id="（1）不使用语法糖">（1）不使用语法糖</h3>
```python
def dec_a(func):
    # 【二】调用 dec_a 函数触发
    print('111')

    def wrapper(*args, **kw):
        # 【三】执行 main_func()
        print('222')
        func(*args, **kw)  # b_wrapper(main_func)
        # 【七】结束上面的 b_wrapper 回来
        print('333')

    return wrapper


def dec_b(func):
    # 【一】进来 dec_b 函数
    print('aaa')

    def wrapper(*args, **kw):
        # 【四】因为在 dec_a 的 wrapper 里面调用了 func --> 就是我自己
        print('bbb')
        func(*args, **kw)  # main_func
        # 【六】执行完 main_func 又回来继续走
        print('ccc')

    return wrapper


@dec_a
@dec_b # 多层语法糖的时候谁在下先调用谁，但是执行校验的时候是谁在上先校验谁
def main_func():
    # 【五】回到真正的 main_func
    print('main_func')

'''
# 定义顺序是一个个挨着定义
# 调用顺序是倒着谁在下先调用谁
main_func = dec_b(main_func)
# main_func = b_wrapper (main_func)
main_func = dec_a(main_func)
# main_func = a_wrapper (b_wrapper(main_func))
main_func()
# a_wrapper

# aaa
# 111
# 222
# bbb
# main_func
# ccc
# 333
'''

main_func()


# 指定结果打印顺序
```


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/4.0requests%E6%A8%A1%E5%9D%97%E4%B9%8B%E5%93%8D%E5%BA%94%E4%BD%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/4.0requests%E6%A8%A1%E5%9D%97%E4%B9%8B%E5%93%8D%E5%BA%94%E4%BD%93/" class="post-title-link" itemprop="url">4.0requests模块之响应体</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:19:13" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>requests模块之响应体</h1>
<h2 id="【一】响应体数据格式转换">【一】响应体数据格式转换</h2>
<ul>
<li>
<p><code>requests.text</code>–&gt;会将响应源代码转化为 文本类型的数据格式</p>
</li>
<li>
<p><code>requests.content</code>–&gt;会将响应源代码转换为字节类型的数据格式 （图片、视频、压缩包等）</p>
</li>
<li>
<p><code>requests.json()</code>–&gt;会将响应源代码转换为json类型的数据格式</p>
</li>
</ul>
<h3 id="【1】requests-text">【1】<code>requests.text</code></h3>
<ul>
<li>将响应体转换为字符串形式。</li>
</ul>
```python
import requests

response = requests.get('https://pic.netbian.com/uploads/allimg/240322/232300-171112098057a5.jpg')

# 获取到文本数据
data = response.text
print(data, type(data)) # <class 'str'>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】`requests.content`</span><br><span class="line"></span><br><span class="line">- 获取响应体的二进制内容，适用于处理图像、视频等非文本类型的响应。（默认是16进制）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">response = requests.get(&#x27;https://pic.netbian.com/uploads/allimg/240322/232300-171112098057a5.jpg&#x27;)</span><br><span class="line"># 获取到图片的二进制数据</span><br><span class="line">data = response.content</span><br><span class="line">print(data, type(data)) # &lt;class &#x27;bytes&#x27;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="【3】requests-encoding">【3】<code>requests.encoding</code></h3>
<ul>
<li>获取响应的编码方式</li>
</ul>
```python
import requests

response = requests.get('https://www.baidu.com/')
# 获取到图片的二进制数据
data = response.encoding
print(data, type(data)) # ISO-8859-1 <class 'str'>
# 查看到当前页面的默认编码格式为 ISO-8859-1
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【4】`response.status_code`</span><br><span class="line"></span><br><span class="line">-  获取响应状态码</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">response = requests.get(&#x27;https://www.baidu.com/&#x27;)</span><br><span class="line"></span><br><span class="line"># `response.status_code`: 获取响应的状态码。</span><br><span class="line">print(response.status_code)</span><br><span class="line"># 200</span><br></pre></td></tr></table></figure>

<h3 id="【5】requests-headers">【5】<code>requests.headers</code></h3>
<ul>
<li>获取响应头信息，返回一个字典对象</li>
</ul>
```python
import requests
response = requests.get("https://www.baidu.com/")
headers = response.headers
print(headers)
# {'Cache-Control': 'private, no-cache, no-store, proxy-revalidate, no-transform', 'Connection': 'keep-alive', 'Content-Encoding': 'gzip', 'Content-Type': 'text/html', 'Date': 'Tue, 16 Jul 2024 11:59:18 GMT', 'Last-Modified': 'Mon, 23 Jan 2017 13:23:55 GMT', 'Pragma': 'no-cache', 'Server': 'bfe/1.0.8.18', 'Set-Cookie': 'BDORZ=27315; max-age=86400; domain=.baidu.com; path=/', 'Transfer-Encoding': 'chunked'}
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【6】响应Cookie</span><br><span class="line"></span><br><span class="line">- response.cookies: 获取服务器返回的cookie信息。</span><br><span class="line">- response.cookies.get_dict(): 将cookie信息转换为字典形式。</span><br><span class="line">- response.cookies.items(): 获取cookie信息并以列表形式返回</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import requests</span><br><span class="line">response = requests.get(&quot;https://www.baidu.com/&quot;)</span><br><span class="line"># 获取服务器返回的cookie信息</span><br><span class="line">cookie = response.cookies</span><br><span class="line">print(cookie)</span><br><span class="line"># &lt;RequestsCookieJar[&lt;Cookie BDORZ=27315 for .baidu.com/&gt;]&gt;</span><br><span class="line"></span><br><span class="line"># 将cookie信息转换为字典形式</span><br><span class="line">cookie_dict = response.cookies.get_dict()</span><br><span class="line">print(cookie_dict)</span><br><span class="line"># &#123;&#x27;BDORZ&#x27;: &#x27;27315&#x27;&#125;</span><br><span class="line"></span><br><span class="line"># 获取cookie信息并以列表形式返回</span><br><span class="line">cookie_items = response.cookies.items()</span><br><span class="line">print(cookie_items)</span><br><span class="line"># [(&#x27;BDORZ&#x27;, &#x27;27315&#x27;)]</span><br></pre></td></tr></table></figure>

<h3 id="【7】当前请求-响应对象的URL">【7】当前请求/响应对象的URL</h3>
<ul>
<li>
<p>response.url: 获取当前响应的URL。</p>
</li>
<li>
<ul>
<li>这是在完成HTTP请求并接收到服务器响应后，实际返回的资源URL。</li>
<li>在重定向发生时，这个属性会反映最终页面的实际URL。</li>
<li>例如，如果你发起一个请求到某个网站A，但该网站随后重定向到了网站B，那么response.url将显示网站B的URL。</li>
</ul>
</li>
<li>
<p>response.request.url: 获取当前请求的URL。</p>
</li>
<li>
<ul>
<li>这是发送HTTP请求时使用的原始URL，即你在发出请求时指定的URL。</li>
<li>无论是否发生重定向，这个属性始终保持不变。</li>
<li>也就是说，它反映了你最初尝试访问的地址。</li>
</ul>
</li>
<li>
<p>总结来说</p>
</li>
<li>
<ul>
<li>没有重定向</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>两者通常是一致的。</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>有重定向</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>response.url 是重定向后的最终URL</li>
<li>response.request.url 则是最初的请求UR</li>
</ul>
</li>
</ul>
</li>
</ul>
```python
import requests

response = requests.get("https://www.baidu.com/")
# `response.url`: 获取当前请求的URL。
url = response.url
print(url)
# https://www.baidu.com/
requests_url = response.request.url
print(requests_url)
# https://www.baidu.com/
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【8】当前请求的重定向URL</span><br><span class="line"></span><br><span class="line">- `response.history`：如果有重定向，返回一个列表，包含所有经过的重定向URL</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">response = requests.get(&quot;https://www.baidu.com/&quot;)</span><br><span class="line"># `response.history`: 如果有重定向，返回一个列表，包含所有经过的重定向URL。</span><br><span class="line">history = response.history</span><br><span class="line">print(history)</span><br><span class="line"># []</span><br></pre></td></tr></table></figure>

<h3 id="【9】迭代获取二进制数据">【9】迭代获取二进制数据</h3>
<ul>
<li><code>response.iter_content()</code>：迭代获取响应内容（适用于处理视频、图片等二进制数据）</li>
</ul>
```python
import requests

tag_url = "https://pic.netbian.com/uploads/allimg/240322/232300-171112098057a5.jpg"

response = requests.get(tag_url)

# 打开本地的文件路径，二进制必须要用wb写
file_path = "01.jpg"
with open(file_path, 'wb') as fp:
    # 循环获取响应数据中的二进制数据，每次只获取 1024 个字节
    for chunk in response.iter_content(chunk_size=1024):
        # 如果存在数据，则进行文件数据的写入
        if chunk:
            fp.write(chunk)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【二】解析json数据</span><br><span class="line"></span><br><span class="line">- 要解析 JSON 数据，可以使用 requests 模块的 json() 方法。</span><br><span class="line">- 该方法将响应内容解析为 JSON 格式，并返回一个 Python 字典对象。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"># 定义目标地址</span><br><span class="line">tag_url = &quot;https://jsonplaceholder.typicode.com/users&quot;</span><br><span class="line"></span><br><span class="line"># 发送请求，获取响应数据</span><br><span class="line">response = requests.get(tag_url)</span><br><span class="line"></span><br><span class="line"># 获取文本类型的响应数据</span><br><span class="line">page_text = response.text</span><br><span class="line"></span><br><span class="line"># 打印响应内容的数据类型</span><br><span class="line">print(type(page_text))</span><br><span class="line"></span><br><span class="line"># 打印原始响应内容</span><br><span class="line">print(page_text)</span><br><span class="line"></span><br><span class="line"># 将响应内容解析为 JSON 格式</span><br><span class="line">data = response.json()</span><br><span class="line"></span><br><span class="line"># 打印响应内容的数据类型</span><br><span class="line">print(type(data))</span><br><span class="line"></span><br><span class="line"># 打印解析后的 JSON 数据</span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure>

<h2 id="【三】SSL认证">【三】SSL认证</h2>
<h3 id="【1】什么是SSL认证">【1】什么是SSL认证</h3>
<ul>
<li>有些网站没有设置好 HTTPS <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%AF%81%E4%B9%A6&amp;spm=1001.2101.3001.7020">证书</a>，或者 HTTPS 证书不被 CA 机构认可，这些网站就会出现 SSL 证书错误提示。</li>
<li>在 requests 模块中进行 SSL 认证时，可以通过 verify 参数来控制是否验证服务器的 SSL 证书。</li>
<li>默认情况下，verify 参数被设置为 True，表示会验证 SSL 证书。</li>
<li>当 verify 设置为布尔值 False 时，会忽略证书验证，但会引发警告。</li>
</ul>
<p>HTTPS请求中 HTTP + SSL 证书</p>
<p>HTTP请求是不需要认真的直接就能访问 都会提示 此网站不安全</p>
<h3 id="【2】认证证书">【2】认证证书</h3>
```python
import requests
url = "https://ssr2.scrape.center/"
response = requests.get(url)
status_code = response.status_code
print(status_code)
# 报错：certificate verify failed
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【3】不认证证书</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &#x27;https://ssr2.scrape.center/&#x27;</span><br><span class="line">response = requests.get(url, verify=False)</span><br><span class="line">print(response.status_code)</span><br><span class="line"># 200</span><br></pre></td></tr></table></figure>

<ul>
<li>报出 InsecureRequestWarning 警告，但得到了请求成功的状态码</li>
</ul>
<h3 id="【4】自定义证书路径">【4】自定义证书路径</h3>
```python
import requests
url = 'https://ssr2.scrape.center/'
# 自定义认证路径
cert_file = "/path/to/my_certificate.pem"
response = requests.get(url,verify=cert_file)
print(response.status_code)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 在上述代码中，将 verify 参数设置为自定义证书文件的路径。requests 将使用指定的证书进行验证。</span><br><span class="line">- 请注意，在实际使用中，如果从未提供过自定义证书，并且要禁用验证，则最好提供证书路径。这样可以避免不必要的错误和警告</span><br><span class="line"></span><br><span class="line">## 【四】使用代理</span><br><span class="line"></span><br><span class="line">### 【1】为什么要使用代理</span><br><span class="line"></span><br><span class="line">- 在网络爬虫和数据抓取的过程中，我们经常需要发送HTTP请求来获取网页内容或与远程服务器进行通信。</span><br><span class="line">- 然而，在某些情况下，直接发送请求可能会受到限制或被阻止，这时就需要借助代理来完成任务。</span><br><span class="line">- 代理在网络通信中起到中间人的作用，它代表我们与目标服务器建立连接并传递请求和响应。</span><br><span class="line">- 通过使用代理，我们可以隐藏真实的IP地址、绕过访问限制，并增加请求的匿名性。</span><br><span class="line">- Python中的requests库提供了便捷且强大的功能来处理HTTP请求，并且支持代理的配置。</span><br><span class="line"></span><br><span class="line">说人话：</span><br><span class="line"></span><br><span class="line">- 一般网站都有屏蔽的限制策略，用自己的IP去爬，被封了那该网站就访问不了，这时候就得用代理IP来解决问题了。</span><br><span class="line">- 封吧，反正封的不是本机IP，封的代理IP</span><br><span class="line"></span><br><span class="line">### 【2】代理配置方法</span><br><span class="line"></span><br><span class="line">- 在使用Python中的requests库发送HTTP请求时，我们可以通过以下几种方法来配置代理。</span><br><span class="line">- 这些方法允许我们灵活地选择适合你需求的代理设置</span><br><span class="line"></span><br><span class="line">#### （1）使用proxies参数设置全局代理</span><br><span class="line"></span><br><span class="line">- requests库提供了一个名为proxies的参数，通过它可以设置全局代理。</span><br><span class="line">- 我们可以将代理配置作为一个字典传递给该参数，字典的键是代理类型（如&#x27;http&#x27;、&#x27;https&#x27;等），值是代理的地址和端口号。</span><br><span class="line">- proxies参数语法格式：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">proxies=&#123;&quot;协议&quot;:&quot;协议://IP:端口号&quot;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>示例</li>
</ul>
```python
import requests

proxies = {
    "http": "http://127.0.0.1:1080",
}
target_url = "https://www.baidu.com"
response = requests.get(
    url=target_url,
    # 携带代理ip，如果代理IP 不生效那就会默认使用本机的IP
    proxies=proxies)

print(response.status_code)
# 200
response.encoding = "utf8"
print(response.text)
# 得到百度首页的文档
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （2）给session对象添加代理</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">session = requests.Session()</span><br><span class="line">session.proxies = proxies</span><br></pre></td></tr></table></figure>

<h4 id="（3）案例">（3）案例</h4>
<ul>
<li>首先认识一个网址</li>
</ul>
```python
http://httpbin.org/get
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240716212801068](D:\pycharm\Temporary_notes\图片\image-20240716212801068.png)</span><br><span class="line"></span><br><span class="line">- 介绍里面的信息</span><br><span class="line">  - `&quot;origin&quot;: &quot;222.65.246.145&quot;`这是你的本机IP，也叫你的网关</span><br><span class="line"></span><br><span class="line">- 自己的ip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import requests</span><br><span class="line">from fake_useragent import UserAgent</span><br><span class="line"></span><br><span class="line"># 自定义地址</span><br><span class="line">url = &#x27;http://httpbin.org/get&#x27;</span><br><span class="line"># 定义请求头参数</span><br><span class="line">headers = &#123;&#x27;User-Agent&#x27;: UserAgent().random&#125;</span><br><span class="line"># 获取响应对象</span><br><span class="line">response = requests.get(url, headers=headers)</span><br><span class="line"># 检测请求是否成功</span><br><span class="line">if response.status_code == 200:</span><br><span class="line">    # 处理相应内容</span><br><span class="line"></span><br><span class="line">    # 设置响应内容的编码格式为utf8</span><br><span class="line">    response.encoding = &quot;utf8&quot;</span><br><span class="line">    # 解析json结果</span><br><span class="line">    # 获取响应信息</span><br><span class="line">    data = response.text</span><br><span class="line">    print(data)</span><br><span class="line">else:</span><br><span class="line">    print(&quot;请求失败！&quot;, response.status_code)</span><br><span class="line">    </span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;args&quot;: &#123;&#125;, </span><br><span class="line">  &quot;headers&quot;: &#123;</span><br><span class="line">    &quot;Accept&quot;: &quot;*/*&quot;, </span><br><span class="line">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, </span><br><span class="line">    &quot;Host&quot;: &quot;httpbin.org&quot;, </span><br><span class="line">    &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 Edg/121.0.0.0&quot;, </span><br><span class="line">    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-669678f7-6f2312dd6ad33674284c6042&quot;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;origin&quot;: &quot;222.70.77.67&quot;, </span><br><span class="line">  &quot;url&quot;: &quot;http://httpbin.org/get&quot;</span><br><span class="line">&#125;</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>代理ip
<ul>
<li>去哪找代理ip
<ul>
<li>89免费代理 / 快代理 …等</li>
</ul>
</li>
</ul>
</li>
</ul>
```python
import requests
from fake_useragent import UserAgent

# 自定义地址
url = 'http://httpbin.org/get'
# 定义请求头参数
headers = {'User-Agent': UserAgent().random}
# 代理IP
proxies = {
    "http": "http://182.155.106.150:8123"
}
# 获取响应对象
response = requests.get(url, headers=headers, proxies=proxies)
# 检测请求是否成功
if response.status_code == 200:
    # 处理相应内容

    # 设置响应内容的编码格式为utf8
    response.encoding = "utf8"
    # 解析json结果
    # 获取响应信息
    data = response.text
    print(data)
else:
    print("请求失败！", response.status_code)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【3】批量抓取代理脚本</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import requests</span><br><span class="line">from fake_useragent import UserAgent</span><br><span class="line"># UserAgent（用户代理）是一个在HTTP请求中发送给服务器的字符串，用于标识发出请求的客户端的详细信息，包括浏览器类型、版本、操作系统、以及安装的设备等</span><br><span class="line"></span><br><span class="line"># 使用xpath解析页面数据</span><br><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line"># UA伪装为headers</span><br><span class="line">headers = &#123;</span><br><span class="line">    &quot;User-Agent&quot;: UserAgent().random</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_proxy():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    url : &#123;89免费代理的url：https://www.89ip.cn/index_2.html&#125;</span><br><span class="line">    :return:返回所有爬取到的ip列表</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 存放所有代理存在的页码</span><br><span class="line">    page_url_lists = []</span><br><span class="line">    # 存放爬取到的所有代码的列表</span><br><span class="line">    ip_lists = []</span><br><span class="line">    # 循环获取每一页的代理页面的url</span><br><span class="line">    for i in range(1, 5):</span><br><span class="line">        if i == 1:</span><br><span class="line">            # 首页的url</span><br><span class="line">            page_url = &quot;https://www.89ip.cn&quot;</span><br><span class="line">            # 将代理页url存储到类可用列表里</span><br><span class="line">            page_url_lists.append(page_url)</span><br><span class="line">        else:</span><br><span class="line">            # 处理第二页及以后所有页码的规则</span><br><span class="line">            # 模仿：https://www.89ip.cn/index_2.html</span><br><span class="line">            page_url = f&quot;https://www.89ip.cn/index_&#123;i&#125;.html&quot;</span><br><span class="line">            # 将代理页url存储到类可用列表里</span><br><span class="line">            page_url_lists.append(page_url)</span><br><span class="line">    # 从存储所有代理存在的页面的列表，循环发起请求获得代理IP和端口</span><br><span class="line">    for page_url in page_url_lists:</span><br><span class="line">        response = requests.get(page_url, headers=headers)</span><br><span class="line">        # 编码</span><br><span class="line">        response.encoding=&quot;utf8&quot;</span><br><span class="line">        # 的得html文本</span><br><span class="line">        page_text = response.text</span><br><span class="line">        tree = etree.HTML(page_text)</span><br><span class="line">        # xpath提取到所有的代理ip列表</span><br><span class="line">        tr_lists = tree.xpath(&quot;//div[3]/div[1]/div/div[1]/table/tbody/tr&quot;)</span><br><span class="line">        # 循环获取每一个代理ip和端口</span><br><span class="line">        for tr in tr_lists:</span><br><span class="line">            # 获取ip并做数据清洗</span><br><span class="line">            ip = tr.xpath(&#x27;./td[1]/text()&#x27;)[0].strip()</span><br><span class="line">            # 获取端口并做数据清洗</span><br><span class="line">            port = tr.xpath(&#x27;./td[2]/text()&#x27;)[0].strip()</span><br><span class="line">            # 将获取到的代理ip和端口拼接</span><br><span class="line">            ip_port = &#x27;http://&#x27; + ip + &#x27;:&#x27; + str(port)</span><br><span class="line">            # 将获取到的代理ip和端口存储到类可用列表里</span><br><span class="line">            ip_lists.append(&#123;&#x27;http&#x27;: ip_port&#125;)</span><br><span class="line">            # 返回所有代理ip列表</span><br><span class="line">        return ip_lists</span><br><span class="line"></span><br><span class="line">def text_ip():</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    url：&#123;百度首页，&#125;</span><br><span class="line">    :return: 做测试返回状态码为200正常可用保留，否则再次执行验证</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    url = &quot;https://www.baidu.com/&quot;</span><br><span class="line">    # 获取到所有ip列表</span><br><span class="line">    ip_lists = get_proxy()</span><br><span class="line">    # 循环测试每一个ip和端口是否可用</span><br><span class="line">    for ip_item in ip_lists:</span><br><span class="line">        response = requests.get(url, proxies=ip_item, headers=headers, timeout=10)</span><br><span class="line">        ret = response.status_code</span><br><span class="line">        # 做判断是否返回值为200可用</span><br><span class="line">        if ret == 200:</span><br><span class="line">            print(f&#x27;当前状态码为:::&#123;ret&#125;,ip可用,返回ip:::&#123;ip_item&#125;&#x27;)</span><br><span class="line">            return ip_item</span><br><span class="line">        else:</span><br><span class="line">            print(f&#x27;当前状态码为:::&#123;ret&#125;,当前ip不可用,重新测试ip中&#x27;)</span><br><span class="line">            text_ip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    ip_lists = get_proxy()</span><br><span class="line">    ip_item = text_ip()</span><br><span class="line">    url = &#x27;https://www.baidu.com/&#x27;</span><br><span class="line">    response = requests.get(url=url, headers=headers, proxies=ip_item)</span><br><span class="line">    print(response.text)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/4.15%E9%97%AD%E5%8C%85%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/4.15%E9%97%AD%E5%8C%85%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">4.15闭包函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:19:13" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>闭包函数</h1>
<h2 id="【一】什么是闭包">【一】什么是闭包</h2>
<h3 id="【1】什么是闭">【1】什么是闭</h3>
<ul>
<li><strong>闭</strong>代表函数是内部的</li>
</ul>
<h3 id="【2】什么是包">【2】什么是包</h3>
<ul>
<li><strong>包</strong>代表函数外包裹着对外层作用域的引用</li>
</ul>
<h3 id="【3】什么是闭包">【3】什么是闭包</h3>
<ul>
<li>闭包是指包含对自由变量的函数和对这些变量的引用环境的组合。</li>
<li>基础函数的概念，可以将函数返回到任意位置去调用。</li>
<li>但作用域的关系是在定义完函数时就已经被确定了的，与函数的调用位置无关。</li>
</ul>
<h3 id="【4】总结">【4】总结</h3>
<ul>
<li>无论在何处调用闭包函数，使用的仍然是包裹在其外层的变量</li>
</ul>
<h2 id="【二】什么是闭包函数">【二】什么是闭包函数</h2>
<ul>
<li>就是对外部作用域有引用的函数</li>
<li>内嵌函数对外部函数作用域有引用，那么内嵌函数就是闭包函数。闭包（Closures）</li>
</ul>
```python
# 定义全局变量
x_global = 1


def outer():
    # 定义局部变量，覆盖全局变量
    x_global = 2

    def inner():
        # 打印外部函数的局部变量
        print(x_global)

    return inner


func = outer()
func()  
# 结果为2
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【三】如何查看闭包函数所包裹的外部变量</span><br><span class="line"></span><br><span class="line">- 可以通过函数closure属性，查看到闭包函数所包裹的外部变量</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 定义全局变量</span><br><span class="line">x_global = 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def outer():</span><br><span class="line">    # 定义局部变量，覆盖全局变量</span><br><span class="line">    x_global = 2</span><br><span class="line"></span><br><span class="line">    def inner():</span><br><span class="line">        # 打印外部函数的局部变量</span><br><span class="line">        print(x_global)</span><br><span class="line"></span><br><span class="line">    return inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func = outer()</span><br><span class="line">func()</span><br><span class="line"># 结果为2</span><br><span class="line"></span><br><span class="line">res_first = func.__closure__</span><br><span class="line">print(res_first)  # (&lt;cell at 0x000001945A08B9A0: int object at 0x0000019459AA0110&gt;,)</span><br><span class="line"></span><br><span class="line">print(dir(func.__closure__[0]))</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">[&#x27;__class__&#x27;, &#x27;__delattr__&#x27;, &#x27;__dir__&#x27;, &#x27;__doc__&#x27;, &#x27;__eq__&#x27;, &#x27;__format__&#x27;, &#x27;__ge__&#x27;, &#x27;__getattribute__&#x27;, &#x27;__gt__&#x27;, &#x27;__hash__&#x27;, &#x27;__init__&#x27;, &#x27;__init_subclass__&#x27;, &#x27;__le__&#x27;, &#x27;__lt__&#x27;, &#x27;__ne__&#x27;, &#x27;__new__&#x27;, &#x27;__reduce__&#x27;, &#x27;__reduce_ex__&#x27;, &#x27;__repr__&#x27;, &#x27;__setattr__&#x27;, &#x27;__sizeof__&#x27;, &#x27;__str__&#x27;, &#x27;__subclasshook__&#x27;, &#x27;cell_contents&#x27;]</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line"># __closure__ 属性是一个元组，包含了函数闭包中的每个 cell 对象。每个 cell 对象都有一个 cell_contents 属性，它存储着相应的值。</span><br><span class="line">res_second = func.__closure__[0].cell_contents</span><br><span class="line">print(res_second)  # 2</span><br></pre></td></tr></table></figure>

<h2 id="【四】闭包函数的用途">【四】闭包函数的用途</h2>
<h3 id="【1】保持状态">【1】保持状态</h3>
<ul>
<li>闭包函数可以用来保持函数调用之间的状态。</li>
<li>我们得到了两种为函数传值的方式
<ul>
<li>直接将值以传参的形式传入</li>
<li>将值包给函数</li>
</ul>
</li>
</ul>
<h4 id="（1）将值以参数的形式传入">（1）将值以参数的形式传入</h4>
```python
import requests

# 将值以参数的形式传入
def get(url):
    return requests.get(url).text
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">（2）将值包给函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"># 将值包给函数</span><br><span class="line">def page(url):</span><br><span class="line">    def get():</span><br><span class="line">        return requests.get(url).text</span><br><span class="line"></span><br><span class="line">    return get</span><br></pre></td></tr></table></figure>

<h4 id="（3）对比">（3）对比</h4>
<ul>
<li>方式一在下载同一页面时需要重复传入url</li>
<li>方式二只需要传一次值，就会得到一个包含指定url的闭包函数，以后调用该闭包函数无需再传url</li>
</ul>
```python
import requests


# 将值以参数的形式传入
def get(url):
    return requests.get(url).text


# 方式一下载同一页面
get('https://www.python.org')
get('https://www.python.org')
get('https://www.python.org')
import requests


# 将值包给函数
def page(url):
    def get():
        return requests.get(url).text

    return get


# 方式二下载同一页面
python = page('https://www.python.org')
python()
python()
python()
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### （2）函数工厂</span><br><span class="line"></span><br><span class="line">- **函数工厂：** 闭包允许创建函数工厂，即可以动态生成函数。</span><br><span class="line">- 在你的例子中，`page` 函数就是一个函数工厂，它返回一个根据传入的 `url` 动态生成的函数。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 将值包给函数</span><br><span class="line">def page(url):</span><br><span class="line">    def get():</span><br><span class="line">        return requests.get(url).text</span><br><span class="line"></span><br><span class="line">    return get</span><br><span class="line"></span><br><span class="line">python = page(&#x27;https://www.python.org&#x27;)</span><br><span class="line">java = page(&#x27;https://www.java.com&#x27;)</span><br></pre></td></tr></table></figure>

<h3 id="（3）封装">（3）封装</h3>
<ul>
<li><strong>封装：</strong> 闭包可以用来实现类似面向对象编程中的封装概念。</li>
<li>通过将函数和其相关的状态（变量）捆绑在一起，形成一个封闭的单元。</li>
</ul>
```python
def counter():
    count = 0

    def increment():
        nonlocal count
        count += 1
        return count

    return increment

counter1 = counter()
counter2 = counter()

print(counter1())  # 1
print(counter1())  # 2
print(counter2())  # 1
```


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/4.13%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/4.13%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">4.13匿名函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:19:13" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>匿名函数</h1>
<ul>
<li>
<p>在python中有两类函数</p>
<ul>
<li>def关键字定义的正规函数</li>
<li>还有就是lambd关键字定义的匿名函数</li>
</ul>
</li>
<li>
<p>Python 使用 <code>lambda</code> 关键词来创建匿名函数</p>
```python
  lambda argument_list:expression
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  - `lambda`:定义匿名函数的关键词。</span><br><span class="line">  - argument_list:函数的参数，它们可以是位置参数、默认参数、关键字参数，和正规函数里的参数类型一样。</span><br><span class="line">  - :冒号，在函数参数和表达式中间要加个冒号。</span><br><span class="line">  - expression：只是一个表达式，输入函数参数，输出一些值。</span><br><span class="line">    - `expression` 中没有 return 语句，因为 lambda 不需要它来返回，表达式**本身结果就是返回值。**</span><br><span class="line">    - 匿名函数拥有自己的命名空间，且不能访问自己参数列表之外或全局命名空间里的参数。</span><br><span class="line"></span><br><span class="line">## 【一】函数的分类</span><br><span class="line"></span><br><span class="line">### 【1】函数的分类</span><br><span class="line"></span><br><span class="line">#### （1）有名函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;````python</span><br><span class="line">#格式</span><br><span class="line">#这就是一个有名函数</span><br><span class="line">def sqr(x):</span><br><span class="line">    # 返回值为参数的平方</span><br><span class="line">    return x ** 2</span><br><span class="line"></span><br><span class="line"># 打印函数的调用地址</span><br><span class="line">print(sqr)</span><br><span class="line">#&lt;function sqr at 0x0000022AC27D9CF0&gt;</span><br><span class="line">````</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （2）无名函数（匿名函数）</span><br><span class="line"></span><br><span class="line">- 格式语法：**lambda 参数 ：表达式**</span><br><span class="line">  - lambda ： 匿名函数的关键字</span><br><span class="line">  - 参数：可以是位置参数、默认参数、关键字参数，和正规函数里的参数类型一样。</span><br><span class="line">  - 表达式：本质上就是返回值</span><br><span class="line"></span><br><span class="line">#### （3）定义匿名函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">#函数+列表生成式</span><br><span class="line">def sqr(x):</span><br><span class="line">    #返回值为参数的平方</span><br><span class="line">    return x**2</span><br><span class="line">y = [sqr(x) for x in range(10)]</span><br><span class="line">print(y)#[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]</span><br><span class="line"></span><br><span class="line">#匿名函数+表达式</span><br><span class="line">#匿名函数语法结构：变量名 = lambda 参数: 返回值</span><br><span class="line">lbd_sqr = lambda x:x**2</span><br><span class="line">print(lbd_sqr)#返回值是lambda类型</span><br><span class="line">#输出：&lt;function &lt;lambda&gt; at 0x00000228B02C9CF0&gt;</span><br><span class="line">y = [lbd_sqr(x) for x in range(10)]</span><br><span class="line">print(y)#[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]</span><br></pre></td></tr></table></figure>

</li>
<li>
<p>多参数匿名函数</p>
<ul>
<li>就是多了参数：表达式：<strong>变量名 = lambda 参数1,参数2 : 返回值</strong></li>
</ul>
</li>
</ul>
<h2 id="【二】匿名函数的两种方式">【二】匿名函数的两种方式</h2>
<ul>
<li>参数是函数（filter,map）</li>
<li>返回值是函数（closure）</li>
</ul>
<h3 id="【1】高级函数示例">【1】高级函数示例</h3>
<h4 id="（1）过滤函数-filter">（1）过滤函数(filter())</h4>
<ul>
<li><code>filter(function, iterable)</code> 过滤序列，过滤掉不符合条件的元素，返回一个迭代器对象，如果要转换为列表，可以使用 <code>list()</code> 来转换。
<ul>
<li>function：函数</li>
<li>iterable：可迭代的</li>
</ul>
</li>
</ul>
```python
#除数除以2余数为1的就是真
odd = lambda x: x % 2 == 1
#判断
templist = filter(odd, [1, 2, 3, 4, 5, 6, 7, 8, 9])
#转换
print(list(templist))  # [1, 3, 5, 7, 9]
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （2）映射函数(map())</span><br><span class="line"></span><br><span class="line">- `map(function, *iterables)` 根据提供的函数对指定序列做映射。</span><br><span class="line">  - function：函数</span><br><span class="line">  -  iterable：可迭代的</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">#[1, 2, 3, 4, 5]每一个数的2平方</span><br><span class="line">m1 = map(lambda x: x ** 2, [1, 2, 3, 4, 5])</span><br><span class="line">print(m1)#&lt;map object at 0x00000223468FECB0&gt;</span><br><span class="line">print(list(m1))# [1, 4, 9, 16, 25]</span><br><span class="line"></span><br><span class="line"># [1, 3, 5, 7, 9] ,[1, 3, 5, 7, 9]两个列表每一个数相加</span><br><span class="line">m2 = map(lambda x, y: x + y, [1, 3, 5, 7, 9],  [1, 3, 5, 7, 9])</span><br><span class="line">print(m2)#&lt;map object at 0x000002F14A737C40&gt;</span><br><span class="line">print(list(m2))# [3, 7, 11, 15, 19]</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/4.11subprocess%E6%A8%A1%E5%9D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/4.11subprocess%E6%A8%A1%E5%9D%97/" class="post-title-link" itemprop="url">4.11subprocess模块</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:19:13" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>subprocess模块</h1>
<h2 id="【一】介绍">【一】介绍</h2>
<ul>
<li>subprocess:它主要用于创建新的进程，连接到这些进程的输入/输出/错误管道，以及获取它们的返回状态。简而言之，通过subprocess模块，你可以在Python代码中执行操作系统级别的命令，并与这些命令进行交互。</li>
<li>简单理解就是：使用我们自己的电脑去连接别人的电脑（socket模块）</li>
</ul>
<h2 id="【二】使用">【二】使用</h2>
<h3 id="【1】导入模块">【1】导入模块</h3>
```python
import subprocess
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】Popen方法</span><br><span class="line"></span><br><span class="line">- Popen 是 subprocess的核心，子进程的创建和管理都靠它处理。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 导入模块</span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#用的时候直接改diraaa命令就行,其它都是定值</span><br><span class="line">res = subprocess.Popen(&#x27;diraaa&#x27;, shell=True,</span><br><span class="line">                       stdout=subprocess.PIPE,  # 管道 负责存储正确的信息</span><br><span class="line">                       stderr=subprocess.PIPE  # 管道 负责存储错误信息</span><br><span class="line">                       )</span><br><span class="line"></span><br><span class="line">print(res)  # &lt;subprocess.Popen object at 0x000001ABB1970310&gt;</span><br><span class="line">print(res.stdout.read().decode(&#x27;gbk&#x27;))  # diraaa执行之后的正确结果返回</span><br><span class="line">print(res.stderr.read().decode(&#x27;gbk&#x27;)) # diraaa执行之后的错误结果返回</span><br></pre></td></tr></table></figure>

<h3 id="【3】run方法">【3】run方法</h3>
<ul>
<li>你可以为 <code>subprocess.run()</code> 设置超时时间，如果命令执行超过指定的时间，进程会被终止。</li>
<li>你可以使用 <code>subprocess.run()</code> 来执行外部命令，并等待命令执行完成。</li>
<li>通过 <code>subprocess.run()</code>，你可以捕获命令的标准输出和错误输出，从而获取命令执行后的结果。</li>
</ul>
```python
import subprocess
def runcmd(command):
    ret = subprocess.run(command,  # 子进程要执行的命令
                         shell=True,  # 执行的是shell的命令
                         stdout=subprocess.PIPE,
                         stderr=subprocess.PIPE,
                         # encoding="utf-8",#二进制无法用utf-8编译
                         timeout=1#等待一秒钟没执行就会报错，这里是设置程序运行时间
                         )
    # print( ret.returncode)
    # returncode属性是run()函数返回结果的状态。
    if ret.returncode == 0:
        print("success:", ret.stdout)#输出的是二进制数据
    else:
        print("error:", ret)#输出的是二进制数据


runcmd(["dir",'/b'])  # 序列参数
# success: CompletedProcess(args=['dir', '/b'], returncode=0, stderr='')
runcmd("exit 1")  # 字符串参数
# error: CompletedProcess(args='exit 1', returncode=1, stdout='', stderr='')
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【3】call方法</span><br><span class="line"></span><br><span class="line">- 调用subprocess.call()函数执行命令，将需要执行的命令以列表形式传递给该函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line">subprocess.call([&#x27;python&#x27;, &#x27;--version&#x27;])</span><br><span class="line"># Python 3.10.10</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">坤</p>
  <div class="site-description" itemprop="description">选择有时候比努力更重要，但是你不努力，选择就只是空谈</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">194</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">坤</span>
</div>
  <div class="powered-by">由 <a href="https://github.com/lsk-0912" class="theme-link" rel="noopener" target="_blank">lsk-0912</a> & <a href="https://github.com/lsk-0912" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
