<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aurora-lsk.asia","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
<meta property="og:type" content="website">
<meta property="og:title" content="坤博客">
<meta property="og:url" content="https://aurora-lsk.asia/page/17/index.html">
<meta property="og:site_name" content="坤博客">
<meta property="og:description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="坤">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://aurora-lsk.asia/page/17/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>坤博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">坤博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/RBAC%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/RBAC%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 18:31:35" itemprop="dateModified" datetime="2025-10-11T18:31:35+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>【一】什么是RBAC</h1>
<h2 id="【1】概念">【1】概念</h2>
<ul>
<li>RBAC 是基于角色的访问控制（Role-Based Access Control ）</li>
<li>在 RBAC 中，权限与角色相关联，用户通过成为适当角色的成员而得到这些角色的权限。</li>
<li>这就极大地简化了权限的管理。</li>
<li>这样管理都是层级相互依赖的，权限赋予给角色，而把角色又赋予用户，这样的权限设计很清楚，管理起来很方便。</li>
</ul>
<h2 id="【2】应用">【2】应用</h2>
<ul>
<li>RBAC - Role-Based Access Control</li>
<li>Django的 Auth组件 采用的认证规则就是RBAC</li>
</ul>
<h3 id="（1）内部系统">（1）内部系统</h3>
<ul>
<li>
<p>专门做人员权限管理的系统（CRM系统）都是公司内部使用</p>
</li>
<li>
<ul>
<li>所以数据量都在10w一下，一般效率要求也不是很高</li>
</ul>
</li>
</ul>
<h3 id="（2）用户分类">（2）用户分类</h3>
<ul>
<li>
<p>用户量极大的常规项目，会分两种用户：</p>
</li>
<li>
<ul>
<li>前台用户(三大认证)</li>
<li>后台用户(BRAC来管理)</li>
</ul>
</li>
</ul>
<h3 id="（3）结论">（3）结论</h3>
<ul>
<li>没有特殊要求的Django项目可以直接采用Auth组件的权限六表</li>
<li>不需要自定义六个表，也不需要断开表关系，单可能需要自定义User表</li>
</ul>
<h2 id="【3】前后台权限控制">【3】前后台权限控制</h2>
<ul>
<li>
<p>1）后台用户对各表操作，是后台项目完成的</p>
</li>
<li>
<ul>
<li>我们可以直接借助admin后台项目（Django自带的）</li>
</ul>
</li>
<li>
<p>2）后期也可以用xadmin框架来做后台用户权限管理</p>
</li>
<li>
<p>3）前台用户的权限管理如何处理</p>
</li>
<li>
<p>定义了一堆数据接口的视图类</p>
</li>
<li>
<ul>
<li>不同的登录用户是否能访问这些视图类，能就代表有权限，不能就代表无权限</li>
</ul>
</li>
<li>
<p>前台用户权限用drf框架的</p>
</li>
<li>
<ul>
<li>三大认证</li>
</ul>
</li>
</ul>
<h1>【二】RBAC关系分析</h1>
<h2 id="【1】权限三表">【1】权限三表</h2>
<h3 id="（1）用户表">（1）用户表</h3>
<ul>
<li>用户表存储用户数据</li>
</ul>
<table>
<thead>
<tr>
<th>id</th>
<th>username</th>
<th>Pwd</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="（2）权限表">（2）权限表</h3>
<ul>
<li>权限表存储权限名称</li>
</ul>
<table>
<thead>
<tr>
<th>id</th>
<th>permission_name</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="（3）用户权限表">（3）用户权限表</h3>
<ul>
<li>一个用户可以有多个权限，一个权限可以对应多个用户</li>
<li>用户和权限之间是多对多关系</li>
</ul>
<table>
<thead>
<tr>
<th>id</th>
<th>user_id</th>
<th>permission_id</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="（4）图解">（4）图解</h3>
<p><a target="_blank" rel="noopener" href="https://img2023.cnblogs.com/blog/2322215/202307/2322215-20230731121438434-493211859.jpg"><img src="http://zhaochunze.dream521.site/202403241221812.jpg" alt="img"></a></p>
<h2 id="【2】权限六表">【2】权限六表</h2>
<h3 id="（1）用户表-2">（1）用户表</h3>
<ul>
<li>用户表存储用户数据</li>
</ul>
<table>
<thead>
<tr>
<th>id</th>
<th>username</th>
<th>Pwd</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="（2）角色表">（2）角色表</h3>
<ul>
<li>根据不同角色区分组</li>
</ul>
<table>
<thead>
<tr>
<th>id</th>
<th>group_name</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="（3）权限表">（3）权限表</h3>
<ul>
<li>权限表存储权限名称</li>
</ul>
<table>
<thead>
<tr>
<th>id</th>
<th>permission_name</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="（4）用户角色表">（4）用户角色表</h3>
<ul>
<li>用户根据角色的不同，分到不同的组内</li>
<li>比如一个部门的角色可以是组长和组员</li>
</ul>
<table>
<thead>
<tr>
<th>id</th>
<th>user_id</th>
<th>group_id</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="（5）角色权限表">（5）角色权限表</h3>
<ul>
<li>一个角色可以有多个权限，一个权限可以对应多个角色</li>
<li>角色和权限之间是多对多关系</li>
</ul>
<table>
<thead>
<tr>
<th>id</th>
<th>group_id</th>
<th>permission_id</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><a target="_blank" rel="noopener" href="https://img2023.cnblogs.com/blog/2322215/202307/2322215-20230731121443356-138660067.jpg"><img src="http://zhaochunze.dream521.site/202403241221824.jpg" alt="img"></a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/PE8%E8%A7%84%E8%8C%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/PE8%E8%A7%84%E8%8C%83/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 18:31:35" itemprop="dateModified" datetime="2025-10-11T18:31:35+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>PE8规范</h1>
<h1>【一】什么是PE8规范</h1>
<ul>
<li>PEP是Python Enhancement Proposal的缩写，通常翻译为“Python增强提案”。</li>
<li>每个PEP都是一份为Python社区提供的指导Python往更好的方向发展的技术文档，其中的第8号增强提案（PEP 8）是针对Python语言编订的代码风格指南。</li>
<li>尽管我们可以在保证语法没有问题的前提下随意书写Python代码，但是在实际开发中，采用一致的风格书写出可读性强的代码是每个专业的程序员应该做到的事情，也是每个公司的编程规范中会提出的要求，这些在多人协作开发一个项目（团队开发）的时候显得尤为重要。</li>
</ul>
<h1>【二】PE8规范的内容</h1>
<ul>
<li>我们可以从Python官方网站的<a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0008/">PEP 8链接</a>中找到该文档，下面我们对该文档的关键部分做一个简单的总结。</li>
</ul>
<h2 id="【1】空格的使用">【1】空格的使用</h2>
<ul>
<li>1、使用空格来表示缩进而不要用制表符（Tab）。
<ul>
<li>这一点对习惯了其他编程语言的人来说简直觉得不可理喻，因为绝大多数的程序员都会用Tab来表示缩进，但是要知道Python并没有像C/C++或Java那样的用花括号来构造一个代码块的语法，在Python中分支和循环结构都使用缩进来表示哪些代码属于同一个级别，鉴于此Python代码对缩进以及缩进宽度的依赖比其他很多语言都强得多。</li>
<li>在不同的编辑器中，Tab的宽度可能是2、4或8个字符，甚至是其他更离谱的值，用Tab来表示缩进对Python代码来说可能是一场灾难。</li>
</ul>
</li>
<li>2、和语法相关的每一层缩进都用4个空格来表示。</li>
<li>3、每行的字符数不要超过79个字符，如果表达式因太长而占据了多行，除了首行之外的其余各行都应该在正常的缩进宽度上再加上4个空格。</li>
<li>4、函数和类的定义，代码前后都要用两个空行进行分隔。</li>
<li>5、在同一个类中，各个方法之间应该用一个空行进行分隔。</li>
<li>6、二元运算符的左右两侧应该保留一个空格，而且只要一个空格就好。</li>
</ul>
<h2 id="【2】标识符的命名">【2】标识符的命名</h2>
<ul>
<li>PEP 8倡导用不同的命名风格来命名Python中不同的标识符，以便在阅读代码时能够通过标识符的名称来确定该标识符在Python中扮演了怎样的角色（在这一点上，Python自己的内置模块以及某些第三方模块都做得并不是很好）。</li>
<li>1、变量、函数和属性应该使用小写字母来拼写，如果有多个单词就使用下划线进行连接。</li>
<li>2、类中受保护的实例属性，应该以一个下划线开头。</li>
<li>3、类中私有的实例属性，应该以两个下划线开头。</li>
<li>4、类和异常的命名，应该每个单词首字母大写。</li>
<li>5、模块级别的常量，应该采用全大写字母，如果有多个单词就用下划线进行连接。</li>
<li>6、类的实例方法，应该把第一个参数命名为self以表示对象自身。</li>
<li>7、类的类方法，应该把第一个参数命名为cls以表示该类自身。</li>
</ul>
<h2 id="【3】表达式和语句">【3】表达式和语句</h2>
<ul>
<li>在Python之禅（可以使用import this查看）中有这么一句名言：
<ul>
<li>“There should be one-- and preferably only one --obvious way to do it.”</li>
<li>翻译成中文是“做一件事应该有而且最好只有一种确切的做法”，这句话传达的思想在PEP 8中也是无处不在的。</li>
</ul>
</li>
<li>1、采用内联形式的否定词，而不要把否定词放在整个表达式的前面。例如if a is not b就比if not a is b更容易让人理解。</li>
<li>2、不要用检查长度的方式来判断字符串、列表等是否为None或者没有元素，应该用if not x这样的写法来检查它。</li>
<li>3、就算if分支、for循环、except异常捕获等中只有一行代码，也不要将代码和if、for、except等写在一起，分开写才会让代码更清晰。</li>
<li>4、import语句总是放在文件开头的地方。</li>
<li>5、引入模块的时候，from math import sqrt比import math更好。</li>
<li>6、如果有多个import语句，应该将其分为三部分，从上到下分别是Python标准模块、第三方模块和自定义模块，每个部分内部应该按照模块名称的字母表顺序来排列。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/MySQL%E7%BB%83%E4%B9%A0%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/MySQL%E7%BB%83%E4%B9%A0%E9%A2%98/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 18:31:35" itemprop="dateModified" datetime="2025-10-11T18:31:35+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>MySQL练习题</h1>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Navicat Premium Data Transfer</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Source Server         : localhost</span></span><br><span class="line"><span class="comment">Source Server Type    : MySQL</span></span><br><span class="line"><span class="comment">Source Server Version : 50624</span></span><br><span class="line"><span class="comment">Source Host           : localhost</span></span><br><span class="line"><span class="comment">Source Database       : sqlexam</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Target Server Type    : MySQL</span></span><br><span class="line"><span class="comment">Target Server Version : 50624</span></span><br><span class="line"><span class="comment">File Encoding         : utf-8</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Date: 10/21/2016 06:46:46 AM</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> NAMES utf8;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">--  Table structure for `class`</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `class`;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> `class` (</span><br><span class="line">  `cid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `caption` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`cid`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">5</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">--  Records of `class`</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT INTO</span> `class` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;三年二班&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;三年三班&#x27;</span>), (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;一年二班&#x27;</span>), (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;二年九班&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">--  Table structure for `course`</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `course`;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> `course` (</span><br><span class="line">  `cid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `cname` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `teacher_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`cid`),</span><br><span class="line">  KEY `fk_course_teacher` (`teacher_id`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `fk_course_teacher` <span class="keyword">FOREIGN KEY</span> (`teacher_id`) <span class="keyword">REFERENCES</span> `teacher` (`tid`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">5</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">--  Records of `course`</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT INTO</span> `course` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;生物&#x27;</span>, <span class="string">&#x27;1&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;物理&#x27;</span>, <span class="string">&#x27;2&#x27;</span>), (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;体育&#x27;</span>, <span class="string">&#x27;3&#x27;</span>), (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;美术&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">--  Table structure for `score`</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `score`;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> `score` (</span><br><span class="line">  `sid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `student_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `course_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `num` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`sid`),</span><br><span class="line">  KEY `fk_score_student` (`student_id`),</span><br><span class="line">  KEY `fk_score_course` (`course_id`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `fk_score_course` <span class="keyword">FOREIGN KEY</span> (`course_id`) <span class="keyword">REFERENCES</span> `course` (`cid`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `fk_score_student` <span class="keyword">FOREIGN KEY</span> (`student_id`) <span class="keyword">REFERENCES</span> `student` (`sid`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">53</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">--  Records of `score`</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT INTO</span> `score` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;10&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;9&#x27;</span>), (<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;66&#x27;</span>), (<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;8&#x27;</span>), (<span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;68&#x27;</span>), (<span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;99&#x27;</span>), (<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;77&#x27;</span>), (<span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;66&#x27;</span>), (<span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;87&#x27;</span>), (<span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;99&#x27;</span>), (<span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;79&#x27;</span>), (<span class="string">&#x27;15&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;11&#x27;</span>), (<span class="string">&#x27;16&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;67&#x27;</span>), (<span class="string">&#x27;17&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;100&#x27;</span>), (<span class="string">&#x27;18&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;79&#x27;</span>), (<span class="string">&#x27;19&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;11&#x27;</span>), (<span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;67&#x27;</span>), (<span class="string">&#x27;21&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;100&#x27;</span>), (<span class="string">&#x27;22&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;9&#x27;</span>), (<span class="string">&#x27;23&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;100&#x27;</span>), (<span class="string">&#x27;24&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;67&#x27;</span>), (<span class="string">&#x27;25&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;100&#x27;</span>), (<span class="string">&#x27;26&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;9&#x27;</span>), (<span class="string">&#x27;27&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;100&#x27;</span>), (<span class="string">&#x27;28&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;67&#x27;</span>), (<span class="string">&#x27;29&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;88&#x27;</span>), (<span class="string">&#x27;30&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;9&#x27;</span>), (<span class="string">&#x27;31&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;100&#x27;</span>), (<span class="string">&#x27;32&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;67&#x27;</span>), (<span class="string">&#x27;33&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;88&#x27;</span>), (<span class="string">&#x27;34&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;91&#x27;</span>), (<span class="string">&#x27;35&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;88&#x27;</span>), (<span class="string">&#x27;36&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;67&#x27;</span>), (<span class="string">&#x27;37&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;22&#x27;</span>), (<span class="string">&#x27;38&#x27;</span>, <span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;90&#x27;</span>), (<span class="string">&#x27;39&#x27;</span>, <span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;77&#x27;</span>), (<span class="string">&#x27;40&#x27;</span>, <span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;43&#x27;</span>), (<span class="string">&#x27;41&#x27;</span>, <span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;87&#x27;</span>), (<span class="string">&#x27;42&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;90&#x27;</span>), (<span class="string">&#x27;43&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;77&#x27;</span>), (<span class="string">&#x27;44&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;43&#x27;</span>), (<span class="string">&#x27;45&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;87&#x27;</span>), (<span class="string">&#x27;46&#x27;</span>, <span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;90&#x27;</span>), (<span class="string">&#x27;47&#x27;</span>, <span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;77&#x27;</span>), (<span class="string">&#x27;48&#x27;</span>, <span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;43&#x27;</span>), (<span class="string">&#x27;49&#x27;</span>, <span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;87&#x27;</span>), (<span class="string">&#x27;52&#x27;</span>, <span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;87&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">--  Table structure for `student`</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `student`;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> `student` (</span><br><span class="line">  `sid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `gender` <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `class_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `sname` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`sid`),</span><br><span class="line">  KEY `fk_class` (`class_id`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `fk_class` <span class="keyword">FOREIGN KEY</span> (`class_id`) <span class="keyword">REFERENCES</span> `class` (`cid`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">17</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">--  Records of `student`</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT INTO</span> `student` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;理解&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;钢蛋&#x27;</span>), (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>), (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;张一&#x27;</span>), (<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;张二&#x27;</span>), (<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;张四&#x27;</span>), (<span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;铁锤&#x27;</span>), (<span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;李三&#x27;</span>), (<span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;李一&#x27;</span>), (<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;李二&#x27;</span>), (<span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>), (<span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;如花&#x27;</span>), (<span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;刘三&#x27;</span>), (<span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;刘一&#x27;</span>), (<span class="string">&#x27;15&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;刘二&#x27;</span>), (<span class="string">&#x27;16&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;刘四&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">--  Table structure for `teacher`</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `teacher`;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> `teacher` (</span><br><span class="line">  `tid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `tname` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`tid`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">6</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">--  Records of `teacher`</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT INTO</span> `teacher` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;张磊老师&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;李平老师&#x27;</span>), (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;刘海燕老师&#x27;</span>), (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;朱云海老师&#x27;</span>), (<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;李杰老师&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h2 id="1、查询所有的课程的名称以及对应的任课老师姓名">1、查询所有的课程的名称以及对应的任课老师姓名</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> course <span class="keyword">left</span> <span class="keyword">join</span> teacher <span class="keyword">on</span> course.teacher_id <span class="operator">=</span> teacher.tid </span><br><span class="line"><span class="keyword">union</span> </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> course <span class="keyword">right</span> <span class="keyword">join</span>  teacher <span class="keyword">on</span> course.teacher_id <span class="operator">=</span> teacher.tid;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240602160916554.png" alt="image-20240602160916554"><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240602162212269.png" alt="image-20240602162212269"><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240602162220962.png" alt="image-20240602162220962"></p>
<h2 id="2、查询学生表中男女生各有多少人">2、查询学生表中男女生各有多少人</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> gender <span class="keyword">as</span> &quot;女生和男生总人数&quot;,<span class="built_in">count</span>(sname) <span class="keyword">as</span> <span class="string">&#x27;总人数&#x27;</span> <span class="keyword">from</span> student <span class="keyword">group</span> <span class="keyword">by</span> gender;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240602162127751.png" alt="image-20240602162127751"><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240602162151131.png" alt="image-20240602162151131"></p>
<h2 id="3、查询物理成绩等于100的学生的姓名">3、查询物理成绩等于100的学生的姓名</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id <span class="keyword">from</span> score <span class="keyword">inner</span> <span class="keyword">join</span> course <span class="keyword">on</span> score.course_id<span class="operator">=</span>course.cid <span class="keyword">where</span> course.cname<span class="operator">=</span><span class="string">&#x27;物理&#x27;</span> <span class="keyword">and</span> score.num<span class="operator">=</span><span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> sname <span class="keyword">from</span> student <span class="keyword">where</span> sid <span class="keyword">in</span> (<span class="keyword">select</span> student_id <span class="keyword">from</span> score <span class="keyword">inner</span> <span class="keyword">join</span> course <span class="keyword">on</span> score.course_id<span class="operator">=</span>course.cid <span class="keyword">where</span> course.cname<span class="operator">=</span><span class="string">&#x27;物理&#x27;</span> <span class="keyword">and</span> score.num<span class="operator">=</span><span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240602185100790.png" alt="image-20240602185100790"></p>
<h2 id="4、查询平均成绩大于八十分的同学的姓名和平均成绩">4、查询平均成绩大于八十分的同学的姓名和平均成绩</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sname <span class="keyword">as</span> <span class="string">&#x27;名字&#x27;</span>,<span class="built_in">avg</span>(num) <span class="keyword">as</span> <span class="string">&#x27;平均成绩&#x27;</span>  <span class="keyword">from</span> student <span class="keyword">inner</span> <span class="keyword">join</span> score <span class="keyword">on</span> student.sid<span class="operator">=</span>score.student_id <span class="keyword">group</span> <span class="keyword">by</span> sname <span class="keyword">having</span> <span class="built_in">avg</span>(num)<span class="operator">&gt;</span><span class="number">80</span>;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240602185035160.png" alt="image-20240602185035160"></p>
<h2 id="5、查询所有学生的学号，姓名，选课数，总成绩">5、查询所有学生的学号，姓名，选课数，总成绩</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">select</span> student.sid <span class="keyword">as</span> <span class="string">&#x27;学号&#x27;</span>,student.sname <span class="keyword">as</span> <span class="string">&#x27;名字&#x27;</span>,student.class_id <span class="keyword">as</span> <span class="string">&#x27;选课数&#x27;</span>,<span class="built_in">sum</span>(num) <span class="keyword">as</span> <span class="string">&#x27;总成绩&#x27;</span> <span class="keyword">from</span> student <span class="keyword">inner</span> <span class="keyword">join</span> score <span class="keyword">on</span> student.sid<span class="operator">=</span>score.student_id <span class="keyword">group</span> <span class="keyword">by</span> student_id;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240602190110610.png" alt="image-20240602190110610"></p>
<h2 id="6、-查询姓李老师的个数">6、 查询姓李老师的个数</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(tid) <span class="keyword">as</span> <span class="string">&#x27;个数&#x27;</span> <span class="keyword">from</span> teacher <span class="keyword">where</span> tname <span class="keyword">like</span><span class="string">&#x27;%李%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240602190806551.png" alt="image-20240602190806551"></p>
<h2 id="7、-查询没有报李平老师课的学生姓名">7、 查询没有报李平老师课的学生姓名</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">select</span> course.cid <span class="keyword">from</span> </span><br><span class="line">course <span class="keyword">inner</span> <span class="keyword">join</span> teacher <span class="keyword">on</span> course.teacher_id <span class="operator">=</span> teacher.tid </span><br><span class="line"><span class="keyword">where</span> teacher.tname<span class="operator">=</span><span class="string">&#x27;李平老师&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> student_id <span class="keyword">from</span> score <span class="keyword">where</span> course_id <span class="keyword">in</span> (<span class="keyword">select</span> course.cid <span class="keyword">from</span> </span><br><span class="line">course <span class="keyword">inner</span> <span class="keyword">join</span> teacher <span class="keyword">on</span> course.teacher_id <span class="operator">=</span> teacher.tid </span><br><span class="line"><span class="keyword">where</span> teacher.tname<span class="operator">=</span><span class="string">&#x27;李平老师&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> student.sname <span class="keyword">from</span> student <span class="keyword">where</span> sid <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> student_id <span class="keyword">from</span> score <span class="keyword">where</span> course_id <span class="keyword">in</span> (<span class="keyword">select</span> course.cid <span class="keyword">from</span> </span><br><span class="line">course <span class="keyword">inner</span> <span class="keyword">join</span> teacher <span class="keyword">on</span> course.teacher_id <span class="operator">=</span> teacher.tid </span><br><span class="line"><span class="keyword">where</span> teacher.tname<span class="operator">=</span><span class="string">&#x27;李平老师&#x27;</span></span><br><span class="line">));</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240602195857862.png" alt="image-20240602195857862"></p>
<h2 id="8、-查询物理课程比生物课程高的学生的学号">8、 查询物理课程比生物课程高的学生的学号</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="9、-查询没有同时选修物理课程和体育课程的学生姓名">9、 查询没有同时选修物理课程和体育课程的学生姓名</h2>
<ul>
<li>查询没有同时选修物理课程和体育课程的学生姓名(没有同时选修指的是选修了一门的，思路是得到物理+体育课程的学生信息表，然后基于学生分组，统计count(课程)=1)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> cid <span class="keyword">from</span> course <span class="keyword">where</span> cname<span class="operator">=</span><span class="string">&#x27;物理&#x27;</span> <span class="keyword">or</span> cname<span class="operator">=</span><span class="string">&#x27;体育&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> student_id <span class="keyword">from</span> score <span class="keyword">where</span> course_id <span class="keyword">in</span> (<span class="keyword">select</span> cid <span class="keyword">from</span> course <span class="keyword">where</span> cname<span class="operator">=</span><span class="string">&#x27;物理&#x27;</span> <span class="keyword">or</span> cname<span class="operator">=</span><span class="string">&#x27;体育&#x27;</span>) <span class="keyword">group</span> <span class="keyword">by</span> student_id <span class="keyword">having</span> <span class="built_in">count</span>(course_id)<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> sname <span class="keyword">from</span> student <span class="keyword">where</span> sid <span class="keyword">in</span> (<span class="keyword">select</span> student_id <span class="keyword">from</span> score <span class="keyword">where</span> course_id <span class="keyword">in</span> (<span class="keyword">select</span> cid <span class="keyword">from</span> course <span class="keyword">where</span> cname<span class="operator">=</span><span class="string">&#x27;物理&#x27;</span> <span class="keyword">or</span> cname<span class="operator">=</span><span class="string">&#x27;体育&#x27;</span>) <span class="keyword">group</span> <span class="keyword">by</span> student_id <span class="keyword">having</span> <span class="built_in">count</span>(course_id)<span class="operator">=</span><span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240610163756856.png" alt="image-20240610163756856"></p>
<h2 id="10、查询挂科超过两门-包括两门-的学生姓名和班级">10、查询挂科超过两门(包括两门)的学生姓名和班级</h2>
<ul>
<li>查询挂科超过两门(包括两门)的学生姓名和班级(求出&lt;60的表，然后对学生进行分组，统计课程数目&gt;=2)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id <span class="keyword">from</span> score <span class="keyword">where</span> num<span class="operator">&lt;</span><span class="number">60</span> <span class="keyword">group</span> <span class="keyword">by</span> student_id <span class="keyword">having</span> <span class="built_in">count</span>(student_id)<span class="operator">&gt;=</span><span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> sname,caption <span class="keyword">from</span> student <span class="keyword">inner</span> <span class="keyword">join</span> class <span class="keyword">on</span> student.class_id<span class="operator">=</span>class.cid <span class="keyword">where</span> sid<span class="operator">=</span>(<span class="keyword">select</span> student_id <span class="keyword">from</span> score <span class="keyword">where</span> num<span class="operator">&lt;</span><span class="number">60</span> <span class="keyword">group</span> <span class="keyword">by</span> student_id <span class="keyword">having</span> <span class="built_in">count</span>(student_id)<span class="operator">&gt;=</span><span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240610165636832.png" alt="image-20240610165636832"></p>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240610165652634.png" alt="image-20240610165652634"></p>
<h2 id="11、查询选修了所有课程的学生姓名">11、查询选修了所有课程的学生姓名</h2>
<ul>
<li>查询选修了所有课程的学生姓名(先从course表统计课程的总数，然后基于score表按照student_id分组，统计课程数据等于课程总数即可)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(cid) <span class="keyword">from</span> course;</span><br><span class="line"></span><br><span class="line"># 看的比较清除</span><br><span class="line"><span class="keyword">select</span> student_id,<span class="built_in">count</span>(course_id) <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> student_id <span class="keyword">having</span> <span class="built_in">count</span>(course_id)<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">count</span>(cid) <span class="keyword">from</span> course);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> student_id <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> student_id <span class="keyword">having</span> <span class="built_in">count</span>(course_id)<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">count</span>(cid) <span class="keyword">from</span> course);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> sname <span class="keyword">from</span> student <span class="keyword">where</span> sid <span class="keyword">in</span> (<span class="keyword">select</span> student_id <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> student_id <span class="keyword">having</span> <span class="built_in">count</span>(course_id)<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">count</span>(cid) <span class="keyword">from</span> course));</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240610183420229.png" alt="image-20240610183420229"></p>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240610183434059.png" alt="image-20240610183434059"></p>
<h2 id="12、查询李平老师教的课程的所有成绩记录">12、查询李平老师教的课程的所有成绩记录</h2>
<ul>
<li>查询李平老师教的课程的所有成绩记录</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> tid <span class="keyword">from</span> teacher <span class="keyword">where</span> tname<span class="operator">=</span><span class="string">&#x27;李平老师&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> cid <span class="keyword">from</span> course <span class="keyword">where</span> teacher_id<span class="operator">=</span>(<span class="keyword">select</span> tid <span class="keyword">from</span> teacher <span class="keyword">where</span> tname<span class="operator">=</span><span class="string">&#x27;李平老师&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> num <span class="keyword">from</span> score <span class="keyword">where</span> course_id <span class="keyword">in</span> (<span class="keyword">select</span> cid <span class="keyword">from</span> course <span class="keyword">where</span> teacher_id<span class="operator">=</span>(<span class="keyword">select</span> tid <span class="keyword">from</span> teacher <span class="keyword">where</span> tname<span class="operator">=</span><span class="string">&#x27;李平老师&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240610184604647.png" alt="image-20240610184604647"></p>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240610184515562.png" alt="image-20240610184515562"></p>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240610184619913.png" alt="image-20240610184619913"></p>
<h2 id="13、查询全部学生都选修了的课程号和课程名">13、查询全部学生都选修了的课程号和课程名</h2>
<ul>
<li>查询全部学生都选修了的课程号和课程名(取所有学生数，然后基于score表的课程分组，找出count(student_id)等于学生数即可)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(sid) <span class="keyword">from</span> student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> course_id <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> course_id <span class="keyword">having</span> <span class="built_in">count</span>(student_id)<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">count</span>(sid) <span class="keyword">from</span> student);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> cid,cname <span class="keyword">from</span> course <span class="keyword">where</span> cid<span class="operator">=</span>(<span class="keyword">select</span> course_id <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> course_id <span class="keyword">having</span> <span class="built_in">count</span>(student_id)<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">count</span>(sid) <span class="keyword">from</span> student));</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240610190027169.png" alt="image-20240610190027169"></p>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240610190011686.png" alt="image-20240610190011686"></p>
<h2 id="14、查询每门课程被选修的次数">14、查询每门课程被选修的次数</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> course_id,<span class="built_in">count</span>(student_id) <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> course_id;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240610190522485.png" alt="image-20240610190522485"></p>
<p>15、查询之选修了一门课程的学生姓名和学号</p>
<p>16、查询所有学生考出的成绩并按从高到低排序（成绩去重）</p>
<p>17、查询平均成绩大于85的学生姓名和平均成绩</p>
<p>18、查询生物成绩不及格的学生姓名和对应生物分数</p>
<p>19、查询在所有选修了李平老师课程的学生中，这些课程(李平老师的课程，不是所有课程)平均成绩最高的学生姓名</p>
<p>20、查询每门课程成绩最好的前两名学生姓名</p>
<p>21、查询不同课程但成绩相同的学号，课程号，成绩</p>
<p>22、查询没学过“叶平”老师课程的学生姓名以及选修的课程名称；</p>
<p>23、查询所有选修了学号为1的同学选修过的一门或者多门课程的同学学号和姓名；</p>
<p>24、任课最多的老师中学生单科成绩最高的学生姓名</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/Scrapy%E6%A1%86%E6%9E%B6%E4%B9%8B%E4%B8%AD%E9%97%B4%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/Scrapy%E6%A1%86%E6%9E%B6%E4%B9%8B%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 18:31:35" itemprop="dateModified" datetime="2025-10-11T18:31:35+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Scrapy框架之中间件</h1>
<h2 id="【一】爬虫中间件">【一】爬虫中间件</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> signals</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpiderNewsSpiderMiddleware</span>:</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 如果有某一个函数没有被重写，那就使用默认的函数对象</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="comment"># 是一个类方法，它会在创建爬虫实例时被Scrapy调用，用于初始化爬虫中间件的实例</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">from_crawler</span>(<span class="params">cls, crawler</span>):</span><br><span class="line">        <span class="comment"># 该方法是scrapy用于创建爬虫示例的方法</span></span><br><span class="line">        <span class="comment"># 首先创建一个中间价实例  s</span></span><br><span class="line">        s = cls()</span><br><span class="line">        <span class="comment"># 通过crawler.signals.connect方法连接了，spider_opened(爬虫打开)信号和对应的处理方法</span></span><br><span class="line">        crawler.signals.connect(s.spider_opened, signal=signals.spider_opened)</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># process_spider_input 方法会在响应从爬虫中间件传递到爬虫之前调用</span></span><br><span class="line">    <span class="comment"># 可以用来对响应进行预处理或检查</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_spider_input</span>(<span class="params">self, response, spider</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param response: 响应对象</span></span><br><span class="line"><span class="string">        :param spider: 当前的爬虫实例</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 当响应从爬虫中间件进入爬虫时，调用该方法进行处理</span></span><br><span class="line">        <span class="comment"># 应返回None或引发异常</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment"># process_spider_output 方法在爬虫处理完响应后会被调用</span></span><br><span class="line">    <span class="comment"># 主要用于对爬虫处理结果进行进一步处理或过滤，并将处理结果返回</span></span><br><span class="line">    <span class="comment"># 必须返回一个可迭代的Request对象或item对象</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_spider_output</span>(<span class="params">self, response, result, spider</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param response: 是爬虫处理后的响应对象</span></span><br><span class="line"><span class="string">        :param result: 是爬虫的处理结果</span></span><br><span class="line"><span class="string">        :param spider: 是当前爬虫实例</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 当爬虫处理完响应后，调用该方法对数据进行处理</span></span><br><span class="line">        <span class="comment"># 必须返回一个request对象或item对象</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">yield</span> i</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># process_spider_exception 方法在爬虫或 process_spider_input() 方法中抛出异常时会被调用</span></span><br><span class="line">    <span class="comment"># 这个方法可以用来对爬虫处理过程中的异常进行处理</span></span><br><span class="line">    <span class="comment"># 可以返回 None 或一个可迭代的Request对象或item对象</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_spider_exception</span>(<span class="params">self, response, exception, spider</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param response: 发生异常的响应体</span></span><br><span class="line"><span class="string">        :param exception: 是抛出的异常对象</span></span><br><span class="line"><span class="string">        :param spider: 是当前的爬虫实例</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 当爬虫中抛出异常时，调用该方法进行处理</span></span><br><span class="line">        <span class="comment"># 应返回None或者一个可迭代的Request对象或item对象</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment"># process_start_requests 方法在爬虫启动时被调用</span></span><br><span class="line">    <span class="comment"># 用于对初始请求进行处理</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_start_requests</span>(<span class="params">self, start_requests, spider</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param start_requests: 是初始请求的列表</span></span><br><span class="line"><span class="string">        :param spider: 当前爬虫的实例</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 在爬虫启动时，对初始请求进行处理</span></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> start_requests:</span><br><span class="line">            <span class="keyword">yield</span> r</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 在爬虫打开时被调用</span></span><br><span class="line">    <span class="comment"># 在这个方法中，通过日志记录器(logger)输出 &quot;Spider opened: 爬虫名称&quot; 的信息</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">spider_opened</span>(<span class="params">self, spider</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param spider: 当前爬虫的实例</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        spider.logger.info(<span class="string">&quot;Spider opened: %s&quot;</span> % spider.name)</span><br></pre></td></tr></table></figure>
<h2 id="【二】下载中间件">【二】下载中间件</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> signals</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpidernewsDownloaderMiddleware</span>:</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">from_crawler</span>(<span class="params">cls, crawler</span>):</span><br><span class="line">        <span class="comment"># Scrapy使用该方法创建我们的爬虫</span></span><br><span class="line">        s = cls()</span><br><span class="line">        <span class="comment"># 通过signals连接spider_opened信号和spider_opened方法</span></span><br><span class="line">        crawler.signals.connect(s.spider_opened, signal=signals.spider_opened)</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 拦截请求的所有对象</span></span><br><span class="line">    <span class="comment"># 参数：request就是拦截到的请求对象，spider爬虫文件中爬虫类实例化的对象</span></span><br><span class="line">    <span class="comment"># spider参数的作用可以实现类和中间类的数据交互</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        <span class="comment"># 返回None：继续处理本次请求，执行下一个中间件的process_request方法</span></span><br><span class="line">        <span class="comment"># 返回一个Response对象：执行当前中间件的process_response方法，重新回到引擎，被调度</span></span><br><span class="line">        <span class="comment"># 返回一个Request对象：直接返回给引擎，被调度。进入调度器等待下次被调用</span></span><br><span class="line">        <span class="comment"># 抛出IgnoreRequest异常：调用已安装的下载中间件的process_exception方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 拦截处理所有的响应对象</span></span><br><span class="line">    <span class="comment"># 参数response就是拦截到的响应体对象，request就是被拦截到响应对象对应的唯一的一个请求对象</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response, spider</span>):</span><br><span class="line">        <span class="comment"># 返回一个Response对象：继续执行，引入引擎，被调度到爬虫中进行解析</span></span><br><span class="line">        <span class="comment"># 返回一个Request对象：进入引擎，返回到调度器被重新调用</span></span><br><span class="line">        <span class="comment"># 或者抛出IgnoreRequest异常：抛出异常</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 拦截和处理发生异常的请求对象</span></span><br><span class="line">    <span class="comment"># 参数：reqeust就是拦截到的发生异常的请求对象</span></span><br><span class="line">    <span class="comment"># 方法存在的意义：将发生异常的请求拦截到，然后对其进行修正</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_exception</span>(<span class="params">self, request, exception, spider</span>):</span><br><span class="line">        <span class="comment"># 当下载处理程序或process_request()方法（来自其他下载中间件）引发异常时调用。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 必须返回以下之一：</span></span><br><span class="line">        <span class="comment"># 返回None：继续处理该异常</span></span><br><span class="line">        <span class="comment"># 返回一个Response对象：停止process_exception()链</span></span><br><span class="line">        <span class="comment"># 返回一个Request对象：停止process_exception()链</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#  控制日志数据的（忽略）</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">spider_opened</span>(<span class="params">self, spider</span>):</span><br><span class="line">        spider.logger.info(<span class="string">&quot;Spider opened: %s&quot;</span> % spider.name)</span><br></pre></td></tr></table></figure>
<ul>
<li>from_crawler(cls, crawler)方法：该方法是Scrapy用来创建爬虫的入口点。它返回一个中间件对象，并通过crawler.signals连接到spider_opened信号，以便在爬虫开启时执行相应的操作。</li>
<li>process_request(self, request, spider)方法：该方法在发送请求之前被调用。您可以在此方法中对请求进行处理和修改。返回值决定了后续处理的行为，可以是None继续处理当前请求，返回一个Response对象以便执行process_response方法，返回一个Request对象以便重新调度，或者抛出IgnoreRequest异常以调用其他下载中间件的process_exception方法。</li>
<li>process_response(self, request, response, spider)方法：该方法在收到响应后被调用。您可以在此方法中对响应进行处理和修改。返回值决定了后续处理的行为，可以是返回Response对象以便进一步处理和解析，返回Request对象以便重新调度，或者抛出IgnoreRequest异常。</li>
<li>process_exception(self, request, exception, spider)方法：当下载处理程序或其他下载中间件的process_request方法引发异常时调用该方法。您可以在此处处理异常，并根据需要返回值。</li>
<li>spider_opened(self, spider)方法：在爬虫开启时被调用。在这个示例中，它会输出一个日志信息。</li>
</ul>
<h2 id="【三】配置文件">【三】配置文件</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 是否启用爬虫中间件</span></span><br><span class="line">SPIDER_MIDDLEWARES = &#123;</span><br><span class="line">   <span class="string">&quot;SpiderNews.middlewares.SpiderNewsSpiderMiddleware&quot;</span>: <span class="number">543</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否启用下载器中间件</span></span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">   <span class="string">&quot;SpiderNews.middlewares.SpiderNewsDownloaderMiddleware&quot;</span>: <span class="number">543</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/Scrapy%E6%A1%86%E6%9E%B6%E4%B9%8B%E8%AF%B7%E6%B1%82%E5%A4%B4%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/Scrapy%E6%A1%86%E6%9E%B6%E4%B9%8B%E8%AF%B7%E6%B1%82%E5%A4%B4%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 18:31:35" itemprop="dateModified" datetime="2025-10-11T18:31:35+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Scrapy框架之请求头操作</h1>
<h2 id="【一】携带代理">【一】携带代理</h2>
<ul>
<li>再下载中间件的process_request方法中写</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">    <span class="comment"># 携带代理</span></span><br><span class="line">    proxies = &#123;</span><br><span class="line">        <span class="string">&#x27;http&#x27;</span>:<span class="string">f&#x27;http://<span class="subst">&#123;<span class="string">&quot;222.190.168.159&quot;</span>&#125;</span>:<span class="subst">&#123;<span class="string">&quot;7788&quot;</span>&#125;</span>&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 通过request的meta属性添加额外的代理ip</span></span><br><span class="line">    request.meta[<span class="string">&#x27;proxy&#x27;</span>] = proxies</span><br><span class="line">    <span class="built_in">print</span>(request.meta)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<h2 id="【二】携带cookie">【二】携带cookie</h2>
<ul>
<li>再下载中间件的process_request方法中写</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 携带cookie</span></span><br><span class="line">      <span class="built_in">print</span>(<span class="built_in">dir</span>(request))  <span class="comment"># 里面有cookie</span></span><br><span class="line">      <span class="comment"># 设置进去</span></span><br><span class="line">      request.cookies = <span class="string">&#x27;cookies&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="【三】向请求头中设置参数">【三】向请求头中设置参数</h2>
<ul>
<li>referer：声明来源地址</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 向请求头中设置参数</span></span><br><span class="line">      <span class="comment"># referer: 声明来源地址</span></span><br><span class="line">      <span class="comment"># 比如</span></span><br><span class="line">      request.headers[<span class="string">&#x27;referer&#x27;</span>] = <span class="string">&quot;https://www.baidu.com&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="【四】随机的请求头">【四】随机的请求头</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置随机的请求头(也可以直接再配置文件中声明：再配置文件中声明，所有的请求都是一样的)</span></span><br><span class="line">request.headers[<span class="string">&quot;User-Agent&quot;</span>] = UserAgent().random</span><br></pre></td></tr></table></figure>
<h2 id="【五】总结">【五】总结</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拦截请求的所有对象</span></span><br><span class="line">    <span class="comment"># 参数：request就是拦截到的请求对象，spider爬虫文件中爬虫类实例化的对象</span></span><br><span class="line">    <span class="comment"># spider参数的作用可以实现类和中间类的数据交互</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        # 携带代理</span></span><br><span class="line"><span class="string">        proxies = &#123;</span></span><br><span class="line"><span class="string">            &#x27;http&#x27;:f&#x27;http://&#123;&quot;222.190.168.159&quot;&#125;:&#123;&quot;7788&quot;&#125;&#x27;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        # 通过request的meta属性添加额外的代理ip</span></span><br><span class="line"><span class="string">        request.meta[&#x27;proxy&#x27;] = proxies</span></span><br><span class="line"><span class="string">        print(request.meta)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 携带cookie</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">dir</span>(request))  <span class="comment"># 里面有cookie</span></span><br><span class="line">        request.cookies = <span class="string">&#x27;cookies&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 向请求头中设置参数</span></span><br><span class="line">        <span class="comment"># referer: 声明来源地址</span></span><br><span class="line">        <span class="comment"># 比如</span></span><br><span class="line">        request.headers[<span class="string">&#x27;referer&#x27;</span>] = <span class="string">&quot;https://www.baidu.com&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置随机的请求头(也可以直接再配置文件中声明：再配置文件中声明，所有的请求都是一样的)</span></span><br><span class="line">        request.headers[<span class="string">&quot;User-Agent&quot;</span>] = UserAgent().random</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/MySQL%E8%BF%9B%E9%98%B6%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/MySQL%E8%BF%9B%E9%98%B6%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 18:31:35" itemprop="dateModified" datetime="2025-10-11T18:31:35+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>MySQL进阶知识之视图</h1>
<h2 id="【一】视图介绍">【一】视图介绍</h2>
<h3 id="【1】什么是视图">【1】什么是视图</h3>
<ul>
<li>视图是一种查询结果的抽象表示</li>
<li>它提供了一种灵活和安全的方式来访问和操作数据库的数据</li>
<li>通过对视图的使用，用户可以根据自己的需求获取所需的数据，而无需直接访问底层的基本表</li>
</ul>
<h3 id="【2】为什么要用视图">【2】为什么要用视图</h3>
<ul>
<li>如果要频繁操作一张虚拟的表（这张表是拼表组成），就可以制作成视图，后续直接操作</li>
</ul>
<h3 id="【3】视图的优点">【3】视图的优点</h3>
<ul>
<li>简化复杂查询</li>
<li>数据安全性</li>
<li>数据完整性</li>
<li>逻辑数据独立性</li>
<li>性能优化</li>
</ul>
<h3 id="【4】总结">【4】总结</h3>
<ul>
<li>视图可以简化查询操作、保护数据安全性、实现数据安全性、提高系统的可维护性和性能优化</li>
<li>视图提供了一种灵活且安全的数据访问方式，使用视图能够根据自身需要方便地获取和操作数据</li>
</ul>
<h2 id="【二】使用视图">【二】使用视图</h2>
<h3 id="【1】语法">【1】语法</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> 视图名（表名）<span class="keyword">as</span> 虚拟表的查询<span class="keyword">SQL</span>语句</span><br></pre></td></tr></table></figure>
<h3 id="【2】创建视图">【2】创建视图</h3>
<ul>
<li>
<p>使用视图语法创建一个视图</p>
</li>
<li>
<p>创建视图时，需要指定视图的名称和查询的原表和过滤条件</p>
</li>
<li>
<p>案例</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> my_course <span class="keyword">as</span> <span class="keyword">select</span> cname,teacher_id <span class="keyword">from</span> course <span class="keyword">where</span> cid<span class="operator">=</span><span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>my_course：视图名称</li>
<li><code>select cname,teacher_id from course where cid</code> ：SQL语句</li>
<li>course: 表名</li>
<li>cname,teacher_id：要选择的列</li>
<li>cid=2: 过滤条件</li>
</ul>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240603164131332.png" alt="image-20240603164131332"></p>
<h3 id="【3】视图查询">【3】视图查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from my_course;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240603164139257.png" alt="image-20240603164139257"></p>
<h3 id="【4】更新视图">【4】更新视图</h3>
<ul>
<li>
<p>更新了视图表，之前的表也会随之更新</p>
</li>
<li>
<p>对视图进行操作：—》update语句</p>
</li>
<li>
<p>只有满足一定条件的视图才支持更新操作</p>
</li>
<li>
<p>语法</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> my_course <span class="keyword">SET</span> column1 <span class="operator">=</span> value1 <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>my_course：视图名</li>
<li>column1：更新的列</li>
<li>column1：设置的值</li>
<li>condition：更新的条件</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> my_course <span class="keyword">SET</span> cname <span class="operator">=</span> <span class="string">&#x27;化学&#x27;</span> <span class="keyword">WHERE</span> cname<span class="operator">=</span><span class="string">&#x27;物理&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240603164725739.png" alt="image-20240603164725739"></p>
<h3 id="【5】删除视图">【5】删除视图</h3>
<ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> my_course;</span><br></pre></td></tr></table></figure>
<ul>
<li>my_course : 视图名</li>
</ul>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240603164754960.png" alt="image-20240603164754960"></p>
<h2 id="【三】总结">【三】总结</h2>
<ul>
<li>创建视图在硬盘上只会有表结构不会有表数据
<ul>
<li>表数据还是来自之前的表</li>
</ul>
</li>
<li>视图一般只会用来查询</li>
<li>当创建了较多视图后，会造成数据的难以维护</li>
</ul>
<h1>MySQL进阶知识之触发器</h1>
<h2 id="【一】触发器介绍">【一】触发器介绍</h2>
<h3 id="【1】什么是触发器">【1】什么是触发器</h3>
<ul>
<li>满足对表数据的增删改的情况下，自动触发的功能，成为触发器</li>
<li>触发器可以作为一种数据库的约束，用于保证数据的完整性和一致性。</li>
</ul>
<h3 id="【2】触发器的特点">【2】触发器的特点</h3>
<ul>
<li>触发器和表一起创建，修改，删除</li>
<li>触发器可以在特定的数据操作之前或之后触发执行</li>
<li>触发器可以根据用户定义的条件判断是否执行相应的逻辑</li>
<li>触发器可以调用储存过程、函数、触发其他触发器等，实行更复杂的业务逻辑</li>
</ul>
<h3 id="【3】为何使用触发器">【3】为何使用触发器</h3>
<ul>
<li>
<p>可以帮助我们实现日志、监控、处理等操作</p>
<ul>
<li>
<p>使用触发器可以实现很多功能</p>
</li>
<li>
<ul>
<li>比如数据验证、数据补全、数据同步、日志记录等。</li>
</ul>
</li>
<li>
<p>但需要注意，触发器的使用也需要谨慎，过多或不当的触发器可能会对数据库性能产生负面影响，因此在设计和使用触发器时应考虑到业务需求和性能方面的平衡。</p>
</li>
</ul>
</li>
</ul>
<h2 id="【二】触发器的六种使用情况">【二】触发器的六种使用情况</h2>
<ul>
<li>增前，增后，删前，删后，改前，改后</li>
</ul>
<h2 id="【三】语法结构">【三】语法结构</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> 触发器的名字 </span><br><span class="line">before<span class="operator">/</span>after </span><br><span class="line"><span class="keyword">insert</span><span class="operator">/</span><span class="keyword">update</span><span class="operator">/</span><span class="keyword">delete</span> </span><br><span class="line"><span class="keyword">on</span> </span><br><span class="line">表名 </span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> <span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">SQL</span>语句</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h2 id="【四】示例">【四】示例</h2>
<h3 id="【1】定义创建触发器（在插入数据前触发）">【1】定义创建触发器（在插入数据前触发）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_name</span><br><span class="line">BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> table_name</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- 触发器逻辑</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h3 id="【2】定义绑定触发器案例（在插入数据前触发）">【2】定义绑定触发器案例（在插入数据前触发）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_name</span><br><span class="line">BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> table_name</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- 您可以在这里执行各种操作，比如插入另一张表、更新其他表、计算值等。</span></span><br><span class="line">    <span class="comment">-- 下面是一个示例，将新插入的数据中的某一列设置为当前时间。</span></span><br><span class="line">    <span class="keyword">SET</span> NEW.column_name <span class="operator">=</span> NOW();</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h3 id="【3】绑定触发器案例">【3】绑定触发器案例</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将名为 &quot;trigger_name&quot; 的触发器绑定到名为 &quot;table_name&quot; 的表上</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> trigger_name</span><br><span class="line">AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> table_name</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- 触发器逻辑</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h3 id="【4】在插入之前触发示例">【4】在插入之前触发示例</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri_before_insert_t1 before <span class="keyword">insert</span> <span class="keyword">on</span> t1</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">sql</span>语句</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h3 id="【5】在插入之后触发示例">【5】在插入之后触发示例</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tigger_name before <span class="keyword">insert</span> <span class="keyword">on</span> table_name</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="comment">--触发器逻辑</span></span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h3 id="【6】查看当前下所有库的触发器信息">【6】查看当前下所有库的触发器信息</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> triggers\G;</span><br></pre></td></tr></table></figure>
<h3 id="【7】删除当前库下指定的触发器信息">【7】删除当前库下指定的触发器信息</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> 触发器名称;</span><br></pre></td></tr></table></figure>
<h3 id="【8】案例">【8】案例</h3>
<h4 id="（1）建表">（1）建表</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> cmd (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> auto_increment,</span><br><span class="line">  <span class="keyword">USER</span> <span class="type">CHAR</span> (<span class="number">32</span>),</span><br><span class="line">  priv <span class="type">CHAR</span> (<span class="number">10</span>),</span><br><span class="line">  cmd <span class="type">CHAR</span> (<span class="number">64</span>),</span><br><span class="line">  sub_time datetime, #提交时间</span><br><span class="line">  success enum (<span class="string">&#x27;yes&#x27;</span>, <span class="string">&#x27;no&#x27;</span>) #<span class="number">0</span>代表执行失败</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> errlog (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> auto_increment,</span><br><span class="line">  err_cmd <span class="type">CHAR</span> (<span class="number">64</span>),</span><br><span class="line">  err_time datetime</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240603183928319.png" alt="image-20240603183928319"></p>
<h4 id="2-需求">(2)需求</h4>
<p>}cmd表插入数据的success如果值为no 则去errlog表中插入一条记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$  # 将mysql默认的结束符由;换成$$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri_after_insert_cmd after <span class="keyword">insert</span> <span class="keyword">on</span> cmd <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  if NEW.success <span class="operator">=</span> <span class="string">&#x27;no&#x27;</span> <span class="keyword">then</span>  # 新记录都会被MySQL封装成<span class="keyword">NEW</span>对象</span><br><span class="line">      <span class="keyword">insert into</span> errlog(err_cmd,err_time) <span class="keyword">values</span>(NEW.cmd,NEW.sub_time);</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;  # 结束之后记得再改回来，不然后面结束符就都是$$了</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240603183941620.png" alt="image-20240603183941620"></p>
<h4 id="（3）往cmd表中插入数据">（3）往cmd表中插入数据</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> cmd (</span><br><span class="line">    <span class="keyword">USER</span>,</span><br><span class="line">    priv,</span><br><span class="line">    cmd,</span><br><span class="line">    sub_time,</span><br><span class="line">    success</span><br><span class="line">)<span class="keyword">VALUES</span></span><br><span class="line">  (<span class="string">&#x27;kevin&#x27;</span>,<span class="string">&#x27;0755&#x27;</span>,<span class="string">&#x27;ls -l /etc&#x27;</span>,NOW(),<span class="string">&#x27;yes&#x27;</span>),</span><br><span class="line">  (<span class="string">&#x27;kevin&#x27;</span>,<span class="string">&#x27;0755&#x27;</span>,<span class="string">&#x27;cat /etc/passwd&#x27;</span>,NOW(),<span class="string">&#x27;no&#x27;</span>),</span><br><span class="line">  (<span class="string">&#x27;kevin&#x27;</span>,<span class="string">&#x27;0755&#x27;</span>,<span class="string">&#x27;useradd xxx&#x27;</span>,NOW(),<span class="string">&#x27;no&#x27;</span>),</span><br><span class="line">  (<span class="string">&#x27;kevin&#x27;</span>,<span class="string">&#x27;0755&#x27;</span>,<span class="string">&#x27;ps aux&#x27;</span>,NOW(),<span class="string">&#x27;yes&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240603183957366.png" alt="image-20240603183957366"></p>
<h4 id="4-查看数据">(4)查看数据</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> cmd;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> errlog;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240603184015762.png" alt="image-20240603184015762"></p>
<h2 id="【五】自定义触发器">【五】自定义触发器</h2>
<h3 id="【1】创建触发器">【1】创建触发器</h3>
<ul>
<li>使用数据库管理系统提供的语法，创建一个新的触发器对象。</li>
<li>在创建触发器时，您需要指定触发器的名称、触发时机（例如在插入、更新或删除之前或之后）、触发的表以及触发时执行的逻辑。</li>
</ul>
<h3 id="【2】定义触发器逻辑">【2】定义触发器逻辑</h3>
<ul>
<li>
<p>在创建触发器时，您需要定义触发器在触发时所执行的逻辑。</p>
<ul>
<li>这可以是任何数据库支持的操作</li>
</ul>
</li>
<li>
<p>比如插入数据、更新数据、删除数据、查询数据等。</p>
</li>
<li>
<ul>
<li>您可以使用SQL语句或调用存储过程、函数来实现触发器的逻辑。</li>
</ul>
</li>
</ul>
<h3 id="【3】定义触发器的条件">【3】定义触发器的条件</h3>
<ul>
<li>指定触发条件
<ul>
<li>触发条件是一个逻辑表达式，当表中的数据满足该表达式时，触发器才会被激活执行相关的逻辑。</li>
<li>例如，您可以指定只有当某列的值大于特定值时才触发触发器。</li>
</ul>
</li>
</ul>
<h3 id="【4】绑定触发器">【4】绑定触发器</h3>
<ul>
<li>将触发器绑定到相应的表上。一般情况下，触发器会与指定的表相关联，当该表发生特定的数据操作时，触发器才会被触发执行。</li>
</ul>
<h3 id="【5】测试触发器">【5】测试触发器</h3>
<ul>
<li>
<p>在绑定触发器后，您可以进行一些测试操作，验证触发器的逻辑是否按照预期执行。</p>
</li>
<li>
<ul>
<li>可以插入、更新或删除数据，观察触发器是否正确地处理这些操作。</li>
</ul>
</li>
</ul>
<h2 id="【六】语句结束符">【六】语句结束符</h2>
<ul>
<li>
<p>在写触发器的语句时，会遇到特殊情况，需要要修改默认的语句结束符</p>
</li>
<li>
<p>临时修改的原因是因为触发器 存储过程等技术点 代码中也需要使用分号</p>
</li>
<li>
<p>如果不修改，则无法书写出完整的代码</p>
</li>
</ul>
<h3 id="【1】创建触发器-2">【1】创建触发器</h3>
<ul>
<li>修改结束符</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br></pre></td></tr></table></figure>
<ul>
<li>修改结束符为了区分错误的执行语句和全局结束语句</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri_after_insert_cmd after <span class="keyword">insert</span> <span class="keyword">on</span> cmd </span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	if NEW.success <span class="operator">=</span> &quot;no&quot; <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">insert into</span> errlog(err_cmd,err_time)</span><br><span class="line">	<span class="keyword">values</span>(NEW.cmd,NEW.sub_time);</span><br><span class="line">		<span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span> $$</span><br></pre></td></tr></table></figure>
<ul>
<li>使用完成后记得修改回来</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h3 id="【2】删除触发器">【2】删除触发器</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> tri_after_insert_cmd;</span><br></pre></td></tr></table></figure>
<h2 id="【七】参考模板">【七】参考模板</h2>
<h3 id="【1】在表中插入新记录时，自动生成唯一标识符">【1】在表中插入新记录时，自动生成唯一标识符</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> generate_uuid_trigger BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> table_name</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SET</span> NEW.uuid <span class="operator">=</span> UUID();</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h3 id="【2】在表中更新记录时，更新最后修改时间">【2】在表中更新记录时，更新最后修改时间</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> generate_uuid_trigger BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> table_name</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SET</span> NEW.uuid <span class="operator">=</span> UUID();</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h3 id="【3】在表中删除记录时，将记录添加到历史记录表">【3】在表中删除记录时，将记录添加到历史记录表</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> archive_deleted_record_trigger AFTER <span class="keyword">DELETE</span> <span class="keyword">ON</span> table_name</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> history_table (id, deleted_at)</span><br><span class="line">    <span class="keyword">VALUES</span> (OLD.id, NOW());</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h3 id="【4】在表中插入新记录时，检查是否满足某个条件，若不满足则取消插入操作">【4】在表中插入新记录时，检查是否满足某个条件，若不满足则取消插入操作</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> check_condition_trigger BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> table_name</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    IF NEW.column_name <span class="operator">&lt;</span> <span class="number">10</span> <span class="keyword">THEN</span></span><br><span class="line">        SIGNAL <span class="keyword">SQLSTATE</span> <span class="string">&#x27;45000&#x27;</span> <span class="keyword">SET</span> MESSAGE_TEXT <span class="operator">=</span> <span class="string">&#x27;Value must be greater than 10&#x27;</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>上述模板中的&quot;table_name&quot;和&quot;column_name&quot;应替换为您实际使用的表名和列名</li>
</ul>
<h3 id="【5】日志模板">【5】日志模板</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 创建语句前修改默认语句结束符</span><br><span class="line">delimiter $$</span><br><span class="line"># 主要是为了区分错误执行语句和全局结束语句</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri_after_insert_cmd after <span class="keyword">insert</span> <span class="keyword">on</span> cmd </span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	if NEW.success <span class="operator">=</span> &quot;no&quot; <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">insert into</span> errlog(err_cmd,err_time)</span><br><span class="line">	<span class="keyword">values</span>(NEW.cmd,NEW.sub_time);</span><br><span class="line">		<span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line"># 使用完以后要修改回原来的默认语句</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h1>MySQL进阶知识之事务</h1>
<h2 id="【一】什么是事务">【一】什么是事务</h2>
<ul>
<li>开启一个事务可以包含多条语句，这些语句要么同时成功，要么同时都不成功</li>
<li>事物的目标是确保多个操作中的每一个操作都成功执行，要么全部失败回滚</li>
</ul>
<h2 id="【二】事物的四大特性">【二】事物的四大特性</h2>
<ul>
<li>ACID</li>
</ul>
<h3 id="【1】原型性（Atomicity）">【1】原型性（Atomicity）</h3>
<ul>
<li><strong>事务被视为一个原子操作，不可再分割</strong>。</li>
<li>要么所有的操作都成功执行，要么所有的操作都会被回滚到事务开始前的状态，确保数据的一致性。</li>
</ul>
<h3 id="【2】一致性（Consistency）">【2】一致性（Consistency）</h3>
<ul>
<li><strong>事务执行前后，数据库应保持一致的状态</strong></li>
<li>在事物开始之前和结束之后，数据库必须满足所有的完整性约束，如数据类型、关系等</li>
</ul>
<h3 id="【3】隔离性（Isolation）">【3】隔离性（Isolation）</h3>
<ul>
<li><strong>事务的执行结果对其他并发执行的事务是隔离的。</strong></li>
<li>即一个事务的执行不应受到其他事务的干扰，各个事务之间应该相互独立工作，从而避免数据的不一致性。</li>
</ul>
<h3 id="【4】持久性-Durability">【4】持久性(Durability)</h3>
<ul>
<li><strong>也叫永久性</strong></li>
<li><strong>一旦事务被提交，其结果应该永久保存在数据库中，并且可以被系统故障恢复。</strong></li>
<li>即使系统发生宕机或崩溃，事务提交后的更改也应该是永久性的。</li>
</ul>
<h2 id="【三】事物的作用">【三】事物的作用</h2>
<ul>
<li>在操作多条数据的时候，可能会出现某几条操作不成功的情况</li>
</ul>
<h3 id="【1】数据库的一致性">【1】数据库的一致性</h3>
<ul>
<li>事务可以保证数据库的一致性</li>
<li>在一个事务中，要么所有操作都成功，要么全部回滚，保证了数据的完整性和一致性</li>
</ul>
<p>案例</p>
<ul>
<li><strong>在一个转账操作中，如果转出账户扣款成功而转入账户未能成功接收资金，事务可以将操作全部回滚，以确保资金的一致性。</strong></li>
</ul>
<h3 id="【2】并发控制">【2】并发控制</h3>
<ul>
<li>事务提供了并发控制机制，确保多个并发的事务不会互相干扰，并避免了数据的混乱和冲突</li>
<li>通过隔离级别的设置，事务可以控制不同事务之间的可见性和影响范围，保证并发执行时的数据一致性和隔离性</li>
</ul>
<h3 id="【3】故障恢复">【3】故障恢复</h3>
<ul>
<li>事务的持久特性确保了在事务提交后，即使系统发生了故障或崩溃，提交的结果仍然可以被恢复</li>
<li>数据库管理系统通过使用日志文件等机制，将事务的操作记录下来，以便在需要时进行恢复和重放</li>
</ul>
<h3 id="【4】高效运行">【4】高效运行</h3>
<ul>
<li>通过组织多个操作为一个事务，可以减少与数据库交互的次数，从而提高数据库的操作效率和性能</li>
<li>事务可以减少磁盘I/O、锁的竞争等操作开销，提高数据库的并发处理能力</li>
</ul>
<h3 id="【5】数据完整性和安全性">【5】数据完整性和安全性</h3>
<ul>
<li>事务可以保证数据的完整性和安全性</li>
<li>通过在事务中定义一些条件和约束，可以确保数据的有效性和准确性</li>
<li><strong>例如，在一个银行系统中，事务可以检查账户余额是否足够以及转账金额是否合法，从而保证数据的安全性和正确性</strong></li>
</ul>
<h3 id="【6】用户提交订单操作案例">【6】用户提交订单操作案例</h3>
<ul>
<li>
<p>检查库存：</p>
</li>
<li>
<ul>
<li>系统需要检查所需商品的库存是否足够。</li>
<li>如果库存不足，系统会提示用户库存不足，无法完成订单。</li>
</ul>
</li>
<li>
<p>扣减库存：</p>
</li>
<li>
<ul>
<li>如果库存充足，系统会将所购商品对应的库存数量减少。</li>
</ul>
</li>
<li>
<p>生成订单：</p>
</li>
<li>
<ul>
<li>系统会生成一个新的订单，包括订单号、商品信息、购买数量、价格等相关信息。</li>
</ul>
</li>
<li>
<p>计算总价：</p>
</li>
<li>
<ul>
<li>根据订单中的商品信息和购买数量，系统会计算出订单的总价格。</li>
</ul>
</li>
<li>
<p>更新用户账户：</p>
</li>
<li>
<ul>
<li>根据用户选择的支付方式，在扣除相应金额后，系统会更新用户账户余额或积分。</li>
</ul>
</li>
<li>
<p>生成支付信息：</p>
</li>
<li>
<ul>
<li>系统会生成相应的支付信息，以便用户完成支付。</li>
</ul>
</li>
<li>
<p>通知物流部门：</p>
</li>
<li>
<ul>
<li>系统会通知物流部门准备配送相关商品。</li>
</ul>
</li>
<li>
<p>发送订单确认邮件/短信：</p>
</li>
<li>
<ul>
<li>系统会向用户发送订单确认的邮件或短信，包括订单详细信息、配送信息等。</li>
</ul>
</li>
<li>
<p>监控商品配送：</p>
</li>
<li>
<ul>
<li>系统会跟踪订单的配送情况，并向用户提供订单状态更新。</li>
</ul>
</li>
<li>
<p>完成订单：</p>
</li>
<li>
<ul>
<li>当用户收到商品并确认满意后，订单状态会被更新为“已完成”。</li>
</ul>
</li>
</ul>
<h2 id="【四】如何使用事务">【四】如何使用事务</h2>
<h3 id="【1】事务的关键字">【1】事务的关键字</h3>
<ul>
<li>开启事务
<ul>
<li><code>start transaction;</code></li>
</ul>
</li>
<li>回滚（回到事务之前的操作）
<ul>
<li><code>rollback;</code></li>
</ul>
</li>
<li>二次确认(确认之后无法回滚)
<ul>
<li><code>commit;</code></li>
</ul>
</li>
<li>当多个数据库操作需要作为一个整体进行提交或回滚时，可以使用事务来实现</li>
</ul>
<h3 id="【2】使用事务的基本步骤">【2】使用事务的基本步骤</h3>
<h4 id="（1）开启">（1）开启</h4>
<h1>MySQL进阶知识之存储过程</h1>
<h1>MySQL进阶知识之函数</h1>
<h1>MySQL进阶知识之流程控制</h1>
<h1>MySQL进阶知识之索引</h1>
<h1>MySQL进阶知识之事务隔离机制</h1>
<h2 id="【一】数据库读现象的本质">【一】数据库读现象的本质</h2>
<ul>
<li>是数据库在高并发场景下</li>
<li>多个同时执行的事务带来的影响。</li>
</ul>
<h2 id="【二】数据库三大读现象">【二】数据库三大读现象</h2>
<ul>
<li>在数据库中，不同的事务隔离级别可能会导致脏读（Dirty Read）、不可重复读（Non-repeatable Read）和幻读（Phantom Read）等问题的出现。</li>
</ul>
<h3 id="【1】脏读">【1】脏读</h3>
<h4 id="（1）概述">（1）概述</h4>
<ul>
<li>事务1和事务2并发执行</li>
<li>事务1改了数据</li>
<li>事务2读取了以后</li>
<li>但事务1进行了回滚</li>
<li>导致事务2读取的数据有误。</li>
</ul>
<h4 id="（2）解释">（2）解释</h4>
<ul>
<li>脏读是指当一个事务读取了其他事务尚未提交的数据时发生的现象。</li>
<li>换句话说，脏读表示读取到的数据并不一定会最终存入数据库中，因此这些数据实际上是不存在的。</li>
<li>脏读现象发生在读取到了不一定存在的数据的情况下。</li>
</ul>
<h4 id="（3）总结">（3）总结</h4>
<ul>
<li>脏读指的是读当前事务到了其他事务未提交的数据，未提交意味着这些数据可能会回滚，</li>
<li>也就是可能最终不会存到数据库中，也就是不存在的数据。读到了并一定最终存在的数据，这就是脏读</li>
</ul>
<h3 id="【2】不可重复读">【2】不可重复读</h3>
<h4 id="（1）概述-2">（1）概述</h4>
<ul>
<li>事务1读取了数据</li>
<li>事务2修改了数据并且提交了</li>
<li>接着事务1再次读取</li>
<li>发现两次的数据不相同</li>
</ul>
<h4 id="（2）解释-2">（2）解释</h4>
<ul>
<li>不可重复读是指在一个事务内多次读取同一批数据，但在事务结束之前，这批数据可能发生了变化，导致读取结果不一致的情况。</li>
<li>不可重复读的产生通常是由于在事务A多次读取同一数据的过程中，事务B对数据进行了更新并提交。</li>
</ul>
<h4 id="（3）总结-2">（3）总结</h4>
<ul>
<li>解释：不可重复读指的是在一个事务内，最开始读到的数据和事务结束前的任意时刻读到的同一批数据出现不一致的情况</li>
<li>导致的原因：事务 A 多次读取同一数据，但事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果 不一致</li>
</ul>
<h3 id="【3】幻读">【3】幻读</h3>
<h4 id="（1）概述-3">（1）概述</h4>
<ul>
<li>本质上说是不可重复读的一种现象</li>
<li>事务1更改或查询了数据</li>
<li>在极短时间内,事务2又插入了一条新的数据</li>
<li>导致事务1在接下来的查询中</li>
<li>就会发现有⼏列数据是它先前所没有的。</li>
</ul>
<h4 id="（2）错误的理解">（2）错误的理解</h4>
<h5 id="1-解释">[1]解释</h5>
<ul>
<li>
<p>有时候，人们错误地将幻读理解为在两次select操作中获得了不同的数据集</p>
</li>
<li>
<ul>
<li>例如第一次select得到10条记录</li>
<li>第二次select得到15条记录。</li>
</ul>
</li>
<li>
<p>实际上，这种情况仍然属于不可重复读而非幻读。</p>
</li>
</ul>
<h5 id="2-总结">[2]总结</h5>
<ul>
<li>幻读是 事务A 执行两次 select 操作得到不同的数据集，即 select 1 得到 10 条记录，select 2 得到 15 条记录。</li>
<li>这其实并不是幻读，既然第一次和第二次读取的不一致，那不还是不可重复读吗，所以这是不可重复读的一种。</li>
</ul>
<h4 id="（3）正确的理解">（3）正确的理解</h4>
<h5 id="1-解释-2">[1]解释</h5>
<ul>
<li>幻读的本质在于某一次select操作得到的结果无法支撑后续的业务操作。</li>
<li>具体来说，例如在执行select判断某条记录是否存在时，假设该记录不存在，准备插入该记录，但在执行insert时却发现该记录已经存在，导致无法插入，这即是幻读的发生。</li>
</ul>
<h5 id="2-总结-2">[2]总结</h5>
<ul>
<li>幻读，并不是说两次读取获取的结果集不同，幻读侧重的方面是某一次的 select 操作得到的结果所表征的数据状态无法支撑后续的业务操作。</li>
<li>更为具体一些：select 某记录是否存在，不存在，准备插入此记录，但执行 insert 时发现此记录已存在，无法插入，此时就发生了幻读</li>
</ul>
<h3 id="【4】解决办法">【4】解决办法</h3>
<ul>
<li>要解决脏读，不可重复读和幻读的问题</li>
<li>我们就要引入几个概念：MVCC机制，事务隔离机制和数据库锁机制。</li>
</ul>
<h2 id="【三】数据库事务隔离机制">【三】数据库事务隔离机制</h2>
<ul>
<li>事务具有原子性、一致性、隔离性、持久性四大特性</li>
</ul>
<h3 id="【1】事务的四大特性-ACID">【1】事务的四大特性(ACID)</h3>
<h4 id="（1）原子性（Atomicity）">（1）原子性（Atomicity）</h4>
<ul>
<li>事务是一个不可再分割的单位，要么全部执行成功，要么全部回滚到初始状态，没有中间状态。</li>
<li>这意味着如果事务中的任何一步操作失败，整个事务都会被回滚，以确保数据的一致性。</li>
</ul>
<h4 id="（2）一致性（Consistency）">（2）一致性（Consistency）</h4>
<ul>
<li>事务执行前后，数据库的状态必须保持一致。</li>
<li>这意味着事务在执行期间对数据的操作必须满足预定义的规则和完整性约束，以确保数据的有效性和正确性。</li>
</ul>
<h4 id="（3）隔离性（Isolation）">（3）隔离性（Isolation）</h4>
<ul>
<li>多个事务可能同时执行，事务之间应该相互隔离，互不影响。</li>
<li>隔离性确保每个事务的操作在逻辑上独立于其他并发事务的操作，从而避免了数据不一致的问题。</li>
</ul>
<h4 id="（4）持久性（Durability）">（4）持久性（Durability）</h4>
<ul>
<li>一旦事务提交，对数据库的更改应该是永久性的，即使在系统故障的情况下也不应该丢失。</li>
<li>持久性通过将事务记录在持久存储介质（如磁盘）上来实现。</li>
</ul>
<h3 id="【2】隔离性的四种级别">【2】隔离性的四种级别</h3>
<h4 id="（1）引入">（1）引入</h4>
<ul>
<li>
<p>而隔离性顾名思义指的就是事务彼此之间隔离开</p>
</li>
<li>
<ul>
<li>多个事务在同时处理一个数据时彼此之间互相不影响</li>
<li>如如果隔离的不够好就有可能会产生脏读、不可重复度、幻读等读现象</li>
</ul>
</li>
<li>
<p>为此，隔离性总共分为四种级别</p>
</li>
<li>
<p>由低到高依次为</p>
</li>
<li>
<ul>
<li>Read uncommitted（未提交读）</li>
<li>Read committed （提交读）</li>
<li>Repeatable read（可重复读）</li>
<li>Serializable（串行化）</li>
</ul>
</li>
</ul>
<h4 id="（2）四种级别">（2）四种级别</h4>
<h5 id="1-Read-uncommitted（读未提交）">[1]Read uncommitted（读未提交）</h5>
<ul>
<li>最低的隔离级别，在这个级别下，一个事务可以读取到另一个事务尚未提交的数据，可能导致脏读（Dirty Read）问题，即读取到未经验证的数据。</li>
</ul>
<h5 id="2-Read-committed（读已提交）">[2]Read committed（读已提交）</h5>
<ul>
<li>在这个级别下，一个事务只能读取到已经提交的数据，避免了脏读问题。</li>
<li>但是可能会出现不可重复读（Non-repeatable Read）问题，即同一事务中，两次读取相同的记录可能得到不同的结果，因为其他事务修改了这些记录。</li>
</ul>
<h5 id="3-Repeatable-read（可重复读取）">[3]Repeatable read（可重复读取）</h5>
<ul>
<li>在这个级别下，事务开始读取数据后，其他事务无法修改这些数据，保证了同一个事务内两次读取相同记录的一致性。</li>
<li>但是可能会出现幻读（Phantom Read）问题，即同一查询在同一事务中两次执行可能返回不同的结果，因为其他事务插入或删除了符合查询条件的记录。</li>
</ul>
<h5 id="4-Serializable（串行化）">[4]Serializable（串行化）</h5>
<ul>
<li>最高级别的隔离级别，要求事务串行执行，事务之间完全隔离，避免了脏读、不可重复读和幻读问题。</li>
<li>但是这会牺牲并发性能，因为并发事务被限制为顺序执行。</li>
</ul>
<h3 id="【3】四大隔离级别解决了什么问题">【3】四大隔离级别解决了什么问题</h3>
<ul>
<li>
<p>Read uncommitted（读未提交）</p>
</li>
<li>
<ul>
<li><strong>存在脏读、不可重复读和幻读问题</strong>。</li>
</ul>
</li>
<li>
<p>Read committed（读已提交）</p>
</li>
<li>
<ul>
<li><strong>解决了脏读问题</strong>，但<strong>仍可能出现不可重复读和幻读</strong>。</li>
</ul>
</li>
<li>
<p>Repeatable read（可重复读取）</p>
</li>
<li>
<ul>
<li><strong>解决了脏读和不可重复读问题</strong>，但<strong>仍可能出现幻读</strong>。</li>
</ul>
</li>
<li>
<p>Serializable（串行化）</p>
</li>
<li>
<ul>
<li><strong>解决了脏读、不可重复读和幻读问题</strong>，但在<strong>效率方面有所牺牲</strong>。</li>
</ul>
</li>
</ul>
<h3 id="【4】MySQL的存储引擎默认的隔离级别">【4】MySQL的存储引擎默认的隔离级别</h3>
<ul>
<li>Repratable read (可重复读)</li>
</ul>
<h3 id="【5】幻读的解决办法">【5】幻读的解决办法</h3>
<ul>
<li>MySQL引入了Next-key lock的行级锁来解决，我们将会在下一节里详细叙述</li>
</ul>
<h2 id="【四】MVCC机制">【四】MVCC机制</h2>
<h3 id="【1】什么是MVCC机制">【1】什么是MVCC机制</h3>
<ul>
<li>MVCC是MySQL InnoDB存储引擎实现的一种基于多版本的并发控制协议。</li>
<li>基于多版本的并发控制协议——MVCC (Multi-Version Concurrency Control) 。</li>
</ul>
<h3 id="【2】MVCC的优势">【2】MVCC的优势</h3>
<ul>
<li>MVCC实现了读不加锁，避免了读写冲突，提高了系统的并发性能。</li>
<li>MVCC解决了数据的脏读问题，保证了数据的一致性。</li>
</ul>
<h3 id="【3】MVCC的读操作">【3】MVCC的读操作</h3>
<ul>
<li>MVCC的并发控制的系统中，读操作可分为两类：当前读和快照读。</li>
</ul>
<h4 id="（1）快照读">（1）快照读</h4>
<ul>
<li>快照读是指对数据库进行简单的select操作时，不会加锁，而是通过查询当前事务开始时的系统时间点，获取该时间点之前的数据副本。</li>
<li>由于每个事务都有自己的时间点，所以每个事务看到的都是自己创建时的状态，从而避免了脏读的发生。</li>
</ul>
<h4 id="（2）当前读">（2）当前读</h4>
<ul>
<li>特殊的读操作，插入/更新/删除操作，属于当前读，需要加锁。</li>
<li>当前读是指对数据库进行插入、更新或删除操作时，需要加锁，以防止其他事务修改已经锁定的数据。只有当事务完成所有更新后，才会将其提交到数据库，并释放所有的锁。</li>
<li>这种机制可以确保数据的一致性和完整性，但会降低系统的并发性能。</li>
</ul>
<h1>MySQL进阶知识之锁机制</h1>
<h2 id="【一】什么是锁机制">【一】什么是锁机制</h2>
<ul>
<li>
<p>我们可以通过一个很简单的比喻来理解事务的锁机制。</p>
</li>
<li>
<p>比如同一个办公室的同事们</p>
</li>
<li>
<ul>
<li>都想使用打印机打印文件</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>如果不加以控制</li>
<li>可能出现两个人同时打印不同的内容在一个文件里</li>
<li>就会引起内容混乱。</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>于是，我们就引入了锁的概念</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>当有并发的多个事务同时操作同一份数据时</li>
<li>只有“抢到”了锁的事务</li>
<li>才能真正去操作数据</li>
<li>使得数据的安全性得到保证。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="【二】为什么要用锁机制">【二】为什么要用锁机制</h2>
<ul>
<li>
<p>锁保证并发的多个事务同一时间只有一个能运行</p>
</li>
<li>
<ul>
<li>会一定程度上降低程序的运行效率</li>
<li>但是能大大提升数据的安全性。</li>
</ul>
</li>
</ul>
<h2 id="【三】数据库锁的分类">【三】数据库锁的分类</h2>
<h3 id="【1】按粒度分">【1】按粒度分</h3>
<ul>
<li>
<p>数据库的锁按粒度分为</p>
</li>
<li>
<ul>
<li>行级锁</li>
<li>表级锁</li>
<li>页级锁</li>
</ul>
</li>
</ul>
<h4 id="（1）什么是⾏级锁">（1）什么是⾏级锁</h4>
<ul>
<li>
<p>⾏级锁是Mysql中锁定粒度最细的⼀种锁</p>
</li>
<li>
<ul>
<li>表示只针对当前操作的⾏进⾏加锁。</li>
</ul>
</li>
<li>
<p>⾏级锁能⼤⼤减少数据库操作的冲突。</p>
</li>
<li>
<ul>
<li>其加锁粒度最⼩，但加锁的开销也最⼤。</li>
</ul>
</li>
<li>
<p>⾏级锁分为共享锁和排他锁。</p>
</li>
</ul>
<h4 id="（2）⾏级锁的特点">（2）⾏级锁的特点</h4>
<ul>
<li>开销⼤，加锁慢；</li>
<li>会出现死锁；</li>
<li>锁定粒度最⼩，发⽣锁冲突的概率最低，并发度也最⾼</li>
</ul>
<h4 id="（3）⾏级锁解释">（3）⾏级锁解释</h4>
<ul>
<li>
<p>由于数据库的库和表都是事先建好的</p>
</li>
<li>
<ul>
<li>所以我们针对数据库的操作一般都是针对记录。</li>
<li>而对记录进行的四种操作（增删改查）</li>
<li>我们可以分为两类</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>增删改属于读操作</li>
<li>而查询属于写操作。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>写操作默认就会加锁，且加的是互斥锁</p>
</li>
<li>
<ul>
<li>很容易理解，在进行写行为的时候一定是必须“排他”的。</li>
<li>读操作默认不受任何锁影响</li>
<li>但是互斥锁和共享锁都可以加。</li>
</ul>
</li>
<li>
<p>读操作加互斥锁 for update;</p>
</li>
<li>
<p>读操作加共享锁 lock in share mode;</p>
</li>
</ul>
<p>提示：关于共享锁和互斥锁，我们将在下一小节更详细地讲述</p>
<h4 id="（4）行级锁锁的是索引">（4）行级锁锁的是索引</h4>
<ul>
<li>
<p>行级锁锁的是索引</p>
</li>
<li>
<ul>
<li>命中索引以后才会锁行</li>
<li>如果没有命中索引</li>
<li>会把整张表都锁起来。</li>
</ul>
</li>
<li>
<p>命中主键索引就锁定这条语句命中的主键索引</p>
</li>
<li>
<ul>
<li>命中辅助索引就会先锁定这条辅助索引</li>
<li>再锁定相关的主键索引</li>
<li>考虑到性能，innodb默认支持行级锁</li>
<li>但是只有在命中索引的情况下才锁行，</li>
</ul>
</li>
<li>
<p>否则锁住所有行</p>
</li>
<li>
<ul>
<li>本质还是行锁</li>
<li>但是此刻相当于锁表了</li>
</ul>
</li>
</ul>
<h4 id="（5）行级锁的三种算法">（5）行级锁的三种算法</h4>
<ul>
<li>
<p>1、Record lock</p>
</li>
<li>
<p>2、Gap lock</p>
</li>
<li>
<p>3、Next-key lock</p>
</li>
<li>
<p>其中 Next-key lock 为MySQL默认的锁机制</p>
</li>
<li>
<ul>
<li>相当于另外两种锁的功能的整合</li>
<li>并能够解决幻读问题。</li>
</ul>
</li>
<li>
<p>提示：</p>
</li>
<li>
<ul>
<li>在RR事务隔离机制下，才会锁间隙</li>
<li>而RR机制是mysql的默认事务隔离机制。</li>
<li>所以，在默认情况下，其实innodb存储引擎锁的是行以及间隙.</li>
</ul>
</li>
<li>
<p>我们可以用一个实验来验证上述关于行锁的结论</p>
</li>
</ul>
<h4 id="（6）实验">（6）<strong>实验</strong></h4>
<table>
<thead>
<tr>
<th>事务一</th>
<th>事务二</th>
</tr>
</thead>
<tbody>
<tr>
<td>start transaction;</td>
<td>开启事务start transaction;</td>
</tr>
<tr>
<td></td>
<td>– 加排他锁select from t1 where id=7 for update; – 须知-- 1、上述语句命中了索引，所以加的是行锁-- 2、InnoDB对于行的查询都是采用了Next-Key Lock的算法，锁定的不是单个值，而是一个范围（GAP）表记录的索引值为1，5，7，11，其记录的GAP区间如下：（-∞,1]，(1,5]，(5,7]，(7,11]，(11,+∞）因为记录行默认就是按照主键自增的，所以是一个左开右闭的区间其中上述查询条件id=7处于区间(5,7]中，所以Next-Key lock会锁定该区间的记录，但是还没完-- 3、<em>InnoDB存储引擎还会对辅助索引下一个键值加上gap lock</em>*。区间(5,7]的下一个Gap是(7,11],所以(7,11]也会被锁定综上所述，最终确定5-11之间的值都会被锁定</td>
</tr>
<tr>
<td>– 下述sql全都会阻塞在原地insert t1 values(5);insert t1 values(6);insert t1 values(7);insert t1 values(8);insert t1 values(9);insert t1 values(10); – 下述等sql均不会阻塞insert t1 values(11); insert t1 values(1); insert t1 values(2);insert t1 values(3);insert t1 values(4);</td>
<td></td>
</tr>
<tr>
<td>– 提交一下事务，不要影响下一次实验commit;</td>
<td>– 提交一下事务，不要影响下一次实验commit;</td>
</tr>
</tbody>
</table>
<h3 id="【2】按级别分">【2】按级别分</h3>
<ul>
<li>
<p>数据库的锁按级别分为</p>
</li>
<li>
<ul>
<li>共享锁，排他锁，共享锁</li>
<li>又被称作读锁，s锁</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>含义是多个事务共享同一把锁</li>
<li>其中每个事务都能访问到数据</li>
<li>但是没有办法进行修改。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>注意：</p>
</li>
<li>
<ul>
<li>如果事务T对数据A加上共享锁后</li>
<li>则其他事务只能对A再加共享锁或不加锁（在其他事务里一定不能再加排他锁</li>
<li>但是在事务T自己里面是可以加的）</li>
</ul>
</li>
<li>
<p>排他锁又被称作互斥锁，写锁，x锁</p>
</li>
<li>
<ul>
<li>含义是如果有一个事务获取了一个数据的排他锁</li>
<li>那么其它的事务都无法再次获得该数据的任何锁了</li>
<li>但是排他锁支持文件读取，修改和写入。</li>
</ul>
</li>
</ul>
<h3 id="【3】按使用方式分">【3】按使用方式分</h3>
<ul>
<li>
<p>数据库的锁按使用方式分为</p>
</li>
<li>
<ul>
<li>悲观锁、乐观锁</li>
</ul>
</li>
</ul>
<h4 id="（1）悲观锁（Pessimistic-Locking）">（1）悲观锁（Pessimistic Locking）</h4>
<ul>
<li>顾名思义指的是对外界将要进行的数据修改操作持悲观态度</li>
<li>因此，在整个数据处理过程中，将数据处于锁定状态。</li>
<li>现在由于互联网的高并发架构，即使加上悲观锁也无法保证数据不被外界修改，因此不推荐使用。</li>
</ul>
<h4 id="（2）乐观锁（Optimistic-Locking）">（2）乐观锁（Optimistic Locking）</h4>
<ul>
<li>
<p>相对悲观锁而言，乐观锁假设认为数据一般情况下不会造成冲突</p>
</li>
<li>
<p>所以在数据进行提交更新的时候，才会正式对数据的冲突与否进行检测</p>
</li>
<li>
<p>如果发现冲突了，则让返回用户错误的信息，让用户决定如何去做。</p>
</li>
<li>
<p>通常乐观锁的实现是在表中加一个字段（可能是时间戳或版本号）</p>
</li>
<li>
<p>在写入的时候会查询一下版本号</p>
</li>
<li>
<ul>
<li>如果版本号没有改变，就写入数据库并同时改变版本号。</li>
</ul>
</li>
<li>
<p>从本质上来说，乐观锁并没有加锁</p>
</li>
<li>
<ul>
<li>所以效率会大大提升</li>
<li>但也有一定的缺陷，就是可能导致一部分任务的写入失败。</li>
</ul>
</li>
</ul>
<h2 id="【四】死锁问题">【四】死锁问题</h2>
<ul>
<li>
<p>我们举一个例子来形象的说明死锁这个概念。</p>
</li>
<li>
<p>比如你和你的邻居同时被锁在了屋子里</p>
</li>
<li>
<ul>
<li>然而你有你邻居的钥匙</li>
<li>你的邻居也有你的钥匙</li>
<li>你们互相可以打开对方的房门</li>
<li>但是却都被锁在了各自的屋子里</li>
<li>这就是一个简单的死锁现象</li>
</ul>
</li>
</ul>
<h3 id="【1】第一种情况的死锁">【1】第一种情况的死锁</h3>
<table>
<thead>
<tr>
<th>事务1</th>
<th>事务2</th>
</tr>
</thead>
<tbody>
<tr>
<td>begin</td>
<td>begin</td>
</tr>
<tr>
<td>select * from t1 where id=6 for update;</td>
<td>delete from t1 where id=3;</td>
</tr>
<tr>
<td>update t1 set age=18 where id=3;</td>
<td>delete from t1 where id=6; – 阻塞</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>第一种死锁情况非常好理解，也是最常见的死锁</p>
</li>
<li>
<ul>
<li>每个事务执行两条SQL，分别持有了一把锁</li>
<li>然后加另一把锁，产生死锁。</li>
</ul>
</li>
<li>
<p>大多数死锁问题</p>
</li>
<li>
<ul>
<li>innodb存储引擎都会发现并抛出异常</li>
<li>但是有一种死锁问题极其隐蔽。</li>
</ul>
</li>
</ul>
<h3 id="【2】第二种情况的死锁">【2】第二种情况的死锁</h3>
<ul>
<li>
<p>与上一种死锁情况不同的是</p>
</li>
<li>
<ul>
<li>这种死锁现象必须是两个事务同时运行的情况下才可能发生。</li>
</ul>
</li>
<li>
<p>前面我们提到过，聚集索引对应的是一整行数据记录。</p>
</li>
<li>
<ul>
<li>当事务1根据一定的过滤条件</li>
<li>筛选出两条辅助索引时</li>
<li>根据索引的有序性</li>
<li>在锁完辅助索引后锁主键索引时</li>
<li>先锁主键1对应的记录再锁主键2。</li>
<li>如果在此同时</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>事务2通过别的辅助索引同样访问到了这两条数据</li>
<li>但顺序却是先锁主键2再锁主键1</li>
<li>就会互相锁住</li>
<li>产生死锁现象</li>
<li>而且这种情况非常隐蔽，较难排查。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1>数据库的三大范式</h1>
<h2 id="【一】什么是范式">【一】什么是范式</h2>
<ul>
<li>范式就是我们设计数据库的表时，一些共同遵循的规范</li>
<li>掌握这些设计时的范式，可以让我们的项目之初，设计库的表结构更加合理和优雅</li>
</ul>
<h2 id="【二】三大范式之间的关系">【二】三大范式之间的关系</h2>
<ul>
<li>三大范式之间是递增的关系，一个范式是在前一个范式的基础上推行</li>
<li>三大范式之间不可颠倒，后者都是建立在前者之上</li>
</ul>
<h2 id="【三】第一范式（1NF）">【三】第一范式（1NF）</h2>
<h3 id="【1】什么是第一范式">【1】什么是第一范式</h3>
<ul>
<li>表库设计时，主要是确保原子性，也就是确保数据具有不可再分性</li>
<li>这里的原子性和MySQL特点中的原子性不同</li>
</ul>
<h3 id="【2】第一范式的原子性">【2】第一范式的原子性</h3>
<ul>
<li>指一个字段不可再分割，其中不可包含其它更小的数据单元</li>
<li>就是说一个字段的数据不能再被进一步分解为更小的数据单元</li>
</ul>
<h4 id="（1）例子说明">（1）例子说明</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 比如我们有一张表</span></span><br><span class="line"><span class="comment">-- 表的结构如下</span></span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+--------+-------+</span></span><br><span class="line"><span class="operator">|</span> student              <span class="operator">|</span> course <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+--------+-------+</span></span><br><span class="line"><span class="operator">|</span> 蚩梦，男，<span class="number">185</span>cm      <span class="operator">|</span> 语文   <span class="operator">|</span>    <span class="number">95</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 蚩梦，男，<span class="number">185</span>cm      <span class="operator">|</span> 数学   <span class="operator">|</span>   <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 蚩梦，男，<span class="number">185</span>cm      <span class="operator">|</span> 英语   <span class="operator">|</span>    <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 萌萌，女，<span class="number">170</span>cm      <span class="operator">|</span> 语文   <span class="operator">|</span>    <span class="number">99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 萌萌，女，<span class="number">170</span>cm      <span class="operator">|</span> 数学   <span class="operator">|</span>    <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 萌萌，女，<span class="number">170</span>cm      <span class="operator">|</span> 英语   <span class="operator">|</span>    <span class="number">95</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+--------+-------+</span></span><br></pre></td></tr></table></figure>
<ul>
<li>student明显不符合我们第一范式的要求
<ul>
<li>第一规范的要求—》<strong>一个字段不可再分割，其中不可包含其它更小的数据单元</strong></li>
</ul>
</li>
<li>student字段还是可以在继续拆分</li>
</ul>
<h4 id="（2）基于第一范式优化">（2）基于第一范式优化</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">--------------+-------------+----------------+--------+-------+</span></span><br><span class="line"><span class="operator">|</span> student_name <span class="operator">|</span> student_sex <span class="operator">|</span> student_height <span class="operator">|</span> course <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+-------------+----------------+--------+-------+</span></span><br><span class="line"><span class="operator">|</span> 蚩梦         <span class="operator">|</span> 男          <span class="operator">|</span> <span class="number">185</span>cm          <span class="operator">|</span> 语文   <span class="operator">|</span>    <span class="number">95</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 蚩梦         <span class="operator">|</span> 男          <span class="operator">|</span> <span class="number">185</span>cm          <span class="operator">|</span> 数学   <span class="operator">|</span>   <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 蚩梦         <span class="operator">|</span> 男          <span class="operator">|</span> <span class="number">185</span>cm          <span class="operator">|</span> 英语   <span class="operator">|</span>    <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 萌萌         <span class="operator">|</span> 女          <span class="operator">|</span> <span class="number">170</span>cm          <span class="operator">|</span> 语文   <span class="operator">|</span>    <span class="number">99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 萌萌         <span class="operator">|</span> 女          <span class="operator">|</span> <span class="number">170</span>cm          <span class="operator">|</span> 数学   <span class="operator">|</span>    <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 萌萌         <span class="operator">|</span> 女          <span class="operator">|</span> <span class="number">170</span>cm          <span class="operator">|</span> 英语   <span class="operator">|</span>    <span class="number">95</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+-------------+----------------+--------+-------+</span></span><br></pre></td></tr></table></figure>
<ul>
<li>将student字段拆分成三个字段后，这张表符合了第一范式的规范</li>
</ul>
<h4 id="（3）如果不去拆分列满足第一范式，会造成什么影响呢？">（3）如果不去拆分列满足第一范式，会造成什么影响呢？</h4>
<ul>
<li>我们使用不符合第一范式的表结构去做业务开发时，操作会比较麻烦一些，当我们进行符合第一范式的二次设计后，虽然表的字段变多了，但是数据结构变得清晰了很多</li>
</ul>
<h4 id="（4）第一范式（1NF）">（4）第一范式（1NF）</h4>
<ul>
<li>第一范式我们通常叫 1NF</li>
<li>第一范式要求我们必须遵守原子性
<ul>
<li>及数据库的每一列都是不可分割
<ul>
<li>每列的值具有原子性，不可再分割</li>
<li>每个字段的值都只能是单一值</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="【四】第二范式（2NF）">【四】第二范式（2NF）</h2>
<h3 id="【1】什么是第二范式">【1】什么是第二范式</h3>
<ul>
<li>第二范式是满足第一范式的基础上</li>
<li>第二范式要求表中的所有列，其数据依赖于主键
<ul>
<li>既一张表只存储同一类型的数据，不能有任何一列数据的主键没有关系</li>
</ul>
</li>
</ul>
<h3 id="【2】案例（第二范式）">【2】案例（第二范式）</h3>
<h4 id="（1）基于第一范式的表">（1）基于第一范式的表</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">--------------+-------------+----------------+--------+-------+</span></span><br><span class="line"><span class="operator">|</span> student_name <span class="operator">|</span> student_sex <span class="operator">|</span> student_height <span class="operator">|</span> course <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+-------------+----------------+--------+-------+</span></span><br><span class="line"><span class="operator">|</span> 蚩梦         <span class="operator">|</span> 男          <span class="operator">|</span> <span class="number">185</span>cm          <span class="operator">|</span> 语文   <span class="operator">|</span>    <span class="number">95</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 蚩梦         <span class="operator">|</span> 男          <span class="operator">|</span> <span class="number">185</span>cm          <span class="operator">|</span> 数学   <span class="operator">|</span>   <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 蚩梦         <span class="operator">|</span> 男          <span class="operator">|</span> <span class="number">185</span>cm          <span class="operator">|</span> 英语   <span class="operator">|</span>    <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 萌萌         <span class="operator">|</span> 女          <span class="operator">|</span> <span class="number">170</span>cm          <span class="operator">|</span> 语文   <span class="operator">|</span>    <span class="number">99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 萌萌         <span class="operator">|</span> 女          <span class="operator">|</span> <span class="number">170</span>cm          <span class="operator">|</span> 数学   <span class="operator">|</span>    <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 萌萌         <span class="operator">|</span> 女          <span class="operator">|</span> <span class="number">170</span>cm          <span class="operator">|</span> 英语   <span class="operator">|</span>    <span class="number">95</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+-------------+----------------+--------+-------+</span></span><br></pre></td></tr></table></figure>
<h4 id="2-基于第二范式进行优化">(2)基于第二范式进行优化</h4>
<ul>
<li>表一
<ul>
<li>student：学生</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+--------+------+--------+--------------+--------------+</span></span><br><span class="line"><span class="operator">|</span> student_id <span class="operator">|</span> name   <span class="operator">|</span> sex  <span class="operator">|</span> height <span class="operator">|</span> department   <span class="operator">|</span> dean         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------+------+--------+--------------+--------------+</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> 蚩梦   <span class="operator">|</span> 男   <span class="operator">|</span> <span class="number">185</span>cm  <span class="operator">|</span> 计算机系     <span class="operator">|</span> 竹子老大     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span> 萌萌   <span class="operator">|</span> 女   <span class="operator">|</span> <span class="number">170</span>cm  <span class="operator">|</span> 金融系       <span class="operator">|</span> 熊猫老大     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------+------+--------+--------------+--------------+</span></span><br></pre></td></tr></table></figure>
<ul>
<li>表二
<ul>
<li>course：学科</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> course_id <span class="operator">|</span> course_name <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------------+</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> 语文        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span> 数学        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">3</span> <span class="operator">|</span> 英语        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------------+</span></span><br></pre></td></tr></table></figure>
<ul>
<li>表三
<ul>
<li>score :成绩</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----------+------------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> score_id <span class="operator">|</span> student_id <span class="operator">|</span> course_id <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>    <span class="number">95</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>   <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span>         <span class="number">3</span> <span class="operator">|</span>    <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">4</span> <span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>    <span class="number">99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">5</span> <span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>    <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">6</span> <span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span>         <span class="number">3</span> <span class="operator">|</span>    <span class="number">95</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------------+-----------+-------+</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>小结：</p>
<ul>
<li>
<p>我们将原来的第一范式优化的表拆成了三份</p>
</li>
<li>
<p>每张表的id作为自己本表的主键，其他字段都依赖于自己的主键</p>
</li>
<li>
<p>无论那张表都可以根据主键id获得其它字段的值</p>
</li>
<li>
<p>我们可以看出经过第二范式优化后，每张表都有各自的业务属性，都具有唯一性</p>
<ul>
<li>每张表只描述一件事</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="【3】小结">【3】小结</h3>
<ul>
<li>
<p>第二范式也叫做2NF</p>
<ul>
<li>第二范式是基于第一范式的基础上建立起来的</li>
<li>满足第二范式必须先满足第一范式</li>
</ul>
</li>
<li>
<p>第一范式要求我们必须遵守原子性</p>
</li>
<li>
<p>第二范式要求表中的所有列，其数据依赖于主键</p>
</li>
<li>
<ul>
<li>即一张表只存储同一类型的数据，不能有任何一列数据与主键没有关系</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>如果表是单主键，那么主键以外的列必须完全依赖于主键，其它列需要跟主键有关系</li>
<li>如果表是复合主键，那么主键以外的列必须完全依赖于主键，不能仅依赖主键的一部分</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="【五】第三范式（3NF）">【五】第三范式（3NF）</h2>
<h3 id="【1】什么是第三范式">【1】什么是第三范式</h3>
<ul>
<li>第三范式是满足第二范式的基础上</li>
<li>第三范式要求表中每一列数据不能与主键以外的字段有直接联系
<ul>
<li>表中的非主键列必须和主键直接相关而不能间接相关</li>
<li>非主键列之间不能相关依赖，不存在传递依赖</li>
</ul>
</li>
</ul>
<h3 id="【2】案例（第三范式）">【2】案例（第三范式）</h3>
<h4 id="（1）基于第二范式的基表">（1）基于第二范式的基表</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+--------+------+--------+--------------+--------------+</span></span><br><span class="line"><span class="operator">|</span> student_id <span class="operator">|</span> name   <span class="operator">|</span> sex  <span class="operator">|</span> height <span class="operator">|</span> department   <span class="operator">|</span> dean         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------+------+--------+--------------+--------------+</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> 蚩梦   <span class="operator">|</span> 男   <span class="operator">|</span> <span class="number">185</span>cm  <span class="operator">|</span> 计算机系     <span class="operator">|</span> 竹子老大     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span> 萌萌   <span class="operator">|</span> 女   <span class="operator">|</span> <span class="number">170</span>cm  <span class="operator">|</span> 金融系       <span class="operator">|</span> 熊猫老大     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------+------+--------+--------------+--------------+</span></span><br></pre></td></tr></table></figure>
<h4 id="2-第三范式进行优化">(2)第三范式进行优化</h4>
<ul>
<li>department : 部门</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">---------------+-----------------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> department_id <span class="operator">|</span> department_name <span class="operator">|</span> department_dean <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-----------------+-----------------+</span></span><br><span class="line"><span class="operator">|</span>             <span class="number">1</span> <span class="operator">|</span> 计算机系        <span class="operator">|</span> 竹子老大        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>             <span class="number">2</span> <span class="operator">|</span> 金融系          <span class="operator">|</span> 熊猫老大        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-----------------+-----------------+</span></span><br></pre></td></tr></table></figure>
<ul>
<li>student：学生</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+--------+------+--------+---------------+</span></span><br><span class="line"><span class="operator">|</span> student_id <span class="operator">|</span> name   <span class="operator">|</span> sex  <span class="operator">|</span> height <span class="operator">|</span> department_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------+------+--------+---------------+</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span> 蚩梦   <span class="operator">|</span> 男   <span class="operator">|</span> <span class="number">185</span>cm  <span class="operator">|</span>             <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span> 萌萌   <span class="operator">|</span> 女   <span class="operator">|</span> <span class="number">170</span>cm  <span class="operator">|</span>             <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------+------+--------+---------------+</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>小结：</p>
</li>
<li>
<p>经过上述优化后，我们又将学生表拆成了 学生表 和 院系表 。</p>
</li>
<li>
<ul>
<li>学生表只存储一个院系对应的 ID</li>
<li>院系表存储院系相关的数据</li>
</ul>
</li>
<li>
<p>通过以上优化，我们可以发现</p>
</li>
<li>
<ul>
<li>学生表中的每个非主键字段与其他非主键字段之间都是相互独立的</li>
<li>彼此之间不存在任何依赖关系</li>
<li>所有的字段都依赖于主键</li>
</ul>
</li>
</ul>
<h3 id="【3】如果不调整表结构会如何？">【3】如果不调整表结构会如何？</h3>
<ul>
<li>
<p>如果不调整上述结构，那么我们在操作数据表的时候就会发生如下问题</p>
</li>
<li>
<ul>
<li>当一个院系院长换人后，需要修改学生信息表中的每一条数据</li>
<li>当一个院长离职后，需要删除院长的相关数据，包括学生表中的相关数据</li>
</ul>
</li>
<li>
<p>由此，会引发很多意料之外的错误和数据异常，让整张表较难维护</p>
</li>
</ul>
<h3 id="【4】小结">【4】小结</h3>
<ul>
<li>
<p>第三范式，我们通常也叫 3NF</p>
</li>
<li>
<ul>
<li>第三范式(3NF)是在第二范式(2NF)的基础上建立起来得</li>
<li>满足第三范式(3NF)必须先满足第二范式(2NF)</li>
</ul>
</li>
<li>
<p>第一范式要求我们必须遵守原子性</p>
</li>
<li>
<p>第二范式要求表中的所有列，其数据依赖于主键</p>
</li>
<li>
<ul>
<li>即一张表只存储同一类型的数据，不能有任何一列数据与主键没有关系</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>如果表是单主键，那么主键以外的列必须完全依赖于主键，其它列需要跟主键有关系</li>
<li>如果表是复合主键，那么主键以外的列必须完全依赖于主键，不能仅依赖主键的一部分</li>
</ul>
</li>
</ul>
</li>
<li>
<p>第三范式要求表中每一列数据不能与主键之外的字段有直接关系</p>
</li>
<li>
<ul>
<li>表中的非主键列必须和主键直接相关而不能间接相关</li>
<li>非主键列之间不能相关依赖，不存在传递依赖</li>
</ul>
</li>
</ul>
<h2 id="【六】数据库三范式总结">【六】数据库三范式总结</h2>
<ul>
<li>
<p>三范式直观阐述，总结如下：</p>
</li>
<li>
<ul>
<li>第一范式：确保原子性，表中每一个列数据都必须是不可再分的字段。</li>
<li>第二范式：确保唯一性，每张表都只描述一种业务属性，一张表只描述一件事。</li>
<li>第三范式：确保独立性，表中除主键外，每个字段之间不存在任何依赖，都是独立的。</li>
</ul>
</li>
<li>
<p>没有按照范式设计时，会存在几个问题：</p>
</li>
<li>
<ul>
<li>整张表数据比较冗余，同一个学生信息会出现多条。</li>
<li>表结构特别臃肿，不易于操作，要新增一个学生信息时，需添加大量数据。</li>
<li>需要更新其他业务属性的数据时，比如院系院长换人了，需要修改所有学生的记录。</li>
</ul>
</li>
<li>
<p>但按照三范式将表结构拆开后</p>
</li>
<li>
<ul>
<li>假设要新增一条学生数据，就只需要插入学生相关的信息即可</li>
<li>同时如果某个院系的院长换人了，只需要修改院系表中的院长就行，学生表中的数据无需发生任何更改。</li>
</ul>
</li>
<li>
<p><strong>经过三范式的设计优化后，整个库中的所有表结构，会显得更为优雅，灵活性也会更强</strong></p>
</li>
</ul>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cc2f707a1-189a-4dfe-bd28-e4572d65f3c3.png" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/Scrapy%E6%A1%86%E6%9E%B6%E4%B9%8B%E5%85%A8%E7%AB%99%E7%88%AC%E5%8F%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/Scrapy%E6%A1%86%E6%9E%B6%E4%B9%8B%E5%85%A8%E7%AB%99%E7%88%AC%E5%8F%96/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 18:31:35" itemprop="dateModified" datetime="2025-10-11T18:31:35+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Scrapy框架之全站爬取</h1>
<h2 id="【一】全站爬取">【一】全站爬取</h2>
<h3 id="【1】介绍">【1】介绍</h3>
<ul>
<li>CrawlSpider：全站数据爬虫的方式，它是一个类，属于Spider的子类</li>
<li>如果不使用CrawlSpider,那么就相当于基于spider，手动发起请求，不方便</li>
<li>基于CrawlSpider可以方便地进行全站数据爬取</li>
</ul>
<h3 id="【2】CrawlSpider">【2】CrawlSpider</h3>
<h4 id="（1）创建一个工程">（1）创建一个工程</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy startproject ProjectName</span><br></pre></td></tr></table></figure>
<h4 id="（2）创建爬虫文件">（2）创建爬虫文件</h4>
<ul>
<li>cd 切换到爬虫工程中后</li>
<li>创建爬虫文件：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy genspider -t crawl 爬虫文件名 www.爬虫文件名.com</span><br></pre></td></tr></table></figure>
<h4 id="（3）规则解析器">（3）规则解析器</h4>
<ul>
<li>使用CrawlSpider和spider产生的爬虫文件除了继承类不一样外还有rules的规则器</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rules = (</span><br><span class="line">    Rule(LinkExtractor(allow=<span class="string">r&#x27;Items/&#x27;</span>), callback=<span class="string">&#x27;parse_item&#x27;</span>, follow=<span class="literal">True</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>在rules规则解析器内有一个链接提取器LinkExtractor(allow=r’Items/')，callback是规则解析器指定的解析方法，follow是指爬取页面内可见部分页面还是全部</p>
</li>
<li>
<p>链接提取器的作用：根据指定的规则allow=r’items/'进行指定的链接提取</p>
</li>
<li>
<p>规则解析器作用：把链接提取器提取到的链接进行指定规则callback='parse_item’的解析操作</p>
</li>
<li>
<p>follow作用：True可以把 链接提取器 继续作用到 链接提取器提取到的链接所对应的 页面 中，False爬取页面内可见部分页面</p>
</li>
</ul>
<h2 id="【二】需求需要">【二】需求需要</h2>
<ul>
<li>继续爬取下一页</li>
<li>爬取文章详情</li>
</ul>
<h2 id="【三】思路分析">【三】思路分析</h2>
<h3 id="【1】Request创建">【1】Request创建</h3>
<ul>
<li>Request创建：在parse中，for循环中，创建Request对象时，传入meta</li>
<li>item对象一定要在for循环中创建，否则，当前页面都用同一个item导致同一页数据都一样</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">yield</span> Request(</span><br><span class="line">                url=article_link,</span><br><span class="line">                callback=<span class="variable language_">self</span>.detail_parse,</span><br><span class="line">                meta=&#123;<span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>
<h3 id="【2】Response对象">【2】Response对象</h3>
<ul>
<li>Response对象：detail_parse中，通过response取出meta取出item，把文章详情写入</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">detail_parse</span>(<span class="params">self, response</span>):</span><br><span class="line">    <span class="comment"># 获取到传入的item对象</span></span><br><span class="line">    item = response.meta.get(<span class="string">&#x27;item&#x27;</span>)</span><br><span class="line">    <span class="comment"># 解析文章详情</span></span><br><span class="line">    content = <span class="built_in">str</span>(response.xpath(<span class="string">&#x27;//*[@id=&quot;topics&quot;]&#x27;</span>).extract_first())</span><br><span class="line">    <span class="comment"># 继续向 item 对象中添加文章详情内容</span></span><br><span class="line">    item[<span class="string">&#x27;article_content&#x27;</span>] = content</span><br><span class="line">    <span class="comment"># 将完整的信息返回</span></span><br><span class="line">    <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure>
<h2 id="【四】完整的思路">【四】完整的思路</h2>
<ul>
<li>爬取博客园的全部文章,并保存到数据库</li>
</ul>
<p>spiders/bokeyuan.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> SpiderNews.items <span class="keyword">import</span> BoKeYuanItem</span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> Request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BokeYuanSpider</span>(scrapy.Spider):</span><br><span class="line">    <span class="comment"># 爬虫文件的唯一标识</span></span><br><span class="line">    name = <span class="string">&quot;bokeyuan&quot;</span></span><br><span class="line">    <span class="comment"># 允许访问的域名</span></span><br><span class="line">    <span class="comment"># https://www.cnblogs.com/</span></span><br><span class="line">    allowed_domains = [<span class="string">&quot;www.cnblogs.com&quot;</span>]</span><br><span class="line">    <span class="comment"># 起始的url列表（很重要）</span></span><br><span class="line">    <span class="comment"># 列表内部的url都会被框架进行异步请求发送</span></span><br><span class="line">    start_urls = [<span class="string">&quot;https://www.cnblogs.com/&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据解析主函数：自动调用</span></span><br><span class="line">    <span class="comment"># 调用的次数取决于start_urls列表内元素的个数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment"># 用Xpath语法爬取数据</span></span><br><span class="line">        article_list = response.xpath(<span class="string">&#x27;//*[@id=&quot;post_list&quot;]/article&#x27;</span>)</span><br><span class="line">        <span class="comment"># print(article_list)</span></span><br><span class="line">        <span class="keyword">for</span> article <span class="keyword">in</span> article_list:</span><br><span class="line">            <span class="comment"># 创建一个管道类对象</span></span><br><span class="line">            item = BoKeYuanItem()</span><br><span class="line">            <span class="comment"># 拿到头像</span></span><br><span class="line">            <span class="comment"># //*[@id=&quot;post_list&quot;]/article[1]/section/div/p/a/img</span></span><br><span class="line">            head_img_url = article.xpath(<span class="string">&#x27;./section/div/p/a[1]/img/@src&#x27;</span>).extract_first()</span><br><span class="line">            <span class="comment"># 文章的作者</span></span><br><span class="line">            <span class="comment"># //*[@id=&quot;post_list&quot;]/article[1]/section/footer/a[1]/span</span></span><br><span class="line">            article_author = article.xpath(<span class="string">&#x27;./section/footer/a[1]/span/text()&#x27;</span>).extract_first()</span><br><span class="line">            <span class="comment"># 文章标题</span></span><br><span class="line">            <span class="comment"># //*[@id=&quot;post_list&quot;]/article[1]/section/div/a</span></span><br><span class="line">            article_title = article.xpath(<span class="string">&#x27;./section/div/a/text()&#x27;</span>).extract_first().strip()</span><br><span class="line">            <span class="comment"># 创建一个详情链接</span></span><br><span class="line">            <span class="comment"># //*[@id=&quot;post_list&quot;]/article[1]/section/div/a</span></span><br><span class="line">            article_link = article.xpath(<span class="string">&#x27;./section/div/a/@href&#x27;</span>).extract_first()</span><br><span class="line">            <span class="comment"># 拿到文章内容</span></span><br><span class="line">            <span class="comment"># //*[@id=&quot;post_list&quot;]/article[2]/section/div/p/text()</span></span><br><span class="line">            <span class="comment">#//*[@id=&quot;post_list&quot;]/article[1]/section/div/p/text()</span></span><br><span class="line">            <span class="comment"># /html/body/div/div[3]/div/div[2]/div[1]/div[4]/article[3]/section/div/p/text()</span></span><br><span class="line">            article_desc_list = article.xpath(<span class="string">&#x27;./section/div/p/text()&#x27;</span>).extract()</span><br><span class="line">            article_desc = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> article_desc <span class="keyword">in</span> article_desc_list:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> article_desc:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    article_desc = article_desc.strip()</span><br><span class="line">            <span class="comment"># 文章更新时间</span></span><br><span class="line">            <span class="comment"># //*[@id=&quot;post_list&quot;]/article[1]/section/footer/span[1]/span</span></span><br><span class="line">            article_update_time = article.xpath(<span class="string">&#x27;./section/footer/span[1]/span/text()&#x27;</span>).extract_first().strip()</span><br><span class="line">            <span class="comment"># print(article_update_time)</span></span><br><span class="line">            <span class="comment"># itme是一个字典--&gt;用字典方便，可以update()更新数据，更新的时候，更新字段要和管道类里面的字段一摸一样</span></span><br><span class="line">            <span class="comment"># print(f&quot;----&#123;article_desc&#125;---&quot;)</span></span><br><span class="line">            item.update(&#123;</span><br><span class="line">                <span class="string">&quot;head_img_url&quot;</span>: head_img_url,</span><br><span class="line">                <span class="string">&quot;article_author&quot;</span>: article_author,</span><br><span class="line">                <span class="string">&quot;article_title&quot;</span>: article_title,</span><br><span class="line">                <span class="string">&quot;article_link&quot;</span>:article_link,</span><br><span class="line">                <span class="string">&quot;article_desc&quot;</span>: article_desc,</span><br><span class="line">                <span class="string">&quot;article_update_time&quot;</span>: article_update_time</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment"># 将itme对象返回出去</span></span><br><span class="line">            <span class="comment"># return 会结束整个程序，不用它</span></span><br><span class="line">            <span class="comment"># 我们用yield，yield可以保存item的状态，不会终止程序的执行</span></span><br><span class="line">            <span class="keyword">yield</span> Request(</span><br><span class="line">                url=article_link,</span><br><span class="line">                callback=<span class="variable language_">self</span>.detail_parse,</span><br><span class="line">                meta=&#123;<span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="comment"># 获取下一页的链接地址</span></span><br><span class="line">        <span class="comment"># //*[@id=&quot;paging_block&quot;]/div/a[5]</span></span><br><span class="line">        next_url = <span class="string">&#x27;https://www.cnblogs.com&#x27;</span> + response.xpath(<span class="string">&#x27;//*[@id=&quot;paging_block&quot;]/div/a[last()]/@href&#x27;</span>).extract_first()</span><br><span class="line">        <span class="keyword">yield</span> Request(</span><br><span class="line">            url=next_url,</span><br><span class="line">            callback=<span class="variable language_">self</span>.parse</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detail_parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment"># 获取到传入的item对象</span></span><br><span class="line">        item = response.meta.get(<span class="string">&#x27;item&#x27;</span>)</span><br><span class="line">        <span class="comment"># 解析文章详情</span></span><br><span class="line">        content = <span class="built_in">str</span>(response.xpath(<span class="string">&#x27;//*[@id=&quot;topics&quot;]&#x27;</span>).extract_first())</span><br><span class="line">        <span class="comment"># 继续向 item 对象中添加文章详情内容</span></span><br><span class="line">        item[<span class="string">&#x27;article_content&#x27;</span>] = content</span><br><span class="line">        <span class="comment"># 将完整的信息返回</span></span><br><span class="line">        <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure>
<ul>
<li>创建数据库，和字段</li>
<li>然后再items.py中创建管道类和管道字段</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://items.py">items.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建管道类</span></span><br><span class="line"><span class="comment"># 就像你再django中创建的模型表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoKeYuanItem</span>(scrapy.Item):</span><br><span class="line">    <span class="comment"># 就像你模型表的字段</span></span><br><span class="line">    head_img_url = scrapy.Field()</span><br><span class="line">    article_author = scrapy.Field()</span><br><span class="line">    article_title = scrapy.Field()</span><br><span class="line">    article_link = scrapy.Field()</span><br><span class="line">    article_desc = scrapy.Field()</span><br><span class="line">    article_content = scrapy.Field()</span><br><span class="line">    article_update_time = scrapy.Field()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://pipelines.py">pipelines.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># useful for handling different item types with a single interface</span></span><br><span class="line"><span class="keyword">from</span> itemadapter <span class="keyword">import</span> ItemAdapter</span><br><span class="line"><span class="keyword">from</span> pymysql.cursors <span class="keyword">import</span> DictCursor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里处理函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpidernewsPipeline</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoKeYuanPipeline</span>:</span><br><span class="line">    <span class="comment"># 爬虫程序开始时走的</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_spider</span>(<span class="params">self, spider</span>):</span><br><span class="line">        <span class="comment"># 可以做数据库的初始操作</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;爬虫开始撒！！初始化数据库连接&quot;</span>)</span><br><span class="line">        <span class="comment"># 连接数据库</span></span><br><span class="line">        <span class="variable language_">self</span>.conn = pymysql.connect(</span><br><span class="line">            user=<span class="string">&quot;root&quot;</span>,</span><br><span class="line">            password=<span class="string">&quot;1234567&quot;</span>,</span><br><span class="line">            host=<span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">            port=<span class="number">3306</span>,</span><br><span class="line">            database=<span class="string">&quot;article_scrapy&quot;</span>,</span><br><span class="line">            charset=<span class="string">&quot;utf8mb4&quot;</span>,</span><br><span class="line">            cursorclass=DictCursor,</span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># 创建一个cursor对象</span></span><br><span class="line">        <span class="variable language_">self</span>.cursor = <span class="variable language_">self</span>.conn.cursor()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;爬虫开始撒！！初始化数据库连接成功&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        <span class="comment"># print(item)</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param item: 就是你的创建的每个管道字段</span></span><br><span class="line"><span class="string">        :param spider:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 获取数据</span></span><br><span class="line">        head_img_url = item.get(<span class="string">&quot;head_img_url&quot;</span>)</span><br><span class="line">        article_author = item.get(<span class="string">&quot;article_author&quot;</span>)</span><br><span class="line">        article_title = item.get(<span class="string">&quot;article_title&quot;</span>)</span><br><span class="line">        article_link = item.get(<span class="string">&quot;article_link&quot;</span>)</span><br><span class="line">        article_desc = item.get(<span class="string">&quot;article_desc&quot;</span>)</span><br><span class="line">        article_content = item.get(<span class="string">&quot;article_content&quot;</span>)</span><br><span class="line">        article_update_time = item.get(<span class="string">&quot;article_update_time&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 向数据库插入数据</span></span><br><span class="line">        sql = <span class="string">&#x27;insert into article(head_img_url,article_author,article_title,article_link,article_desc, article_content,article_update_time) values(%s,%s,%s,%s,%s,%s,%s)&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 执行spl语句</span></span><br><span class="line">        <span class="variable language_">self</span>.cursor.execute(sql, [head_img_url, article_author, article_title, article_link, article_desc, article_content, article_update_time])</span><br><span class="line">        <span class="comment"># 提交事务</span></span><br><span class="line">        <span class="variable language_">self</span>.conn.commit()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;当前作者--<span class="subst">&#123;article_author&#125;</span>--插入成功&quot;</span>)</span><br><span class="line">        <span class="comment"># print(item)</span></span><br><span class="line">        <span class="comment"># 注意每次用完item记得返回出去，不然会报错</span></span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 爬虫程序结束时走的</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close_spider</span>(<span class="params">self, spider</span>):</span><br><span class="line">        <span class="comment"># 可以将数据库，连接关闭</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;爬虫结束！！！关闭数据库&quot;</span>)</span><br><span class="line">        <span class="comment"># 关闭对象</span></span><br><span class="line">        <span class="variable language_">self</span>.conn.close()</span><br><span class="line">        <span class="comment"># 关闭连接对象</span></span><br><span class="line">        <span class="variable language_">self</span>.cursor.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://settings.py">settings.py</a></p>
<ul>
<li>要将你新创建的类，再配置中注册</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 管道类</span></span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">    <span class="comment"># 项目默认的处理类，没有任何操作</span></span><br><span class="line">   <span class="string">&quot;SpiderNews.pipelines.SpidernewsPipeline&quot;</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="comment"># 自己写的注册的处理类，后面你的数字越小优先级越高，根据优先级一次执行管道处理类</span></span><br><span class="line">   <span class="string">&quot;SpiderNews.pipelines.BoKeYuanPipeline&quot;</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/Scrapy%E6%A1%86%E6%9E%B6%E4%B9%8B%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/Scrapy%E6%A1%86%E6%9E%B6%E4%B9%8B%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 18:31:35" itemprop="dateModified" datetime="2025-10-11T18:31:35+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Scrapy框架之布隆过滤器</h1>
<h2 id="【一】布隆过滤器介绍">【一】布隆过滤器介绍</h2>
<ul>
<li>布隆过滤器是一种基于哈希函数映射的数据结构，常用于快速判断一个元素是否在一个集合内，具有较好的时间和空间效率</li>
</ul>
<h2 id="【二】python中使用布隆过滤器">【二】python中使用布隆过滤器</h2>
<h3 id="【1】安装模块">【1】安装模块</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pybloom_live</span><br></pre></td></tr></table></figure>
<h3 id="【2】测试布隆过滤器">【2】测试布隆过滤器</h3>
<ul>
<li>我们可以自己扩展错误率，底层数组如果大于了错误率会自动扩容</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置了错误率，就会自动扩容</span></span><br><span class="line"><span class="comment"># 不设置错误率，不会自动扩容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先引入模块</span></span><br><span class="line"><span class="keyword">from</span> pybloom_live <span class="keyword">import</span> ScalableBloomFilter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个可扩容的布隆过滤器对象</span></span><br><span class="line"><span class="comment"># initial_capacity：初始的过滤器对象</span></span><br><span class="line"><span class="comment"># error_rate：期望的错误率</span></span><br><span class="line"><span class="comment"># mode：过滤器模式，可选的值有：</span></span><br><span class="line"><span class="comment"># ScalableBloomFilter.SMALL_SET_GROWTH：很慢但是占用更少的内存空间</span></span><br><span class="line"><span class="comment"># ScalableBloomFilter.LARGE_SET_GROWTH: 很快，但是需要占用更多的内存</span></span><br><span class="line">bloom = ScalableBloomFilter(initial_capacity=<span class="number">100</span>, error_rate=<span class="number">0.001</span>, mode=ScalableBloomFilter.LARGE_SET_GROWTH)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加元素到布隆过滤器中</span></span><br><span class="line">url = <span class="string">&quot;www.cnblogs.com&quot;</span></span><br><span class="line">url2 = <span class="string">&quot;www.baidu.com&quot;</span></span><br><span class="line">bloom.add(url)</span><br><span class="line">bloom.add(url2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断元素是否在布隆过滤器中</span></span><br><span class="line"><span class="built_in">print</span>(url <span class="keyword">in</span> bloom)</span><br><span class="line"><span class="built_in">print</span>(url2 <span class="keyword">in</span> bloom)</span><br></pre></td></tr></table></figure>
<ul>
<li>add方法：将元素添加到布隆过滤器中</li>
<li>使用in关键字段判断元素是否存在于布隆过滤器中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="【三】总结">【三】总结</h2>
<ul>
<li>
<p>如果有去重的情况，就可以使用集合</p>
</li>
<li>
<ul>
<li>但是集合占的内存空间大，如果到了亿级别的数据量，想一种更小内存占用，而去重的方案</li>
<li>布隆过滤器</li>
</ul>
</li>
<li>
<p>布隆过滤器：</p>
</li>
<li>
<ul>
<li>通过不同的hash函数，加底层数组实现的极小内存去重</li>
</ul>
</li>
<li>
<p>python中如何使用：pybloom_live</p>
</li>
<li>
<ul>
<li>指定错误率</li>
<li>指定大小</li>
</ul>
</li>
<li>
<p>使用redis实现布隆过滤器</p>
</li>
<li>
<ul>
<li>编译redis(把第三方扩展布隆过滤器编译进去，才有这个功能)</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/Scrapy%E6%A1%86%E6%9E%B6%E4%B9%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/Scrapy%E6%A1%86%E6%9E%B6%E4%B9%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 18:31:35" itemprop="dateModified" datetime="2025-10-11T18:31:35+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Scrapy框架之配置文件介绍</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> fake_useragent <span class="keyword">import</span> UserAgent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前项目的项目名字</span></span><br><span class="line">BOT_NAME = <span class="string">&quot;SpiderNews&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前爬虫项目所在的位置</span></span><br><span class="line">SPIDER_MODULES = [<span class="string">&quot;SpiderNews.spiders&quot;</span>]</span><br><span class="line"><span class="comment"># 当前爬虫项目所在的位置</span></span><br><span class="line">NEWSPIDER_MODULE = <span class="string">&quot;SpiderNews.spiders&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定那个日志级别，达到了你设置的日志级别才会显示日志</span></span><br><span class="line"><span class="comment"># 指定输出日志的类型：</span></span><br><span class="line">LOG_LEVEL = <span class="string">&quot;WARNING&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义请求头</span></span><br><span class="line"><span class="comment"># 我们也可以写成：</span></span><br><span class="line">USER_AGENT = UserAgent().random</span><br><span class="line"><span class="comment">#USER_AGENT = &quot;SpiderNews (+http://www.yourdomain.com)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Obey robots.txt rules</span></span><br><span class="line"><span class="comment"># 是否遵循robots.txt协议</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最大请求数量</span></span><br><span class="line"><span class="comment">#CONCURRENT_REQUESTS = 32</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载延迟，如果下载三秒中还没反应，会直接抛出异常</span></span><br><span class="line"><span class="comment">#DOWNLOAD_DELAY = 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 并发请求的最大数量</span></span><br><span class="line"><span class="comment">#CONCURRENT_REQUESTS_PER_DOMAIN = 16</span></span><br><span class="line"><span class="comment"># 并发请求的ip最大数量</span></span><br><span class="line"><span class="comment">#CONCURRENT_REQUESTS_PER_IP = 16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否启用cookie</span></span><br><span class="line"><span class="comment">#COOKIES_ENABLED = False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用控制台输出</span></span><br><span class="line"><span class="comment">#TELNETCONSOLE_ENABLED = False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认的请求头参数</span></span><br><span class="line"><span class="comment">#DEFAULT_REQUEST_HEADERS = &#123;</span></span><br><span class="line"><span class="comment">#    &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;,</span></span><br><span class="line"><span class="comment">#    &quot;Accept-Language&quot;: &quot;en&quot;,</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否启用爬虫中间件</span></span><br><span class="line"><span class="comment">#SPIDER_MIDDLEWARES = &#123;</span></span><br><span class="line"><span class="comment">#    &quot;SpiderNews.middlewares.SpidernewsSpiderMiddleware&quot;: 543,</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否启用下载器中间件</span></span><br><span class="line"><span class="comment">#DOWNLOADER_MIDDLEWARES = &#123;</span></span><br><span class="line"><span class="comment">#    &quot;SpiderNews.middlewares.SpidernewsDownloaderMiddleware&quot;: 543,</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调度引擎</span></span><br><span class="line"><span class="comment">#EXTENSIONS = &#123;</span></span><br><span class="line"><span class="comment">#    &quot;scrapy.extensions.telnet.TelnetConsole&quot;: None,</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 管道类</span></span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">    <span class="comment"># 项目默认的处理类，没有任何操作</span></span><br><span class="line">   <span class="string">&quot;SpiderNews.pipelines.SpidernewsPipeline&quot;</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="comment"># 自己写的注册的处理类，后面你的数字越小优先级越高，根据优先级一次执行管道处理类</span></span><br><span class="line">   <span class="string">&quot;SpiderNews.pipelines.BoKeYuanPipeline&quot;</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动限速</span></span><br><span class="line"><span class="comment">#AUTOTHROTTLE_ENABLED = True</span></span><br><span class="line"><span class="comment"># 下载延迟</span></span><br><span class="line"><span class="comment">#AUTOTHROTTLE_START_DELAY = 5</span></span><br><span class="line"><span class="comment"># 最大并发数延迟</span></span><br><span class="line"><span class="comment">#AUTOTHROTTLE_MAX_DELAY = 60</span></span><br><span class="line"><span class="comment"># The average number of requests Scrapy should be sending in parallel to</span></span><br><span class="line"><span class="comment"># each remote server</span></span><br><span class="line"><span class="comment">#AUTOTHROTTLE_TARGET_CONCURRENCY = 1.0</span></span><br><span class="line"><span class="comment"># Enable showing throttling stats for every response received:</span></span><br><span class="line"><span class="comment">#AUTOTHROTTLE_DEBUG = False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable and configure HTTP caching (disabled by default)</span></span><br><span class="line"><span class="comment"># See https://docs.scrapy.org/en/latest/topics/downloader-middleware.html#httpcache-middleware-settings</span></span><br><span class="line"><span class="comment">#HTTPCACHE_ENABLED = True</span></span><br><span class="line"><span class="comment">#HTTPCACHE_EXPIRATION_SECS = 0</span></span><br><span class="line"><span class="comment">#HTTPCACHE_DIR = &quot;httpcache&quot;</span></span><br><span class="line"><span class="comment">#HTTPCACHE_IGNORE_HTTP_CODES = []</span></span><br><span class="line"><span class="comment">#HTTPCACHE_STORAGE = &quot;scrapy.extensions.httpcache.FilesystemCacheStorage&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set settings whose default value is deprecated to a future-proof value</span></span><br><span class="line">REQUEST_FINGERPRINTER_IMPLEMENTATION = <span class="string">&quot;2.7&quot;</span></span><br><span class="line">TWISTED_REACTOR = <span class="string">&quot;twisted.internet.asyncioreactor.AsyncioSelectorReactor&quot;</span></span><br><span class="line">FEED_EXPORT_ENCODING = <span class="string">&quot;utf-8&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/Typora%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/Typora%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 18:31:35" itemprop="dateModified" datetime="2025-10-11T18:31:35+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>【一】TYPORA安装过程</h1>
<h2 id="【1】官网">【1】官网</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://typoraio.cn/">Typora 官方中文站 (typoraio.cn)</a></li>
</ul>
<h2 id="【2】-介绍">【2】  介绍</h2>
<ul>
<li>官方下载需要钱</li>
<li>89元</li>
</ul>
<p>![屏幕截图 2024-03-25 181319](C:\Users\86177\Pictures\Screenshots\屏幕截图 2024-03-25 181319.png)</p>
<h2 id="【3】破解">【3】破解</h2>
<h5 id="（1）搜索个平台">（1）搜索个平台</h5>
<h5 id="（2）直接用">（2）直接用</h5>
<ul>
<li>下载软件到本地</li>
<li>文件夹替换</li>
<li>C:\Program Files\Typora\resources中替换app.asar文件</li>
</ul>
<p><img src="C:%5CUsers%5C86177%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240325184633391.png" alt="image-20240325184633391"></p>
<ul>
<li>输入激活码输入</li>
</ul>
<p><img src="C:%5CUsers%5C86177%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240325184720007.png" alt="image-20240325184720007"></p>
<ul>
<li>激活成功</li>
</ul>
<p><img src="C:%5CUsers%5C86177%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240325195400670.png" alt="image-20240325195400670"></p>
<h1>【二】博客园上传笔记</h1>
<h2 id="【1】博客园网址">【1】博客园网址</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/">https://www.cnblogs.com/</a></li>
</ul>
<h2 id="【2】进后台">【2】进后台</h2>
<p><img src="C:%5CUsers%5C86177%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240325200123975.png" alt="image-20240325200123975"></p>
<h2 id="【3】图片处理">【3】图片处理</h2>
<ul>
<li>
<p>手动拖拽</p>
</li>
<li>
<p>打开自己发送的博客园，点击编辑，把图片地址删除</p>
</li>
</ul>
<p><img src="C:%5CUsers%5C86177%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240325201521624.png" alt="image-20240325201521624"></p>
<ul>
<li>把文件夹里原来的原图片拖拽在里面就行</li>
<li>提交保存即可</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">坤</p>
  <div class="site-description" itemprop="description">选择有时候比努力更重要，但是你不努力，选择就只是空谈</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">196</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">坤</span>
</div>
  <div class="powered-by">由 <a href="https://github.com/lsk-0912" class="theme-link" rel="noopener" target="_blank">lsk-0912</a> & <a href="https://github.com/lsk-0912" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
