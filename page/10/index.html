<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aurora-lsk.asia","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
<meta property="og:type" content="website">
<meta property="og:title" content="坤博客">
<meta property="og:url" content="https://aurora-lsk.asia/page/10/index.html">
<meta property="og:site_name" content="坤博客">
<meta property="og:description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="坤">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://aurora-lsk.asia/page/10/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>坤博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">坤博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/3.5%E5%8D%8F%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/3.5%E5%8D%8F%E7%A8%8B/" class="post-title-link" itemprop="url">3.5Э��</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 17:47:38" itemprop="dateModified" datetime="2025-10-11T17:47:38+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>协程理论</h1>
<h1>【一】基于单线程来实现并�?</h1>
<h2 id="�-】并发的本质">�?】并发的本质</h2>
<ul>
<li>
<p>本节的主题是基于单线程来实现并发</p>
</li>
<li>
<ul>
<li>即只用一个主线程（很明显可利用的cpu只有一个）情况下实现并�?</li>
<li>为此我们需要先回顾下并发的本质�?</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>切换+保存状�?</li>
</ul>
</li>
</ul>
</li>
<li>
<p>CPU正在运行一个任�?</p>
</li>
<li>
<ul>
<li>会在两种情况下切走去执行其他的任务（切换由操作系统强制控制）</li>
<li>一种情况是该任务发生了阻塞</li>
<li>另外一种情况是该任务计算的时间过长或有一个优先级更高的程序替代了它�?</li>
</ul>
</li>
</ul>
<p><img src="http://zhaochunze.dream521.site/2322215-20230625082605320-1726976824.png" alt="img"></p>
<p>ps�?</p>
<p>在介绍进程理论时，提及进程的三种执行状�?</p>
<p>而线程才是执行单位，所以也可以将上图理解为线程的三种状�?</p>
<h2 id="�-】yield关键�">�?】yield关键�?</h2>
<ul>
<li>
<p>其中第二种情况并不能提升效率</p>
</li>
<li>
<p>只是为了让cpu能够雨露均沾</p>
</li>
<li>
<p>实现看起来所有任务都被“同时”执行的效果</p>
</li>
<li>
<p>如果多个任务都是纯计算的</p>
</li>
<li>
<p>这种切换反而会降低效率�?</p>
</li>
<li>
<p>为此我们可以基于yield来验�?</p>
</li>
<li>
<ul>
<li>yield本身就是一种在单线程下可以保存任务运行状态的方法</li>
<li>我们来简单复习一下：</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">yield</span>可以保存状�?</span><br><span class="line">	<span class="keyword">yield</span>的状态保存与操作系统的保存线程状态很像，但是<span class="keyword">yield</span>是代码级别控制的，更轻量�?</span><br><span class="line"><span class="number">2</span> send可以把一个函数的结果传给另外一个函�?</span><br><span class="line">	以此实现单线程内程序之间的切�?</span><br></pre></td></tr></table></figure>
<ul>
<li>单纯地切换反而会降低运行效率</li>
</ul>
<h3 id="�-）串行执�">�?）串行执�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>):</span><br><span class="line">        i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>):</span><br><span class="line">        i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">func1()</span><br><span class="line">func2()</span><br><span class="line">stop = time.time()</span><br><span class="line"><span class="built_in">print</span>(stop - start)</span><br></pre></td></tr></table></figure>
<h3 id="�-）基于yield并发执行">�?）基于yield并发执行</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    g = func1()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>):</span><br><span class="line">        i+<span class="number">1</span></span><br><span class="line">        <span class="built_in">next</span>(g)</span><br><span class="line"></span><br><span class="line">start=time.time()</span><br><span class="line">func2()</span><br><span class="line">stop=time.time()</span><br><span class="line"><span class="built_in">print</span>(stop-start)</span><br></pre></td></tr></table></figure>
<h2 id="�-】实现遇到IO自动切换">�?】实现遇到IO自动切换</h2>
<ul>
<li>
<p>第一种情况的切换�?</p>
</li>
<li>
<p>在任务一遇到IO情况�?</p>
</li>
<li>
<p>切到任务二去执行</p>
</li>
<li>
<p>这样就可以利用任务一阻塞的时间完成任务二的计�?</p>
</li>
<li>
<p>效率的提升就在于此�?</p>
</li>
<li>
<p>yield不能检测IO</p>
</li>
<li>
<ul>
<li>实现遇到IO自动切换</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;func1&#x27;</span>)</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    g = func1()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        i + <span class="number">1</span></span><br><span class="line">        <span class="built_in">next</span>(g)</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;func2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">func2()</span><br><span class="line">stop = time.time()</span><br><span class="line"><span class="built_in">print</span>(stop - start)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>*<em>对于单线程下，我们不可避免程序中出现IO操作，但如果我们能在自己的程序中（即用户程序级别，而非操作系统级别）控制单线程下的多个任务能在一个任务遇到io阻塞时就切换到另外一个任务去计算，这样就保证了该线程能够最大限度地处于就绪态，即随时都可以被cpu执行的状态，相当于我们在用户程序级别将自己的IO操作最大限度地隐藏起来，从而可以迷惑操作系统，让其看到：该线程好像是一直在计算，IO比较少，从而更多的将cpu的执行权限分配给我们的线程�?</em></p>
</li>
<li>
<p>协程的本质就是在单线程下</p>
</li>
<li>
<ul>
<li>由用户自己控制一个任务遇到io阻塞了就切换另外一个任务去执行，以此来提升效率�?</li>
</ul>
</li>
<li>
<p>为了实现它，我们需要找寻一种可以同时满足以下条件的解决方案�?</p>
</li>
<li>
<ul>
<li>可以控制多个任务之间的切换，切换之前将任务的状态保存下来，以便重新运行时，可以基于暂停的位置继续执行�?</li>
<li>作为1的补充：可以检测IO操作，在遇到IO操作的情况下才发生切�?</li>
</ul>
</li>
</ul>
<h1>【二】协程介�?</h1>
<h2 id="�-】什么是协程">�?】什么是协程</h2>
<ul>
<li>
<p>是单线程下的并发，又称微线程，纤程。英文名Coroutine�?</p>
</li>
<li>
<p>一句话说明什么是线程�?</p>
</li>
<li>
<ul>
<li>*<em>协程是一种用户态的轻量级线程，即协程是由用户程序自己控制调度的�?</em></li>
</ul>
</li>
<li>
<p>需要强调的是：</p>
</li>
<li>
<ul>
<li>python的线程属于内核级别的，即由操作系统控制调度（如单线程遇到io或执行时间过长就会被迫交出cpu执行权限，切换其他线程运行）</li>
<li>单线程内开启协程，一旦遇到io，就会从应用程序级别（而非操作系统）控制切换，以此来提升效率（！！！非io操作的切换与效率无关�?</li>
</ul>
</li>
<li>
<p>对比操作系统控制线程的切换，用户在单线程内控制协程的切换</p>
</li>
</ul>
<h2 id="�-】优�">�?】优�?</h2>
<ul>
<li>协程的切换开销更小，属于程序级别的切换，操作系统完全感知不到，因而更加轻量级</li>
<li>单线程内就可以实现并发的效果，最大限度地利用cpu</li>
<li>应用程序级别速度要远远高于操作系统的切换</li>
</ul>
<h2 id="�-】缺�">�?】缺�?</h2>
<ul>
<li>协程的本质是单线程下，无法利用多核，可以是一个程序开启多个进程，每个进程内开启多个线程，每个线程内开启协�?</li>
<li>协程指的是单个线程，因而一旦协程出现阻塞，将会阻塞整个线程(多个任务一旦有一个阻塞没有切，整个线程都阻塞在原�?该线程内的其他的任务都不能执行了)</li>
</ul>
<h2 id="�-】总结">�?】总结</h2>
<ul>
<li>*<em>1.必须在只有一个单线程里实现并�?</em></li>
<li><strong>2.修改共享数据不需加锁</strong></li>
<li>*<em>3.用户程序里自己保存多个控制流的上下文�?</em></li>
<li><strong>4.附加：一个协程遇到IO操作自动切换到其它协程（如何实现检测IO，yield、greenlet都无法实现，就用到了gevent模块（select机制））</strong></li>
</ul>
<h1>【三】Greenlet</h1>
<ul>
<li>
<p>如果我们在单个线程内�?0个任�?</p>
</li>
<li>
<ul>
<li>要想实现在多个任务之间切�?</li>
<li>使用yield生成器的方式过于麻烦（需要先得到初始化一次的生成器，然后再调用send。。。非常麻�?</li>
<li>而使用greenlet模块可以非常简单地实现�?0个任务直接的切换</li>
</ul>
</li>
</ul>
<h2 id="�-】安�">�?】安�?</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install greenlet</span><br></pre></td></tr></table></figure>
<h2 id="�-】使�">�?】使�?</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> greenlet <span class="keyword">import</span> greenlet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s eat 1&#x27;</span> % name)</span><br><span class="line">    g2.switch(<span class="string">&#x27;hope&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s eat 2&#x27;</span> % name)</span><br><span class="line">    g2.switch()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s play 1&#x27;</span> % name)</span><br><span class="line">    g1.switch()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s play 2&#x27;</span> % name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = greenlet(eat)</span><br><span class="line">g2 = greenlet(play)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以在第一次switch时传入参数，以后都不需�?</span></span><br><span class="line">g1.switch(<span class="string">&#x27;dream&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># dream eat 1</span></span><br><span class="line"><span class="comment"># hope play 1</span></span><br><span class="line"><span class="comment"># dream eat 2</span></span><br><span class="line"><span class="comment"># hope play 2</span></span><br></pre></td></tr></table></figure>
<h2 id="�-】单纯切换降低效�">�?】单纯切换降低效�?</h2>
<ul>
<li>单纯的切换（在没有io的情况下或者没有重复开辟内存空间的操作），反而会降低程序的执行速度</li>
</ul>
<h3 id="�-）顺序执�">�?）顺序执�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 顺序执行</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f1</span>():</span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000</span>):</span><br><span class="line">        res += i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f2</span>():</span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000</span>):</span><br><span class="line">        res *= i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">f1()</span><br><span class="line">f2()</span><br><span class="line">stop = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;run time is %s&#x27;</span> % (stop - start))</span><br><span class="line"><span class="comment"># run time is 3.5635316371917725</span></span><br></pre></td></tr></table></figure>
<h3 id="�-）切换执�">�?）切换执�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> greenlet <span class="keyword">import</span> greenlet</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f1</span>():</span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000</span>):</span><br><span class="line">        res += i</span><br><span class="line">        g2.switch()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f2</span>():</span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000</span>):</span><br><span class="line">        res *= i</span><br><span class="line">        g1.switch()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">g1 = greenlet(f1)</span><br><span class="line">g2 = greenlet(f2)</span><br><span class="line">g1.switch()</span><br><span class="line">stop = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;run time is %s&#x27;</span> % (stop - start))</span><br><span class="line"><span class="comment"># run time is 27.30641794204712</span></span><br></pre></td></tr></table></figure>
<h2 id="�-】小�">�?】小�?</h2>
<ul>
<li>
<p>greenlet只是提供了一种比generator更加便捷的切换方�?</p>
</li>
<li>
<ul>
<li>当切到一个任务执行时如果遇到io</li>
<li>那就原地阻塞，仍然是没有解决遇到IO自动切换来提升效率的问题�?</li>
</ul>
</li>
<li>
<p>单线程里的这20个任务的代码通常会既有计算操作又有阻塞操�?</p>
</li>
<li>
<ul>
<li>我们完全可以在执行任�?时遇到阻�?</li>
<li>就利用阻塞的时间去执行任�?。。。�?</li>
<li>如此，才能提高效率，这就用到了Gevent模块�?</li>
</ul>
</li>
</ul>
<h1>【四】Gevent介绍</h1>
<h2 id="�-】介�">�?】介�?</h2>
<ul>
<li>Gevent 是一个第三方�?</li>
<li>可以轻松通过gevent实现并发同步或异步编�?</li>
<li>在gevent中用到的主要模式是Greenlet</li>
<li>它是以C扩展模块形式接入Python的轻量级协程�?</li>
<li>Greenlet全部运行在主程序操作系统进程的内部，但它们被协作式地调度�?</li>
</ul>
<h2 id="�-�-安装">�?�?<em>安装</em>*</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install gevent</span><br></pre></td></tr></table></figure>
<h2 id="�-】使�-2">�?】使�?</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(args)  <span class="comment"># (1, 2, 3)</span></span><br><span class="line">    <span class="built_in">print</span>(kwargs)  <span class="comment"># &#123;&#x27;x&#x27;: 4, &#x27;y&#x27;: 5&#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;ok&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个协程对象g1，spawn括号内第一个参数是函数名，如eat，后面可以有多个参数，可以是位置实参或关键字实参，都是传给函数eat�?</span></span><br><span class="line">g1 = gevent.spawn(func, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, x=<span class="number">4</span>, y=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个协程对象g2</span></span><br><span class="line">g2 = gevent.spawn(func2)</span><br><span class="line"></span><br><span class="line">g1.join()  <span class="comment"># 等待g1结束</span></span><br><span class="line"></span><br><span class="line">g2.join()  <span class="comment"># 等待g2结束</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者上述两步合作一步：gevent.joinall([g1,g2])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拿到func1的返回�?</span></span><br><span class="line">result = g1.value</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># ok</span></span><br></pre></td></tr></table></figure>
<h2 id="�-�-遇到IO阻塞时会自动切换任务">�?�?<em>遇到IO阻塞时会自动切换任务</em>*</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s eat 1&#x27;</span> % name)</span><br><span class="line">    gevent.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s eat 2&#x27;</span> % name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s play 1&#x27;</span> % name)</span><br><span class="line">    gevent.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s play 2&#x27;</span> % name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = gevent.spawn(eat, <span class="string">&#x27;dream&#x27;</span>)</span><br><span class="line">g2 = gevent.spawn(play, name=<span class="string">&#x27;hope&#x27;</span>)</span><br><span class="line">g1.join()</span><br><span class="line">g2.join()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者gevent.joinall([g1,g2])</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;�?)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># dream eat 1</span></span><br><span class="line"><span class="string"># hope play 1</span></span><br><span class="line"><span class="string"># hope play 2</span></span><br><span class="line"><span class="string"># dream eat 2</span></span><br><span class="line"><span class="string"># �?</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>上例gevent.sleep(2)模拟的是gevent可以识别的io阻塞</strong></li>
</ul>
<h2 id="�-】兼容其他IO">�?】兼容其他IO</h2>
<ul>
<li>
<p><strong>而time.sleep(2)或其他的阻塞,gevent是不能直接识别的需要用下面一行代�?打补�?就可以识别了</strong></p>
</li>
<li>
<p><strong>from gevent import monkey;monkey.patch_all()必须放到被打补丁者的前面</strong></p>
</li>
<li>
<ul>
<li><strong>如time，socket模块之前</strong></li>
</ul>
</li>
<li>
<p>*<em>或者我们干脆记忆成：要用gevent，需要将from gevent import monkey; monkey.patch_all()放到文件的开�?</em></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line"></span><br><span class="line">monkey.patch_all()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">eat</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;eat food 1&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;eat 中的 :&gt;&gt;&gt;&gt; <span class="subst">&#123;threading.current_thread()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;eat food 2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;play 1&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;play 中的 :&gt;&gt;&gt;&gt; <span class="subst">&#123;threading.current_thread()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;play 2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = gevent.spawn(eat)</span><br><span class="line">g2 = gevent.spawn(play)</span><br><span class="line">gevent.joinall([g1, g2])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(threading.current_thread())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;�?)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># eat food 1</span></span><br><span class="line"><span class="string"># play 1</span></span><br><span class="line"><span class="string"># play 中的 :&gt;&gt;&gt;&gt; &lt;_DummyThread(Dummy-1, started daemon 5168389856)&gt;</span></span><br><span class="line"><span class="string"># play 2</span></span><br><span class="line"><span class="string"># eat 中的 :&gt;&gt;&gt;&gt; &lt;_DummyThread(Dummy-2, started daemon 5168390016)&gt;</span></span><br><span class="line"><span class="string"># eat food 2</span></span><br><span class="line"><span class="string"># &lt;_MainThread(MainThread, started 5168107712)&gt;</span></span><br><span class="line"><span class="string"># �?</span></span><br></pre></td></tr></table></figure>
<ul>
<li>我们可以用threading.current_thread()来查看每个g1和g2，查看的结果为DummyThread-n，即假线�?</li>
</ul>
<h1>【五】Gevent之同步与异步</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> spawn, joinall, monkey</span><br><span class="line"></span><br><span class="line">monkey.patch_all()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        start = time.time()</span><br><span class="line">        res = func(*args, **kwargs)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;当前程序 <span class="subst">&#123;func.__name__&#125;</span> 总耗时 :&gt;&gt;&gt;&gt; <span class="subst">&#123;time.time() - start&#125;</span> s&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">pid</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Some non-deterministic task</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Task %s done&#x27;</span> % pid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@timer</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">synchronous</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        task(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@timer</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asynchronous</span>():</span><br><span class="line">    g_l = [spawn(task, i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">    joinall(g_l)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Synchronous:&#x27;</span>)</span><br><span class="line">    synchronous()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Asynchronous:&#x27;</span>)</span><br><span class="line">    asynchronous()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Synchronous:</span></span><br><span class="line">    <span class="comment"># Task 0 done</span></span><br><span class="line">    <span class="comment"># Task 1 done</span></span><br><span class="line">    <span class="comment"># Task 2 done</span></span><br><span class="line">    <span class="comment"># Task 3 done</span></span><br><span class="line">    <span class="comment"># Task 4 done</span></span><br><span class="line">    <span class="comment"># Task 5 done</span></span><br><span class="line">    <span class="comment"># Task 6 done</span></span><br><span class="line">    <span class="comment"># Task 7 done</span></span><br><span class="line">    <span class="comment"># Task 8 done</span></span><br><span class="line">    <span class="comment"># Task 9 done</span></span><br><span class="line">    <span class="comment"># 当前程序 synchronous 总耗时 :&gt;&gt;&gt;&gt; 5.034381151199341 s</span></span><br><span class="line">    <span class="comment"># Asynchronous:</span></span><br><span class="line">    <span class="comment"># Task 0 done</span></span><br><span class="line">    <span class="comment"># Task 1 done</span></span><br><span class="line">    <span class="comment"># Task 2 done</span></span><br><span class="line">    <span class="comment"># Task 3 done</span></span><br><span class="line">    <span class="comment"># Task 4 done</span></span><br><span class="line">    <span class="comment"># Task 5 done</span></span><br><span class="line">    <span class="comment"># Task 6 done</span></span><br><span class="line">    <span class="comment"># Task 7 done</span></span><br><span class="line">    <span class="comment"># Task 8 done</span></span><br><span class="line">    <span class="comment"># Task 9 done</span></span><br><span class="line">    <span class="comment"># 当前程序 asynchronous 总耗时 :&gt;&gt;&gt;&gt; 0.504889726638794 s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面程序的重要部分是将task函数封装到Greenlet内部线程的gevent.spawn�?</span></span><br><span class="line"><span class="comment"># 初始化的greenlet列表存放在数组threads中，此数组被传给gevent.joinall 函数，后者阻塞当前流程，并执行所有给定的greenlet�?</span></span><br><span class="line"><span class="comment"># 执行流程只会�?所有greenlet执行完后才会继续向下走�?</span></span><br></pre></td></tr></table></figure>
<h1>【六】Gevent之应用举例一</h1>
<ul>
<li>协程应用：爬�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line"></span><br><span class="line">monkey.patch_all()</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_page</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;当前正在获取 :&gt;&gt;&gt;&gt; <span class="subst">&#123;url&#125;</span>&quot;</span>)</span><br><span class="line">    response = requests.get(url=url)</span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;当前响应数据总长�?:&gt;&gt;&gt;&gt; <span class="subst">&#123;<span class="built_in">len</span>(response.text)&#125;</span> 当前链接 :&gt;&gt;&gt;&gt; <span class="subst">&#123;url&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start_time = time.time()</span><br><span class="line">gevent.joinall([</span><br><span class="line">    gevent.spawn(get_page, <span class="string">&#x27;https://www.python.org/&#x27;</span>),</span><br><span class="line">    gevent.spawn(get_page, <span class="string">&#x27;https://www.jd.com/&#x27;</span>),</span><br><span class="line">    gevent.spawn(get_page, <span class="string">&#x27;https://www.baidu.com/&#x27;</span>),</span><br><span class="line">])</span><br><span class="line">stop_time = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;总耗时 :&gt;&gt;&gt;&gt; <span class="subst">&#123;stop_time - start_time&#125;</span>s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前正在获取 :&gt;&gt;&gt;&gt; https://www.python.org/</span></span><br><span class="line"><span class="comment"># 当前正在获取 :&gt;&gt;&gt;&gt; https://www.jd.com/</span></span><br><span class="line"><span class="comment"># 当前正在获取 :&gt;&gt;&gt;&gt; https://www.baidu.com/</span></span><br><span class="line"><span class="comment"># 当前响应数据总长�?:&gt;&gt;&gt;&gt; 227 当前链接 :&gt;&gt;&gt;&gt; https://www.baidu.com/</span></span><br><span class="line"><span class="comment"># 当前响应数据总长�?:&gt;&gt;&gt;&gt; 182756 当前链接 :&gt;&gt;&gt;&gt; https://www.jd.com/</span></span><br><span class="line"><span class="comment"># 当前响应数据总长�?:&gt;&gt;&gt;&gt; 50995 当前链接 :&gt;&gt;&gt;&gt; https://www.python.org/</span></span><br><span class="line"><span class="comment"># 总耗时 :&gt;&gt;&gt;&gt; 15.546293020248413s</span></span><br></pre></td></tr></table></figure>
<h1>【七】Gevent之应用举例二</h1>
<ul>
<li>通过gevent实现单线程下的socket并发</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey;</span><br><span class="line">monkey.patch_all()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一定要放到导入socket模块之前，否则gevent无法识别socket的阻塞）</span></span><br></pre></td></tr></table></figure>
<h2 id="�-】服务端">�?】服务端</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line"></span><br><span class="line">monkey.patch_all()</span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不想用money.patch_all()打补�?可以用gevent自带的socket</span></span><br><span class="line"><span class="comment"># from gevent import socket</span></span><br><span class="line"><span class="comment"># s=socket.socket()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">server</span>(<span class="params">server_ip, port</span>):</span><br><span class="line">    s = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">    s.setsockopt(SOL_SOCKET, SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">    s.bind((server_ip, port))</span><br><span class="line">    s.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        conn, addr = s.accept()</span><br><span class="line">        gevent.spawn(talk, conn, addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">talk</span>(<span class="params">conn, addr</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            res = conn.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;client %s:%s msg: %s&#x27;</span> % (addr[<span class="number">0</span>], addr[<span class="number">1</span>], res))</span><br><span class="line">            conn.send(res.upper())</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    server(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8080</span>)</span><br></pre></td></tr></table></figure>
<h2 id="�-】客户端">�?】客户端</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">client = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8080</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg = <span class="built_in">input</span>(<span class="string">&#x27;&gt;&gt;: &#x27;</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> msg: <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    client.send(msg.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    msg = client.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(msg.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h2 id="�-】多线程并发多个客户�">�?】多线程并发多个客户�?</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client</span>(<span class="params">server_ip, port</span>):</span><br><span class="line">    <span class="comment"># 套接字对象一定要加到函数内，即局部名称空间内</span></span><br><span class="line">    <span class="comment"># 放在函数外则被所有线程共享，则大家公用一个套接字对象，那么客户端端口永远一样了</span></span><br><span class="line">    c = socket(AF_INET, SOCK_STREAM)  </span><br><span class="line">    c.connect((server_ip, port))</span><br><span class="line"></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        c.send((<span class="string">&#x27;%s say hello %s&#x27;</span> % (threading.current_thread().getName(), count)).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        msg = c.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="built_in">print</span>(msg.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">        t = Thread(target=client, args=(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8080</span>))</span><br><span class="line">        t.start()</span><br></pre></td></tr></table></figure>
<h1>协程操作</h1>
<ul>
<li>基于 async �?await 关键字的协程可以实现异步编程，这也是目前 Python 异步相关的主流技术。在这里我们主要介绍一下实现异步的模块：asyncio 模块</li>
</ul>
<h1>【一】asyncio 模块</h1>
<ul>
<li>asyncio 模块�?Python 中实现异步的一个模块，该模块在 Python3.4 的时候发�?</li>
<li>async �?await 关键字在 Python3.5 中引入�?</li>
<li>因此，想要使用asyncio模块，建�?Python 解释器的版本不要低于 Python3.5 �?</li>
</ul>
<h1>【二】事件循�?</h1>
<ul>
<li>所谓的事件循环，我们可以把它当作是一�?while 循环，这�?while 循环在循环生命周期内运行并执行一些任务，在特定的条件下结束循环�?</li>
<li>在编写程序的时候可以通过如下代码来获取和创建事件循环�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br></pre></td></tr></table></figure>
<h1>【三】协程函数和协程对象</h1>
<h2 id="�-】什么是协程函数">�?】什么是协程函数</h2>
<ul>
<li>
<p>首先我们来看一下协程函�?</p>
</li>
<li>
<ul>
<li>什么是协程函数呢？</li>
</ul>
</li>
<li>
<p>直白的讲，定义为如下形式的函�?</p>
</li>
<li>
<p>我们可以称之为协程函数，如下代码所示：</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 async 声明的函数就是协程函�?</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fn</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h2 id="�-】什么是协程对象">�?】什么是协程对象</h2>
<ul>
<li>
<p>知道了什么是协程函数</p>
</li>
<li>
<ul>
<li>接下来我们再来看一下什么是协程对象</li>
<li>所谓的协程对象就是调用协程函数之后返回的对�?</li>
<li>我们称之�?<strong>协程对象</strong>，如下代码所示：</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 async 声明的函数就是协程函�?</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fn</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用携程函数得到的对象就是协程对�?</span></span><br><span class="line">res = fn()</span><br><span class="line"><span class="built_in">print</span>(res) <span class="comment"># &lt;coroutine object fn at 0x1029684a0&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>注意事项：调用协程函数时，函数内部的代码不会执行，只是会返回一个协程对象！</li>
</ul>
<h1>【四】协程函数应�?</h1>
<h2 id="�-】基本应�">�?】基本应�?</h2>
<ul>
<li>在编写程序的时候，如果想要执行协程函数内部的代码，通过 <strong>函数�?)</strong> 调用函数是不可以的，需�?<strong>事件循环</strong> �?<strong>协程对象</strong> 配合才能实现，如下代码所示：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fn</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;协程函数内部的代�?)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 执行协程代码的方式一</span></span><br><span class="line"><span class="string">def main_first():</span></span><br><span class="line"><span class="string">    # 调用协程函数，返回一个协程对�?</span></span><br><span class="line"><span class="string">    res = fn()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # todo�?、创建一个事件循�?</span></span><br><span class="line"><span class="string">    loop = asyncio.get_event_loop()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # todo�?、将协程当作任务提交到事件循环的任务列表中，协程执行完成之后终止</span></span><br><span class="line"><span class="string">    loop.run_until_complete(res)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 执行协程代码的方式二</span></span><br><span class="line"><span class="string">def main_second():</span></span><br><span class="line"><span class="string">    # 调用协程函数，返回一个协程对�?</span></span><br><span class="line"><span class="string">    res = fn()</span></span><br><span class="line"><span class="string">    # 解析：第二种方式在本质上和第一种方式是相同的，其内部先创建事件循环，然后执�?run_until_complete</span></span><br><span class="line"><span class="string">    # 但是要注意：该方式只支持 Python3.7+ 的解释器，因为该方式�?Python3.7 加入的�?</span></span><br><span class="line"><span class="string">    asyncio.run(res)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__ == &#x27;</span>__main__<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">    main_first()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    main_second()</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>这个过程可以简单理解为�?</p>
</li>
<li>
<ul>
<li>�?<strong>协程函数</strong> 当做任务添加�?<strong>事件循环</strong> 的任务列�?</li>
<li>然后事件循环检测列表中�?<em>协程函数</em>* 是否已准备就绪（默认可理解为就绪状态）</li>
<li>如果准备就绪则执行其内部代码�?</li>
</ul>
</li>
</ul>
<h2 id="�-】await关键�">�?】await关键�?</h2>
<ul>
<li>await 是一�?只能 在协程函数中使用的关键字，用于当协程函数遇到IO操作的时候挂起当前协程（任务），</li>
<li>当前协程挂起过程中，事件循环可以去执行其他的协程（任务）</li>
<li>当前协程IO处理完成时，可以再次切换回来执行 await 之后的代�?</li>
<li>怎么理解呢？请看如下代码�?</li>
</ul>
<h3 id="�-�-实例1">�?�?<em>实例1</em>*</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fn</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;协程函数内部的代�?)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # 遇到IO操作之后挂起当前协程（任务），等IO操作完成之后再继续往下执行�?</span></span><br><span class="line"><span class="string">    # 当前协程挂起时，事件循环可以去执行其他协程（任务�?</span></span><br><span class="line"><span class="string">    response = await asyncio.sleep(2)  # 模拟遇到了IO操作</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    print(f&#x27;</span>IO请求结束，结果为：&#123;response&#125;<span class="string">&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def main():</span></span><br><span class="line"><span class="string">    # 调用协程函数，返回一个协程对�?</span></span><br><span class="line"><span class="string">    res = fn()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # 执行协程函数</span></span><br><span class="line"><span class="string">    asyncio.run(res)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__ == &#x27;</span>__main__<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">    main()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    运行结果�?</span><br><span class="line">    协程函数内部的代�?</span><br><span class="line">    IO请求结束，结果为：<span class="literal">None</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-�-实例2">�?�?<em>实例2</em>*</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">other_tasks</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;start&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)  <span class="comment"># 模拟遇到了IO操作</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;返回�?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">async def fn():</span></span><br><span class="line"><span class="string">    print(&#x27;</span>协程函数内部的代�?)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 遇到IO操作之后挂起当前协程（任务），等IO操作完成之后再继续往下执行�?</span></span><br><span class="line">    <span class="comment"># 当前协程挂起时，事件循环可以去执行其他协程（任务�?</span></span><br><span class="line">    response = <span class="keyword">await</span> other_tasks()  <span class="comment"># 模拟执行其他协程任务</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;IO请求结束，结果为：<span class="subst">&#123;response&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 调用协程函数，返回一个协程对�?</span></span><br><span class="line">    res = fn()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 执行协程函数</span></span><br><span class="line">    asyncio.run(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    运行结果�?</span></span><br><span class="line"><span class="string">    协程函数内部的代�?</span></span><br><span class="line"><span class="string">    start</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    IO请求结束，结果为：返回�?</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-）实�">�?）实�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">other_tasks</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;start&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)  <span class="comment"># 模拟遇到了IO操作</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;返回�?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">async def fn():</span></span><br><span class="line"><span class="string">    print(&#x27;</span>协程函数内部的代�?)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 遇到IO操作之后挂起当前协程（任务），等IO操作完成之后再继续往下执行�?</span></span><br><span class="line">    <span class="comment"># 当前协程挂起时，事件循环可以去执行其他协程（任务�?</span></span><br><span class="line">    respnse1 = <span class="keyword">await</span> other_tasks()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;IO请求结束，结果为：<span class="subst">&#123;respnse1&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    respnse2 = <span class="keyword">await</span> other_tasks()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;IO请求结束，结果为：<span class="subst">&#123;respnse2&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 调用协程函数，返回一个协程对�?</span></span><br><span class="line">    cor_obj = fn()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 执行协程函数</span></span><br><span class="line">    asyncio.run(cor_obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    运行结果�?</span></span><br><span class="line"><span class="string">    协程函数内部的代�?</span></span><br><span class="line"><span class="string">    start</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    IO请求结束，结果为：返回�?</span></span><br><span class="line"><span class="string">    start</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    IO请求结束，结果为：返回�?</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-）小�">�?）小�?</h3>
<ul>
<li>
<p>上述的所有实例都只是创建了一个任�?</p>
</li>
<li>
<ul>
<li>即：事件循环的任务列表中只有一个任�?</li>
<li>所以在IO等待时无法演示切换到其他任务效果�?</li>
</ul>
</li>
<li>
<p>在程序中想要创建多个任务对象</p>
</li>
<li>
<ul>
<li>需要使用Task对象来实现�?</li>
</ul>
</li>
</ul>
<h2 id="�-】Task-对象">�?】Task 对象</h2>
<ul>
<li>
<p>Tasks 用于并发调度协程</p>
</li>
<li>
<p>通过 asyncio.create_task(协程对象) 的方式创�?Task 对象</p>
</li>
<li>
<p>这样可以让协程加入事件循环中等待被调度执行�?</p>
</li>
<li>
<p>除了使用 asyncio.create_task() 函数以外</p>
</li>
<li>
<p>还可以用低层级的loop.create_task() �?ensure_future() 函数。并且不建议手动实例�?Task 对象�?</p>
</li>
<li>
<p>本质上是将协程对象封装成 Task 对象</p>
</li>
<li>
<p>并将协程立即加入事件循环，同时追踪协程的状态�?</p>
</li>
<li>
<p>注意事项�?</p>
</li>
<li>
<ul>
<li>asyncio.create_task() 函数�?Python3.7 中被加入�?</li>
<li>�?Python3.7 之前，可以改用低层级�?</li>
<li>asyncio.ensure_future() 函数�?</li>
</ul>
</li>
</ul>
<h3 id="�-）协程运行方式一">�?）协程运行方式一</h3>
<ul>
<li>async.run() 运行协程</li>
<li>async.create_task()创建task</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">other_tasks</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;start&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)  <span class="comment"># 模拟遇到了IO操作</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;返回�?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">async def fn():</span></span><br><span class="line"><span class="string">    print(&#x27;</span>fn开�?)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建协程，将协程封装到一个Task对象中并立即添加到事件循环的任务列表中，等待事件循环去执行（默认是就绪状态）�?</span></span><br><span class="line">    task1 = asyncio.create_task(other_tasks())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建协程，将协程封装到一个Task对象中并立即添加到事件循环的任务列表中，等待事件循环去执行（默认是就绪状态）�?</span></span><br><span class="line">    task2 = asyncio.create_task(other_tasks())</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;fn结束&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 当执行某协程遇到IO操作时，会自动化切换执行其他任务�?</span></span><br><span class="line">    <span class="comment"># 此处的await是等待相对应的协程全都执行完毕并获取结果</span></span><br><span class="line">    response1 = <span class="keyword">await</span> task1</span><br><span class="line">    response2 = <span class="keyword">await</span> task2</span><br><span class="line">    <span class="built_in">print</span>(response1, response2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    asyncio.run(fn())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    运行结果�?</span></span><br><span class="line"><span class="string">    fn开�?</span></span><br><span class="line"><span class="string">    fn结束</span></span><br><span class="line"><span class="string">    start</span></span><br><span class="line"><span class="string">    start</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    返回�?返回�?</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-）协程运行方式二">�?）协程运行方式二</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">other_tasks</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;start&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)  <span class="comment"># 模拟遇到了IO操作</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;返回�?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">async def fn():</span></span><br><span class="line"><span class="string">    print(&#x27;</span>fn开�?)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建协程，将协程封装到一个Task对象中并立即添加到事件循环的任务列表中，等待事件循环去执行（默认是就绪状态）�?</span></span><br><span class="line">    task_lis = [</span><br><span class="line">        asyncio.create_task(other_tasks()),</span><br><span class="line">        asyncio.create_task(other_tasks()),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;fn结束&#x27;</span>)</span><br><span class="line">    <span class="comment"># 当执行某协程遇到IO操作时，会自动化切换执行其他任务�?</span></span><br><span class="line">    <span class="comment"># 此处的await是等待所有协程执行完毕，并将所有协程的返回值保存到done</span></span><br><span class="line">    <span class="comment"># 如果设置了timeout值，则意味着此处最多等待的秒，完成的协程返回值写入到done中，未完成则写到pending中�?</span></span><br><span class="line">    done, pending = <span class="keyword">await</span> asyncio.wait(task_lis, timeout=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;done :&gt;&gt;&gt;&gt; <span class="subst">&#123;done&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;pending :&gt;&gt;&gt;&gt; <span class="subst">&#123;pending&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    asyncio.run(fn())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    fn开�?</span></span><br><span class="line"><span class="string">    fn结束</span></span><br><span class="line"><span class="string">    start</span></span><br><span class="line"><span class="string">    start</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    done :&gt;&gt;&gt;&gt; &#123;&lt;Task finished name=&#x27;Task-2&#x27; coro=&lt;other_tasks() done, defined at /Users/dream/Desktop/PythonProjects/12并发编程/02协程/01.py:4&gt; result=&#x27;返回�?&gt;, &lt;Task finished name=&#x27;Task-3&#x27; coro=&lt;other_tasks() done, defined at /Users/dream/Desktop/PythonProjects/12并发编程/02协程/01.py:4&gt; result=&#x27;返回�?&gt;&#125;</span></span><br><span class="line"><span class="string">    pending :&gt;&gt;&gt;&gt; set()</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-）获取协程返回�">�?）获取协程返回�?</h3>
<ul>
<li>async.gather()获取返回�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">other_tasks</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;start&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)  <span class="comment"># 模拟遇到了IO操作</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;返回�?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">async def fn():</span></span><br><span class="line"><span class="string">    print(&#x27;</span>fn开�?)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建协程，将协程封装到一个Task对象中并立即添加到事件循环的任务列表中，等待事件循环去执行（默认是就绪状态）�?</span></span><br><span class="line">    task_lis = [</span><br><span class="line">        asyncio.create_task(other_tasks()),</span><br><span class="line">        asyncio.create_task(other_tasks()),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;fn结束&#x27;</span>)</span><br><span class="line">    <span class="comment"># 当执行某协程遇到IO操作时，会自动化切换执行其他任务�?</span></span><br><span class="line">    <span class="comment"># 此处的await是等待所有协程执行完毕，并将所有协程的返回值保存到done</span></span><br><span class="line">    <span class="comment"># 如果设置了timeout值，则意味着此处最多等待的秒，完成的协程返回值写入到done中，未完成则写到pending中�?</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.wait(task_lis, timeout=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    response = <span class="keyword">await</span> asyncio.gather(task_lis[<span class="number">0</span>], task_lis[<span class="number">1</span>])  <span class="comment"># 将task_lis作为参数传入gather，等异步任务都结束后返回结果列表</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;response :&gt;&gt;&gt;&gt; <span class="subst">&#123;response&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    asyncio.run(fn())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    fn开�?</span></span><br><span class="line"><span class="string">    fn结束</span></span><br><span class="line"><span class="string">    start</span></span><br><span class="line"><span class="string">    start</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    response :&gt;&gt;&gt;&gt; [&#x27;返回�?, &#x27;返回�?]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="�-】aiohtpp对象">�?】aiohtpp对象</h2>
<ul>
<li>
<p>我们之前学习过爬虫最重要的模块requests，但它是阻塞式的发起请求，每次请求发起后需阻塞等待其返回响应，不能做其他的事情�?</p>
</li>
<li>
<ul>
<li>本文要介绍的aiohttp可以理解成是和requests对应Python异步网络请求库，它是基于 asyncio 的异步模块，可用于实现异步爬虫，有点就是更快�?requests 的同步爬虫�?</li>
<li>安装方式，pip install aiohttp�?</li>
</ul>
</li>
<li>
<p>aiohttp是一个为Python提供异步HTTP 客户�?服务端编程，基于asyncio的异步库�?</p>
</li>
<li>
<ul>
<li>asyncio可以实现单线程并发IO操作，其实现了TCP、UDP、SSL等协议，</li>
<li>aiohttp就是基于asyncio实现的http框架�?</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> session.get(<span class="string">&quot;http://httpbin.org/headers&quot;</span>) <span class="keyword">as</span> response:</span><br><span class="line">            <span class="built_in">print</span>(<span class="keyword">await</span> response.text())</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>
<h1>【五】异步迭代器</h1>
<h2 id="�-】什么是异步迭代器？">�?】什么是异步迭代器？</h2>
<ul>
<li>实现�?<strong>aiter</strong>() �?<strong>anext</strong>()方法的对象�?</li>
<li><strong>anext</strong> 必须返回一�?awaitable 对象�?</li>
<li>async for会处理异步迭代器�?<strong>anext</strong>()方法所返回的可等待对象，直到其引发一�?StopAsyncIteration异常�?</li>
</ul>
<h2 id="�-】什么是异步可迭代对象？">�?】什么是异步可迭代对象？</h2>
<ul>
<li>可在 async for语句中被使用的对象�?</li>
<li>必须通过它的 <strong>aiter</strong>()方法返回一�?asynchronous iterator �?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Reader</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 自定义异步迭代器（同时也是异步可迭代对象�?&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">readline</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.count == <span class="number">100</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.count</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__aiter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">__anext__</span>(<span class="params">self</span>):</span><br><span class="line">        val = <span class="keyword">await</span> <span class="variable language_">self</span>.readline()</span><br><span class="line">        <span class="keyword">if</span> val <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopAsyncIteration</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fn</span>():</span><br><span class="line">    <span class="comment"># 创建异步可迭代对�?</span></span><br><span class="line"></span><br><span class="line">    async_iter = Reader()</span><br><span class="line">    <span class="comment"># async for 必须放在async def 函数内，否则语法错误�?</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">for</span> item <span class="keyword">in</span> async_iter:</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">asyncio.run((fn()))</span><br></pre></td></tr></table></figure>
<h1>【六】异步上下文管理�?</h1>
<ul>
<li>此种对象通过定义 <strong>aenter</strong>() �?<strong>aexit</strong>() 方法来对 <em>async with</em> 语句中的环境进行控制�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncContextManager</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.conn = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">do_something</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 异步操作数据�?</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">__aenter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 异步链接数据�?</span></span><br><span class="line">        <span class="variable language_">self</span>.conn = <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">__aexit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span><br><span class="line">        <span class="comment"># 异步关闭数据库链�?</span></span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fn</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> AsyncContextManager() <span class="keyword">as</span> f:</span><br><span class="line">        res = <span class="keyword">await</span> f.do_something()</span><br><span class="line">        <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">asyncio.run(fn())</span><br></pre></td></tr></table></figure>
<h1>【七】小�?</h1>
<ul>
<li>在程序中只要看到 <em>async</em> �?<em>await</em> 关键�?</li>
<li>其内部就是基于协程实现的异步编程</li>
<li>这种异步编程是通过一个线程在IO等待时间去执行其他任务，从而实现并发�?</li>
</ul>
<p>以上就是异步编程的常见操作，更多内容请参�?Python 官方文档：<a href="d2dbc46621cc5538ec739f56976641e3">https://docs.python.org/zh-cn/3.8/library/asyncio.html</a></p>
<h1>【八】小试牛刀</h1>
<ul>
<li>需求：访问苹果官网 50 次，测试其总访问时间�?</li>
</ul>
<h2 id="�-�-同步版本">�?�?<em>同步版本</em>*</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc_visit_time</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算程序的执行时�?*</span></span><br><span class="line"><span class="string">    :param url:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="keyword">for</span> times <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">51</span>):</span><br><span class="line">        response = requests.get(url=url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;第【<span class="subst">&#123;times&#125;</span>】次链接成功�?)</span></span><br><span class="line"><span class="string">    else:</span></span><br><span class="line"><span class="string">        print(f&#x27;</span>链接失败�?.center(<span class="number">50</span>, <span class="string">&#x27;-&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    end_time = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;任务消耗了<span class="subst">&#123;end_time - start_time&#125;</span>秒的时间�?)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def main():</span></span><br><span class="line"><span class="string">    calc_visit_time(&#x27;</span>https://www.baidu.com<span class="string">&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__ == &#x27;</span>__main__<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">    main()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    运行结果�?</span><br><span class="line">    第�?】次链接成功�?</span><br><span class="line">    第�?】次链接成功�?</span><br><span class="line">    第�?】次链接成功�?</span><br><span class="line">    第�?】次链接成功�?</span><br><span class="line">    第�?】次链接成功�?</span><br><span class="line">    ...</span><br><span class="line">    第�?<span class="number">6</span>】次链接成功�?</span><br><span class="line">    第�?<span class="number">7</span>】次链接成功�?</span><br><span class="line">    第�?<span class="number">8</span>】次链接成功�?</span><br><span class="line">    第�?<span class="number">9</span>】次链接成功�?</span><br><span class="line">    第�?<span class="number">0</span>】次链接成功�?</span><br><span class="line">    任务消耗了<span class="number">5.65</span>秒的时间�?</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="�-】异步版�">�?】异步版�?</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 异步版本</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch_async</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    异步的aiohttp模块，替代了之前的同步的requests模块</span></span><br><span class="line"><span class="string">    :param url:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="comment"># 跳过证书验证 :&gt;&gt;&gt;&gt; ssl=False</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> session.get(url=url, ssl=<span class="literal">False</span>) <span class="keyword">as</span> response:</span><br><span class="line">            <span class="keyword">if</span> response.status == <span class="number">200</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;链接成功�?)</span></span><br><span class="line"><span class="string">            else:</span></span><br><span class="line"><span class="string">                print(f&#x27;</span>链接失败�?.center(<span class="number">50</span>, <span class="string">&#x27;-&#x27;</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">calc_visit_time</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算程序的执行时�?</span></span><br><span class="line"><span class="string">    :param url:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    task_lis = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">        task_lis.append(fetch_async(url))</span><br><span class="line">    <span class="keyword">await</span> asyncio.gather(*task_lis)</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;任务消耗了<span class="subst">&#123;end_time - start_time&#125;</span>秒的时间�?)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def main():</span></span><br><span class="line"><span class="string">    asyncio.run(calc_visit_time(&#x27;</span>https://www.baidu.com<span class="string">&#x27;))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__ == &#x27;</span>__main__<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">    main()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    运行结果�?</span><br><span class="line">    链接成功�?</span><br><span class="line">    链接成功�?</span><br><span class="line">    链接成功�?</span><br><span class="line">    链接成功�?</span><br><span class="line">    链接成功�?</span><br><span class="line">    ...</span><br><span class="line">    链接成功�?</span><br><span class="line">    链接成功�?</span><br><span class="line">    链接成功�?</span><br><span class="line">    链接成功�?</span><br><span class="line">    链接成功�?</span><br><span class="line">    任务消耗了<span class="number">0.31</span>秒的时间�?</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>通过上述两个实例的运行结果，我们可以看到，使用了异步之后，其效率提升18倍�?</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/3.6IO%E6%A8%A1%E5%9E%8B%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/3.6IO%E6%A8%A1%E5%9E%8B%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">3.6IOģ�ͼ��</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 17:47:38" itemprop="dateModified" datetime="2025-10-11T17:47:38+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>【零】IO模型简�?</h1>
<ul>
<li>
<p>我们研究�?IO 都是基于网络 IO �?</p>
</li>
<li>
<p>Stevens在文章中一共比较了五种IO Model�?</p>
</li>
<li>
<ul>
<li><em>blocking IO</em></li>
<li>nonblocking IO</li>
<li><em>IO multiplexing</em></li>
<li>signal driven IO —（忽略）</li>
<li>asynchronous IO 由signal driven IO（信号驱动IO）在实际中并不常用，所以主要介绍其余四种IO Model�?</li>
</ul>
</li>
<li>
<p>当一个read操作发生时，该操作会经历两个阶段�?</p>
</li>
<li>
<ul>
<li>1、等待数据准�?(Waiting for the data to be ready)</li>
<li>2、将数据从内核拷贝到进程�?Copying the data from the kernel to the process)</li>
</ul>
</li>
<li>
<p>同步</p>
</li>
<li>
<ul>
<li>在同步模式下，一个组件必须等待另一个组件完成某个操作，然后再进行下一个操作�?</li>
</ul>
</li>
<li>
<p>异步</p>
</li>
<li>
<ul>
<li>在异步模式下，组件之间互不干扰，它们可以独立地执行任务。当一个组件完成任务后，它可以直接通知另一个组件继续执行操作�?</li>
</ul>
</li>
<li>
<p>阻塞</p>
</li>
<li>
<ul>
<li>在阻塞模式下，一个进程或线程在执行某个操作时，如果该操作没有完成，它将立即停止一切操作，并等待操作完成后再继续进行后续操作�?</li>
</ul>
</li>
<li>
<p>非阻�?</p>
</li>
<li>
<ul>
<li>在非阻塞模式下，一个进程或线程在执行某个操作时，即使该操作没有完成，也会立即返回执行下一个操作，不会出现停滞等待的情况�?如果下一个操作需要依赖于上一个还未完成的操作，它将定期检查上一个操作是否完成，保证这些未完成的操作不会影响后续任务的执行�?</li>
</ul>
</li>
<li>
<p>常见的网络IO</p>
</li>
<li>
<ul>
<li>accept</li>
<li>recv</li>
<li>recvfrom</li>
</ul>
</li>
</ul>
<h1>【一】阻塞IO模型</h1>
<p>我们之前写的都是阻塞 IO 模型 （协程除外）</p>
<h2 id="�-】TCP-UDP协议模型">�?】TCP/UDP协议模型</h2>
<p><a target="_blank" rel="noopener" href="https://img2023.cnblogs.com/blog/2322215/202306/2322215-20230630215817953-1689712558.png"><img src="http://zhaochunze.dream521.site/2322215-20230630215817953-1689712558.png" alt="img"></a></p>
<h2 id="�-】TCP-经典IO">�?】TCP 经典IO</h2>
<ul>
<li>客户�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">client = socket()</span><br><span class="line"></span><br><span class="line">IP = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">PORT = <span class="number">8083</span></span><br><span class="line">client.connect((IP, PORT))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg_to_server = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">    msg_to_server = msg_to_server.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    client.send(msg_to_server)</span><br><span class="line"></span><br><span class="line">    msg_from_server = client.recv(<span class="number">1024</span>)</span><br><span class="line">    msg_from_server = msg_from_server.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(msg_from_server)</span><br></pre></td></tr></table></figure>
<ul>
<li>服务�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">server = socket()</span><br><span class="line"></span><br><span class="line">IP = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">PORT = <span class="number">8082</span></span><br><span class="line">server.bind((IP, PORT))</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    conn, addr = server.accept()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            msg_from_client = conn.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(msg_from_client) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(msg_from_client.decode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">            conn.send(msg_from_client.upper())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span>  Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>
<ul>
<li>问题：服务端只能接待一个客户端</li>
</ul>
<h2 id="�-】问题解决方�">�?】问题解决方�?</h2>
<ul>
<li>在服务端开设多进程或多线程，进程池线程池，以此来解决IO问题</li>
<li>但是还没在根本上解决IO问题</li>
<li>因为在服务端 虽然解决�?请求数据这部分的IO 但是没有从根本上解决 向内核要数据和拷贝数据给客户端这个IO</li>
</ul>
<h1>【二】非阻塞IO模型</h1>
<ul>
<li>将所有的阻塞操作变为非阻�?</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://img2023.cnblogs.com/blog/2322215/202306/2322215-20230630215827590-2025602751.png"><img src="http://zhaochunze.dream521.site/2322215-20230630215827590-2025602751.png" alt="img"></a></p>
<h2 id="�-】TCP-非阻塞经典IO">�?】TCP 非阻塞经典IO</h2>
<ul>
<li>服务�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">server = socket()</span><br><span class="line"></span><br><span class="line">IP = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">PORT = <span class="number">8083</span></span><br><span class="line">server.bind((IP, PORT))</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将所有的网络阻塞 变为 非阻�?</span></span><br><span class="line"><span class="comment"># BlockingIOError: [WinError 10035] 无法立即完成一个非阻止性套接字操作�?---- 表示服务端并没有立即建立链接，导致了资源无法接收</span></span><br><span class="line">server.setblocking(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">conn_list = []</span><br><span class="line">del_conn_list = []</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn, addr = server.accept()</span><br><span class="line">        conn_list.append(conn)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检测进程资源利用错�?</span></span><br><span class="line">    <span class="keyword">except</span> BlockingIOError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;当前无阻�?可进行其他工�?)</span></span><br><span class="line"><span class="string">        for conn in conn_list:</span></span><br><span class="line"><span class="string">            try:</span></span><br><span class="line"><span class="string">                data_from_client = conn.recv(1024)  # 没有消息则报�?</span></span><br><span class="line"><span class="string">                if len(data_from_client) == 0:</span></span><br><span class="line"><span class="string">                    # 如果接收到的消息�?0  则表示当前链接无效：关闭当前链接</span></span><br><span class="line"><span class="string">                    conn.close()  # （客户端断开连接�?</span></span><br><span class="line"><span class="string">                    # 将无用的conn链接从链接列表中删除�?</span></span><br><span class="line"><span class="string">                    del_conn_list.append(conn)  # (将无用的链接放到无用的链接列表里)</span></span><br><span class="line"><span class="string">                    continue</span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string">                # 链接对象正常：反馈消息给客户�?</span></span><br><span class="line"><span class="string">                conn.send(data_from_client.upper())</span></span><br><span class="line"><span class="string">            # 检测进程资源利用错�?</span></span><br><span class="line"><span class="string">            except BlockingIOError as e:</span></span><br><span class="line"><span class="string">                # 查看其他链接对象是否有消息发过来</span></span><br><span class="line"><span class="string">                continue</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            # 检测到客户端断开链接错误</span></span><br><span class="line"><span class="string">            except ConnectionError as e:</span></span><br><span class="line"><span class="string">                # 断开链接</span></span><br><span class="line"><span class="string">                conn.close()</span></span><br><span class="line"><span class="string">                # 将无效的链接添加到废弃列表里</span></span><br><span class="line"><span class="string">                del_conn_list.append(conn)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        # 回收无用的链接对�?</span></span><br><span class="line"><span class="string">        for conn in del_conn_list:</span></span><br><span class="line"><span class="string">            # 在有效列表内删除无效的链接对�?</span></span><br><span class="line"><span class="string">            conn_list.remove(conn)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        # 清空无效链接列表</span></span><br><span class="line"><span class="string">        del_conn_list.clear()</span></span><br></pre></td></tr></table></figure>
<ul>
<li>客户�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">client = socket()</span><br><span class="line"></span><br><span class="line">IP = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">PORT = <span class="number">8083</span></span><br><span class="line">client.connect((IP, PORT))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg_to_server = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">    msg_to_server = msg_to_server.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    client.send(msg_to_server)</span><br><span class="line"></span><br><span class="line">    msg_from_server = client.recv(<span class="number">1024</span>)</span><br><span class="line">    msg_from_server = msg_from_server.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(msg_from_server)</span><br></pre></td></tr></table></figure>
<h2 id="�-】总结">�?】总结</h2>
<ul>
<li>
<p>虽然非阻�?IO 看起来十分优秀</p>
</li>
<li>
<ul>
<li>但是该模型会长时间占�?CPU 而不处理数据（大部分资源都浪费在反复发起请求 请求数据上）</li>
</ul>
</li>
<li>
<p>实际应用中不会考虑使用非阻�?IO 模型</p>
</li>
<li>
<ul>
<li>占用资源严重</li>
</ul>
</li>
</ul>
<h1>【三】IO多路复用</h1>
<h2 id="�-】什么是IO多路复用">�?】什么是IO多路复用</h2>
<p><a target="_blank" rel="noopener" href="https://img2023.cnblogs.com/blog/2322215/202306/2322215-20230630215838477-64289328.png"><img src="http://zhaochunze.dream521.site/2322215-20230630215838477-64289328.png" alt="img"></a></p>
<ul>
<li>
<p>当监管的对象只有一个的时候，其实IO多路复用连阻塞IO的功能都比不�?</p>
</li>
<li>
<p>但是IO多路复用一次性可以监管多个对�?</p>
</li>
<li>
<ul>
<li>server = socket.socket()</li>
<li>conn, addr = socket.accept()</li>
</ul>
</li>
<li>
<p>这个监管机制是由操作系统本身就存在的（select�?</p>
</li>
<li>
<p>如果使用需要导入相关的模块（select模块�?</p>
</li>
</ul>
<h2 id="�-】基�-select模块解决-IO-阻塞">�?】基�?select模块解决 IO 阻塞</h2>
<ul>
<li>客户�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line">server = socket()</span><br><span class="line"></span><br><span class="line">IP = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">PORT = <span class="number">8083</span></span><br><span class="line">server.bind((IP, PORT))</span><br><span class="line">server.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将阻塞模型变为非阻塞模型</span></span><br><span class="line">server.setblocking(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将监管目�?谁来发起链接)添加到监管列�?</span></span><br><span class="line">read_list = [server]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    r_list, w_list, x_list = select.select(read_list, [], [])  <span class="comment"># 检测server�?</span></span><br><span class="line">    <span class="comment"># 返回值（server对象,[],[]�?�?([&lt;socket.socket fd=408, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=(&#x27;127.0.0.1&#x27;, 8083)&gt;], [], [])</span></span><br><span class="line">    <span class="comment"># 一旦有链接发起，直接拿到监管链�?</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 循环拿到每一个发起的链接对象</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> r_list:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        针对不同的对象进行分类处�?</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果是服务对象就将其添加到服务列表内，再次确�?</span></span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">is</span> server:</span><br><span class="line">            <span class="comment"># 拿到每一个链接对�?</span></span><br><span class="line">            conn, addr = i.accept()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 将链接对象添加到监管机制�?</span></span><br><span class="line">            read_list.append(conn)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果是链接请求就拿到客户端发起的数据</span></span><br><span class="line">            msg_from_client = i.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(res) == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># 关闭无效链接</span></span><br><span class="line">                i.close()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 将无效链接从列表中移�?</span></span><br><span class="line">                read_list.remove(i)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            msg_from_client = msg_from_client.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(msg_from_client)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 反馈信息给客户端</span></span><br><span class="line">            i.send(msg_from_client.upper())</span><br></pre></td></tr></table></figure>
<ul>
<li>服务�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">client = socket()</span><br><span class="line"></span><br><span class="line">IP = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">PORT = <span class="number">8083</span></span><br><span class="line">client.connect((IP, PORT))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg_to_server = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">    msg_to_server = msg_to_server.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    client.send(msg_to_server)</span><br><span class="line"></span><br><span class="line">    msg_from_server = client.recv(<span class="number">1024</span>)</span><br><span class="line">    msg_from_server = msg_from_server.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(msg_from_server)</span><br></pre></td></tr></table></figure>
<h2 id="�-】总结-2">�?】总结</h2>
<ul>
<li>
<p>监管机制有很�?</p>
</li>
<li>
<p>select机制</p>
</li>
<li>
<ul>
<li>Windows/Mac 都有</li>
</ul>
</li>
<li>
<p>poll机制</p>
</li>
<li>
<ul>
<li>只有Linux�?</li>
<li>poll �?select 机制都可以监管多个对象，但是 poll监管的对象更�?</li>
</ul>
</li>
</ul>
<p>上述两个机制都不是很完美</p>
<p>当监管的对象特别多的时候，可能会出现机器大的延迟响�?</p>
<ul>
<li>
<p>epoll机制</p>
</li>
<li>
<ul>
<li>只在 Linux 机制�?</li>
<li>给每个监管对象都绑定了一个回调机�?</li>
<li>一旦有响应，回调机制会立刻发起提醒</li>
</ul>
</li>
</ul>
<p>针对不同的操作系统，需要考虑不同的监管机制，太过麻烦</p>
<p>因此有了一个新的模块（selectors模块�?</p>
<p>根据平台的不同而自动选择不同的机�?</p>
<h1>【四】异步IO</h1>
<ul>
<li>异步IO 是所有模型中效率最高的，也是使用最广泛�?</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://img2023.cnblogs.com/blog/2322215/202309/2322215-20230921090343398-1608144674.png"><img src="http://zhaochunze.dream521.site/2322215-20230921090343398-1608144674.png" alt="img"></a></p>
<ul>
<li>
<p>由于涉及到调用操作系统底层，我们只能通过C语言代码才能模拟出效�?</p>
</li>
<li>
<p>但是，有相关大佬已经帮我们将相关的方法进行了封装</p>
</li>
<li>
<p>模块</p>
</li>
<li>
<ul>
<li>asyncio 模块</li>
</ul>
</li>
<li>
<p>异步框架</p>
</li>
<li>
<ul>
<li>sanic</li>
<li>tronado</li>
<li>twisted</li>
</ul>
</li>
</ul>
<h2 id="�-】asyncio-模块安装">�?】asyncio 模块安装</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install asyncio</span><br></pre></td></tr></table></figure>
<h2 id="�-】方法示�">�?】方法示�?</h2>
<ul>
<li>单线程实现并发效�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;hello world statr:&gt;&gt;<span class="subst">&#123;threading.current_thread()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)  <span class="comment"># 真正�?IO 操作 ---- 交互时操�?/ 响应式操�?</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;hello world end:&gt;&gt;&gt;<span class="subst">&#123;threading.current_thread()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">tasks = [hello(), hello()]</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line">loop.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单线程实现并发效�?</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hello world statr:&gt;&gt;&lt;_MainThread(MainThread, started 8005963776)&gt;</span></span><br><span class="line"><span class="comment"># hello world statr:&gt;&gt;&lt;_MainThread(MainThread, started 8005963776)&gt;</span></span><br><span class="line"><span class="comment"># hello world end:&gt;&gt;&gt;&lt;_MainThread(MainThread, started 8005963776)&gt;</span></span><br><span class="line"><span class="comment"># hello world end:&gt;&gt;&gt;&lt;_MainThread(MainThread, started 8005963776)&gt;</span></span><br></pre></td></tr></table></figure>
<h1>【五】IO总结</h1>
<ul>
<li>四个IO模型对比</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://img2023.cnblogs.com/blog/2322215/202306/2322215-20230630215852336-1714846496.jpg"><img src="http://zhaochunze.dream521.site/2322215-20230630215852336-1714846496.jpg" alt="img"></a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/4.0Django%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8%E4%B9%8BORM%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/4.0Django%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8%E4%B9%8BORM%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">4.0Django�������֮ORM����</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 17:47:38" itemprop="dateModified" datetime="2025-10-11T17:47:38+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>ORM迁移数据�?</h1>
<h2 id="【一】什么是ORM">【一】什么是ORM</h2>
<ul>
<li>ORM是一种对象与关系型数据库之间的映射关系，主要实现了一下三个方面的功能
<ul>
<li>数据库中的映射为数据库中的类</li>
<li>数据库中的字段映射为python中的属�?</li>
<li>数据库中的记录映射为python中的实例</li>
</ul>
</li>
<li>ORM的主要优点是可以减少开发人员编写重复的SQL语句的时间和工作量，并且可以减少由于SQL语句的调整和更改所带来的错误�?</li>
</ul>
<h2 id="【二】Django-ORM的特�">【二】Django ORM的特�?</h2>
<p>API：应用程序接口，指两个不同软件应用之间进行交互的一组方�?</p>
<ul>
<li>与其他ORM框架相比，Django ORM拥有以下优点�?</li>
<li>简单易用：Django ORM的API非常简单，易于掌握和使用�?</li>
<li>丰富的API：Django ORM提供了丰富的API来完成常见的数据库操作，如增删改查等，同时也支持高级查询和聚合查询等操作�?</li>
<li>具有良好的扩展性：Django ORM可以与其他第三方库进行无缝集成，如Django REST framework、Django-Oscar等�?</li>
<li>自动映射：Django ORM支持自动映射，开发者只需要定义数据库表的结构，就可以自动生成相应的Python类，从而减少开发过程中的重复代码量</li>
</ul>
<h2 id="【三】创建数据库模型�">【三】创建数据库模型�?</h2>
<h3 id="�-】定义模型表">�?】定义模型表</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个类 继承models.Model</span></span><br><span class="line"><span class="comment"># CharField ：字符串类型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span>(models.Model):</span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>,</span><br><span class="line">                                verbose_name=<span class="string">&quot;用户�?)</span></span><br><span class="line"><span class="string">    # max_length:字符串的最大长�?</span></span><br><span class="line"><span class="string">    # verbose_name：注�?-》相同与数据库里的comment</span></span><br><span class="line"><span class="string">    password = models.CharField(max_length=28,</span></span><br><span class="line"><span class="string">                                verbose_name=&quot;</span>密码<span class="string">&quot;)</span></span><br><span class="line"><span class="string">    age = models.IntegerField(verbose_name=&quot;</span>年龄<span class="string">&quot;)</span></span><br><span class="line"><span class="string">    # IntegerField：int类型</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】创建表">�?】创建表</h3>
<ul>
<li>CharField 字符串类型字�?</li>
<li>IntegerField 数字类型字段</li>
</ul>
<h4 id="�-）python-manage-py-makemigrations">�?）<code>python manage.py makemigrations</code></h4>
<ul>
<li>将定义的Django模型表转换为SQL语句</li>
</ul>
<h4 id="�-）python-manage-py-migrate">�?）<code>python manage.py migrate</code></h4>
<ul>
<li>SQL语句写入到数据库�?</li>
</ul>
<h4 id="�-）执行方�">�?）执行方�?</h4>
<ul>
<li>创建表的同时你要在settings.py文件中连接数�?不然会报�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 换成mysql数据�?</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="comment"># mysql引擎</span></span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="comment"># 数据库IP地址</span></span><br><span class="line">        <span class="string">&quot;HOST&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">        <span class="comment"># 数据库端�?</span></span><br><span class="line">        <span class="string">&quot;POST&quot;</span>: <span class="number">3306</span>,</span><br><span class="line">        <span class="comment"># 数据库登入名</span></span><br><span class="line">        <span class="string">&quot;USER&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">        <span class="comment"># 数据库密�?</span></span><br><span class="line">        <span class="string">&quot;PASSWORD&quot;</span>: <span class="string">&quot;1234567&quot;</span>,</span><br><span class="line">        <span class="comment"># 数据库名�?-&gt;不要用DATABASE,用NAME</span></span><br><span class="line">        <span class="string">&quot;NAME&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="comment"># 数据库编码格�?</span></span><br><span class="line">        <span class="string">&quot;CHARSET&quot;</span>: <span class="string">&quot;utf8mb4&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>打开pycharm中的Tools里面的运行manage.py任务</p>
</li>
<li>
<p>在控制台输入<code>makemigrations</code>,点击回车—》将Django的模型表映射成SQL语句，APP文件下的<code>migrations</code>就多东西</p>
</li>
<li>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240619195529055.png" alt="image-20240619195529055"></p>
</li>
<li>
<p>创建成功会出现一下数�?</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">D:\pycharm\python310\python.exe &quot;D:\pycharm\PyCharm 2023.3.4\plugins\python\helpers\pycharm\django_manage.py&quot; makemigrations D:/pycharm/project/Django练习/first_django</span><br><span class="line">Tracking file by folder pattern:  migrations</span><br><span class="line">Migrations for &#x27;user&#x27;:</span><br><span class="line">  user\migrations\0001_initial.py</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">这里创建了一个UserInfo的一张表</span></span><br><span class="line">    - Create model UserInfo</span><br><span class="line"></span><br><span class="line">Following files were affected </span><br><span class="line"> D:\pycharm\project\Django练习\first_django\user\migrations\0001_initial.py</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>创建好了之后你在你的数据库还是看不到�?</p>
</li>
<li>
<p>需要在终端执行migrate命令才行</p>
</li>
<li>
<p>执行完之后会，出现以下信�?</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">manage.py@first_django &gt; migrate</span><br><span class="line">D:\pycharm\python310\python.exe &quot;D:\pycharm\PyCharm 2023.3.4\plugins\python\helpers\pycharm\django_manage.py&quot; migrate D:/pycharm/project/Django练习/first_django</span><br><span class="line">Tracking file by folder pattern:  migrations</span><br><span class="line">Operations to perform:</span><br><span class="line">  Apply all migrations: admin, auth, contenttypes, sessions, user</span><br><span class="line">Running migrations:</span><br><span class="line">  Applying contenttypes.0001_initial... OK</span><br><span class="line">  Applying auth.0001_initial... OK</span><br><span class="line">  Applying admin.0001_initial... OK</span><br><span class="line">  Applying admin.0002_logentry_remove_auto_add... OK</span><br><span class="line">  Applying admin.0003_logentry_add_action_flag_choices... OK</span><br><span class="line">  Applying contenttypes.0002_remove_content_type_name... OK</span><br><span class="line">  Applying auth.0002_alter_permission_name_max_length... OK</span><br><span class="line">  Applying auth.0003_alter_user_email_max_length... OK</span><br><span class="line">  Applying auth.0004_alter_user_username_opts... OK</span><br><span class="line">  Applying auth.0005_alter_user_last_login_null... OK</span><br><span class="line">  Applying auth.0006_require_contenttypes_0002... OK</span><br><span class="line">  Applying auth.0007_alter_validators_add_error_messages... OK</span><br><span class="line">  Applying auth.0008_alter_user_username_max_length... OK</span><br><span class="line">  Applying auth.0009_alter_user_last_name_max_length... OK</span><br><span class="line">  Applying auth.0010_alter_group_name_max_length... OK</span><br><span class="line">  Applying auth.0011_update_proxy_permissions... OK</span><br><span class="line">  Applying auth.0012_alter_user_first_name_max_length... OK</span><br><span class="line">  Applying sessions.0001_initial... OK</span><br><span class="line">  Applying user.0001_initial... OK</span><br></pre></td></tr></table></figure>
<ul>
<li>创建成功</li>
</ul>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240619202112472.png" alt="image-20240619202112472"></p>
<ul>
<li></li>
</ul>
<h4 id="�-）注�">�?）注�?</h4>
<ul>
<li>
<p>只要修改了models中有关数据库相关的代码，就必须执行上面的数据库迁移命�?</p>
</li>
<li>
<p><strong>注意的是当你在控制台执行了<code>makemigrations</code>之后，你的APP文件下的<code>migrations</code>就会多东西，如果你想重新迁移的话就把多的东西给删掉，记住不要删除<code>__init__</code>文件</strong></p>
</li>
<li>
<p>你可以看到他会自动给你补充id主键字段</p>
</li>
<li>
<p>Django的默认机�?</p>
<ul>
<li>
<p>在settings.py文件中他有一个数�?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_AUTO_FIELD = <span class="string">&#x27;django.db.models.BigAutoField&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>这个机制自动创建了ID字段，你直接写了的话就用你自己的ID字段</p>
</li>
</ul>
</li>
<li>
<p>Django的默认机制就是如果你的表没有创建ID字段，默认帮你加一�?ID 字段</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span>(models.Model):</span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>,</span><br><span class="line">                                verbose_name=<span class="string">&quot;用户�?)</span></span><br><span class="line"><span class="string">    password = models.CharField(max_length=32,</span></span><br><span class="line"><span class="string">                                verbose_name=&quot;</span>密码<span class="string">&quot;)</span></span><br><span class="line"><span class="string">    age = models.IntegerField(verbose_name=&quot;</span>年龄<span class="string">&quot;)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>你没执行那两个命令一次之后，你的APP文件下的<code>migrations</code>就会多东�?</li>
</ul>
<h3 id="�-】增加约束条�">�?】增加约束条�?</h3>
<h4 id="�-）字段是否为�">�?）字段是否为�?</h4>
<ul>
<li>
<p>默认是不为空�?</p>
</li>
<li>
<p>不允许为空：null = False</p>
</li>
<li>
<p>允许为空：null = True</p>
</li>
</ul>
<h4 id="�-）给字段添加默认�">�?）给字段添加默认�?</h4>
<ul>
<li>意思就是，你不写的话就会有默认值去填充字段</li>
<li><code>dafault = 默认值</code></li>
</ul>
<h3 id="�-】想要增加字�">�?】想要增加字�?</h3>
<ul>
<li>直接在原本的模型表上增加字段就可�?</li>
<li>迁移数据库再执行那两个命�?</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">makemigrations</span><br><span class="line"></span><br><span class="line">migrate</span><br></pre></td></tr></table></figure>
<p>比如：在原本的字段中添加BooleanField类型的字段，bool�?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span>(models.Model):</span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>,</span><br><span class="line">                                verbose_name=<span class="string">&quot;用户�?)</span></span><br><span class="line"><span class="string">    password = models.CharField(max_length=32,</span></span><br><span class="line"><span class="string">                                verbose_name=&quot;</span>密码<span class="string">&quot;)</span></span><br><span class="line"><span class="string">    # 允许为空</span></span><br><span class="line"><span class="string">    age = models.IntegerField(verbose_name=&quot;</span>年龄<span class="string">&quot;, null=True)</span></span><br><span class="line"><span class="string">    # 增加一个爱好的字段允许为你�?</span></span><br><span class="line"><span class="string">    # 给他一个默认值default=1</span></span><br><span class="line"><span class="string">    gender = models.BooleanField(verbose_name=&quot;</span>男人或女�?,</span><br><span class="line">                                 default=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240619204014910.png" alt="image-20240619204014910"></p>
<ul>
<li>添加成功</li>
</ul>
<h3 id="�-】删除字�">�?】删除字�?</h3>
<ul>
<li>删除字段的话，就在模型表上把你不想要的字段给删掉</li>
<li>在次执行那两个命�?</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">makemigrations</span><br><span class="line"></span><br><span class="line">migrate</span><br></pre></td></tr></table></figure>
<ul>
<li>不过，在生产环境中删除字段前请确保不会影响现有数据，因为这可能导致数据丢失或结构不一致�?</li>
</ul>
<h3 id="【补充�">【补充�?</h3>
<ul>
<li>每次修改关于数据库字段的操作时，都要执行数据库的迁移相关操作</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>
<h1>ORM操作数据�?</h1>
<h2 id="【一】不启动Django就能操作数据库的使用方法">【一】不启动Django就能操作数据库的使用方法</h2>
<ul>
<li>
<p>再Dajngo框架中，Django必须启动才能使用DjangoORM语句</p>
</li>
<li>
<p>不启动Django就能操作数据库的使用方法</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">    </span><br><span class="line">找到 manage.py copy main 下面的第一行代�?</span><br><span class="line">os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;first_django.settings&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入dajngo模块</span></span><br><span class="line"><span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动dajango项目</span></span><br><span class="line"><span class="comment">#缺点就是这个启动只是一次性的</span></span><br><span class="line">django.setup()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240619211027663.png" alt="image-20240619211027663"></p>
<h2 id="【二】对数据库的表进行查数据">【二】对数据库的表进行查数据</h2>
<ul>
<li>方法一：first()：拿到你筛选条件的第一个�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># first()：是拿到你筛选条件的第一个�?</span></span><br><span class="line">    res_two = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>).first()</span><br><span class="line">    <span class="built_in">print</span>(res_two)</span><br><span class="line">    <span class="comment"># UserInfo object (1)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>方法二：last()：拿到你筛选条件的最后一个�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># last()：是拿到你筛选条件的最后一个�?</span></span><br><span class="line">    res_one = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>).last()</span><br><span class="line">    <span class="built_in">print</span>(res_one)</span><br><span class="line">    <span class="comment"># UserInfo object (2)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>案例</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这是manage.py中的main下的第一行数�?</span></span><br><span class="line">    os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;first_django.settings&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 启动django项目</span></span><br><span class="line">    <span class="comment"># 缺点是一次性的</span></span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用Django项目的模型表</span></span><br><span class="line">    <span class="comment"># 导入</span></span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment"># �?】查数据</span></span><br><span class="line">    <span class="comment"># 确保了表里有数据</span></span><br><span class="line">    res_one = UserInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="built_in">print</span>(res_one)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&lt;UserInfo: UserInfo object (1)&gt;]&gt;</span></span><br><span class="line">    <span class="comment"># 得到的是一个对�?</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据库只有一个数据的时�?</span></span><br><span class="line">    <span class="comment"># 过滤filter</span></span><br><span class="line">    res_one = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>)</span><br><span class="line">    <span class="comment"># 这样就找到了username这个�?</span></span><br><span class="line">    <span class="built_in">print</span>(res_one)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&lt;UserInfo: UserInfo object (1)&gt;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据库要是有两条数据的话，并且名字一样，我们就要两个参数来判�?</span></span><br><span class="line">    res_two = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>, password=<span class="string">&quot;912&quot;</span>)</span><br><span class="line">    <span class="comment"># 找两个叫tom的数�?</span></span><br><span class="line">    <span class="built_in">print</span>(res_two)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&lt;UserInfo: UserInfo object (2)&gt;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 表中有三个数�?</span></span><br><span class="line">    <span class="comment"># first()：是拿到你筛选条件的第一个�?</span></span><br><span class="line">    res_two = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>).first()</span><br><span class="line">    <span class="built_in">print</span>(res_two)</span><br><span class="line">    <span class="comment"># UserInfo object (1)</span></span><br><span class="line">    <span class="comment"># last()：是拿到你筛选条件的最后一个�?</span></span><br><span class="line">    res_one = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>).last()</span><br><span class="line">    <span class="built_in">print</span>(res_one)</span><br><span class="line">    <span class="comment"># UserInfo object (2)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 取�?-&gt;直接拿res_one当作一个对象，进行.属性获取数�?</span></span><br><span class="line">    username = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>).last().username</span><br><span class="line">    <span class="built_in">print</span>(username)</span><br><span class="line">    <span class="comment"># # tom</span></span><br><span class="line">    <span class="comment"># 可以写成</span></span><br><span class="line">    res_one = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>).last()</span><br><span class="line">    <span class="built_in">print</span>(res_one.password)</span><br><span class="line">    <span class="comment"># 912</span></span><br><span class="line">    <span class="comment"># 记住了只能拿到对象以后才能才能点属性“UserInfo object (1)�?</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】对数据库的表增加数�">�?】对数据库的表增加数�?</h3>
<ul>
<li>方法：<code>create()</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这是manage.py中的main下的第一行数�?</span></span><br><span class="line">    os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;first_django.settings&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 启动django项目</span></span><br><span class="line">    <span class="comment"># 缺点是一次性的</span></span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用Django项目的模型表</span></span><br><span class="line">    <span class="comment"># 导入</span></span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加表数�?-&gt;create</span></span><br><span class="line">    res = UserInfo.objects.create(username=<span class="string">&quot;dream&quot;</span>, password=<span class="string">&quot;521&quot;</span>, age=<span class="string">&quot;22&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    <span class="comment"># UserInfo object (4)#添加成功</span></span><br><span class="line">    <span class="comment"># 在Django中不需要提交事�?</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】对数据库的表进行删数据">�?】对数据库的表进行删数据</h3>
<ul>
<li>方法：<code>delete()</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这是manage.py中的main下的第一行数�?</span></span><br><span class="line">    os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;first_django.settings&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 启动django项目</span></span><br><span class="line">    <span class="comment"># 缺点是一次性的</span></span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用Django项目的模型表</span></span><br><span class="line">    <span class="comment"># 导入</span></span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除数据</span></span><br><span class="line">    <span class="comment"># 方案一：获取到指定的对象后直接删除--&gt;delete()</span></span><br><span class="line">    UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;dream&quot;</span>, password=<span class="string">&quot;521&quot;</span>).delete()</span><br><span class="line">    <span class="comment"># 删除成功</span></span><br><span class="line">    <span class="comment"># 方法�?先获取对�?然后删除</span></span><br><span class="line">    <span class="comment"># get的属性，找不到值就会报�?</span></span><br><span class="line">    <span class="comment"># get 获取多个值也会直接报�?</span></span><br><span class="line">    res = UserInfo.objects.get(username=<span class="string">&quot;dream&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    <span class="comment"># UserInfo object (6) #拿到一个对�?</span></span><br><span class="line">    <span class="comment"># 删除到的话就直接delete()</span></span><br><span class="line">    res.delete()</span><br><span class="line">    <span class="comment"># 删除成功</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】对数据库的表进行修改数�">�?】对数据库的表进行修改数�?</h3>
<ul>
<li>方法：<code>update()</code></li>
<li>方法二记得提交事务：save()</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这是manage.py中的main下的第一行数�?</span></span><br><span class="line">    os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;first_django.settings&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 启动django项目</span></span><br><span class="line">    <span class="comment"># 缺点是一次性的</span></span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用Django项目的模型表</span></span><br><span class="line">    <span class="comment"># 导入</span></span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改数据</span></span><br><span class="line">    <span class="comment"># 方法一：直接获取后然后删除--&gt;update</span></span><br><span class="line">    res = UserInfo.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>).update(password=<span class="string">&quot;88888&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    <span class="comment"># 1--》只影响到了一条数据所以才会返�?</span></span><br><span class="line">    <span class="comment"># 修改成功</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方法二：获取对象以后在删�?</span></span><br><span class="line">    rew_obj = UserInfo.objects.get(<span class="built_in">id</span>=<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(rew_obj)</span><br><span class="line">    <span class="comment"># UserInfo object (2)</span></span><br><span class="line">    rew_obj.password = <span class="string">&quot;77777&quot;</span></span><br><span class="line">    rew_obj.age = <span class="number">66</span></span><br><span class="line">    <span class="comment"># 你会发现没反�?</span></span><br><span class="line">    rew_obj.save()  <span class="comment"># 可以看作是修改后提交事务</span></span><br><span class="line">    <span class="comment"># 修改成功</span></span><br></pre></td></tr></table></figure>
<h3 id="【案例�">【案例�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这是manage.py中的main下的第一行数�?</span></span><br><span class="line">    os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;first_django.settings&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 启动django项目</span></span><br><span class="line">    <span class="comment"># 缺点是一次性的</span></span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用Django项目的模型表</span></span><br><span class="line">    <span class="comment"># 导入</span></span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment"># �?】查数据</span></span><br><span class="line">    <span class="comment"># 确保了表里有数据</span></span><br><span class="line">    res_one = UserInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="built_in">print</span>(res_one)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&lt;UserInfo: UserInfo object (1)&gt;]&gt;</span></span><br><span class="line">    <span class="comment"># 得到的是一个对�?</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据库只有一个数据的时�?</span></span><br><span class="line">    <span class="comment"># 过滤filter</span></span><br><span class="line">    res_one = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>)</span><br><span class="line">    <span class="comment"># 这样就找到了username这个�?</span></span><br><span class="line">    <span class="built_in">print</span>(res_one)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&lt;UserInfo: UserInfo object (1)&gt;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据库要是有两条数据的话，并且名字一样，我们就要两个参数来判�?</span></span><br><span class="line">    res_two = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>, password=<span class="string">&quot;912&quot;</span>)</span><br><span class="line">    <span class="comment"># 找两个叫tom的数�?</span></span><br><span class="line">    <span class="built_in">print</span>(res_two)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&lt;UserInfo: UserInfo object (2)&gt;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 表中有三个数�?</span></span><br><span class="line">    <span class="comment"># first()：是拿到你筛选条件的第一个�?</span></span><br><span class="line">    res_two = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>).first()</span><br><span class="line">    <span class="built_in">print</span>(res_two)</span><br><span class="line">    <span class="comment"># UserInfo object (1)</span></span><br><span class="line">    <span class="comment"># last()：是拿到你筛选条件的最后一个�?</span></span><br><span class="line">    res_one = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>).last()</span><br><span class="line">    <span class="built_in">print</span>(res_one)</span><br><span class="line">    <span class="comment"># UserInfo object (2)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 取�?-&gt;直接拿res_one当作一个对象，进行.属性获取数�?</span></span><br><span class="line">    username = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>).last().username</span><br><span class="line">    <span class="built_in">print</span>(username)</span><br><span class="line">    <span class="comment"># # tom</span></span><br><span class="line">    <span class="comment"># 可以写成</span></span><br><span class="line">    res_one = UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;tom&quot;</span>).last()</span><br><span class="line">    <span class="built_in">print</span>(res_one.password)</span><br><span class="line">    <span class="comment"># 912</span></span><br><span class="line">    <span class="comment"># 记住了只能拿到对象以后才能才能点属性“UserInfo object (1)�?</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># �?】增加表数据--&gt;create</span></span><br><span class="line">    res = UserInfo.objects.create(username=<span class="string">&quot;dream&quot;</span>, password=<span class="string">&quot;521&quot;</span>, age=<span class="string">&quot;22&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    <span class="comment"># UserInfo object (4)#添加成功</span></span><br><span class="line">    <span class="comment"># 在Django中不需要提交事�?</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># �?】删除数�?</span></span><br><span class="line">    <span class="comment"># 方案一：获取到指定的对象后直接删除--&gt;delete()</span></span><br><span class="line">    UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&quot;dream&quot;</span>, password=<span class="string">&quot;521&quot;</span>).delete()</span><br><span class="line">    <span class="comment"># 删除成功</span></span><br><span class="line">    <span class="comment"># 方法�?先获取对�?然后删除</span></span><br><span class="line">    <span class="comment"># get的属性，找不到值就会报�?</span></span><br><span class="line">    <span class="comment"># get 获取多个值也会直接报�?</span></span><br><span class="line">    res = UserInfo.objects.get(username=<span class="string">&quot;dream&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    <span class="comment"># UserInfo object (6) #拿到一个对�?</span></span><br><span class="line">    <span class="comment"># 删除到的话就直接delete()</span></span><br><span class="line">    res.delete()</span><br><span class="line">    <span class="comment"># 删除成功</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># �?】修改数�?</span></span><br><span class="line">    <span class="comment"># 方法一：直接获取后然后删除--&gt;update</span></span><br><span class="line">    res = UserInfo.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>).update(password=<span class="string">&quot;88888&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    <span class="comment"># 1--》只影响到了一条数据所以才会返�?</span></span><br><span class="line">    <span class="comment"># 修改成功</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方法二：获取对象以后在删�?</span></span><br><span class="line">    rew_obj = UserInfo.objects.get(<span class="built_in">id</span>=<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(rew_obj)</span><br><span class="line">    <span class="comment"># UserInfo object (2)</span></span><br><span class="line">    rew_obj.password = <span class="string">&quot;77777&quot;</span></span><br><span class="line">    rew_obj.age = <span class="number">66</span></span><br><span class="line">    <span class="comment"># 你会发现没反�?</span></span><br><span class="line">    rew_obj.save()  <span class="comment"># 可以看作是修改后提交事务</span></span><br><span class="line">    <span class="comment"># 修改成功</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/4.0css%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/4.0css%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">4.0css����</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 17:47:38" itemprop="dateModified" datetime="2025-10-11T17:47:38+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>css基础</h1>
<ul>
<li>文件类型显示stylesheet，后缀为css</li>
</ul>
<h2 id="【一】什么是css">【一】什么是css</h2>
<ul>
<li>层级样式：就是给HTML标签添加样式，让它变的好�?</li>
</ul>
<h2 id="【二】注释语�">【二】注释语�?</h2>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*这是注释语法*/</span></span><br></pre></td></tr></table></figure>
<h2 id="【三】css的语法结�">【三】css的语法结�?</h2>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">选择�?&#123;</span><br><span class="line">    样式属�? 样式属性�?</span><br><span class="line">    样式属�? 样式属性�?</span><br><span class="line">    样式属�? 样式属性�? 样式属性�? 样式属性�?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>一个正常的网页css样式是非常多的就算专门开设css文件存储也很�?</li>
<li>这个时候就可以在css文件中通过注释来辅助辨别与查找</li>
</ul>
<h2 id="【四】css的三种引入方�">【四】css的三种引入方�?</h2>
<h3 id="�-】style标签内部直接书写">�?】style标签内部直接书写</h3>
<ul>
<li>在head内style标签直接编写css代码</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">h2</span>&#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">color</span>:black;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】引入外部css文件">�?】引入外部css文件</h3>
<ul>
<li>head内link标签引入外部css文件</li>
<li>用link形式符合标准</li>
<li>0.1.css是css文件�?</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--HTML文件--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;01.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">    这是一级标�?</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】行内式">�?】行内式</h3>
<ul>
<li>标签内部通过style属性直接编�?</li>
<li>第三种也称之�?行内�?是最不推荐使用的一种方�?</li>
<li>因为它会将HTML和CSS柔和到一�?</li>
<li>增加了耦合�?</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">h1</span> style=&quot;<span class="attribute">color</span>:black;&quot;&gt;id是black&lt;/<span class="selector-tag">h1</span>&gt;</span><br></pre></td></tr></table></figure>
<h2 id="【五】基本选择�">【五】基本选择�?</h2>
<ul>
<li>在CSS中，选择器用于选取HTML文档中的元素�?</li>
<li>根据选择器的类型和语法的不同，可以选择不同的元素�?</li>
<li>常用的有id选择器、类选择器、元�?标签选择器和通用选择器�?</li>
</ul>
<h3 id="�-】id选择�">�?】id选择�?</h3>
<ul>
<li>每个页面的id值是唯一的，所以在css中不能重复使用同一个id选择�?</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#p</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: blue;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;p&quot;</span>&gt;</span>蓝色<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】类选择�-—》class">�?】类选择�?—》class</h3>
<ul>
<li>多个元素可以共享一个class</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#p</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: blue;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.h</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>:red;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;p&quot;</span>&gt;</span>id蓝色<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;h&quot;</span>&gt;</span>class红色<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】元�-标签选择�">�?】元�?标签选择�?</h3>
<ul>
<li>通过元素的标签名进行选取</li>
<li>比如段落、列表等</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">span</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: royalblue;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">p</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: blueviolet;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>指定颜色<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>指定颜色<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】通用选择�">�?】通用选择�?</h3>
<ul>
<li>*标识所有的元素都会改变</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: chocolate;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>*代表全局颜色所有数据都会变颜色，除了被定义�?/h1&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】综�">�?】综�?</h3>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#p</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: blue;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.h</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>:red;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    *&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: chocolate;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">span</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: royalblue;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">p</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: blueviolet;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;p&quot;</span>&gt;</span>id蓝色<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;h&quot;</span>&gt;</span>class红色<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>*代表全局颜色所有数据都会变颜色，除了被定义�?/h1&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>指定颜色<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>指定颜色<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240605232203850.png" alt="image-20240605232203850"></p>
<h2 id="【六】关系选择�">【六】关系选择�?</h2>
<table>
<thead>
<tr>
<th>选择�?</th>
<th>名称</th>
<th>版本</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>E F</td>
<td>包含选择�?Descendant combinator)</td>
<td>CSS1</td>
<td>选择所有被E元素包含的F元素�?</td>
</tr>
<tr>
<td>E&gt;F</td>
<td>子选择�?Child combinator)</td>
<td>CSS2</td>
<td>选择所有作为E元素的子元素F�?</td>
</tr>
<tr>
<td>E+F</td>
<td>相邻选择�?Adjacent sibling combinator)</td>
<td>CSS2</td>
<td>选择紧贴在E元素之后F元素�?</td>
</tr>
<tr>
<td>E~F</td>
<td>兄弟选择�?General sibling combinator)</td>
<td>CSS3</td>
<td>选择E元素所有兄弟元素F�?</td>
</tr>
</tbody>
</table>
<h3 id="�-】四�">�?】四�?</h3>
<ul>
<li>后代选择�?</li>
<li>儿子选择�?</li>
<li>毗邻选择�?</li>
<li>弟弟选择�?</li>
</ul>
<h3 id="�-】标签关�">�?】标签关�?</h3>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>div1</span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span>div2</span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>p1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span>p2</span><br><span class="line">		<span class="tag">&lt;<span class="name">span</span>&gt;</span>span1<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span>&gt;</span>span2<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>通过嵌套层级来表示亲属关�?</p>
</li>
<li>
<ul>
<li>1.<strong>对于div1来说</strong>：div2、p2、span2都是儿子</li>
<li>2.<strong>对于div2、p2、span2来说</strong>：div1就是父亲</li>
<li>3.<strong>对于p1来说</strong>：div2是父�?div1是爷�?可以将div1和div2统称为祖�?</li>
<li>4.<strong>对于span2来说</strong>：div2、p2是哥�?span2是弟�?</li>
<li>5.div1内部所有的标签无论层级都可以称之为是div1的后�?</li>
</ul>
</li>
</ul>
<p>ps:判断的时候一定要看层级关�?</p>
<h3 id="�-】介�">�?】介�?</h3>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line"><span class="comment">/*后代选择�?/</span></span><br><span class="line"><span class="comment">/*div标签里面所有的p标签*/</span></span><br><span class="line">    <span class="selector-tag">div</span> <span class="selector-tag">p</span>&#123;</span><br><span class="line">        <span class="attribute">color</span> : rosybrown;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*儿子选择�?/</span></span><br><span class="line"><span class="comment">/*比div标签低一级的span标签*/</span></span><br><span class="line"><span class="selector-tag">div</span>&gt;<span class="selector-tag">span</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>:red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*毗邻选择�?/</span></span><br><span class="line"><span class="comment">/*于div紧挨着的span会发生改�?/</span></span><br><span class="line"><span class="comment">div + span&#123;</span></span><br><span class="line"><span class="comment">    color: darkgreen;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">/*弟弟选择�?/</span></span><br><span class="line"><span class="comment">/*div下的所有p兄弟标签就会发生改变*/</span></span><br><span class="line"><span class="selector-tag">div</span>~<span class="selector-tag">p</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>:slateblue;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="�-】案�">�?】案�?</h3>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="comment">/*后代选择�?/</span></span></span><br><span class="line"><span class="comment"><span class="language-css">    /*div标签里面所有的p标签*/</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">div</span> <span class="selector-tag">p</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span> : rosybrown;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/*儿子选择�?/</span></span></span><br><span class="line"><span class="comment"><span class="language-css">    /*比div标签低一级的span标签*/</span></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">div</span>&gt;<span class="selector-tag">span</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>:red;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/*毗邻选择�?/</span></span></span><br><span class="line"><span class="comment"><span class="language-css">    /*于div紧挨着的span会发生改�?/</span></span></span><br><span class="line"><span class="comment"><span class="language-css">    div + span&#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        color: darkgreen;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">    &#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">    /*弟弟选择�?/</span></span></span><br><span class="line"><span class="comment"><span class="language-css">    /*div下的所有p兄弟标签就会发生改变*/</span></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">div</span>~<span class="selector-tag">p</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>:slateblue;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>【一】组合选择�?/h1&gt;</span><br><span class="line"><span class="comment">&lt;!--后代选择�?-&gt;</span></span><br><span class="line"><span class="comment">&lt;div&gt;div1</span></span><br><span class="line"><span class="comment">    &lt;div&gt;div2</span></span><br><span class="line"><span class="comment">        &lt;p&gt;p1&lt;/p&gt;</span></span><br><span class="line"><span class="comment">    &lt;/div&gt;</span></span><br><span class="line"><span class="comment">    &lt;p&gt;p1</span></span><br><span class="line"><span class="comment">        &lt;span&gt;span2&lt;/span&gt;</span></span><br><span class="line"><span class="comment">    &lt;/p&gt;</span></span><br><span class="line"><span class="comment">    &lt;span&gt;span1&lt;/span&gt;</span></span><br><span class="line"><span class="comment">&lt;/div&gt;</span></span><br><span class="line"><span class="comment">&lt;span&gt;div标签外的span&lt;/span&gt;</span></span><br><span class="line"><span class="comment">&lt;/body&gt;</span></span><br><span class="line"><span class="comment">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240606151625916.png" alt="image-20240606151625916"></p>
<h2 id="【七】属性选择�">【七】属性选择�?</h2>
<h3 id="�-】用�">�?】用�?</h3>
<ul>
<li>含有某个属�?</li>
<li>含有某个属性并且有某个�?</li>
<li>含有某个属性并且有某个值的某个标签</li>
</ul>
<table>
<thead>
<tr>
<th>选择�?</th>
<th>版本</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>E[att]</td>
<td>CSS2</td>
<td>选择具有att属性的E元素�?</td>
</tr>
<tr>
<td>E[att=“val”]</td>
<td>CSS2</td>
<td>选择具有att属性且属性值等于val的E元素�?</td>
</tr>
<tr>
<td>E[att~=“val”]</td>
<td>CSS2</td>
<td>选择具有att属性且属性值为一用空格分隔的字词列表，其中一个等于val的E元素�?</td>
</tr>
<tr>
<td>E[att^=“val”]</td>
<td>CSS3</td>
<td>选择具有att属性且属性值为以val开头的字符串的E元素�?</td>
</tr>
<tr>
<td>E[att$=“val”]</td>
<td>CSS3</td>
<td>选择具有att属性且属性值为以val结尾的字符串的E元素�?</td>
</tr>
<tr>
<td>E[att*=“val”]</td>
<td>CSS3</td>
<td>选择具有att属性且属性值为包含val的字符串的E元素�?</td>
</tr>
<tr>
<td>E[att|=“val”]</td>
<td>CSS2</td>
<td>选择具有att属性且属性值为以val开头并用连接符&quot;-&quot;分隔的字符串的E元素，如果属性值仅为val，也将被选择�?</td>
</tr>
</tbody>
</table>
<h3 id="�-】语�">�?】语�?</h3>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> &lt;style&gt;</span><br><span class="line"><span class="comment">/*直接锁定属性名�?/</span></span><br><span class="line"><span class="comment">   [name]&#123;</span></span><br><span class="line"><span class="comment">     color:red;</span></span><br><span class="line"><span class="comment">   &#125;</span></span><br><span class="line"><span class="comment">/*属性名=属性�?/</span></span><br><span class="line"><span class="comment">   [username=&quot;tom&quot;]&#123;</span></span><br><span class="line"><span class="comment">     color:chartreuse;</span></span><br><span class="line"><span class="comment">   &#125;</span></span><br><span class="line"><span class="comment">   /*标签[属性名=属性值]*/</span></span><br><span class="line">   <span class="selector-tag">input</span><span class="selector-attr">[name=<span class="string">&quot;password&quot;</span>]</span>&#123;</span><br><span class="line">     <span class="attribute">color</span>:darkturquoise;</span><br><span class="line">   &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="�-】案�-2">�?】案�?</h3>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE <span class="selector-tag">html</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">html</span> lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-<span class="number">8</span>&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line"><span class="comment">/*直接锁定属性名�?/</span></span><br><span class="line"><span class="comment">    [name]&#123;</span></span><br><span class="line"><span class="comment">      color:red;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">/*属性名=属性�?/</span></span><br><span class="line"><span class="comment">    [username=&quot;tom&quot;]&#123;</span></span><br><span class="line"><span class="comment">      color:chartreuse;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    /*标签[属性名=属性值]*/</span></span><br><span class="line">    <span class="selector-tag">input</span><span class="selector-attr">[name=<span class="string">&quot;password&quot;</span>]</span>&#123;</span><br><span class="line">      <span class="attribute">color</span>:darkturquoise;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">div</span><span class="selector-attr">[name=<span class="string">&quot;opp&quot;</span>]</span>&#123;</span><br><span class="line">      <span class="attribute">color</span>:maroon;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line">&lt;!--输入<span class="selector-tag">input</span>框里的数据就是红色的--&gt;</span><br><span class="line">&lt;<span class="selector-tag">input</span> type=&quot;<span class="selector-tag">text</span>&quot; name=&quot;tom&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">p</span> username=&quot;tom&quot;&gt;这个是tom&lt;/<span class="selector-tag">p</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">input</span> type=&quot;password&quot; name=&quot;password&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> name=&quot;opp&quot;&gt;这是opp&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">body</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">html</span>&gt;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240606155633995.png" alt="image-20240606155633995"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/4.0Mysql%E4%B9%8B%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/4.0Mysql%E4%B9%8B%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6/" class="post-title-link" itemprop="url">4.0Mysql֮Լ������</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 17:47:38" itemprop="dateModified" datetime="2025-10-11T17:47:38+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Mysql之约束条�?</h1>
<ul>
<li>前面已经学了not null和null，unique，zerofill约束条件</li>
</ul>
<h2 id="【一】什么约束条�">【一】什么约束条�?</h2>
<ul>
<li>就是创建表格时，限制表中的数据，保证添加到表中的数据准确和可靠性！
<ul>
<li>不符合就会插入失�?</li>
</ul>
</li>
<li>修改表的时候也可以添加约束条件</li>
</ul>
<h2 id="【二】约束条件概�">【二】约束条件概�?</h2>
<ul>
<li>
<p>null ：可以为�?</p>
</li>
<li>
<p>not null : 非空约束</p>
<ul>
<li>不可以为�?</li>
</ul>
</li>
<li>
<p>unique ：唯一性约�?</p>
<ul>
<li>插入的数据不能和表中的数据重复（数据在表中只能出现一次），否则会报错</li>
</ul>
</li>
<li>
<p>zerofill：默认用0填充至指定长�?</p>
</li>
<li>
<p>primary key : 主键约束pk</p>
<ul>
<li>增加查询效率</li>
</ul>
</li>
<li>
<p>foreign key ：外键约束fk</p>
<ul>
<li>表与另一张表之间的联�?</li>
</ul>
</li>
</ul>
<ol>
<li>约束条件就是为了限制表中的数据，保证数据的准确性和可靠性而存�?</li>
<li>约束条件在创建表时根据需求可加可不加</li>
</ol>
<h3 id="�-】如何查看当前表的约束条�-字段限制">�?】如何查看当前表的约束条�?字段限制</h3>
<ul>
<li>给约束条件添加名�?</li>
<li>查看当前所有的�?</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529185809245.png" alt="image-20240529185809245"></p>
<ul>
<li>进入到information_schema库中</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use information_schema;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529185753902.png" alt="image-20240529185753902"></p>
<ul>
<li>查看所有的�?</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529185735536.png" alt="image-20240529185735536"></p>
<ul>
<li>table_constraints 该表专门存储约束信息</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">desc</span> table_constraints;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529185925155.png" alt="image-20240529185925155"></p>
<ul>
<li>查看某个表的约束条件</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> constraint_name <span class="keyword">from</span> table_constraints <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;表名&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529190005455.png" alt="image-20240529190005455"></p>
<h3 id="�-】null">�?】null</h3>
<ul>
<li>数据可以为空</li>
</ul>
<h3 id="�-】not-null">�?】not null</h3>
<ul>
<li>数据不能可空，必须给�?</li>
</ul>
<h3 id="�-】unique">�?】unique</h3>
<ul>
<li>保证数据的唯一性，确保表中无相同数�?</li>
<li>但是可以为空</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 把t17这个表的id改成唯一�?</span></span><br><span class="line"><span class="comment">-- 前提是你要创建好的有一个他t17的这个表</span></span><br><span class="line"><span class="keyword">alter table</span> t17 modify id <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">unique</span>;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529150750729.png" alt="image-20240529150750729"></p>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529150810612.png" alt="image-20240529150810612"></p>
<h3 id="�-】主键约束PK（primary-key�">�?】主键约束PK（<code>primary key</code>�?</h3>
<ul>
<li>主键约束–》不能为空，而且唯一，一张表只能有一个主键约�?</li>
</ul>
<h4 id="�-）主键术�">�?）主键术�?</h4>
<ul>
<li>主键约束–》给表中的某个字段添加主键约�?</li>
<li>主键字段–》表中的某个字段添加了主键约�?</li>
<li>主键�?-》主键字段出现的每个值就是主键�?</li>
</ul>
<h4 id="�-）作�">�?）作�?</h4>
<ul>
<li>主键约束不能为空，不能重复出�?</li>
<li>'not null，unique’的效果也是不能为空，不能重复出现</li>
<li>二者本质不同，添加主键约束之后还会自动添加‘索�?-index’；</li>
<li>一张表没有主键是无效的，主键是当前行的唯一标识�?</li>
<li>即使两行数据相同，但是根据主键的不同，两行数据还是不同的</li>
</ul>
<h4 id="�-）主键根据个数分�">�?）主键根据个数分�?</h4>
<ul>
<li>单一主键，复合主�?
<ul>
<li>单一主键：给字段添加一个主键约�?</li>
<li>复合主键：给多个字段联合添加一个主键约�?</li>
</ul>
</li>
</ul>
<h5 id="1-单一主键：列级约�">[1]单一主键：列级约�?</h5>
<ul>
<li>if exists ：有责删除，无责什么都不发�?</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加表之前看一下表是否已经存在</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> 表名;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> user_one(</span><br><span class="line">	id <span class="type">int</span>(<span class="number">4</span>)  <span class="keyword">primary key</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">32</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529155222721.png" alt="image-20240529155222721"></p>
<h5 id="2-单一主键：表级约�">[2]单一主键：表级约�?</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加表之前看一下表是否已经存在</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> 表名;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> user_one(</span><br><span class="line">	id <span class="type">int</span>(<span class="number">11</span>),</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">32</span>),</span><br><span class="line">    <span class="keyword">primary key</span>(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529160047870.png" alt="image-20240529160047870"></p>
<ul>
<li>给主键重命名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> user_one(</span><br><span class="line">	id <span class="type">int</span>(<span class="number">11</span>),</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">32</span>),</span><br><span class="line">    <span class="keyword">constraint</span> one_user_id_pk <span class="keyword">primary key</span>(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529160258352.png" alt="image-20240529160258352"></p>
<h5 id="3-复合主键：只能为表级约束">[3]复合主键：只能为表级约束</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加表之前看一下表是否已经存在</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> 表名;</span><br></pre></td></tr></table></figure>
<ul>
<li>复合主键，表级约束，并且给其重命�?</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> user_one(</span><br><span class="line">	id <span class="type">int</span>(<span class="number">11</span>),</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">32</span>),</span><br><span class="line">    <span class="keyword">constraint</span> one_user_id_pk <span class="keyword">primary key</span>(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529161057598.png" alt="image-20240529161057598"></p>
<h4 id="4-主键根据性质分类">(4)主键根据性质分类</h4>
<ul>
<li>自然主键：主键是个自然数，这个主键与业务没有任何关系</li>
<li>业务主键：主键值与表中的业务密切相关。这种业务发生改变时，业务主键也会跟着受影响�?</li>
</ul>
<h4 id="5-自动生成主键">(5)自动生成主键</h4>
<ul>
<li>
<p>使用字段auto_increment</p>
</li>
<li>
<p>mysql数据库系统提供一个自然自增数据，专门用来生成主键值，主键值不需要用户去维护，也不需要生成，mysql自动生成</p>
</li>
<li>
<p>默认数字�?开始，�?开始递增</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加表之前看一下表是否已经存在</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> 表名;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> user_one(</span><br><span class="line">id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">32</span>));</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529162317862.png" alt="image-20240529162317862"></p>
<ul>
<li>插入数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> user_one(name) <span class="keyword">values</span>(<span class="string">&#x27;tom&#x27;</span>),(<span class="string">&#x27;opp&#x27;</span>),(<span class="string">&#x27;dream&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529162809340.png" alt="image-20240529162809340"></p>
<ul>
<li>每次递增的数字只会出现一�?</li>
</ul>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529164029559.png" alt="image-20240529164029559"></p>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529164047272.png" alt="image-20240529164047272"></p>
<h4 id="6-重置主键起始位置">(6)重置主键起始位置</h4>
<h5 id="1-清空表数�">[1]清空表数�?</h5>
<ul>
<li>
<p>将原来表的数据全部清空，就重置了主键的起始位�?</p>
</li>
<li>
<p>不建议使�?</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trucate 表名�?</span><br></pre></td></tr></table></figure>
<h5 id="2-指定主键的起始位�">[2]指定主键的起始位�?</h5>
<ul>
<li>使用表修改语句将带有 AUTO_INCREMENT 的字段数字指定为自定义位�?</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 AUTO_INCREMENT <span class="operator">=</span> 指定主键的起始位�?</span><br></pre></td></tr></table></figure>
<ul>
<li>字段数字指定为自定义位置,指定的位置就会继续递增</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> user_one AUTO_INCREMENT <span class="operator">=</span> <span class="number">958</span>;</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529164406578.png" alt="image-20240529164406578"></p>
<h3 id="�-】外键约束FK（foreign-key�">�?】外键约束FK（foreign key�?</h3>
<h4 id="�-）引�">�?）引�?</h4>
<ul>
<li>某个字段依赖于另一张表中某个字段的值，而被依赖的字段必须具有主键约束或者唯一约束，被依赖的数据表称为主表（父表），设置外键约束的表称为子表或者从表�?</li>
</ul>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529165441539.png" alt="image-20240529165441539"></p>
<ul>
<li>
<p>上表�?</p>
</li>
<li>
<p>主表就是班级�?-》班级号–》主�?</p>
</li>
<li>
<p>外表就是学生�?-》班级号–》外�?</p>
</li>
</ul>
<h4 id="�-）外键术�">�?）外键术�?</h4>
<ul>
<li>外键约束–》给表中的某个字段添加外键约�?</li>
<li>外键字段–》某个字段添加了外键约束</li>
<li>外键�?-》外键字段中的每一个数据都是外键�?</li>
</ul>
<h4 id="�-）外键的关系">�?）外键的关系</h4>
<ul>
<li>一对一–》好比：人和人的信息</li>
<li>一对多–》好比：书和印刷�?</li>
<li>多对�?-》好比：书和作�?</li>
</ul>
<h4 id="�-）外键语�">�?）外键语�?</h4>
<ul>
<li>先建立需要被建立关系的表，这样才能让建立关系的表去和它建立关�?</li>
<li>建立一个建立关系的�?</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> 表名<span class="number">1</span>(</span><br><span class="line">字段�? 字段类型<span class="number">1</span> 约束条件<span class="number">1</span> comment 注释<span class="number">1</span>,</span><br><span class="line">	字段�? 字段类型<span class="number">2</span> 约束条件<span class="number">2</span> comment 注释<span class="number">2</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ul>
<li>和它建立关系的表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> 表名<span class="number">2</span>(</span><br><span class="line">字段�? 字段类型<span class="number">1</span> 约束条件<span class="number">1</span> comment 注释<span class="number">1</span>,</span><br><span class="line">	字段�? 字段类型<span class="number">2</span> 约束条件<span class="number">2</span> comment 注释<span class="number">2</span>,</span><br><span class="line">    <span class="keyword">foreign key</span>(字段<span class="number">2</span>) <span class="keyword">references</span> 表名<span class="number">1</span>(字段�?)</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- foreign key后面括号里面跟着的是自己的外键字�?</span></span><br><span class="line"><span class="comment">-- references后面括号里面填的是被关联的表�?需要关联的外键字段</span></span><br></pre></td></tr></table></figure>
<h4 id="�-）一对多外键关系">�?）一对多外键关系</h4>
<ul>
<li>一对多：外键关系应该健在多的一�?
<ul>
<li>就好比：部门只有一个，但是部门有好多个员工</li>
</ul>
</li>
<li>部门表先创建</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- comment给字段添加注�?</span></span><br><span class="line"><span class="keyword">create table</span> dep(</span><br><span class="line">	id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">primary key</span> auto_increment comment <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">    dep_name <span class="type">varchar</span>(<span class="number">32</span>) comment<span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">    def_desc <span class="type">varchar</span>(<span class="number">32</span>) comment<span class="string">&#x27;部门描述&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529182821276.png" alt="image-20240529182821276"></p>
<ul>
<li>有了部门表在创建员工表，并且要员工和部门绑定</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> emp(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment comment <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">32</span>) comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">  age <span class="type">int</span> comment <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">  dep_id <span class="type">int</span> comment <span class="string">&#x27;部门编号&#x27;</span>,</span><br><span class="line">    <span class="comment">-- dep_id:是建部门表的id</span></span><br><span class="line">    <span class="comment">-- dep:是部门表的表�?</span></span><br><span class="line">  <span class="keyword">foreign key</span>(dep_id) <span class="keyword">references</span> dep(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529182832126.png" alt="image-20240529182832126"></p>
<ul>
<li>插入数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 向部门表中插入数�?</span></span><br><span class="line"><span class="keyword">insert into</span> dep(dep_name,def_desc) <span class="keyword">values</span>(<span class="string">&#x27;back&#x27;</span>,<span class="string">&#x27;后勤部门&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> dep(dep_name,def_desc) <span class="keyword">values</span>(<span class="string">&#x27;per&#x27;</span>,<span class="string">&#x27;人事部门&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 向员工表中插入数�?</span></span><br><span class="line"><span class="comment">-- 不选部门就是null</span></span><br><span class="line"><span class="keyword">insert into</span> emp(name,age) <span class="keyword">values</span>(<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;22&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 向员工表中插入数�?</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert into</span> emp(name,age,dep_id) <span class="keyword">values</span>(<span class="string">&#x27;opp&#x27;</span>,<span class="string">&#x27;23&#x27;</span>,<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 向员工表中插入数�?</span></span><br><span class="line"><span class="comment">-- 这条数据是错误的因为只有两个部门，没有第三个</span></span><br><span class="line"><span class="keyword">insert into</span> emp(name,age,dep_id) <span class="keyword">values</span>(<span class="string">&#x27;bob&#x27;</span>,<span class="string">&#x27;18&#x27;</span>,<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"></span><br><span class="line">ERROR <span class="number">1452</span> (<span class="number">23000</span>): Cannot <span class="keyword">add</span> <span class="keyword">or</span> <span class="keyword">update</span> a child <span class="type">row</span>: a <span class="keyword">foreign key</span> <span class="keyword">constraint</span> fails (`day01`.`emp`, <span class="keyword">CONSTRAINT</span> `emp_ibfk_1` <span class="keyword">FOREIGN KEY</span> (`dep_id`) <span class="keyword">REFERENCES</span> `dep` (`id`))</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529184453830.png" alt="image-20240529184453830"></p>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529184503857.png" alt="image-20240529184503857"></p>
<ul>
<li>级联更新<code>on update cascade</code>，级联删除<code>on delete cascade</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> emp1(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment comment <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">32</span>) comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">  age <span class="type">int</span> comment <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">  dep_id <span class="type">int</span> comment <span class="string">&#x27;部门编号&#x27;</span>,</span><br><span class="line">   <span class="comment">-- 建立联系</span></span><br><span class="line">  <span class="keyword">foreign key</span>(dep_id) <span class="keyword">references</span> dep1(id) </span><br><span class="line">  <span class="keyword">on</span> <span class="keyword">update</span> cascade  # 级联更新</span><br><span class="line">  <span class="keyword">on</span> <span class="keyword">delete</span> cascade  # 级联删除</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> dep1(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment comment <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">  dep_name <span class="type">varchar</span>(<span class="number">32</span>) comment <span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">  dep_desc <span class="type">varchar</span>(<span class="number">32</span>) comment <span class="string">&#x27;部门描述&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="�-）外键字段的约束效果">�?）外键字段的约束效果</h4>
<ul>
<li>建表时应该先创建被关联的表（没有外键字段的表�?</li>
<li>插入数据的时�?应该先插入被关联�?没有外键字段的表)
<ul>
<li>外键字段填入的值只能是被关联表中已经存在的�?</li>
</ul>
</li>
<li>修改、删除被关联表数据都会出现障�?</li>
</ul>
<h4 id="�-）多对多关系">�?）多对多关系</h4>
<ul>
<li>
<p>好比书和作�?</p>
<ul>
<li>书有好几个作�?</li>
<li>作者发出好多本�?</li>
</ul>
</li>
<li>
<p>多对多无法判断谁先创建谁后创�?</p>
</li>
<li>
<p>需要借助第三张表专门建立关系</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> book(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">  title <span class="type">varchar</span>(<span class="number">32</span>),</span><br><span class="line">  price <span class="type">float</span>(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> author(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">32</span>),</span><br><span class="line">  gender enum(<span class="string">&#x27;male&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,<span class="string">&#x27;others&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529193101402.png" alt="image-20240529193101402"></p>
<ul>
<li>建立第三张表来储存它们的关系</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> book2author(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">  author_id <span class="type">int</span>,</span><br><span class="line">  book_id <span class="type">int</span>,</span><br><span class="line">  <span class="keyword">foreign key</span>(author_id) <span class="keyword">references</span> author(id) </span><br><span class="line">  <span class="keyword">on</span> <span class="keyword">update</span> cascade   </span><br><span class="line">  <span class="keyword">on</span> <span class="keyword">delete</span> cascade,  </span><br><span class="line">  <span class="keyword">foreign key</span>(book_id) <span class="keyword">references</span> book(id) </span><br><span class="line">  <span class="keyword">on</span> <span class="keyword">update</span> cascade  </span><br><span class="line">  <span class="keyword">on</span> <span class="keyword">delete</span> cascade  </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529193112192.png" alt="image-20240529193112192"></p>
<ul>
<li>两张表内的数据没有在第三张表内绑定关系的情况下随意新增修改和删除</li>
</ul>
<h4 id="�-）一对一关系">�?）一对一关系</h4>
<ul>
<li>一对一关系外键字段在任意一方都可以，推荐在查询率较高的一�?</li>
</ul>
<h3 id="【补充�">【补充�?</h3>
<ul>
<li>
<p>外键根据个数分类</p>
<ul>
<li>单一外键【给一个字段添加外键约束�?</li>
<li>复合外键【给多个字段联合添加成一个外键约束�?</li>
</ul>
</li>
<li>
<p>一张表可以有多个外键字�?</p>
</li>
<li>
<p>外键字段可以为null</p>
</li>
<li>
<p>外键字段引用一张表的某个字段时，被引用的字段必须具有unique约束</p>
</li>
<li>
<p>有了外键引用之后，表分为父表和子表。一对多关系中，一为父表，多为子表。创建表时，先创建父表，再创建子表；插入数据时先插入父表中的数据，再插入子表中的数据�?<em>删除数据时，需先删除子表的数据，再删除父表的数�?</em></p>
</li>
<li>
<p>外键约束没有列级约束，只有标记约�?</p>
</li>
</ul>
<h2 id="【三】级联更新和级联删除">【三】级联更新和级联删除</h2>
<ul>
<li>什么是级联更新
<ul>
<li>当主表中的某条记录的值发生改变时，从表中的相应记录的值也会自动发生相应的变化，保持数据的一致性�?</li>
</ul>
</li>
<li>什么是级联删除
<ul>
<li>当主表中的某条记录被删除时，从表中的相应记录也会自动被删除，确保了当主关键字段中相应的记录被删除时，会自动删除相关表中对应的记录，从而保持数据的一致性和完整性�?</li>
</ul>
</li>
</ul>
<h3 id="�-】介�">�?】介�?</h3>
<ul>
<li>添加级联更新和级联删除时需要在外键约束后面添加</li>
<li>在删除父表中的数据时，级联删除子表中的数�?on delete cascade</li>
<li>在更新父表中的数据时，级联更新子表中的数�?on update cascade</li>
<li>以上的级联更新和级联删除谨慎使用，因为级联操作会将数据改变或删除【数据无价�?</li>
<li>在修改约束条件时，建议可以将原先的约束删除再重新添加约束条件</li>
</ul>
<h1>【作业�?</h1>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240529204705803.png" alt="image-20240529204705803"></p>
<ul>
<li>基于上面的信息做一个数据库下面的多张表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按照你理想中的方式进行分�?</span></span><br><span class="line"><span class="comment">-- 所有信息都放在一张表�?，合理但是有�?</span></span><br><span class="line"><span class="comment">-- 按照自己的想法和思路将上述所有信息进行分�? </span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在自己的表的基础上进行插入数�?</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 你的建表语句 ---&gt; 字段及字段类型的创建</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 你的数据插入语句</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">create table</span> class(id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,class_id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">not null</span>,class <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">not null</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">create table</span> student(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     name <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">not null</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     class_id <span class="type">int</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="keyword">foreign key</span> (class_id) <span class="keyword">references</span> class(id)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="keyword">on</span> <span class="keyword">delete</span> cascade</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="keyword">on</span> <span class="keyword">update</span> cascade</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> );</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">insert into</span> class(class_id,class) <span class="keyword">values</span>(<span class="number">100</span>,<span class="string">&#x27;北京�?01中学高三一�?);</span></span><br><span class="line"><span class="string">insert into class(class_id,class) values(101,&#x27;</span>北京�?<span class="number">01</span>中学高三二班<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">insert into class(class_id,class) values(102,&#x27;</span>北京�?<span class="number">01</span>中学高三三班<span class="string">&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">insert into student(name,class_id) values(&#x27;</span>tom<span class="string">&#x27;,1);</span></span><br><span class="line"><span class="string">insert into student(name,class_id) values(&#x27;</span>opp<span class="string">&#x27;,2);</span></span><br><span class="line"><span class="string">insert into student(name,class_id) values(&#x27;</span>dream<span class="string">&#x27;,2);</span></span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240531083035591.png" alt="image-20240531083035591"></p>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240531083106308.png" alt="image-20240531083106308"><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240531083135792.png" alt="image-20240531083135792"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/4.0Scrapy%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/4.0Scrapy%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E5%BC%8F/" class="post-title-link" itemprop="url">4.0Scrapy������Ŀ�ĳ־û��������ݵķ�ʽ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 17:47:38" itemprop="dateModified" datetime="2025-10-11T17:47:38+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>用Xpath解析器语法，并保存数�?</h1>
<h2 id="【一】案例：博客园的文章信息">【一】案例：博客园的文章信息</h2>
<ul>
<li>爬取数据，并的到</li>
</ul>
<p>spiders/bokeyuan.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BokeyuanSpider</span>(scrapy.Spider):</span><br><span class="line">    <span class="comment"># 爬虫文件的唯一标识</span></span><br><span class="line">    <span class="comment"># 里面写你的爬虫的文件名字</span></span><br><span class="line">    name = <span class="string">&quot;bokeyuan&quot;</span></span><br><span class="line">    <span class="comment"># 允许访问的域�?</span></span><br><span class="line">    <span class="comment"># https://www.cnblogs.com/</span></span><br><span class="line">    allowed_domains = [<span class="string">&quot;www.cnblogs.com&quot;</span>]</span><br><span class="line">    <span class="comment"># 起始的url列表（很重要�?</span></span><br><span class="line">    <span class="comment"># 列表内部的url都会被框架进行异步请求发�?</span></span><br><span class="line">    start_urls = [<span class="string">&quot;https://www.cnblogs.com/&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据解析主函数：自动调用</span></span><br><span class="line">    <span class="comment"># 调用的次数取决于start_urls列表内元素的个数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment"># 得到的是你爬取的博客园的页面</span></span><br><span class="line">         <span class="comment"># 用Xpath语法爬取数据</span></span><br><span class="line">        article_list = response.xpath(<span class="string">&#x27;//*[@id=&quot;post_list&quot;]/article&#x27;</span>)</span><br><span class="line">        <span class="comment"># 创建一个管道类对象</span></span><br><span class="line">        item = BoKeYuanItem()</span><br><span class="line">        <span class="comment"># 创建一个列�?</span></span><br><span class="line">        article_data = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> article <span class="keyword">in</span> article_list:</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 拿到头像</span></span><br><span class="line">            head_img_url = article.xpath(<span class="string">&#x27;./section/div/p/a[1]/img/@src&#x27;</span>).extract_first()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 文章的作�?</span></span><br><span class="line">            article_author = article.xpath(<span class="string">&#x27;./section/footer/a[1]/span/text()&#x27;</span>).extract_first()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 文章标题</span></span><br><span class="line">            article_title = article.xpath(<span class="string">&#x27;./section/div/a/text()&#x27;</span>).extract_first().strip()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 拿到文章内容</span></span><br><span class="line">            article_desc = article.xpath(<span class="string">&#x27;./section/div/p/text()&#x27;</span>).extract_first()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 文章更新时间</span></span><br><span class="line">            article_update_time = article.xpath(<span class="string">&#x27;./section/footer/span[1]/span/text()&#x27;</span>).extract_first().strip()</span><br><span class="line">            <span class="comment"># 拿到了所有的数据并保存到了字典中</span></span><br><span class="line">            article_data[article_author] = &#123;</span><br><span class="line">                <span class="string">&quot;head_img_url&quot;</span>: head_img_url,</span><br><span class="line">                <span class="string">&quot;article_author&quot;</span>: article_author,</span><br><span class="line">                <span class="string">&quot;article_title&quot;</span>: article_title,</span><br><span class="line">                <span class="string">&quot;article_desc&quot;</span>: article_desc,</span><br><span class="line">                <span class="string">&quot;article_update_time&quot;</span>: article_update_time</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment"># 记得返回出去</span></span><br><span class="line">        <span class="keyword">return</span> article_data</span><br></pre></td></tr></table></figure>
<h3 id="�-】将上面的数据持久化保存到本�">�?】将上面的数据持久化保存到本�?</h3>
<h4 id="�-）方式一：json格式">�?）方式一：json格式</h4>
<ul>
<li>终端执行下面语法</li>
<li>bokeyuan：改成自己的爬虫文件�?</li>
<li>bokeyuan.json：改成自己的爬虫文件�?json</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl bokeyuan -o bokeyuan.json</span><br></pre></td></tr></table></figure>
<ul>
<li>就会得到json格式的数�?</li>
</ul>
<h4 id="�-）方式二：csv格式—》得到的是wps表格">�?）方式二：csv格式—》得到的是wps表格</h4>
<ul>
<li>在终端输�?</li>
<li>bokeyuan：改成自己的爬虫文件�?</li>
<li>bokeyuan.json：改成自己的爬虫文件�?csv</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl bokeyuan -o bokeyuan.csv -t csv</span><br></pre></td></tr></table></figure>
<h3 id="�-】持久化保存到数据库">�?】持久化保存到数据库</h3>
<h4 id="�-）我们先了解一个概念：管道：pipelines-py">�?）我们先了解一个概念：管道：<a target="_blank" rel="noopener" href="http://pipelines.py">pipelines.py</a></h4>
<ul>
<li>process_item(self, item, spider):
<ul>
<li>管道类中必须有的函数</li>
<li>实现对item数据的处�?</li>
<li>但是最后一步必须：return item</li>
</ul>
</li>
<li>爬虫开始最先走�?
<ul>
<li>open_spider(self, spider): 在爬虫开启的时候仅执行一�?</li>
</ul>
</li>
<li>爬虫结束时最后走�?
<ul>
<li>close_spider(self, spider): 在爬虫关闭的时候仅执行一�?</li>
</ul>
</li>
</ul>
<h4 id="�-）保存数据到数据�">�?）保存数据到数据�?</h4>
<ul>
<li>我们要先创建管道类，再：items.py文件中创�?</li>
<li>这里创建的管道类里面的字段创建是根据你pipelines文件中需要的字段</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建管道�?</span></span><br><span class="line"><span class="comment"># 就像你再django中创建的模型�?</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoKeYuanItem</span>(scrapy.Item):</span><br><span class="line">    <span class="comment"># 就像你模型表的字�?</span></span><br><span class="line">    <span class="comment"># 写你，需要保存的字段</span></span><br><span class="line">    head_img_url = scrapy.Field()</span><br><span class="line">    article_author = scrapy.Field()</span><br><span class="line">    article_title = scrapy.Field()</span><br><span class="line">    article_desc = scrapy.Field()</span><br><span class="line">    article_update_time = scrapy.Field()</span><br></pre></td></tr></table></figure>
<ul>
<li>创建好管道类之后我们需要在settings.py文件中注册这个管道类</li>
<li>每个Item在被Spider抓取后，都会被发送到Item Pipeline进行处理。Item Pipeline的主要作用包括数据清洗、验证、去重和存储�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 管道�?</span></span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">    <span class="comment"># 项目默认的处理类，没有任何操�?</span></span><br><span class="line">   <span class="string">&quot;SpiderNews.pipelines.SpidernewsPipeline&quot;</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="comment"># 自己写的注册的处理类，后面你的数字越小优先级越高，根据优先级一次执行管道处理类</span></span><br><span class="line">   <span class="string">&quot;SpiderNews.pipelines.BoKeYuanPipeline&quot;</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>我们需要创建好数据库，还要需要创建好我们需要的字段</p>
<ul>
<li>字段要与你创建的管道类字段的名一�?</li>
</ul>
</li>
<li>
<p>我们再pipelines.py文件中，写保存数据的程序</p>
</li>
<li>
<p>第一步我们需要创建一个爬虫开始的函数和一个爬虫结束的函数</p>
<ul>
<li>开始：<code>def open_spider(self, spider):</code>
<ul>
<li>在这里面写你需要的初始化操作，比如连接数据库等</li>
</ul>
</li>
<li>结束：<code>def close_spider(self, spider):</code>
<ul>
<li>走到这里的时候，就代表程序已经执行完毕，需要做一些你在执行中的关闭操�?</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymysql.cursors <span class="keyword">import</span> DictCursor</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoKeYuanPipeline</span>:</span><br><span class="line">    <span class="comment"># 爬虫程序开始时走的</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_spider</span>(<span class="params">self, spider</span>):</span><br><span class="line">        <span class="comment"># 可以做数据库的初始操�?</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;爬虫开始撒！！初始化数据库连接&quot;</span>)</span><br><span class="line">        <span class="comment"># 连接数据�?</span></span><br><span class="line">        <span class="variable language_">self</span>.conn = pymysql.connect(</span><br><span class="line">            user=<span class="string">&quot;root&quot;</span>,</span><br><span class="line">            password=<span class="string">&quot;1234567&quot;</span>,</span><br><span class="line">            host=<span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">            port=<span class="number">3306</span>,</span><br><span class="line">            database=<span class="string">&quot;article_scrapy&quot;</span>,</span><br><span class="line">            charset=<span class="string">&quot;utf8mb4&quot;</span>,</span><br><span class="line">            cursorclass=DictCursor,</span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># 创建一个cursor对象</span></span><br><span class="line">        <span class="variable language_">self</span>.cursor = <span class="variable language_">self</span>.conn.cursor()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;爬虫开始撒！！初始化数据库连接成功&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param item: 就是你的创建的每个管道字�?</span></span><br><span class="line"><span class="string">        :param spider:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 获取数据</span></span><br><span class="line">        head_img_url = item.get(<span class="string">&quot;head_img_url&quot;</span>)</span><br><span class="line">        head_img_url = <span class="built_in">str</span>(head_img_url)</span><br><span class="line">        article_author = item.get(<span class="string">&quot;article_author&quot;</span>)</span><br><span class="line">        article_title = item.get(<span class="string">&quot;article_title&quot;</span>)</span><br><span class="line">        article_desc = item.get(<span class="string">&quot;article_content&quot;</span>)</span><br><span class="line">        article_update_time = item.get(<span class="string">&quot;article_update_time&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(head_img_url)</span><br><span class="line">        <span class="comment"># 向数据库插入数据</span></span><br><span class="line">        sql = <span class="string">&#x27;insert into article(head_img_url,article_author,article_title,article_desc,article_update_time) values(%s,%s,%s,%s,%s)&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 执行spl语句</span></span><br><span class="line">        <span class="variable language_">self</span>.cursor.execute(sql, [head_img_url, article_author, article_title, article_desc, article_update_time])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 提交事务</span></span><br><span class="line">        <span class="variable language_">self</span>.conn.commit()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;当前数据<span class="subst">&#123;article_author&#125;</span>插入成功&quot;</span>)</span><br><span class="line">        <span class="comment"># 注意每次用完item记得返回出去，不然会报错</span></span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 爬虫程序结束时走�?</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close_spider</span>(<span class="params">self, spider</span>):</span><br><span class="line">        <span class="comment"># 可以将数据库，连接关�?</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;爬虫结束！！！关闭数据库&quot;</span>)</span><br><span class="line">        <span class="comment"># 关闭连接的数据库</span></span><br><span class="line">        <span class="variable language_">self</span>.conn.close()</span><br><span class="line">        <span class="comment"># 关闭连接对象</span></span><br><span class="line">        <span class="variable language_">self</span>.cursor.close()</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>在你创建的爬虫文件中有所改变</p>
</li>
<li>
<p>需要将你创建的管道类导入进来，然后创建一个管道类对象</p>
</li>
<li>
<p>记住了，持久化保存到数据库的时候，不用return</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> SpiderNews.items <span class="keyword">import</span> BoKeYuanItem</span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BokeyuanSpider</span>(scrapy.Spider):</span><br><span class="line">    <span class="comment"># 爬虫文件的唯一标识</span></span><br><span class="line">    name = <span class="string">&quot;bokeyuan&quot;</span></span><br><span class="line">    <span class="comment"># 允许访问的域�?</span></span><br><span class="line">    <span class="comment"># https://www.cnblogs.com/</span></span><br><span class="line">    allowed_domains = [<span class="string">&quot;www.cnblogs.com&quot;</span>]</span><br><span class="line">    <span class="comment"># 起始的url列表（很重要�?</span></span><br><span class="line">    <span class="comment"># 列表内部的url都会被框架进行异步请求发�?</span></span><br><span class="line">    start_urls = [<span class="string">&quot;https://www.cnblogs.com/&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据解析主函数：自动调用</span></span><br><span class="line">    <span class="comment"># 调用的次数取决于start_urls列表内元素的个数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment"># 用Xpath语法爬取数据</span></span><br><span class="line">        article_list = response.xpath(<span class="string">&#x27;//*[@id=&quot;post_list&quot;]/article&#x27;</span>)</span><br><span class="line">        <span class="comment"># 创建一个管道类对象</span></span><br><span class="line">        item = BoKeYuanItem()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> article <span class="keyword">in</span> article_list:</span><br><span class="line">            <span class="comment"># 拿到头像</span></span><br><span class="line">            head_img_url = article.xpath(<span class="string">&#x27;./section/div/p/a[1]/img/@src&#x27;</span>).extract_first()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 文章的作�?</span></span><br><span class="line">            article_author = article.xpath(<span class="string">&#x27;./section/footer/a[1]/span/text()&#x27;</span>).extract_first()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 文章标题</span></span><br><span class="line">            article_title = article.xpath(<span class="string">&#x27;./section/div/a/text()&#x27;</span>).extract_first().strip()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 拿到文章内容</span></span><br><span class="line">            article_desc = article.xpath(<span class="string">&#x27;./section/div/p/text()&#x27;</span>).extract_first()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 文章更新时间</span></span><br><span class="line">            article_update_time = article.xpath(<span class="string">&#x27;./section/footer/span[1]/span/text()&#x27;</span>).extract_first().strip()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># itme是一个字�?-&gt;用字典方便，可以update()更新数据，更新的时候，更新字段要和管道类里面的字段一摸一�?</span></span><br><span class="line">            item.update(&#123;</span><br><span class="line">                <span class="string">&quot;head_img_url&quot;</span>: head_img_url,</span><br><span class="line">                <span class="string">&quot;article_author&quot;</span>: article_author,</span><br><span class="line">                <span class="string">&quot;article_title&quot;</span>: article_title,</span><br><span class="line">                <span class="string">&quot;article_desc&quot;</span>: article_desc,</span><br><span class="line">                <span class="string">&quot;article_update_time&quot;</span>: article_update_time</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment"># 将itme对象返回出去</span></span><br><span class="line">            <span class="comment"># return 会结束整个程序，不用�?</span></span><br><span class="line">            <span class="comment"># 我们用yield，yield可以保存item的状态，不会终止程序的执�?</span></span><br><span class="line">            <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/4.0%E4%BB%80%E4%B9%88%E6%98%AF%E8%A3%85%E9%A5%B0%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/4.0%E4%BB%80%E4%B9%88%E6%98%AF%E8%A3%85%E9%A5%B0%E5%99%A8/" class="post-title-link" itemprop="url">4.0ʲô��װ����</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 17:47:38" itemprop="dateModified" datetime="2025-10-11T17:47:38+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>【一】什么是装饰�?</h1>
<ul>
<li><code>装饰</code> <strong>代指为被装饰对象添加新的功能</strong>，<code>器</code> 代指器具/<strong>工具</strong>，装饰器与被装饰的对象均可以是任意可调用对象�?</li>
<li>概括地讲，装饰器的作用就�?<em>在不修改被装饰对象源代码和调用方式的前提下为被装饰对象添加额外的功能�?</em></li>
<li>装饰器经常用于有切面需求的场景
<ul>
<li>插入日志、性能测试、事务处理、缓存、权限校验等应用场景</li>
<li>装饰器是解决这类问题的绝佳设�?</li>
<li>有了装饰器，就可以抽离出大量与函数功能本身无关的雷同代码并继续重用�?</li>
</ul>
</li>
</ul>
<blockquote>
<p>提示：可调用对象有函数，方法或者类，此处我们单以本章主题函数为例，来介绍函数装饰器，并且被装饰的对象也是函数�?</p>
</blockquote>
<h2 id="�-】装饰器的用�">�?】装饰器的用�?</h2>
<ul>
<li>对上线后的程序进行新功能的添加和修改</li>
<li>给一个功能添加新的需求或者改变原来程序的运行逻辑</li>
</ul>
<h2 id="�-】装饰器的分�">�?】装饰器的分�?</h2>
<ul>
<li>被分�?
<ul>
<li>有参函数</li>
<li>无参函数</li>
</ul>
</li>
</ul>
<h2 id="�-】装饰器的原�">�?】装饰器的原�?</h2>
<ul>
<li>闭包函数+函数对象的组合使�?</li>
</ul>
<h1>【二】无参装饰器</h1>
<h2 id="�-】什么是无参装饰�">�?】什么是无参装饰�?</h2>
<ul>
<li>无参就是没有参数</li>
<li>就是没有参数的装饰器</li>
</ul>
<h2 id="�-】推到装饰器的语�">�?】推到装饰器的语�?</h2>
<ul>
<li>例子：要为一段代码增加计时功�?</li>
</ul>
<h3 id="�-）面条版">�?）面条版</h3>
<ul>
<li>import：进�?/ 输入</li>
<li>time:时间</li>
<li>.sleep（）:睡眠</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># 记录程序运行起始时间</span></span><br><span class="line">start_time = time.time()</span><br><span class="line"><span class="comment"># 程序运行主代码逻辑</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;我开始睡觉了 .... &quot;</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;我结束睡觉了 .... &quot;</span>)</span><br><span class="line"><span class="comment"># 记录程序运行结束时间</span></span><br><span class="line">end_time = time.time()</span><br><span class="line"><span class="comment"># 总结总耗时</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;当前程序总耗时 :&gt;&gt;&gt;&gt;  <span class="subst">&#123;end_time - start_time&#125;</span> s&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line"><span class="comment"># 我开始睡觉了 .... </span></span><br><span class="line"><span class="comment"># 我结束睡觉了 .... </span></span><br><span class="line"><span class="comment"># 当前程序总耗时 :&gt;&gt;&gt;&gt;  2.004431962966919 s</span></span><br></pre></td></tr></table></figure>
<h3 id="�-）函数版">�?）函数版</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment">#起始时间，变量名随便定start：开�?</span></span><br><span class="line">sleep_start = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;我开始睡觉了�?)</span></span><br><span class="line"><span class="string">#固定语法.sleep()睡觉</span></span><br><span class="line"><span class="string">time.sleep(2)</span></span><br><span class="line"><span class="string">print(&quot;</span>我结束睡觉了<span class="string">&quot;)</span></span><br><span class="line"><span class="string">#time.time固定语法时间</span></span><br><span class="line"><span class="string">sleep_edd = time.time()</span></span><br><span class="line"><span class="string">print(f&quot;</span>&#123;sleep_edd-sleep_start&#125;<span class="string">&quot;)#2.0138323307037354</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p><img src="C:%5CUsers%5C86177%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240416153527672.png" alt="image-20240416153527672"></p>
<h3 id="3-闭包函数">(3)闭包函数</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">    <span class="comment"># 程序运行主代码逻辑</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;我开始睡觉了 .... &quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;我结束睡觉了 .... &quot;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_show</span>():</span><br><span class="line">    <span class="comment"># 程序运行主代码逻辑</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;我开始睡觉了 .... &quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;我结束睡觉了 .... &quot;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="comment"># func = show_show</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        func()</span><br><span class="line">        <span class="built_in">print</span>(func)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本质</span></span><br><span class="line"><span class="comment">#运行第一�?</span></span><br><span class="line">inner = outer(show)</span><br><span class="line"><span class="comment"># 但是函数的返回值可以重新命�?</span></span><br><span class="line"><span class="comment">#运行第二�?</span></span><br><span class="line">show_show = outer(show_show)</span><br><span class="line"><span class="comment">#共同用这个执�?</span></span><br><span class="line">show_show()</span><br></pre></td></tr></table></figure>
<h2 id="�-】装饰器的推�">�?】装饰器的推�?</h2>
<h3 id="�-）需�">�?）需�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义一个用户数据字�?</span></span><br><span class="line"><span class="comment"># 校验当前用户名和密码是否正确，如果正确则打印登录成功并取�?</span></span><br><span class="line"><span class="comment"># 要求 调用还是 withdral() </span></span><br><span class="line"><span class="comment"># 但是会先验证用户名和密码</span></span><br></pre></td></tr></table></figure>
<ul>
<li>闭包函数-增加校验逻辑</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">user_psw_add</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">user_psw</span>():</span><br><span class="line">        username = <span class="built_in">input</span>(<span class="string">&quot;username:----&quot;</span>).strip()</span><br><span class="line">        password = <span class="built_in">input</span>(<span class="string">&quot;password:----&quot;</span>).strip()</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&quot;tom&quot;</span> <span class="keyword">and</span> password == <span class="string">&quot;710&quot;</span>:</span><br><span class="line">            func()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;cg&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;sb&quot;</span>)</span><br><span class="line">    <span class="comment">#一定要对着闭包函数</span></span><br><span class="line">    <span class="keyword">return</span> user_psw</span><br><span class="line"></span><br><span class="line"><span class="comment">#存款函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transfer</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Transfer&quot;</span>)</span><br><span class="line"><span class="comment">#这里的func等于transfer</span></span><br><span class="line">transfer = user_psw_add(transfer)</span><br><span class="line"><span class="comment">#传入实参</span></span><br><span class="line">transfer()</span><br></pre></td></tr></table></figure>
<ul>
<li>普通版�?修改源代�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dict_data = &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;tom&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;710&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_psw</span>():</span><br><span class="line">    username_input = <span class="built_in">input</span>(<span class="string">&quot;username:----&quot;</span>).strip()</span><br><span class="line">    password_input = <span class="built_in">input</span>(<span class="string">&quot;password:----&quot;</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> username_input == dict_data.get(<span class="string">&quot;username&quot;</span>) <span class="keyword">and</span> password_input == dict_data.get(<span class="string">&quot;password&quot;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;登入成功�?)</span></span><br><span class="line"><span class="string">        print(&quot;</span>转账成功�?)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;登入失败�?)</span></span><br><span class="line"><span class="string">user_psw()</span></span><br></pre></td></tr></table></figure>
<h2 id="�-】无参装饰器的模�">�?】无参装饰器的模�?</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 无参装饰器的模板</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; </span></span><br><span class="line"><span class="string">    :param func: 每一次需要调用传递的函数</span></span><br><span class="line"><span class="string">    :return:返回值是内嵌函数 inner 的函数内存地址 </span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        <span class="comment"># 可以加逻辑校验</span></span><br><span class="line">        <span class="comment"># 当符合指定条件后，可以允许执行传递进来的函数</span></span><br><span class="line">        <span class="comment"># 不符合条件的时候不执行函数</span></span><br><span class="line">        func()</span><br><span class="line">        <span class="comment"># 做逻辑校验，func 函数执行后的逻辑</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>
<h1>【三】有参装饰器</h1>
<h2 id="�-】无参装饰器">�?】无参装饰器</h2>
<ul>
<li>无参装饰器无法传递参�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 无参装饰器无法传递参�?</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        func()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="comment">#无法传递参数，报错</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">username, money</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;�?<span class="subst">&#123;username&#125;</span> 转账 <span class="subst">&#123;money&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment">#这里outer(transform)是outer(func)</span></span><br><span class="line">transform = outer(transform)</span><br><span class="line">transform() <span class="comment"># 报错</span></span><br></pre></td></tr></table></figure>
<h3 id="�-）有参装饰器">�?）有参装饰器</h3>
<ul>
<li>根据指定的位置参数传递参�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">username, money</span>):</span><br><span class="line">        func(username, money)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">username, money</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;�?<span class="subst">&#123;username&#125;</span> 转账 <span class="subst">&#123;money&#125;</span>&quot;</span>)</span><br><span class="line">username = <span class="string">&#x27;opp&#x27;</span></span><br><span class="line">money= <span class="number">10000</span></span><br><span class="line">transform = outer(transform)</span><br><span class="line">transform(username,money)</span><br></pre></td></tr></table></figure>
<h3 id="�-）有参装饰器的优�">�?）有参装饰器的优�?</h3>
<ul>
<li>用可变长位置参数和可变长关键字参数接收函数所需要的所有参�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">*ages, **kwargs</span>):</span><br><span class="line">        func(*ages, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">username, money</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;�?<span class="subst">&#123;username&#125;</span> 转账 <span class="subst">&#123;money&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#这里outer(transform)=outer(func)，inner接收</span></span><br><span class="line">transform = outer(transform)</span><br><span class="line">transform(<span class="string">&quot;tom&quot;</span>,<span class="number">10000</span>)</span><br></pre></td></tr></table></figure>
<h3 id="�-）有参数装饰器模�">�?）有参数装饰器模�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#无参模版</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        func()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="comment">#有参模版</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer_yes</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>
<h1>【四】装饰器语法�?</h1>
<ul>
<li><strong>装饰器谁在上面就先校验谁</strong></li>
</ul>
<h2 id="�-】无参装饰器语法�">�?】无参装饰器语法�?</h2>
<ul>
<li>@标志</li>
</ul>
<h3 id="�-）没有语法糖的时�">�?）没有语法糖的时�?</h3>
<ul>
<li>import意�?输入，引�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        start = time.time()</span><br><span class="line">        func()</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;总耗时 :&gt;&gt;&gt;&gt; <span class="subst">&#123;end - start&#125;</span> s&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="comment">#相当于把这个函数调到上面函数里面去了</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>():</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#这里 timer(transform)=timer(func)</span></span><br><span class="line">transform = timer(transform)</span><br><span class="line">transform()</span><br></pre></td></tr></table></figure>
<h3 id="�-）有糖语法的时�">�?）有糖语法的时�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">timer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        start = time.time()</span><br><span class="line">        func()</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;总耗时 :&gt;&gt;&gt;&gt; <span class="subst">&#123;end - start&#125;</span> s&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="comment">#@函数�?</span></span><br><span class="line"><span class="meta">@timer </span><span class="comment"># 等同于transform=timer(transform)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>():</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">transform()</span><br></pre></td></tr></table></figure>
<h2 id="�-】有参装饰器语法�">�?】有参装饰器语法�?</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">timer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">*args,**kwargs</span>):</span><br><span class="line">        start = time.time()</span><br><span class="line">        func(*args,**kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;总耗时 :&gt;&gt;&gt;&gt; <span class="subst">&#123;end - start&#125;</span> s&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"><span class="meta">@timer</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">username,money</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;username&#125;</span> | <span class="subst">&#123;money&#125;</span>&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">transform(<span class="string">&quot;dream&quot;</span>,<span class="number">188</span>)</span><br></pre></td></tr></table></figure>
<h2 id="�-】有参语法糖">�?】有参语法糖</h2>
<h3 id="�-）单语法�">�?）单语法�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">login_dict = &#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;dream&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_auth</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> login_dict.get(<span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">            func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;请先登录!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        start = time.time()</span><br><span class="line">        func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;总耗时 :&gt;&gt;&gt;&gt; <span class="subst">&#123;end - start&#125;</span> s&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="comment">#只能使用一种装饰器</span></span><br><span class="line"><span class="meta">@login_auth</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">username, money</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;username&#125;</span> | <span class="subst">&#123;money&#125;</span>&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># transform = timer(transform)</span></span><br><span class="line"><span class="comment"># transform()</span></span><br><span class="line"><span class="comment"># 现在只能使用一种装饰器并且在装饰器中不能切�?</span></span><br><span class="line">transform(<span class="string">&quot;dream&quot;</span>, <span class="number">188</span>)</span><br></pre></td></tr></table></figure>
<h3 id="�-）多语法�">�?）多语法�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">login_dict = &#123;<span class="string">&#x27;username&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrator</span>(<span class="params">tag</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param tag: &#x27;login_auth&#x27; ---&gt; 登录认证装饰�?</span></span><br><span class="line"><span class="string">    &#x27;timer&#x27; ---&gt; 返回 计时装饰�?</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> tag == <span class="string">&quot;login_auth&quot;</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">login_auth</span>(<span class="params">func</span>):</span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">                <span class="keyword">if</span> login_dict.get(<span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">                    func(*args, **kwargs)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;请先登录!&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> inner</span><br><span class="line">        <span class="keyword">return</span> login_auth</span><br><span class="line">    <span class="keyword">elif</span> tag == <span class="string">&quot;timer&quot;</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">timer</span>(<span class="params">func</span>):</span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">                start = time.time()</span><br><span class="line">                func(*args, **kwargs)</span><br><span class="line">                end = time.time()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;总耗时 :&gt;&gt;&gt;&gt; <span class="subst">&#123;end - start&#125;</span> s&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> timer</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;无参数的&quot;</span>,tag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># @decrator(tag=&#x27;login_auth&#x27;)</span></span><br><span class="line"><span class="meta">@decrator(<span class="params">tag=<span class="string">&#x27;timer&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">username, money</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;username&#125;</span> | <span class="subst">&#123;money&#125;</span>&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">transform(<span class="string">&quot;dream&quot;</span>,<span class="number">999</span>)</span><br></pre></td></tr></table></figure>
<h2 id="�-】多层语法糖案例">�?】多层语法糖案例</h2>
<h3 id="�-）不使用语法�">�?）不使用语法�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dec_a</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="comment"># 【二】调�?dec_a 函数触发</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;111&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kw</span>):</span><br><span class="line">        <span class="comment"># 【三】执�?main_func()</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;222&#x27;</span>)</span><br><span class="line">        func(*args, **kw)  <span class="comment"># b_wrapper(main_func)</span></span><br><span class="line">        <span class="comment"># 【七】结束上面的 b_wrapper 回来</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;333&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec_b</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="comment"># 【一】进�?dec_b 函数</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kw</span>):</span><br><span class="line">        <span class="comment"># 【四】因为在 dec_a �?wrapper 里面调用�?func --&gt; 就是我自�?</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;bbb&#x27;</span>)</span><br><span class="line">        func(*args, **kw)  <span class="comment"># main_func</span></span><br><span class="line">        <span class="comment"># 【六】执行完 main_func 又回来继续走</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ccc&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@dec_a</span></span><br><span class="line"><span class="meta">@dec_b </span><span class="comment"># 多层语法糖的时候谁在下先调用谁，但是执行校验的时候是谁在上先校验�?</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main_func</span>():</span><br><span class="line">    <span class="comment"># 【五】回到真正的 main_func</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;main_func&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># 定义顺序是一个个挨着定义</span></span><br><span class="line"><span class="string"># 调用顺序是倒着谁在下先调用�?</span></span><br><span class="line"><span class="string">main_func = dec_b(main_func)</span></span><br><span class="line"><span class="string"># main_func = b_wrapper (main_func)</span></span><br><span class="line"><span class="string">main_func = dec_a(main_func)</span></span><br><span class="line"><span class="string"># main_func = a_wrapper (b_wrapper(main_func))</span></span><br><span class="line"><span class="string">main_func()</span></span><br><span class="line"><span class="string"># a_wrapper</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># aaa</span></span><br><span class="line"><span class="string"># 111</span></span><br><span class="line"><span class="string"># 222</span></span><br><span class="line"><span class="string"># bbb</span></span><br><span class="line"><span class="string"># main_func</span></span><br><span class="line"><span class="string"># ccc</span></span><br><span class="line"><span class="string"># 333</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">main_func()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定结果打印顺序</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/4.0requests%E6%A8%A1%E5%9D%97%E4%B9%8B%E5%93%8D%E5%BA%94%E4%BD%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/4.0requests%E6%A8%A1%E5%9D%97%E4%B9%8B%E5%93%8D%E5%BA%94%E4%BD%93/" class="post-title-link" itemprop="url">4.0requestsģ��֮��Ӧ��</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 17:47:38" itemprop="dateModified" datetime="2025-10-11T17:47:38+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>requests模块之响应体</h1>
<h2 id="【一】响应体数据格式转换">【一】响应体数据格式转换</h2>
<ul>
<li>
<p><code>requests.text</code>–&gt;会将响应源代码转化为 文本类型的数据格�?</p>
</li>
<li>
<p><code>requests.content</code>–&gt;会将响应源代码转换为字节类型的数据格�?（图片、视频、压缩包等）</p>
</li>
<li>
<p><code>requests.json()</code>–&gt;会将响应源代码转换为json类型的数据格�?</p>
</li>
</ul>
<h3 id="�-】requests-text">�?】<code>requests.text</code></h3>
<ul>
<li>将响应体转换为字符串形式�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://pic.netbian.com/uploads/allimg/240322/232300-171112098057a5.jpg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取到文本数�?</span></span><br><span class="line">data = response.text</span><br><span class="line"><span class="built_in">print</span>(data, <span class="built_in">type</span>(data)) <span class="comment"># &lt;class &#x27;str&#x27;&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】requests-content">�?】<code>requests.content</code></h3>
<ul>
<li>获取响应体的二进制内容，适用于处理图像、视频等非文本类型的响应。（默认�?6进制�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://pic.netbian.com/uploads/allimg/240322/232300-171112098057a5.jpg&#x27;</span>)</span><br><span class="line"><span class="comment"># 获取到图片的二进制数�?</span></span><br><span class="line">data = response.content</span><br><span class="line"><span class="built_in">print</span>(data, <span class="built_in">type</span>(data)) <span class="comment"># &lt;class &#x27;bytes&#x27;&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】requests-encoding">�?】<code>requests.encoding</code></h3>
<ul>
<li>获取响应的编码方�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://www.baidu.com/&#x27;</span>)</span><br><span class="line"><span class="comment"># 获取到图片的二进制数�?</span></span><br><span class="line">data = response.encoding</span><br><span class="line"><span class="built_in">print</span>(data, <span class="built_in">type</span>(data)) <span class="comment"># ISO-8859-1 &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line"><span class="comment"># 查看到当前页面的默认编码格式�?ISO-8859-1</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】response-status-code">�?】<code>response.status_code</code></h3>
<ul>
<li>获取响应状态码</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://www.baidu.com/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># `response.status_code`: 获取响应的状态码�?</span></span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line"><span class="comment"># 200</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】requests-headers">�?】<code>requests.headers</code></h3>
<ul>
<li>获取响应头信息，返回一个字典对�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">&quot;https://www.baidu.com/&quot;</span>)</span><br><span class="line">headers = response.headers</span><br><span class="line"><span class="built_in">print</span>(headers)</span><br><span class="line"><span class="comment"># &#123;&#x27;Cache-Control&#x27;: &#x27;private, no-cache, no-store, proxy-revalidate, no-transform&#x27;, &#x27;Connection&#x27;: &#x27;keep-alive&#x27;, &#x27;Content-Encoding&#x27;: &#x27;gzip&#x27;, &#x27;Content-Type&#x27;: &#x27;text/html&#x27;, &#x27;Date&#x27;: &#x27;Tue, 16 Jul 2024 11:59:18 GMT&#x27;, &#x27;Last-Modified&#x27;: &#x27;Mon, 23 Jan 2017 13:23:55 GMT&#x27;, &#x27;Pragma&#x27;: &#x27;no-cache&#x27;, &#x27;Server&#x27;: &#x27;bfe/1.0.8.18&#x27;, &#x27;Set-Cookie&#x27;: &#x27;BDORZ=27315; max-age=86400; domain=.baidu.com; path=/&#x27;, &#x27;Transfer-Encoding&#x27;: &#x27;chunked&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】响应Cookie">�?】响应Cookie</h3>
<ul>
<li>response.cookies: 获取服务器返回的cookie信息�?</li>
<li>response.cookies.get_dict(): 将cookie信息转换为字典形式�?</li>
<li>response.cookies.items(): 获取cookie信息并以列表形式返回</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">&quot;https://www.baidu.com/&quot;</span>)</span><br><span class="line"><span class="comment"># 获取服务器返回的cookie信息</span></span><br><span class="line">cookie = response.cookies</span><br><span class="line"><span class="built_in">print</span>(cookie)</span><br><span class="line"><span class="comment"># &lt;RequestsCookieJar[&lt;Cookie BDORZ=27315 for .baidu.com/&gt;]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将cookie信息转换为字典形�?</span></span><br><span class="line">cookie_dict = response.cookies.get_dict()</span><br><span class="line"><span class="built_in">print</span>(cookie_dict)</span><br><span class="line"><span class="comment"># &#123;&#x27;BDORZ&#x27;: &#x27;27315&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取cookie信息并以列表形式返回</span></span><br><span class="line">cookie_items = response.cookies.items()</span><br><span class="line"><span class="built_in">print</span>(cookie_items)</span><br><span class="line"><span class="comment"># [(&#x27;BDORZ&#x27;, &#x27;27315&#x27;)]</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】当前请�-响应对象的URL">�?】当前请�?响应对象的URL</h3>
<ul>
<li>
<p>response.url: 获取当前响应的URL�?</p>
</li>
<li>
<ul>
<li>这是在完成HTTP请求并接收到服务器响应后，实际返回的资源URL�?</li>
<li>在重定向发生时，这个属性会反映最终页面的实际URL�?</li>
<li>例如，如果你发起一个请求到某个网站A，但该网站随后重定向到了网站B，那么response.url将显示网站B的URL�?</li>
</ul>
</li>
<li>
<p>response.request.url: 获取当前请求的URL�?</p>
</li>
<li>
<ul>
<li>这是发送HTTP请求时使用的原始URL，即你在发出请求时指定的URL�?</li>
<li>无论是否发生重定向，这个属性始终保持不变�?</li>
<li>也就是说，它反映了你最初尝试访问的地址�?</li>
</ul>
</li>
<li>
<p>总结来说</p>
</li>
<li>
<ul>
<li>没有重定�?</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>两者通常是一致的�?</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>有重定向</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>response.url 是重定向后的最终URL</li>
<li>response.request.url 则是最初的请求UR</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&quot;https://www.baidu.com/&quot;</span>)</span><br><span class="line"><span class="comment"># `response.url`: 获取当前请求的URL�?</span></span><br><span class="line">url = response.url</span><br><span class="line"><span class="built_in">print</span>(url)</span><br><span class="line"><span class="comment"># https://www.baidu.com/</span></span><br><span class="line">requests_url = response.request.url</span><br><span class="line"><span class="built_in">print</span>(requests_url)</span><br><span class="line"><span class="comment"># https://www.baidu.com/</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】当前请求的重定向URL">�?】当前请求的重定向URL</h3>
<ul>
<li><code>response.history</code>：如果有重定向，返回一个列表，包含所有经过的重定向URL</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&quot;https://www.baidu.com/&quot;</span>)</span><br><span class="line"><span class="comment"># `response.history`: 如果有重定向，返回一个列表，包含所有经过的重定向URL�?</span></span><br><span class="line">history = response.history</span><br><span class="line"><span class="built_in">print</span>(history)</span><br><span class="line"><span class="comment"># []</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】迭代获取二进制数据">�?】迭代获取二进制数据</h3>
<ul>
<li><code>response.iter_content()</code>：迭代获取响应内容（适用于处理视频、图片等二进制数据）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">tag_url = <span class="string">&quot;https://pic.netbian.com/uploads/allimg/240322/232300-171112098057a5.jpg&quot;</span></span><br><span class="line"></span><br><span class="line">response = requests.get(tag_url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开本地的文件路径，二进制必须要用wb�?</span></span><br><span class="line">file_path = <span class="string">&quot;01.jpg&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="comment"># 循环获取响应数据中的二进制数据，每次只获�?1024 个字�?</span></span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> response.iter_content(chunk_size=<span class="number">1024</span>):</span><br><span class="line">        <span class="comment"># 如果存在数据，则进行文件数据的写�?</span></span><br><span class="line">        <span class="keyword">if</span> chunk:</span><br><span class="line">            fp.write(chunk)</span><br></pre></td></tr></table></figure>
<h2 id="【二】解析json数据">【二】解析json数据</h2>
<ul>
<li>要解�?JSON 数据，可以使�?requests 模块�?json() 方法�?</li>
<li>该方法将响应内容解析�?JSON 格式，并返回一�?Python 字典对象�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义目标地址</span></span><br><span class="line">tag_url = <span class="string">&quot;https://jsonplaceholder.typicode.com/users&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送请求，获取响应数据</span></span><br><span class="line">response = requests.get(tag_url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取文本类型的响应数�?</span></span><br><span class="line">page_text = response.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印响应内容的数据类�?</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(page_text))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印原始响应内容</span></span><br><span class="line"><span class="built_in">print</span>(page_text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将响应内容解析为 JSON 格式</span></span><br><span class="line">data = response.json()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印响应内容的数据类�?</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(data))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印解析后的 JSON 数据</span></span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>
<h2 id="【三】SSL认证">【三】SSL认证</h2>
<h3 id="�-】什么是SSL认证">�?】什么是SSL认证</h3>
<ul>
<li>有些网站没有设置�?HTTPS <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%AF%81%E4%B9%A6&amp;spm=1001.2101.3001.7020">证书</a>，或�?HTTPS 证书不被 CA 机构认可，这些网站就会出�?SSL 证书错误提示�?</li>
<li>�?requests 模块中进�?SSL 认证时，可以通过 verify 参数来控制是否验证服务器�?SSL 证书�?</li>
<li>默认情况下，verify 参数被设置为 True，表示会验证 SSL 证书�?</li>
<li>�?verify 设置为布尔�?False 时，会忽略证书验证，但会引发警告�?</li>
</ul>
<p>HTTPS请求�?HTTP + SSL 证书</p>
<p>HTTP请求是不需要认真的直接就能访问 都会提示 此网站不安全</p>
<h3 id="�-】认证证�">�?】认证证�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;https://ssr2.scrape.center/&quot;</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line">status_code = response.status_code</span><br><span class="line"><span class="built_in">print</span>(status_code)</span><br><span class="line"><span class="comment"># 报错：certificate verify failed</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】不认证证书">�?】不认证证书</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://ssr2.scrape.center/&#x27;</span></span><br><span class="line">response = requests.get(url, verify=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line"><span class="comment"># 200</span></span><br></pre></td></tr></table></figure>
<ul>
<li>报出 InsecureRequestWarning 警告，但得到了请求成功的状态码</li>
</ul>
<h3 id="�-】自定义证书路径">�?】自定义证书路径</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;https://ssr2.scrape.center/&#x27;</span></span><br><span class="line"><span class="comment"># 自定义认证路�?</span></span><br><span class="line">cert_file = <span class="string">&quot;/path/to/my_certificate.pem&quot;</span></span><br><span class="line">response = requests.get(url,verify=cert_file)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br></pre></td></tr></table></figure>
<ul>
<li>在上述代码中，将 verify 参数设置为自定义证书文件的路径。requests 将使用指定的证书进行验证�?</li>
<li>请注意，在实际使用中，如果从未提供过自定义证书，并且要禁用验证，则最好提供证书路径。这样可以避免不必要的错误和警告</li>
</ul>
<h2 id="【四】使用代�">【四】使用代�?</h2>
<h3 id="�-】为什么要使用代理">�?】为什么要使用代理</h3>
<ul>
<li>在网络爬虫和数据抓取的过程中，我们经常需要发送HTTP请求来获取网页内容或与远程服务器进行通信�?</li>
<li>然而，在某些情况下，直接发送请求可能会受到限制或被阻止，这时就需要借助代理来完成任务�?</li>
<li>代理在网络通信中起到中间人的作用，它代表我们与目标服务器建立连接并传递请求和响应�?</li>
<li>通过使用代理，我们可以隐藏真实的IP地址、绕过访问限制，并增加请求的匿名性�?</li>
<li>Python中的requests库提供了便捷且强大的功能来处理HTTP请求，并且支持代理的配置�?</li>
</ul>
<p>说人话：</p>
<ul>
<li>一般网站都有屏蔽的限制策略，用自己的IP去爬，被封了那该网站就访问不了，这时候就得用代理IP来解决问题了�?</li>
<li>封吧，反正封的不是本机IP，封的代理IP</li>
</ul>
<h3 id="�-】代理配置方�">�?】代理配置方�?</h3>
<ul>
<li>在使用Python中的requests库发送HTTP请求时，我们可以通过以下几种方法来配置代理�?</li>
<li>这些方法允许我们灵活地选择适合你需求的代理设置</li>
</ul>
<h4 id="�-）使用proxies参数设置全局代理">�?）使用proxies参数设置全局代理</h4>
<ul>
<li>requests库提供了一个名为proxies的参数，通过它可以设置全局代理�?</li>
<li>我们可以将代理配置作为一个字典传递给该参数，字典的键是代理类型（�?http’�?https’等），值是代理的地址和端口号�?</li>
<li>proxies参数语法格式�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxies=&#123;<span class="string">&quot;协议&quot;</span>:<span class="string">&quot;协议://IP:端口�?&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>示例</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&quot;http&quot;</span>: <span class="string">&quot;http://127.0.0.1:1080&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">target_url = <span class="string">&quot;https://www.baidu.com&quot;</span></span><br><span class="line">response = requests.get(</span><br><span class="line">    url=target_url,</span><br><span class="line">    <span class="comment"># 携带代理ip，如果代理IP 不生效那就会默认使用本机的IP</span></span><br><span class="line">    proxies=proxies)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line"><span class="comment"># 200</span></span><br><span class="line">response.encoding = <span class="string">&quot;utf8&quot;</span></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="comment"># 得到百度首页的文�?</span></span><br></pre></td></tr></table></figure>
<h4 id="�-）给session对象添加代理">�?）给session对象添加代理</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">session = requests.Session()</span><br><span class="line">session.proxies = proxies</span><br></pre></td></tr></table></figure>
<h4 id="�-）案�">�?）案�?</h4>
<ul>
<li>首先认识一个网址</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://httpbin.org/get</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240716212801068.png" alt="image-20240716212801068"></p>
<ul>
<li>
<p>介绍里面的信�?</p>
<ul>
<li><code>&quot;origin&quot;: &quot;222.65.246.145&quot;</code>这是你的本机IP，也叫你的网�?</li>
</ul>
</li>
<li>
<p>自己的ip</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> fake_useragent <span class="keyword">import</span> UserAgent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义地址</span></span><br><span class="line">url = <span class="string">&#x27;http://httpbin.org/get&#x27;</span></span><br><span class="line"><span class="comment"># 定义请求头参�?</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: UserAgent().random&#125;</span><br><span class="line"><span class="comment"># 获取响应对象</span></span><br><span class="line">response = requests.get(url, headers=headers)</span><br><span class="line"><span class="comment"># 检测请求是否成�?</span></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="comment"># 处理相应内容</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置响应内容的编码格式为utf8</span></span><br><span class="line">    response.encoding = <span class="string">&quot;utf8&quot;</span></span><br><span class="line">    <span class="comment"># 解析json结果</span></span><br><span class="line">    <span class="comment"># 获取响应信息</span></span><br><span class="line">    data = response.text</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求失败�?, response.status_code)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;args&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;headers&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;httpbin.org&quot;</span>, </span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 Edg/121.0.0.0&quot;</span>, </span><br><span class="line">    <span class="string">&quot;X-Amzn-Trace-Id&quot;</span>: <span class="string">&quot;Root=1-669678f7-6f2312dd6ad33674284c6042&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;origin&quot;</span>: <span class="string">&quot;222.70.77.67&quot;</span>, </span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://httpbin.org/get&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>代理ip
<ul>
<li>去哪找代理ip
<ul>
<li>89免费代理 / 快代�?..�?</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> fake_useragent <span class="keyword">import</span> UserAgent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义地址</span></span><br><span class="line">url = <span class="string">&#x27;http://httpbin.org/get&#x27;</span></span><br><span class="line"><span class="comment"># 定义请求头参�?</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: UserAgent().random&#125;</span><br><span class="line"><span class="comment"># 代理IP</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&quot;http&quot;</span>: <span class="string">&quot;http://182.155.106.150:8123&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 获取响应对象</span></span><br><span class="line">response = requests.get(url, headers=headers, proxies=proxies)</span><br><span class="line"><span class="comment"># 检测请求是否成�?</span></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="comment"># 处理相应内容</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置响应内容的编码格式为utf8</span></span><br><span class="line">    response.encoding = <span class="string">&quot;utf8&quot;</span></span><br><span class="line">    <span class="comment"># 解析json结果</span></span><br><span class="line">    <span class="comment"># 获取响应信息</span></span><br><span class="line">    data = response.text</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求失败�?, response.status_code)</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】批量抓取代理脚�">�?】批量抓取代理脚�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> fake_useragent <span class="keyword">import</span> UserAgent</span><br><span class="line"><span class="comment"># UserAgent（用户代理）是一个在HTTP请求中发送给服务器的字符串，用于标识发出请求的客户端的详细信息，包括浏览器类型、版本、操作系统、以及安装的设备�?</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用xpath解析页面数据</span></span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="comment"># UA伪装为headers</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: UserAgent().random</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_proxy</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    url : &#123;89免费代理的url：https://www.89ip.cn/index_2.html&#125;</span></span><br><span class="line"><span class="string">    :return:返回所有爬取到的ip列表</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 存放所有代理存在的页码</span></span><br><span class="line">    page_url_lists = []</span><br><span class="line">    <span class="comment"># 存放爬取到的所有代码的列表</span></span><br><span class="line">    ip_lists = []</span><br><span class="line">    <span class="comment"># 循环获取每一页的代理页面的url</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># 首页的url</span></span><br><span class="line">            page_url = <span class="string">&quot;https://www.89ip.cn&quot;</span></span><br><span class="line">            <span class="comment"># 将代理页url存储到类可用列表�?</span></span><br><span class="line">            page_url_lists.append(page_url)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 处理第二页及以后所有页码的规则</span></span><br><span class="line">            <span class="comment"># 模仿：https://www.89ip.cn/index_2.html</span></span><br><span class="line">            page_url = <span class="string">f&quot;https://www.89ip.cn/index_<span class="subst">&#123;i&#125;</span>.html&quot;</span></span><br><span class="line">            <span class="comment"># 将代理页url存储到类可用列表�?</span></span><br><span class="line">            page_url_lists.append(page_url)</span><br><span class="line">    <span class="comment"># 从存储所有代理存在的页面的列表，循环发起请求获得代理IP和端�?</span></span><br><span class="line">    <span class="keyword">for</span> page_url <span class="keyword">in</span> page_url_lists:</span><br><span class="line">        response = requests.get(page_url, headers=headers)</span><br><span class="line">        <span class="comment"># 编码</span></span><br><span class="line">        response.encoding=<span class="string">&quot;utf8&quot;</span></span><br><span class="line">        <span class="comment"># 的得html文本</span></span><br><span class="line">        page_text = response.text</span><br><span class="line">        tree = etree.HTML(page_text)</span><br><span class="line">        <span class="comment"># xpath提取到所有的代理ip列表</span></span><br><span class="line">        tr_lists = tree.xpath(<span class="string">&quot;//div[3]/div[1]/div/div[1]/table/tbody/tr&quot;</span>)</span><br><span class="line">        <span class="comment"># 循环获取每一个代理ip和端�?</span></span><br><span class="line">        <span class="keyword">for</span> tr <span class="keyword">in</span> tr_lists:</span><br><span class="line">            <span class="comment"># 获取ip并做数据清洗</span></span><br><span class="line">            ip = tr.xpath(<span class="string">&#x27;./td[1]/text()&#x27;</span>)[<span class="number">0</span>].strip()</span><br><span class="line">            <span class="comment"># 获取端口并做数据清洗</span></span><br><span class="line">            port = tr.xpath(<span class="string">&#x27;./td[2]/text()&#x27;</span>)[<span class="number">0</span>].strip()</span><br><span class="line">            <span class="comment"># 将获取到的代理ip和端口拼�?</span></span><br><span class="line">            ip_port = <span class="string">&#x27;http://&#x27;</span> + ip + <span class="string">&#x27;:&#x27;</span> + <span class="built_in">str</span>(port)</span><br><span class="line">            <span class="comment"># 将获取到的代理ip和端口存储到类可用列表里</span></span><br><span class="line">            ip_lists.append(&#123;<span class="string">&#x27;http&#x27;</span>: ip_port&#125;)</span><br><span class="line">            <span class="comment"># 返回所有代理ip列表</span></span><br><span class="line">        <span class="keyword">return</span> ip_lists</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text_ip</span>():</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    url：&#123;百度首页，&#125;</span></span><br><span class="line"><span class="string">    :return: 做测试返回状态码�?00正常可用保留，否则再次执行验�?</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    url = <span class="string">&quot;https://www.baidu.com/&quot;</span></span><br><span class="line">    <span class="comment"># 获取到所有ip列表</span></span><br><span class="line">    ip_lists = get_proxy()</span><br><span class="line">    <span class="comment"># 循环测试每一个ip和端口是否可�?</span></span><br><span class="line">    <span class="keyword">for</span> ip_item <span class="keyword">in</span> ip_lists:</span><br><span class="line">        response = requests.get(url, proxies=ip_item, headers=headers, timeout=<span class="number">10</span>)</span><br><span class="line">        ret = response.status_code</span><br><span class="line">        <span class="comment"># 做判断是否返回值为200可用</span></span><br><span class="line">        <span class="keyword">if</span> ret == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;当前状态码�?::<span class="subst">&#123;ret&#125;</span>,ip可用,返回ip:::<span class="subst">&#123;ip_item&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> ip_item</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;当前状态码�?::<span class="subst">&#123;ret&#125;</span>,当前ip不可�?重新测试ip�?)</span></span><br><span class="line"><span class="string">            text_ip()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__ == &#x27;</span>__main__<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">    ip_lists = get_proxy()</span></span><br><span class="line"><span class="string">    ip_item = text_ip()</span></span><br><span class="line"><span class="string">    url = &#x27;</span>https://www.baidu.com/<span class="string">&#x27;</span></span><br><span class="line"><span class="string">    response = requests.get(url=url, headers=headers, proxies=ip_item)</span></span><br><span class="line"><span class="string">    print(response.text)</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/4.0vue%E9%AB%98%E7%BA%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/4.0vue%E9%AB%98%E7%BA%A7/" class="post-title-link" itemprop="url">4.0vue�߼�</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 17:47:38" itemprop="dateModified" datetime="2025-10-11T17:47:38+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>【一】ref属�?</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ref也可以做组件间的通信</span></span><br><span class="line"><span class="comment"># ref是vue提供的属性，可以放在任意标签或组件上</span></span><br><span class="line">	- 如果放在标签�?</span><br><span class="line">    	-通过  this.$refs.标签上的名字   拿到的值是 标签 对象</span><br><span class="line">        -我们可以通过标签对象，修�?标签的属性。。。src属性，value属�?</span><br><span class="line">        </span><br><span class="line">     - 如果放在组件�?</span><br><span class="line">    	-通过  this.$refs.标签上的名字   拿到的值是 组件 对象</span><br><span class="line">        -我们可以通过 组件对象，直接修改对象中得数据，直接调用对象中得方法</span><br></pre></td></tr></table></figure>
<h2 id="�-】使�">�?】使�?</h2>
<h3 id="�-）放在普通标签上">�?）放在普通标签上</h3>
<ul>
<li>使用<code>this.$refs.ref对应的值</code>，就可以得到这个标签对象</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;h1&gt;ref的使�?/h1&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;img :src=&quot;img&quot; ref=&quot;my_img&quot; style=&quot;height: 200px;width: 200px&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; ref=&quot;my_input&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;button @click=&quot;handleSon&quot;&gt;点击看控制台&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name:&#x27;one&#x27;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      // 这里他会检测不到这是个路径，需要一个方法require</span><br><span class="line">      img:require(&#x27;../assets/img/1.png&#x27;),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    handleSon()&#123;</span><br><span class="line">      // 获得img标签</span><br><span class="line">      console.log(this.$refs.my_img);</span><br><span class="line">      // 可以获得img的属性�?</span><br><span class="line">      console.log(this.$refs.my_img.src);</span><br><span class="line">      // 还可以属性�?</span><br><span class="line">      this.$refs.my_img.src=require(&#x27;../assets/logo.png&#x27;)</span><br><span class="line">      // 赋�?</span><br><span class="line">      this.$refs.my_input.value=&#x27;xxxx&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h2 id="�-】ref属性之父传�">�?】ref属性之父传�?</h2>
<ul>
<li>
<p>父传子是自定义属�?</p>
</li>
<li>
<p>父组件：<code>HOMEView.vue</code></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">&lt;h1&gt;首页&lt;/h1&gt;</span><br><span class="line">    &lt;one :msg=&quot;my_data&quot;&gt;&lt;/one&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import one from &#x27;@/components/one&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HomeView&#x27;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      my_data:&#x27;father&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components:&#123;</span><br><span class="line">    one</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>子组件：<code>one.vue</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;h1&gt;ref的使�?/h1&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;img :src=&quot;img&quot; ref=&quot;my_img&quot; style=&quot;height: 200px;width: 200px&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;!--  使用父亲传过来的�? --&gt;</span><br><span class="line">  &lt;h2&gt;`&#123;&#123;msg&#125;&#125;`&lt;/h2&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name:&#x27;one&#x27;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      // 这里他会检测不到这是个路径，需要一个方法require</span><br><span class="line">      img:require(&#x27;../assets/img/1.png&#x27;),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  props:[&quot;msg&quot;]</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>�?】ref属性之子传�?</p>
<ul>
<li>
<p>子传父是自定义事件：子的东西传给父亲，子里面肯定要有东西触发，在可以传给�?</p>
</li>
<li>
<p>子传父：子组件中用到了，事件：<code>this.$emit(&quot;自定义事件名&quot;,传给父组件的�?</code>，父组件要接受这个�?</p>
</li>
<li>
<p>父组件：<code>HOMEView.vue</code></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">&lt;h1&gt;首页&lt;/h1&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;one  :msg=&quot;my_data&quot; @son=&quot;my_father&quot;&gt;&lt;/one&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;h1&gt;`&#123;&#123;res&#125;&#125;`&lt;/h1&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import one from &#x27;@/components/one&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HomeView&#x27;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      my_data:&#x27;father&#x27;,</span><br><span class="line">      res:&#x27;&#x27;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    // 这里接受到子传过来的username</span><br><span class="line">    my_father(username)&#123;</span><br><span class="line">      this.res=username</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components:&#123;</span><br><span class="line">    one</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>子组件：<code>one.vue</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;h1&gt;ref的使�?/h1&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;img :src=&quot;img&quot; ref=&quot;my_img&quot; style=&quot;height: 200px;width: 200px&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;!--  使用父亲传过来的�? --&gt;</span><br><span class="line">  &lt;h2&gt;`&#123;&#123;msg&#125;&#125;`&lt;/h2&gt;</span><br><span class="line">&lt;!--  子传�?-&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; v-model=&quot;username&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;button @click=&quot;handleSon&quot;&gt;子传�?/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name:&#x27;one&#x27;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      // 这里他会检测不到这是个路径，需要一个方法require</span><br><span class="line">      img:require(&#x27;../assets/img/1.png&#x27;),</span><br><span class="line">     username:&#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    handleSon()&#123;</span><br><span class="line">      // 子传�?</span><br><span class="line">      this.$emit(&quot;son&quot;,this.username)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  props:[&quot;msg&quot;]</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h2 id="【补充�-父子通信的方�">【补充�?父子通信的方�?</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 子组件中拿到父组件对�?</span></span><br><span class="line">this.$parent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 父子通信的方�?</span></span><br><span class="line"><span class="comment"># 1 自定义属�?</span></span><br><span class="line"><span class="comment"># 2 自定义事�?</span></span><br><span class="line"><span class="comment"># 3 通过ref属�?this.$refs</span></span><br><span class="line"><span class="comment"># 4 子组件中通过 this.$parent</span></span><br></pre></td></tr></table></figure>
<h1>【二】props</h1>
<ul>
<li>功能：让组件接收外部传过来的数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># props配置项是：子传父，自定义属性的时候用来接收父组件传给子组件的属性的，对应一个数�?</span></span><br><span class="line"><span class="comment"># 方法一�?</span></span><br><span class="line">props=[<span class="string">&#x27;msg&#x27;</span>]</span><br><span class="line"><span class="comment"># 方法�?</span></span><br><span class="line">	- 这个意思是尽量的接收String类型的数据，会报错，但是不影响操�?</span><br><span class="line">props: &#123;myname: String&#125;,</span><br><span class="line"><span class="comment"># 方法�?</span></span><br><span class="line">props: &#123;</span><br><span class="line">    myname: &#123;</span><br><span class="line">        <span class="built_in">type</span>: String, //类型</span><br><span class="line">        required: true, //必要�?</span><br><span class="line">        default: <span class="string">&#x27;老王&#x27;</span> //默认�?</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h1>【三】混入<code>（mixin）</code></h1>
<ul>
<li>前言（js文件�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 混入的意思是：抽取公共的代码</span></span><br><span class="line">	- 多个组件都在用的方法和属性，抽出来，做成公共�?</span><br><span class="line">    - 那个组件用，使用mixin引入即可</span><br><span class="line"><span class="comment"># 有两种方式：我们可以叫做，局部使用和全局使用</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用</li>
<li>公共的组�?</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">username</span>: <span class="string">&#x27;王一�?</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    methods: &#123;</span></span><br><span class="line"><span class="string">        handleName(name) &#123;</span></span><br><span class="line"><span class="string">            this.username = name</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在其他组件中<code>局部</code>使用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">// 可以使用多个</span><br><span class="line">import m1 from &#x27;../mixin&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HomeView&#x27;,</span><br><span class="line">    // 一定要�?</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    //一定要�?</span><br><span class="line">  methods:&#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  mixins:[m1]</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>全局使用</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局使用 定义在main.js</span></span><br><span class="line"><span class="keyword">import</span> m1 <span class="keyword">from</span> <span class="string">&#x27;@/mixin&#x27;</span></span><br><span class="line"><span class="keyword">import</span> m2 <span class="keyword">from</span> <span class="string">&#x27;@/mixin2&#x27;</span></span><br><span class="line">Vue.mixin(m1)</span><br><span class="line">Vue.mixin(m2)</span><br></pre></td></tr></table></figure>
<h1>【四】插�?</h1>
<ul>
<li>前言</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 插件的功能就是增强vue</span></span><br><span class="line"></span><br><span class="line">													<span class="comment"># 插件使用者的意思就是：使用插件的时候串的�?</span></span><br><span class="line">    												Vue.user(ElementUI,<span class="string">&#x27;lsk&#x27;</span>)</span><br><span class="line"><span class="comment"># 本质就是：包含install方法的一个对象，install的第一个参数是Vue，第二个以后的参数是插件使用者传递的数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们使用了：vue-router插件，vuex插件，elementui插件</span></span><br><span class="line">	- 有了这些插件，我们就可以使用�?</span><br><span class="line">    this.$router</span><br><span class="line">    this.$store</span><br><span class="line">    <span class="comment"># 弹框</span></span><br><span class="line">    this.$alert</span><br><span class="line">    this.$message</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用别人写好的插件：</span></span><br><span class="line">	- 首先记得引入</span><br><span class="line">    <span class="keyword">import</span> ElementUI <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line">	Vue.user(ElementUI)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>使用</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 存放到原型类�?prototype</span></span><br><span class="line">	- 注册</span><br><span class="line">    <span class="keyword">import</span> m1 <span class="keyword">from</span> <span class="string">&#x27;@/mixin&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> aaa <span class="keyword">from</span> <span class="string">&#x27;./pulgin&#x27;</span></span><br><span class="line">    Vue.use(aaa)</span><br><span class="line">	- 插件</span><br><span class="line">    export default &#123;</span><br><span class="line">    install(Vue)&#123;</span><br><span class="line">        console.log(Vue)</span><br><span class="line">        // prototype原型类：就好比，你放在了一个最底层的代码中，别人用的时候他没有，就会往�?	查，就会查到你定制进去的</span><br><span class="line">        // $age：名字随便定义，但是必须�?</span><br><span class="line">        Vue.prototype.$age=<span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">        // 你也可以将axios存放到原型类�?</span><br><span class="line">        Vue.prototype.$ajax=<span class="string">&#x27;axios&#x27;</span></span><br><span class="line">        // 你也可以添加路由</span><br><span class="line">        Vue.prototype.$BASE_URL=<span class="string">&#x27;http://192.168.1.69:8080/&#x27;</span></span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    - 在其他组件中使用</span><br><span class="line">    methods:&#123;</span><br><span class="line">    handleName()&#123;</span><br><span class="line">      // 就可以直接使�?</span><br><span class="line">      // 就会渲染上去</span><br><span class="line">      this.age=this.$age</span><br><span class="line">       // 你发送axios请求，就可以这样</span><br><span class="line">       this.$ajax.get(this.$BASE_URL+<span class="string">&#x27;/login&#x27;</span>).then()</span><br><span class="line">        <span class="comment"># 使用混入，这样我们就不用在main.js里面写了</span></span><br><span class="line">        Vue.mixin(m1)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#自定义指�?--》可能会有第三方插件，在项目中使用后，会有没见过的指�?</span></span><br><span class="line">//定义全局指令：跟v-model一样，获取焦点</span><br><span class="line">        Vue.directive(<span class="string">&quot;fbind&quot;</span>, &#123;</span><br><span class="line">            //指令与元素成功绑定时（一上来�?</span><br><span class="line">            bind(element, binding) &#123;</span><br><span class="line">                element.value = binding.value;</span><br><span class="line">            &#125;,</span><br><span class="line">            //指令所在元素被插入页面�?</span><br><span class="line">            inserted(element, binding) &#123;</span><br><span class="line">                element.focus();</span><br><span class="line">            &#125;,</span><br><span class="line">            //指令所在的模板被重新解析时</span><br><span class="line">            update(element, binding) &#123;</span><br><span class="line">                element.value = binding.value;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment"># 定义全局组件</span></span><br><span class="line">		- 好比elementui---》全局组件   &lt;el-button&gt;</span><br><span class="line">        - vue-router----&gt;全局组件   &lt;router-view/&gt;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 在main.js中使用，可以传参�?</span></span><br><span class="line"><span class="comment"># 1 使用自定义插�?</span></span><br><span class="line"><span class="keyword">import</span> my <span class="keyword">from</span> <span class="string">&#x27;@/plugins&#x27;</span></span><br><span class="line">Vue.use(my,<span class="string">&#x27;lsk&#x27;</span>) // 内部本质会执行install</span><br><span class="line">	- 你一旦传了参�?</span><br><span class="line">   export default &#123;</span><br><span class="line">    install(Vue,a)&#123;</span><br><span class="line">        console.log(a) <span class="comment"># 就是lsk</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 咱们需要掌握的;</span></span><br><span class="line">	-有些第三方插件，用了以后，增强了vue功能</span><br><span class="line">    -this.$router</span><br><span class="line">    -全局组件 ：el-button</span><br><span class="line">    -this.$message---&gt;</span><br><span class="line">    -this.$http.get</span><br></pre></td></tr></table></figure>
<h1>【五】插�?</h1>
<ul>
<li>前言</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 让父组件可以向子组件指定位置插入html结构，也是一种组件间通信的方式，适用�?父组�?===&gt; 子组�?</span></span><br><span class="line"><span class="comment"># 在小组件中使用：solt来显示你传的html结构的标�?</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">##########自定义的小组�?</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;hello&quot;&gt;</span><br><span class="line">    &lt;slot name=&#x27;one&#x27;&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;h1&gt;小组件HelloWorld&lt;/h1&gt;</span><br><span class="line">    &lt;slot name=&#x27;two&#x27;&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HelloWorld&#x27;,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">############使用</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;about&quot;&gt;</span><br><span class="line">    &lt;h1&gt;About组件&lt;/h1&gt;</span><br><span class="line">    &lt;HelloWorld&gt;</span><br><span class="line">        &lt;!-- 在小组件中使用：solt，就会显示这张图片。这个你可以看作是传给小组件的图片，但是必须放在小组件中 --&gt;</span><br><span class="line">      &lt;div name=&#x27;one&#x27;&gt;</span><br><span class="line">          &lt;img src=&quot;https://ts1.cn.mm.bing.net/th/id/R-C.987f582c510be58755c4933cda68d525?rik=C0D21hJDYvXosw&amp;riu=http%3a%2f%2fimg.pconline.com.cn%2fimages%2fupload%2fupc%2ftx%2fwallpaper%2f1305%2f16%2fc4%2f20990657_1368686545122.jpg&amp;ehk=netN2qzcCVS4ALUQfDOwxAwFcy41oxC%2b0xTFvOYy5ds%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0&quot; alt=&quot;&quot; style=&quot;height: 400px;width: 400px&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div name=&#x27;two&#x27;&gt;</span><br><span class="line">   lllll</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/HelloWorld&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import HelloWorld from &quot;@/components/HelloWorld.vue&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  template:&#x27;AboutView&#x27;,</span><br><span class="line">  components:&#123;</span><br><span class="line">    HelloWorld</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>【六】vuex</h1>
<ul>
<li>前言</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vuex是一个第三方插件：它叫状态管理器：统一位置管理变量---》也能实现组件间通信：页面刷新，会重�?</span></span><br><span class="line">- vue：vuex</span><br><span class="line">- vue3：vuex，也有pina：用的多</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用vuex---》vuex的新版本支持vue3</span></span><br><span class="line">	-我们在创建项目时候，已经装了</span><br><span class="line">        -项目依赖有了</span><br><span class="line">            -项目中有�?store文件�?-&gt;index.js</span><br><span class="line">            -main.js 中，引入且使用了</span><br><span class="line">    </span><br><span class="line">    - 在创建项目时，没�?</span><br><span class="line">    	-我们要安装：</span><br><span class="line">        - 指定版本 cnpm install vuex@<span class="number">3.6</span><span class="number">.2</span> -S---&gt;S是安装到你这个项目中，不加S的话，就是全局，别人用的时候，就会没有</span><br><span class="line">        - 在项目中新建 store�?-》index.js文件</span><br><span class="line">        - 在index.js中写入代�?</span><br><span class="line">        	<span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">            <span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line">            Vue.use(Vuex)</span><br><span class="line">            export default new Vuex.Store(&#123;</span><br><span class="line">                state: &#123;</span><br><span class="line">                    <span class="comment"># 放变�?</span></span><br><span class="line">                &#125;,</span><br><span class="line">                mutations: &#123;</span><br><span class="line">                    <span class="comment"># 提交，修改就会触发（commit�?</span></span><br><span class="line">                &#125;,</span><br><span class="line">                actions: &#123;</span><br><span class="line">                    <span class="comment"># 调度就会触发（dispatch�?</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">        - 在main.js中使�?</span><br><span class="line">        	- 先引�?</span><br><span class="line">            	- <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line">            - 使用</span><br><span class="line">            	new Vue(&#123;</span><br><span class="line">                    store,</span><br><span class="line">                    render: h =&gt; h(App)</span><br><span class="line">                &#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>使用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#####在组件中使用</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">&lt;h1&gt;首页&lt;/h1&gt;</span><br><span class="line">&lt;h2&gt;我们在state文件中的vuex插件中的count：`&#123;&#123;$store.state.count&#125;&#125;`&lt;/h2&gt;</span><br><span class="line">    &lt;button @click=&quot;handleCount&quot;&gt;点击�?&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HomeView&#x27;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    handleCount()&#123;</span><br><span class="line">      // 方式一</span><br><span class="line">      // 我们之间进行�?---&gt;这样写不太安�?</span><br><span class="line">      // this.$store.state.count++</span><br><span class="line">      // 方式�?</span><br><span class="line">      // 我们先通知dispatch在通知commit,进行一系列操作</span><br><span class="line">      // dataAdd你定义在actions里面的方�?</span><br><span class="line">      this.$store.dispatch(&#x27;dataAdd&#x27;)</span><br><span class="line">      //  this.$store.commit(&#x27;dataAdd&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>vuex插件</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">##############在store/index.<span class="property">js</span>中代�?</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">count</span>:<span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="comment">// 这里面做�?</span></span><br><span class="line">    <span class="comment">// 定义一个函数，随便起名�?</span></span><br><span class="line">    <span class="comment">// 这里回传一个变�?</span></span><br><span class="line">    <span class="title function_">add</span>(<span class="params">two</span>)&#123;</span><br><span class="line">      two.<span class="property">count</span>+=<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 也可以在这里进行判断</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 定义一个函数，随便起名�?</span></span><br><span class="line">    <span class="comment">// 这里回传一个变�?</span></span><br><span class="line">    <span class="title function_">dataAdd</span>(<span class="params">one</span>)&#123;</span><br><span class="line">      <span class="comment">// 通知mutations里面的对象add�?</span></span><br><span class="line">      <span class="comment">// one.commit(&#x27;add&#x27;)</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 我们还可以进行判�?</span></span><br><span class="line">      <span class="comment">// one也可以拿到count</span></span><br><span class="line">      <span class="keyword">if</span> (one.<span class="property">state</span>.<span class="property">count</span> &gt;=<span class="number">5</span>)&#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;太大�?)</span></span><br><span class="line"><span class="string">      &#125;else&#123;</span></span><br><span class="line"><span class="string">          // 通知mutations里面的对象add�?</span></span><br><span class="line"><span class="string">          one.commit(&#x27;add&#x27;)</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<h2 id="�-】重�">�?】重�?</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为什么经�?actions和mutations </span></span><br><span class="line">	- 可以跟后端交互，可以做数据验�?</span><br><span class="line"><span class="comment">#  getters</span></span><br><span class="line">	- 可以通过getters获取数据--》对state中的数据，再做处�?</span><br><span class="line">    $store.getters.里面的方�?</span><br><span class="line"><span class="comment"># modules</span></span><br><span class="line">	- 分到不同模块中，不同模块有自己的state，actions</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240814104538278.png" alt="image-20240814104538278"></p>
<h1>【七】本地储�?</h1>
<ul>
<li>前言</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 能存储数据的位置，登录成�?--》token存储</span></span><br><span class="line">	vuex: 页面重新加载--》数据会恢复</span><br><span class="line">    <span class="comment"># 过期时间</span></span><br><span class="line">	cookie：登录信息放这里，有过期时间，一旦过期，就没�?</span><br><span class="line">    <span class="comment"># 会话储存</span></span><br><span class="line">    sessionStorage：当前浏览器生效---》关闭浏览器，数据就没了</span><br><span class="line">    <span class="comment"># 本地储存</span></span><br><span class="line">    localStorage：永久生效，除非代码删除或清空浏览器缓存</span><br><span class="line">    	-未登录，加购物车</span><br><span class="line">        </span><br><span class="line"><span class="comment">#2 vue中操作cookie 需要下�?vue-cookies</span></span><br><span class="line">cnpm install vue-cookies -S</span><br></pre></td></tr></table></figure>
<ul>
<li>使用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;首页&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h2&gt;localStorage&lt;/h2&gt;</span><br><span class="line">    &lt;button @click=&quot;handleSaveLocalStorage&quot;&gt;存储到localStorage&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;handleGetLocalStorage&quot;&gt;从localStorage取出&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;handleDeleteLocalStorage&quot;&gt;删除localStorage&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h2&gt;sessionStorage使用&lt;/h2&gt;</span><br><span class="line">    &lt;button @click=&quot;handleSavesessionStorage&quot;&gt;存储到sessionStorage&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;handleGetsessionStorage&quot;&gt;从sessionStorage取出&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;handleDeletesessionStorage&quot;&gt;删除sessionStorage&lt;/button&gt;</span><br><span class="line">    &lt;h2&gt;cookie使用&lt;/h2&gt;</span><br><span class="line">    &lt;button @click=&quot;handleSaveCookie&quot;&gt;存储到cookie&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;handleGetCookie&quot;&gt;从cookie取出&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;handleDeleteCookie&quot;&gt;删除cookie&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HomeView&#x27;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 存储到localStorage�?</span><br><span class="line">    handleSaveLocalStorage() &#123;</span><br><span class="line">      localStorage.setItem(&quot;name&quot;, &#x27;lqz&#x27;)</span><br><span class="line">      let user = &#123;</span><br><span class="line">        name: &#x27;xxx&#x27;,</span><br><span class="line">        age: 19</span><br><span class="line">      &#125;</span><br><span class="line">      localStorage.setItem(&quot;user&quot;, JSON.stringify(user)) // 不要放对�?</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    handleGetLocalStorage() &#123;</span><br><span class="line">      let name = localStorage.getItem(&quot;name&quot;)</span><br><span class="line">      let user = localStorage.getItem(&#x27;user&#x27;)</span><br><span class="line">      console.log(name)</span><br><span class="line">      console.log(user)</span><br><span class="line">      console.log(typeof user)</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    handleDeleteLocalStorage() &#123;</span><br><span class="line">      // 只会删除name</span><br><span class="line">      // localStorage.removeItem(&#x27;name&#x27;)</span><br><span class="line">      // 删除所�?</span><br><span class="line">      localStorage.clear()</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 存储到sessionStorage�?</span><br><span class="line">    handleSavesessionStorage() &#123;</span><br><span class="line">      sessionStorage.setItem(&quot;name&quot;, &#x27;彭于�?)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleGetsessionStorage() &#123;</span><br><span class="line">      let name = sessionStorage.getItem(&#x27;name&#x27;)</span><br><span class="line">      console.log(name)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleDeletesessionStorage() &#123;</span><br><span class="line">      sessionStorage.removeItem(&#x27;name&#x27;)</span><br><span class="line">      // sessionStorage.clear()</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 存储到cookies�?</span><br><span class="line">    // 必须下载 cnpm i vue-cookies -S</span><br><span class="line">    // 我们必须在main.js中引�?</span><br><span class="line">    //import cookies from &#x27;vue-cookies&#x27;</span><br><span class="line">    // 放在原型�?</span><br><span class="line">    // Vue.prototype.$cookie = cookies;</span><br><span class="line">    handleSaveCookie() &#123;</span><br><span class="line">      // 过期时间可以�?d�?h�?m</span><br><span class="line">      this.$cookies.set(&#x27;name&#x27;, &#x27;zzzz&#x27;, &#x27;100s&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleGetCookie() &#123;</span><br><span class="line">      let name = this.$cookies.get(&#x27;name&#x27;)</span><br><span class="line">      console.log(name)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleDeleteCookie() &#123;</span><br><span class="line">      this.$cookies.remove(&#x27;name&#x27;)</span><br><span class="line">      // 不可以删除所有，只可以指�?</span><br><span class="line">      // this.$cookies.clear()</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>【八】<code>vue-router</code></h1>
<h2 id="�-】router插件">�?】router插件</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 如果我们创建项目时，已经安装�?</span></span><br><span class="line">	-router--》index.js</span><br><span class="line">    -main.js 引入�?</span><br><span class="line">    -后期在组件中使用�?</span><br><span class="line">    	-js中：</span><br><span class="line">            this.$router <span class="comment"># 用来跳转路径</span></span><br><span class="line">            this.$route   <span class="comment"># 目前没学</span></span><br><span class="line">        -template中：</span><br><span class="line">        	&lt;router-view/&gt;  <span class="comment"># 当访问某个路径时，会把页面组件替换到�?</span></span><br><span class="line">            &lt;router-link&gt;&lt;/router-link&gt;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="comment"># 2 创建项目没有安装，自行引�?</span></span><br><span class="line">	- 安装：cnpm install vue-router -S</span><br><span class="line">	-创建文件夹router---index.js</span><br><span class="line">    -index.js写代�?</span><br><span class="line">    <span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> HomeView <span class="keyword">from</span> <span class="string">&quot;@/views/HomeView&quot;</span>;</span><br><span class="line">    Vue.use(VueRouter)</span><br><span class="line">    const routes = [</span><br><span class="line">        &#123;</span><br><span class="line">            path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">            name: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">            component: HomeView</span><br><span class="line">        &#125;,</span><br><span class="line">    ]</span><br><span class="line">    const router = new VueRouter(&#123;</span><br><span class="line">        mode: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">        base: process.env.BASE_URL,</span><br><span class="line">        routes</span><br><span class="line">    &#125;)</span><br><span class="line">    export default router</span><br><span class="line">    </span><br><span class="line">	-main.js中使�?</span><br><span class="line">        <span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line">        new Vue(&#123;</span><br><span class="line">            router,</span><br><span class="line">            render: h =&gt; h(App)</span><br><span class="line">        &#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">     -后续所有组件中</span><br><span class="line">	    -js中：</span><br><span class="line">            this.$router <span class="comment"># 跳转路径</span></span><br><span class="line">            this.$route   <span class="comment"># 目前没学</span></span><br><span class="line">        -template中：</span><br><span class="line">        	&lt;router-view/&gt;  <span class="comment"># 当访问某个路径时，会把页面组件替换到�?</span></span><br><span class="line">            &lt;router-link&gt;&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>
<h2 id="�-】路由跳�">�?】路由跳�?</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 之前学过，在App.vue中放 </span></span><br><span class="line">  &lt;div <span class="built_in">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">    &lt;router-view/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 在router---index.js�?-》注册路�?-&gt;routes</span></span><br><span class="line">    const routes = [</span><br><span class="line">            &#123;</span><br><span class="line">                path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">                name: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">                component: HomeView</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">        ]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 3 以后访问某个路径，就会显示页面组�?</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4 重点：页面跳转两种方�?</span></span><br><span class="line">	<span class="comment">## 4.1 js跳转</span></span><br><span class="line">       <span class="comment"># 1 传路�?</span></span><br><span class="line">        // http://<span class="number">192.168</span><span class="number">.1</span><span class="number">.69</span>:<span class="number">8080</span>/about/</span><br><span class="line">      // this.$router.push(<span class="string">&#x27;/about&#x27;</span>)</span><br><span class="line">      <span class="comment"># 2 传对�?</span></span><br><span class="line">        // http://<span class="number">192.168</span><span class="number">.1</span><span class="number">.69</span>:<span class="number">8080</span>/</span><br><span class="line">        // 这个name：就是你注册的时候的别名</span><br><span class="line">      // this.$router.push(&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;about&#x27;</span>&#125;)</span><br><span class="line">    	// path：就是你访问的路�?</span><br><span class="line">      // this.$router.push(&#123;<span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;/about&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># 3 携带参数跳转</span></span><br><span class="line">        // 系带参数访问</span><br><span class="line">      // this.$router.push(<span class="string">&#x27;/about?name=lqz&amp;age=19&#x27;</span>)</span><br><span class="line">    	// 传对象，携带参数</span><br><span class="line">      // this.$router.push(&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;about&#x27;</span>,query:&#123;name:<span class="string">&#x27;zhangsan&#x27;</span>,age:<span class="number">19</span>&#125;&#125;)</span><br><span class="line">    	// 传对象，携带参数</span><br><span class="line">      this.$router.push(&#123;<span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;/about&#x27;</span>,query:&#123;name:<span class="string">&#x27;zhangsan&#x27;</span>,age:<span class="number">19</span>&#125;&#125;)</span><br><span class="line">    </span><br><span class="line">    	<span class="comment"># 4 template中跳转：使用：router-link组件</span></span><br><span class="line">        &lt;router-link to=<span class="string">&quot;/about&quot;</span>&gt;</span><br><span class="line">           &lt;button&gt;点我跳转到about页面-router-link&lt;/button&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">		// 使用：router-link组件，传入对象的格式，携带的参数放在query�?</span><br><span class="line">        &lt;router-link :to=<span class="string">&quot;&#123;name:&#x27;about&#x27;,query:&#123;name:&#x27;xxx&#x27;&#125;&#125;&quot;</span>&gt;</span><br><span class="line">           &lt;button&gt;点我跳转到about页面-router-link&lt;/button&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#5 重点 上个页面跳转时，携带数据(查询参数)---》下一个页面中取出�?</span></span><br><span class="line">	-在下一个页面中写：AboutView.vue</span><br><span class="line">    -写在created�?</span><br><span class="line">    created()&#123;</span><br><span class="line">        <span class="comment"># 比如你传的是id</span></span><br><span class="line">        this.book_id=this.$route.query[<span class="string">&#x27;book_id&#x27;</span>]</span><br><span class="line">        <span class="comment">#this.book_id=this.$route.query.book_id</span></span><br><span class="line">        <span class="comment">#console.log(this.$router) // VueRouter 的对�?</span></span><br><span class="line">        <span class="comment">#console.log(this.$route)  // 当前路由对象</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 6 重点 上个页面跳转时，携带数据(查询参数)---》下一个页面中取出来》》》转换器</span></span><br><span class="line">	<span class="number">6.1</span> 路由写法变了</span><br><span class="line">    	 &#123;</span><br><span class="line">            path: <span class="string">&#x27;/:pk/lqz&#x27;</span>,</span><br><span class="line">            name: <span class="string">&#x27;lqz&#x27;</span>,</span><br><span class="line">            component: LQZView</span><br><span class="line">        &#125;,</span><br><span class="line">   <span class="number">6.2</span> 传递数�?</span><br><span class="line">		-js�?</span><br><span class="line">    		this.$router.push(<span class="string">&quot;/99/lqz&quot;</span>)</span><br><span class="line">        	this.$router.push(&#123;name:<span class="string">&#x27;lqz&#x27;</span>,params:&#123;pk:<span class="number">666</span>&#125;&#125;)</span><br><span class="line">    	-router-link:</span><br><span class="line">          &lt;router-link to=<span class="string">&quot;/99/lqz&quot;</span>&gt;</span><br><span class="line">    	  &lt;router-link :to=<span class="string">&quot;&#123;name:&#x27;lqz&#x27;,params:&#123;pk:666&#125;&#125;&quot;</span>&gt;</span><br><span class="line">            </span><br><span class="line">  <span class="number">6.3</span> 另一个页面获取数�?</span><br><span class="line">	this.$route.params.pk</span><br></pre></td></tr></table></figure>
<h2 id="�-】相关API-》router方法">�?】相关<code>API--》router方法</code></h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 指的是：this.$router---&gt;方法</span><br><span class="line"><span class="number">2</span> 常用�?</span><br><span class="line">this.$router.push(path): 相当于点击路由链�?可以返回到当前路由界�?</span><br><span class="line">this.$router.replace(path): 用新路由替换当前路由(不可以返回到当前路由界面)</span><br><span class="line">this.$router.back(): 请求(返回)上一个记录路�?</span><br><span class="line">this.$router.go(-<span class="number">1</span>): 请求(返回)上一个记录路�?</span><br><span class="line">this.$router.go(<span class="number">1</span>): 请求下一个记录路�?</span><br></pre></td></tr></table></figure>
<h2 id="�-】多级路�">�?】多级路�?</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 就是可以分很多层的路�?</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomeView</span> <span class="keyword">from</span> <span class="string">&quot;@/views/HomeView&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">AboutView</span> <span class="keyword">from</span> <span class="string">&quot;@/views/AboutView&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LQZView</span> <span class="keyword">from</span> <span class="string">&quot;@/views/LQZView&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MulRouterView</span> <span class="keyword">from</span> <span class="string">&quot;@/views/MulRouterView&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">IndexView</span> <span class="keyword">from</span> <span class="string">&quot;../../src_昨日/views/pages/IndexView&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">OrderView</span> <span class="keyword">from</span> <span class="string">&quot;../../src_昨日/views/pages/OrderView&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">GoodsView</span> <span class="keyword">from</span> <span class="string">&quot;../../src_昨日/views/pages/GoodsView&quot;</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>,)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">HomeView</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/mul&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;mul&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">MulRouterView</span>,</span><br><span class="line">        <span class="attr">children</span>: [ <span class="comment">//通过children配置子级路由</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">//此处一定不要写�?news</span></span><br><span class="line">                <span class="attr">name</span>:<span class="string">&#x27;index&#x27;</span>,</span><br><span class="line">                <span class="attr">component</span>: <span class="title class_">IndexView</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">path</span>: <span class="string">&#x27;order&#x27;</span>,</span><br><span class="line">                <span class="attr">name</span>:<span class="string">&#x27;order&#x27;</span>,</span><br><span class="line">                <span class="attr">component</span>: <span class="title class_">OrderView</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">path</span>: <span class="string">&#x27;goods&#x27;</span>,</span><br><span class="line">                <span class="attr">component</span>: <span class="title class_">GoodsView</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">    <span class="attr">base</span>: process.<span class="property">env</span>.<span class="property">BASE_URL</span>,</span><br><span class="line">    routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br><span class="line"><span class="title class_">MulRouterView</span>.<span class="property">vue</span></span><br><span class="line">    pages</span><br><span class="line">    <span class="title class_">GoodsView</span>.<span class="property">vue</span></span><br><span class="line">    <span class="title class_">IndexView</span>.<span class="property">vue</span></span><br><span class="line">    <span class="title class_">OrderView</span>.<span class="property">vue</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>MulRouterView.vue</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div style=&quot;height: 80px;background-color: pink&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;el-container&gt;</span><br><span class="line">      &lt;el-aside width=&quot;200px&quot;&gt;</span><br><span class="line">        &lt;div style=&quot;background-color:greenyellow;height:700px &quot;&gt;</span><br><span class="line">           &lt;!-- 多级路由--&gt; </span><br><span class="line">          &lt;p&gt;&lt;router-link to=&quot;/mul&quot;&gt;首页&lt;/router-link&gt;&lt;/p&gt;</span><br><span class="line">            &lt;!-- 多级路由---也可以指定别�?-&gt; </span><br><span class="line">          &lt;p&gt;&lt;router-link :to=&quot;&#123;name:&#x27;order&#x27;&#125;&quot;&gt;订单&lt;/router-link&gt;&lt;/p&gt;</span><br><span class="line">            &lt;!-- 多级路由---直接锁定根路�?-&gt; </span><br><span class="line">          &lt;p&gt;&lt;router-link to=&quot;/mul/goods&quot;&gt;商品&lt;/router-link&gt;&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/el-aside&gt;</span><br><span class="line">      &lt;el-container&gt;</span><br><span class="line">        &lt;el-header&gt;</span><br><span class="line">          &lt;div style=&quot;background-color:rebeccapurple&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/el-header&gt;</span><br><span class="line">        &lt;el-main&gt;</span><br><span class="line">          &lt;div style=&quot;height:500px;background-color: aqua&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-main&gt;</span><br><span class="line">        &lt;el-footer&gt;</span><br><span class="line">          &lt;div style=&quot;background-color: pink;height:50px&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/el-footer&gt;</span><br><span class="line">      &lt;/el-container&gt;</span><br><span class="line">    &lt;/el-container&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;MulRouterView&quot;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><strong>pages-- GoodsView.vue</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;商品&lt;/h1&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;GoodsView&quot;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><strong>pages-- IndexView.vue</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;h1&gt;后台首页&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;IndexView&quot;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><strong>pages–OrderView.vue</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;h1&gt;订单&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;OrderView&quot;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h2 id="�-】路由守�">�?】路由守�?</h2>
<ul>
<li>前言</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 路由守护：就是字面的意思，守护路由</span></span><br><span class="line"><span class="comment"># 就比如：你需要登才可以访问的页面</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 守护路由：全局守护，独享守护，组件内守�?</span></span><br><span class="line"><span class="comment"># 我们用到的最多的就是全局守护</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//////// router/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置全局的路由守�?</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// to:要去的路由的对象，from:来自那个路由的对象，next：跳转到那个路径</span></span><br><span class="line">    <span class="comment">// 要去的路径，如果不是登入路径�?根路径，要判断有没有登入，登录的token存入到localStorage�?</span></span><br><span class="line">    <span class="comment">// 这里的name就是你路由中的别名，path就是你路由中的真正路由地址</span></span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">name</span> == <span class="string">&#x27;login&#x27;</span> || to.<span class="property">path</span> == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 直接跳转</span></span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 判断有没有登�?取token</span></span><br><span class="line">        <span class="keyword">let</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">        <span class="comment">// 在进行判断token</span></span><br><span class="line">        <span class="keyword">if</span> (token)&#123;</span><br><span class="line">            <span class="comment">// 存在直接跳转</span></span><br><span class="line">            <span class="title function_">next</span>()</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 使用Message需要导入Element</span></span><br><span class="line">            <span class="comment">// 这是一个好看的弹框</span></span><br><span class="line">            <span class="title class_">Element</span>.<span class="property">Message</span>.<span class="title function_">error</span>(<span class="string">&#x27;请先登录！！&#x27;</span>)</span><br><span class="line">            <span class="comment">// 跳转到等于页�?</span></span><br><span class="line">            <span class="title function_">next</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;login&#x27;</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="�-】路由的两种工作模式">�?】路由的两种工作模式</h2>
<ul>
<li>Hash模式</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// URL 示例: http://192.168.1.69:8080/#/login</span></span><br><span class="line"><span class="comment">//  特点: 使用 URL �?hash (#) 部分来表示路由。浏览器不会发�?hash 部分到服务器，所以页面刷新时不会向服务器发起请求�?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomeView</span> <span class="keyword">from</span> <span class="string">&#x27;../views/HomeView.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Element</span> <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由配置</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">HomeView</span></span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;hash&#x27;</span>,   <span class="comment">// 使用 hash 模式</span></span><br><span class="line">    <span class="attr">base</span>: process.<span class="property">env</span>.<span class="property">BASE_URL</span>, <span class="comment">// 基础路径</span></span><br><span class="line">    routes <span class="comment">// 路由配置</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置全局的路由守�?</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>History 模式</strong>:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// URL 示例: http://192.168.1.69:8080/login</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 特点: 使用 HTML5 History API 来管�?URL，使 URL 看起来更干净和自然。需要服务器支持，通常需配置服务器以处理所有请求并返回应用的入�?HTML 文件�?</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置方式:</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomeView</span> <span class="keyword">from</span> <span class="string">&#x27;../views/HomeView.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Element</span> <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由配置</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">HomeView</span></span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;history&#x27;</span>,   <span class="comment">// 使用 history 模式</span></span><br><span class="line">    <span class="attr">base</span>: process.<span class="property">env</span>.<span class="property">BASE_URL</span>, <span class="comment">// 基础路径</span></span><br><span class="line">    routes <span class="comment">// 路由配置</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置全局的路由守�?</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>
<ul>
<li>总结</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">选择哪一个：</span><br><span class="line"></span><br><span class="line">如果你希�?URL 更加干净和现代，并且可以配置服务器来支持此模式，则选择 history 模式�?</span><br><span class="line">如果你需要兼容旧浏览器或无法配置服务器，则选择 <span class="built_in">hash</span> 模式�?</span><br></pre></td></tr></table></figure>
<h1>【九】scoped样式</h1>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 作用：让样式在局部生效，防止冲突�?</span></span><br><span class="line"><span class="comment"># 写法�?style scoped&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2023/01/01/4.11subprocess%E6%A8%A1%E5%9D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/4.11subprocess%E6%A8%A1%E5%9D%97/" class="post-title-link" itemprop="url">4.11subprocessģ��</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-11 17:47:38" itemprop="dateModified" datetime="2025-10-11T17:47:38+08:00">2025-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>subprocess模块</h1>
<h2 id="【一】介�">【一】介�?</h2>
<ul>
<li>subprocess:它主要用于创建新的进程，连接到这些进程的输入/输出/错误管道，以及获取它们的返回状态。简而言之，通过subprocess模块，你可以在Python代码中执行操作系统级别的命令，并与这些命令进行交互�?</li>
<li>简单理解就是：使用我们自己的电脑去连接别人的电脑（socket模块�?</li>
</ul>
<h2 id="【二】使�">【二】使�?</h2>
<h3 id="�-】导入模�">�?】导入模�?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br></pre></td></tr></table></figure>
<h3 id="�-】Popen方法">�?】Popen方法</h3>
<ul>
<li>Popen �?subprocess的核心，子进程的创建和管理都靠它处理�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入模块</span></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#用的时候直接改diraaa命令就行,其它都是定�?</span></span><br><span class="line">res = subprocess.Popen(<span class="string">&#x27;diraaa&#x27;</span>, shell=<span class="literal">True</span>,</span><br><span class="line">                       stdout=subprocess.PIPE,  <span class="comment"># 管道 负责存储正确的信�?</span></span><br><span class="line">                       stderr=subprocess.PIPE  <span class="comment"># 管道 负责存储错误信息</span></span><br><span class="line">                       )</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res)  <span class="comment"># &lt;subprocess.Popen object at 0x000001ABB1970310&gt;</span></span><br><span class="line"><span class="built_in">print</span>(res.stdout.read().decode(<span class="string">&#x27;gbk&#x27;</span>))  <span class="comment"># diraaa执行之后的正确结果返�?</span></span><br><span class="line"><span class="built_in">print</span>(res.stderr.read().decode(<span class="string">&#x27;gbk&#x27;</span>)) <span class="comment"># diraaa执行之后的错误结果返�?</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】run方法">�?】run方法</h3>
<ul>
<li>你可以为 <code>subprocess.run()</code> 设置超时时间，如果命令执行超过指定的时间，进程会被终止�?</li>
<li>你可以使�?<code>subprocess.run()</code> 来执行外部命令，并等待命令执行完成�?</li>
<li>通过 <code>subprocess.run()</code>，你可以捕获命令的标准输出和错误输出，从而获取命令执行后的结果�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runcmd</span>(<span class="params">command</span>):</span><br><span class="line">    ret = subprocess.run(command,  <span class="comment"># 子进程要执行的命�?</span></span><br><span class="line">                         shell=<span class="literal">True</span>,  <span class="comment"># 执行的是shell的命�?</span></span><br><span class="line">                         stdout=subprocess.PIPE,</span><br><span class="line">                         stderr=subprocess.PIPE,</span><br><span class="line">                         <span class="comment"># encoding=&quot;utf-8&quot;,#二进制无法用utf-8编译</span></span><br><span class="line">                         timeout=<span class="number">1</span><span class="comment">#等待一秒钟没执行就会报错，这里是设置程序运行时�?</span></span><br><span class="line">                         )</span><br><span class="line">    <span class="comment"># print( ret.returncode)</span></span><br><span class="line">    <span class="comment"># returncode属性是run()函数返回结果的状态�?</span></span><br><span class="line">    <span class="keyword">if</span> ret.returncode == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;success:&quot;</span>, ret.stdout)<span class="comment">#输出的是二进制数�?</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;error:&quot;</span>, ret)<span class="comment">#输出的是二进制数�?</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">runcmd([<span class="string">&quot;dir&quot;</span>,<span class="string">&#x27;/b&#x27;</span>])  <span class="comment"># 序列参数</span></span><br><span class="line"><span class="comment"># success: CompletedProcess(args=[&#x27;dir&#x27;, &#x27;/b&#x27;], returncode=0, stderr=&#x27;&#x27;)</span></span><br><span class="line">runcmd(<span class="string">&quot;exit 1&quot;</span>)  <span class="comment"># 字符串参�?</span></span><br><span class="line"><span class="comment"># error: CompletedProcess(args=&#x27;exit 1&#x27;, returncode=1, stdout=&#x27;&#x27;, stderr=&#x27;&#x27;)</span></span><br></pre></td></tr></table></figure>
<h3 id="�-】call方法">�?】call方法</h3>
<ul>
<li>调用subprocess.call()函数执行命令，将需要执行的命令以列表形式传递给该函�?</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">subprocess.call([<span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;--version&#x27;</span>])</span><br><span class="line"><span class="comment"># Python 3.10.10</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">坤</p>
  <div class="site-description" itemprop="description">选择有时候比努力更重要，但是你不努力，选择就只是空谈</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">201</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">坤</span>
</div>
  <div class="powered-by">由 <a href="https://github.com/lsk-0912" class="theme-link" rel="noopener" target="_blank">lsk-0912</a> & <a href="https://github.com/lsk-0912" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
