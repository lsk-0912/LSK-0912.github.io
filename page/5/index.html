<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aurora-lsk.asia","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
<meta property="og:type" content="website">
<meta property="og:title" content="坤博客">
<meta property="og:url" content="https://aurora-lsk.asia/page/5/index.html">
<meta property="og:site_name" content="坤博客">
<meta property="og:description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="坤">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://aurora-lsk.asia/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>坤博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">坤博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/10.0selenium%E6%A1%86%E6%9E%B6%E4%B9%8B%E6%B5%8F%E8%A7%88%E5%99%A8%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/10.0selenium%E6%A1%86%E6%9E%B6%E4%B9%8B%E6%B5%8F%E8%A7%88%E5%99%A8%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">10.0selenium框架之浏览器操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:15:49" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>selenium框架之浏览器操作</h1>
<h2 id="【一】页面的操作">【一】页面的操作</h2>
<h3 id="【1】初始化浏览器对象">【1】初始化浏览器对象</h3>
<ul>
<li>前期我们将Chrome驱动添加到环境变量了，所以我们可以直接初始化界面。（或者也可以通过指定绝对路径的方式）</li>
</ul>
<h4 id="（1）方式一：使用环境变量">（1）方式一：使用环境变量</h4>
<ul>
<li>我们不指定驱动位置，在selenium打开浏览器的时间会很长</li>
</ul>
```python
from selenium.webdriver import Chrome
# 初始化浏览器为chrome浏览器
browser = Chrome()

browser.get('https://www.baidu.com')
# 关闭浏览器
browser.close()
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （2）方式二：使用绝对路径</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from selenium.webdriver import Chrome</span><br><span class="line">from selenium.webdriver.chrome.service import Service</span><br><span class="line"></span><br><span class="line">service = Service(executable_path=&#x27;./text/chromedriver.exe&#x27;)</span><br><span class="line"></span><br><span class="line">browser = Chrome(service=service)</span><br><span class="line"># 使用创建好的驱动发送get请求，打开指定网址</span><br><span class="line">browser.get(&#x27;https://www.baidu.com&#x27;)</span><br></pre></td></tr></table></figure>

<h3 id="【2】访问页面">【2】访问页面</h3>
<ul>
<li>进行页面访问使用的是get方法，传入参数为待访问页面的URL地址即可</li>
</ul>
```python
from selenium.webdriver import Chrome
from selenium.webdriver.chrome.service import Service

service = Service(executable_path='./text/chromedriver.exe')

browser = Chrome(service=service)
# 使用创建好的驱动发送get请求，打开指定网址
browser.get('https://www.baidu.com')
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【3】设置浏览器的大小</span><br><span class="line"></span><br><span class="line">- 方法：set_window_size（宽度，高度）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from selenium.webdriver import Chrome</span><br><span class="line">from selenium.webdriver.chrome.service import Service</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">service = Service(executable_path=&#x27;./text/chromedriver.exe&#x27;)</span><br><span class="line"></span><br><span class="line"># 创建浏览器</span><br><span class="line">browser = Chrome(service=service)</span><br><span class="line"># 使用创建好的驱动发送get请求，打开指定网址</span><br><span class="line">browser.get(&#x27;https://www.baidu.com&#x27;)</span><br><span class="line"></span><br><span class="line">time.sleep(2)</span><br><span class="line"></span><br><span class="line"># 设置浏览器的打开的大小</span><br><span class="line">browser.set_window_size(1000,500)</span><br></pre></td></tr></table></figure>

<h3 id="【4】设置浏览器为全屏">【4】设置浏览器为全屏</h3>
<ul>
<li>方法：maximize_window（）</li>
</ul>
```python
from selenium.webdriver import Chrome
from selenium.webdriver.chrome.service import Service
import time

service = Service(executable_path='./text/chromedriver.exe')

# 创建浏览器
browser = Chrome(service=service)
# 使用创建好的驱动发送get请求，打开指定网址
browser.get('https://www.baidu.com')

time.sleep(2)

# 设置浏览器全屏
browser.maximize_window()
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【5】前进和后退页面</span><br><span class="line"></span><br><span class="line">- 前进页面：forward（）</span><br><span class="line">- 后退页面：back（）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from selenium.webdriver import Chrome</span><br><span class="line">from selenium.webdriver.chrome.service import Service</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">service = Service(executable_path=&#x27;./text/chromedriver.exe&#x27;)</span><br><span class="line"></span><br><span class="line"># 创建浏览器</span><br><span class="line">browser = Chrome(service=service)</span><br><span class="line"># 使用创建好的驱动发送get请求，打开指定网址</span><br><span class="line">browser.get(&#x27;https://www.baidu.com&#x27;)</span><br><span class="line"></span><br><span class="line">time.sleep(2)</span><br><span class="line"></span><br><span class="line"># 前进和后退页面</span><br><span class="line"># 先打开一个网址</span><br><span class="line">browser.get(&#x27;https://www.jd.com&#x27;)</span><br><span class="line"></span><br><span class="line"># 后退回百度</span><br><span class="line">browser.back()</span><br><span class="line">time.sleep(2)</span><br><span class="line"></span><br><span class="line"># 前进到京东页面</span><br><span class="line">browser.forward()</span><br><span class="line">time.sleep(2)</span><br></pre></td></tr></table></figure>

<h3 id="【6】获得页面的基础属性">【6】获得页面的基础属性</h3>
```python
from selenium.webdriver import Chrome
from selenium.webdriver.chrome.service import Service
import time

service = Service(executable_path='./text/chromedriver.exe')

# 创建浏览器
browser = Chrome(service=service)
# 使用创建好的驱动发送get请求，打开指定网址
browser.get('https://www.baidu.com')

time.sleep(2)

# 获得网页标题
print(browser.title)  # 百度一下，你就知道
# 获得当前网址
print(browser.current_url)  # https://www.baidu.com/
# 获得浏览器的名字
print(browser.name)  # chrome
# 获得网页源码
print(browser.page_source)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【7】在浏览器中切换，新开，关闭，页面</span><br><span class="line"></span><br><span class="line">- 隐士等待：`browser.implicitly_wait(2)`</span><br><span class="line">  - 如果在这两秒（或指定的时间）内WebDriver找到了元素,会立即停止等待并继续执行后续的代码</span><br><span class="line">  - 如果过了这两秒之后，元素仍然没有被找到,WebDriver会抛出一个NoSuchElementException异常</span><br><span class="line">- `browser.window_handles`：获得浏览器打开的所有页面的句柄，得到的是一个列表</span><br><span class="line">  - 得到这个句柄切换页面</span><br><span class="line">  - 也可以说或的页面的所有选项卡</span><br><span class="line">- `browser.switch_to.window(all_handles[0])`：切换到第一个选项卡页面</span><br><span class="line">- 在本页面打开新的页面：`browser.get(&#x27;https://www.pinduoduo.com/&#x27;)`</span><br><span class="line">- 关闭当前选项卡：`browser.close()`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from selenium.webdriver import Chrome</span><br><span class="line">from selenium.webdriver.chrome.service import Service</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">service = Service(executable_path=&#x27;./text/chromedriver.exe&#x27;)</span><br><span class="line"></span><br><span class="line"># 创建浏览器</span><br><span class="line">browser = Chrome(service=service)</span><br><span class="line"># 使用创建好的驱动发送get请求，打开指定网址</span><br><span class="line">browser.get(&#x27;https://www.jd.com&#x27;)</span><br><span class="line"></span><br><span class="line"># time.sleep(2)</span><br><span class="line"></span><br><span class="line"># 隐士等待两秒，确保页面加载完全</span><br><span class="line"># 当你使用browser.implicitly_wait(2)设置了隐式等待时间后，如果在这两秒（或指定的时间）内WebDriver找到了元素，</span><br><span class="line"># 那么它就会立即停止等待并继续执行后续的代码。</span><br><span class="line"># 但是，如果过了这两秒之后，元素仍然没有被找到，</span><br><span class="line"># 那么WebDriver会抛出一个NoSuchElementException异常，表示它无法在指定的时间内找到该元素</span><br><span class="line">browser.implicitly_wait(2)</span><br><span class="line"></span><br><span class="line"># browser.window_handles是一个属性，它返回当前会话中打开的所有窗口（或标签页）的句柄列表。</span><br><span class="line"># 每个句柄都是一个唯一的标识符，用于区分不同的窗口或标签页</span><br><span class="line">print(browser.window_handles)</span><br><span class="line"></span><br><span class="line"># 在当前浏览器实例中新打开一个选项卡</span><br><span class="line">browser.execute_script(&#x27;window.open(&quot;https://www.baidu.com&quot;)&#x27;)</span><br><span class="line">time.sleep(2)</span><br><span class="line"></span><br><span class="line"># 获取所有选项卡</span><br><span class="line">all_handles = browser.window_handles</span><br><span class="line"></span><br><span class="line"># 切换到第一个选项卡</span><br><span class="line">browser.switch_to.window(all_handles[0])</span><br><span class="line">time.sleep(2)</span><br><span class="line"></span><br><span class="line"># 在第一个选项中打开拼多多</span><br><span class="line">browser.get(&#x27;https://www.pinduoduo.com/&#x27;)</span><br><span class="line">time.sleep(2)</span><br><span class="line"></span><br><span class="line"># 切换到第二个选项卡上，打开百度</span><br><span class="line">browser.switch_to.window(all_handles[1])</span><br><span class="line">time.sleep(2)</span><br><span class="line"></span><br><span class="line"># 关闭当前选项卡</span><br><span class="line">browser.close()</span><br><span class="line">time.sleep(2)</span><br><span class="line"># 关闭当前浏览器</span><br><span class="line">browser.quit()</span><br></pre></td></tr></table></figure>

<h2 id="【二】定位页面元素">【二】定位页面元素</h2>
<h3 id="【1】前言">【1】前言</h3>
<ul>
<li>我们熟知的 百度为例，我们进入首页，按 【F12】 进入开发者工具。</li>
<li>红框中显示的就是页面的代码，我们要做的就是从代码中定位获取我们需要的元素</li>
</ul>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cee02bd15-8922-4f62-8ce7-91baf3ab2401.png" alt="ee02bd15-8922-4f62-8ce7-91baf3ab2401"></p>
<h3 id="【2】八大选择器介绍">【2】八大选择器介绍</h3>
<ul>
<li>通过webdriver对象的 find_element(by=“属性名”, value=“属性值”)</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>函数</th>
</tr>
</thead>
<tbody>
<tr>
<td>CLASS</td>
<td>find_element(by=By.CLASS_NAME, value=‘’)</td>
</tr>
<tr>
<td>XPATH</td>
<td>find_element(by=By.XPATH, value=‘’)</td>
</tr>
<tr>
<td>LINK_TEXT</td>
<td>find_element(by=By.LINK_TEXT, value=‘’)</td>
</tr>
<tr>
<td>PARTIAL_LINK_TEXT</td>
<td>find_element(by=By.PARTIAL_LINK_TEXT, value=‘’)</td>
</tr>
<tr>
<td>TAG</td>
<td>find_element(by=By.TAG_NAME, value=‘’)</td>
</tr>
<tr>
<td>CSS</td>
<td>find_element(by=By.CSS_SELECTOR, value=‘’)</td>
</tr>
<tr>
<td>ID</td>
<td>find_element(<a target="_blank" rel="noopener" href="http://by=By.ID">by=By.ID</a>, value=‘’)</td>
</tr>
</tbody>
</table>
<h3 id="【3】八大选择器示例">【3】八大选择器示例</h3>
<h4 id="（1）ID">（1）ID</h4>
<ul>
<li>通过ID进行定位</li>
<li><code>browser</code>: 生成的浏览器对象</li>
<li><code>real_id</code>：查找元素的真实ID</li>
</ul>
```python

label_position = browser.find_element(By.ID, "real_id")
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （2）Name</span><br><span class="line"></span><br><span class="line">- 通过元素name的属性进行定位</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">label_position = browser.find_element(By.NAME, &#x27;real_name&#x27;)</span><br></pre></td></tr></table></figure>

<h4 id="（3）Class">（3）Class</h4>
<ul>
<li>通过元素的 Class 属性进行定位</li>
</ul>
```python
label_position = browser.find_element(By.CLASS_NAME, 'real_class')
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （4）Tag定位</span><br><span class="line"></span><br><span class="line">- 通过标签名进行定位</span><br><span class="line">- 将 &#x27;div&#x27; 替换为你要查找的具体标签名，如 &#x27;a&#x27;、&#x27;span&#x27;</span><br><span class="line">- 使用 find_element**s** 方法，通过标签名进行定位</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">label_position = browser.find_elements(By.TAG_NAME, &#x27;div&#x27;)</span><br></pre></td></tr></table></figure>

<h4 id="（5）Link文字进行定位">（5）Link文字进行定位</h4>
<ul>
<li>精准定位</li>
<li>将 ‘link_text’ 替换为你要查找的链接文字</li>
</ul>
```python
label_position = browser.find_element(By.LINK_TEXT, 'link_text')
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （6）Partial Link文字</span><br><span class="line"></span><br><span class="line">- 模糊定位</span><br><span class="line">- 将 &#x27;partial_link_text&#x27; 替换为你要查找的部分链接文字</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">label_position = browser.find_element(By.PARTIAL_LINK_TEXT, &#x27;partial_link_text&#x27;)</span><br></pre></td></tr></table></figure>

<h4 id="（7）Xpath">（7）Xpath</h4>
<ul>
<li>xpath表达式进行定位</li>
<li>将 ‘xpath_expression’ 替换为你要使用的实际 XPath 表达式</li>
</ul>
```python
label_position = browser.find_element(By.XPATH, 'xpath_expression')
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （8）CSS选择器</span><br><span class="line"></span><br><span class="line">- 将 &#x27;css_selector&#x27; 替换为你要使用的实际 CSS 选择器</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">element = bro.find_element(By.CSS_SELECTOR, &#x27;css_selector&#x27;)</span><br></pre></td></tr></table></figure>

<h3 id="【4】百度案例">【4】百度案例</h3>
```python
# 八大选择器案例
from selenium.webdriver import Chrome
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.service import Service
import time
# 查找到驱动
service = Service('./text/chromedriver.exe')
# 创建浏览器对象
browser = Chrome(service=service)
# 打开百度
browser.get('https://www.baidu.com')
time.sleep(2)
# 通过类属性查找百度搜索框
search_input = browser.find_element(By.CLASS_NAME, "s_ipt")
print(search_input)

# 通过id属性查找百度搜索框
search_input = browser.find_element(By.ID, "kw")
print(search_input)

# 通过name属性查找百度搜索框
search_input = browser.find_element(By.NAME, "wd")
print(search_input)

# 通过Tag标签名查找所有的input框
search_input = browser.find_elements(By.TAG_NAME, "input")
print(search_input)

# 通过Xpath方法查找百度搜索框
search_input = browser.find_element(By.XPATH, '//*[@id="kw"]')
print(search_input)

# 通过Link文字查找百度的新闻标签
search_input = browser.find_element(By.LINK_TEXT, '新闻')
print(search_input)

# 通过Partial Link文字查找百度的新闻标签
search_input = browser.find_element(By.PARTIAL_LINK_TEXT, '新')
print(search_input)

# 通过CSS选择器查找百度搜索框
search_input = browser.find_element(By.CSS_SELECTOR, '#kw')
print(search_input)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【5】小结</span><br><span class="line"></span><br><span class="line">- 以上示例中的定位方式都是通过 find_element 或 find_elements 方法配合相应的定位器（如 By.ID、By.NAME 等）来定位元素。 </span><br><span class="line"></span><br><span class="line">- - find_element 方法返回第一个匹配到的元素</span><br><span class="line">  - find_elements 方法返回所有匹配到的元素的列表</span><br><span class="line"></span><br><span class="line">## 【三】元素操作（节点交互）</span><br><span class="line"></span><br><span class="line">- Selenium可以驱动浏览器来执行一些操作，也就是说可以让浏览器模拟执行一些动作。 </span><br><span class="line"></span><br><span class="line">- - 比较常见的用法有： </span><br><span class="line"></span><br><span class="line">- - - 输入文字时用send_keys()方法，</span><br><span class="line">    - 清空文字时用clear()方法，</span><br><span class="line">    - 点击按钮时用click()方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;````python</span><br><span class="line">kw1.clear()        #清除元素的值</span><br><span class="line">kw1.click()        #点击元素</span><br><span class="line">kw1.id             #Selenium所使用的内部ID</span><br><span class="line">kw1.get_property(&#x27;background&#x27;) #获取元素的属性的值</span><br><span class="line">kw1.get_attribute(&#x27;id&#x27;) #获取元素的属性的值</span><br><span class="line">kw1.location       #不滚动获取元素的坐标</span><br><span class="line">kw1.location_once_scrolled_into_view  #不滚动且底部对齐并获取元素的坐标</span><br><span class="line">kw1.parent         #父元素</span><br><span class="line">kw1.send_keys(&#x27;&#x27;)  #向元素内输入值</span><br><span class="line">kw1.size           #大小</span><br><span class="line">kw1.submit         #提交</span><br><span class="line">kw1.screenshot(&#x27;2.png&#x27;) #截取元素形状并保存为图片</span><br><span class="line">kw1.tag_name       #标签名</span><br><span class="line">kw1.text           #内容，如果是表单元素则无法获取</span><br><span class="line">kw1.is_selected()  #判断元素是否被选中</span><br><span class="line">kw1.is_enabled()   #判断元素是否可编辑</span><br><span class="line">kw1.is_displayed   #判断元素是否显示</span><br><span class="line">kw1.value_of_css_property(&#x27;color&#x27;) #获取元素属性的值</span><br><span class="line">kw1._upload(&#x27;2.png&#x27;) #上传文件</span><br><span class="line">````</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- find_element方法仅仅能够获取元素对象，接下来就可以对元素执行以下操作 从定位到的元素中提取数据的方法</span><br><span class="line"></span><br><span class="line">### 【1】从定位到的元素中获取数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">el.get_attribute(key)           # 获取key属性名对应的属性值</span><br><span class="line">el.text                        	# 获取开闭标签之间的文本内容</span><br></pre></td></tr></table></figure>

<h3 id="【2】对定位到的元素的操作">【2】对定位到的元素的操作</h3>
```python
el.click()                      # 对元素执行点击操作
el.submit()                     # 对元素执行提交操作
el.clear()                      # 清空可输入元素中的数据
el.send_keys(data)              # 向可输入元素输入数据
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【3】百度登入案例</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 引入模块</span><br><span class="line">from selenium.webdriver import Chrome</span><br><span class="line"># 引入Service</span><br><span class="line">from selenium.webdriver.chrome.service import Service</span><br><span class="line">#</span><br><span class="line">from selenium.webdriver.common.by import By</span><br><span class="line"># 时间</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># 创建Service对象，指定ChromeDriver的路径</span><br><span class="line">service = Service(executable_path=&quot;./chromedriver.exe&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 生成浏览器对象</span><br><span class="line">browser = Chrome(</span><br><span class="line">    service=service</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># 设置浏览器为全屏</span><br><span class="line">browser.maximize_window()</span><br><span class="line"># 控制浏览器打开百度</span><br><span class="line">browser.get(&quot;https://www.baidu.com&quot;)</span><br><span class="line">time.sleep(2)</span><br><span class="line"></span><br><span class="line"># 设置你打开的浏览器的分辨率</span><br><span class="line"># browser.set_window_size(1920, 1080)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 找到百度的登入按钮</span><br><span class="line">search_btn = browser.find_element(By.ID, &quot;s-top-loginbtn&quot;)</span><br><span class="line"></span><br><span class="line">search_btn.click()</span><br><span class="line">time.sleep(2)</span><br><span class="line"></span><br><span class="line"># 找到登入界面的手机号输入框</span><br><span class="line">search_input_phone = browser.find_element(By.XPATH,&#x27;//*[@id=&quot;TANGRAM__PSP_11__userName&quot;]&#x27;)</span><br><span class="line"></span><br><span class="line"># 渲染数据</span><br><span class="line">search_input_phone.send_keys(&quot;17746302958&quot;)</span><br><span class="line"></span><br><span class="line"># 找到登入界面的密码输入框</span><br><span class="line">search_input_psw = browser.find_element(By.XPATH, &#x27;//*[@id=&quot;TANGRAM__PSP_11__password&quot;]&#x27;)</span><br><span class="line"></span><br><span class="line"># 渲染数据</span><br><span class="line">search_input_psw.send_keys(&quot;lsk2lmy1314&quot;)</span><br><span class="line">time.sleep(2)</span><br><span class="line"></span><br><span class="line"># 先点击阅读接收</span><br><span class="line">search_receive_btn = browser.find_element(By.XPATH, &#x27;//*[@id=&quot;TANGRAM__PSP_11__isAgree&quot;]&#x27;)</span><br><span class="line"></span><br><span class="line"># 点击</span><br><span class="line">search_receive_btn.click()</span><br><span class="line"></span><br><span class="line">time.sleep(3)</span><br><span class="line"></span><br><span class="line"># 然后找到登入按钮</span><br><span class="line">search_btn = browser.find_element(By.XPATH, &#x27;//*[@id=&quot;TANGRAM__PSP_11__submit&quot;]&#x27;)</span><br><span class="line"></span><br><span class="line"># 点击按钮</span><br><span class="line">search_btn.click()</span><br><span class="line"></span><br><span class="line">time.sleep(3)</span><br><span class="line"># 获得点击发送验证码的按钮</span><br><span class="line">search_input_verification_btn = browser.find_element(By.XPATH,&#x27;//*[@id=&quot;goToVerify&quot;]&#x27;)</span><br><span class="line"># 点击发送验证码</span><br><span class="line">search_input_verification_btn.click()</span><br><span class="line">time.sleep(3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 获得输入验证码的框</span><br><span class="line">search_input_verification = browser.find_element(By.XPATH, &#x27;//*[@id=&quot;passAuthVcode&quot;]&#x27;)</span><br><span class="line"># 将得到的验证码在一分钟之内，输入进去</span><br><span class="line"># 第一次见进入的时候，会发送验证码，你随机填的验证码肯定不正确</span><br><span class="line"># 但是你第二次，启动之前把你获得的验证码放在括号里，就可以登入成功</span><br><span class="line">search_input_verification.send_keys(&quot;913879&quot;)</span><br><span class="line">time.sleep(3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 获得校验验证码的按钮</span><br><span class="line">search_verification_btn = browser.find_element(By.XPATH, &#x27;//*[@id=&quot;passAuthSubmitCode&quot;]&#x27;)</span><br><span class="line"># 点击下一步</span><br><span class="line">search_verification_btn.click()</span><br><span class="line"></span><br><span class="line">time.sleep(3)</span><br><span class="line"># 可以用input标签不让程序自动关闭</span><br><span class="line"># input(&quot;阻止它关闭：&quot;)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/11.0Django%E6%A1%86%E6%9E%B6%E4%B9%8B%E5%88%86%E9%A1%B5%E5%99%A8%E6%8E%A8%E5%88%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/11.0Django%E6%A1%86%E6%9E%B6%E4%B9%8B%E5%88%86%E9%A1%B5%E5%99%A8%E6%8E%A8%E5%88%B0/" class="post-title-link" itemprop="url">11.0Django框架之分页器推到</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:15:49" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Django框架之分页器推到</h1>
<h2 id="【一】引入">【一】引入</h2>
<ul>
<li>前端展示的数据有时候会有很多</li>
<li>一页展示了很多数据，数据量很大，查找不方便</li>
</ul>
<p>解决办法</p>
<ul>
<li>做分页处理</li>
</ul>
<h2 id="【二】分页推到">【二】分页推到</h2>
<h3 id="【1】分析">【1】分析</h3>
<ul>
<li>get请求是可以携带参数的</li>
<li>由此我们可以在前端点击页数的时候，把这个页数一起发送给后端</li>
<li>queryset对象是支持索引取值和切片操作的
<ul>
<li>不支持负索引取值</li>
</ul>
</li>
</ul>
<h3 id="【2】代码分析">【2】代码分析</h3>
<ul>
<li>后端代码分析
<ul>
<li>在后端通过model.objects.all()得到所有数据的quertset对象</li>
<li>queryset对象可以进行切分，但是不支持反向切分</li>
</ul>
</li>
<li>前端展示数据
<ul>
<li>在前端需传入当前的页面</li>
<li>在后端根据指定的页面进行切分</li>
<li>在前端的url上声明当前的页码</li>
<li><code>http://127.0.0.1:8000/?page=1</code></li>
<li>后端的request.GET.get(‘page’)就可以拿到当前的页码</li>
</ul>
</li>
<li>在后端处理
<ul>
<li>我们需要</li>
<li>当前的页码curreny_page</li>
<li>每一页展示的数据量size</li>
<li>起始的页码 start_page</li>
<li>结束的页码 end_page</li>
<li>queryset对象[起始位置：结束位置]
<ul>
<li>列入<code> book_queryset = models.Book.objects.all()[start_page:end_page]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="【3】代码分析">【3】代码分析</h3>
<h4 id="1-页器组件参考bootstrap">(1)页器组件参考bootstrap</h4>
<ul>
<li>参考bootstrap官方文档，拷贝分页器代码进行优化</li>
</ul>
```html
<nav aria-label="Page navigation">
  <ul class="pagination">
    <li>
      <a href="#" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
    <li><a href="#">1</a></li>
    <li><a href="#">2</a></li>
    <li><a href="#">3</a></li>
    <li><a href="#">4</a></li>
    <li><a href="#">5</a></li>
    <li>
      <a href="#" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### (2)优化后的代码</span><br><span class="line"></span><br><span class="line">- 前端</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link href=&quot;https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&#123;% for user_obj in user_queryset %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; user_obj.username &#125;&#125; : &#123;&#123; user_obj.password &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&lt;nav aria-label=&quot;Page navigation&quot;&gt;</span><br><span class="line">    &lt;ul class=&quot;pagination&quot;&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">            &lt;a href=&quot;#&quot; aria-label=&quot;Previous&quot;&gt;</span><br><span class="line">                &lt;span aria-hidden=&quot;true&quot;&gt;&amp;laquo;&lt;/span&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &#123;# safe取消转义 - 将后端的html页面进行转义，转为前端页码/也可以后端做这件事  #&#125;</span><br><span class="line">        &#123;&#123; page_html|safe &#125;&#125;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">            &lt;a href=&quot;#&quot; aria-label=&quot;Next&quot;&gt;</span><br><span class="line">                &lt;span aria-hidden=&quot;true&quot;&gt;&amp;raquo;&lt;/span&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&lt;/nav&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>后端</li>
</ul>
```python
from django.shortcuts import render

from .models import UserInfo


def index(request):
    # 分页操作 推导

    # （1） 支持切片models.Book.objects.all()[1:20] --- 展示前20条数据
    # （2） 分页操作
    # user对象
    user_obj = UserInfo.objects.all()
    # 想访问的页数
    current_page = request.GET.get('page', 1)  # 如果获取不到当前页码就展示第一页
    # 异常捕获
    try:
        current_page = int(current_page)
    except Exception:
        current_page = 1
    # 每页展示多少条
    per_page_num = 10
    # 动态计算出需要的总页数
    all_count = user_obj.count()
    # divmod得到的是商和余数的元组
    page_count, more = divmod(all_count, per_page_num)
    # 要是有余数的话，页面也要加1
    if more:
        page_count += 1

    # 纠正左侧负数页的问题
    left_page_count = current_page
    if current_page < 6:
        current_page = 6
    page_html = ''
    # 前端动态页面展示 - 后端写好页面传给前端
    for count in range(current_page - 5, current_page + 6):
        if left_page_count == count:
            # 第一页高亮显示
            page_html += f'<li class="active"><a href="?page={count}" >{count}</a></li>'
        else:
            page_html += f'<li><a href="?page={count}" >{count}</a></li>'
    # 起始位置
    start_page = (current_page - 1) * per_page_num
    # 终止位置
    end_page = current_page * per_page_num
    # 切片
    user_queryset = user_obj[start_page:end_page]
    '''
    start_page = (current_page-1) * per_page_num
    end_page = current_page * per_page_num
    '''
    return render(request, 'index.html', locals())
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【4】分页器模板</span><br><span class="line"></span><br><span class="line">- 创建一个py文件，把下面的代码放进去</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">class Pagination(object):</span><br><span class="line">    def __init__(self, current_page, all_count, per_page_num=2, pager_count=11):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        封装分页相关数据</span><br><span class="line">        :param current_page: 当前页</span><br><span class="line">        :param all_count:    数据库中的数据总条数</span><br><span class="line">        :param per_page_num: 每页显示的数据条数</span><br><span class="line">        :param pager_count:  最多显示的页码个数</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        try:</span><br><span class="line">            current_page = int(current_page)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            current_page = 1</span><br><span class="line"> </span><br><span class="line">        if current_page &lt; 1:</span><br><span class="line">            current_page = 1</span><br><span class="line"> </span><br><span class="line">        self.current_page = current_page</span><br><span class="line"> </span><br><span class="line">        self.all_count = all_count</span><br><span class="line">        self.per_page_num = per_page_num</span><br><span class="line"> </span><br><span class="line">        # 总页码</span><br><span class="line">        all_pager, tmp = divmod(all_count, per_page_num)</span><br><span class="line">        if tmp:</span><br><span class="line">            all_pager += 1</span><br><span class="line">        self.all_pager = all_pager</span><br><span class="line"> </span><br><span class="line">        self.pager_count = pager_count</span><br><span class="line">        self.pager_count_half = int((pager_count - 1) / 2)</span><br><span class="line"> </span><br><span class="line">    @property</span><br><span class="line">    def start(self):</span><br><span class="line">        return (self.current_page - 1) * self.per_page_num</span><br><span class="line"> </span><br><span class="line">    @property</span><br><span class="line">    def end(self):</span><br><span class="line">        return self.current_page * self.per_page_num</span><br><span class="line"> </span><br><span class="line">    def page_html(self):</span><br><span class="line">        # 如果总页码 &lt; 11个：</span><br><span class="line">        if self.all_pager &lt;= self.pager_count:</span><br><span class="line">            pager_start = 1</span><br><span class="line">            pager_end = self.all_pager + 1</span><br><span class="line">        # 总页码  &gt; 11</span><br><span class="line">        else:</span><br><span class="line">            # 当前页如果&lt;=页面上最多显示11/2个页码</span><br><span class="line">            if self.current_page &lt;= self.pager_count_half:</span><br><span class="line">                pager_start = 1</span><br><span class="line">                pager_end = self.pager_count + 1</span><br><span class="line"> </span><br><span class="line">            # 当前页大于5</span><br><span class="line">            else:</span><br><span class="line">                # 页码翻到最后</span><br><span class="line">                if (self.current_page + self.pager_count_half) &gt; self.all_pager:</span><br><span class="line">                    pager_end = self.all_pager + 1</span><br><span class="line">                    pager_start = self.all_pager - self.pager_count + 1</span><br><span class="line">                else:</span><br><span class="line">                    pager_start = self.current_page - self.pager_count_half</span><br><span class="line">                    pager_end = self.current_page + self.pager_count_half + 1</span><br><span class="line"> </span><br><span class="line">        page_html_list = []</span><br><span class="line">        # 添加前面的nav和ul标签</span><br><span class="line">        page_html_list.append(&#x27;&#x27;&#x27;</span><br><span class="line">                    &lt;nav aria-label=&#x27;Page navigation&gt;&#x27;</span><br><span class="line">                    &lt;ul class=&#x27;pagination&#x27;&gt;</span><br><span class="line">                &#x27;&#x27;&#x27;)</span><br><span class="line">        first_page = &#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;首页&lt;/a&gt;&lt;/li&gt;&#x27; % (1)</span><br><span class="line">        page_html_list.append(first_page)</span><br><span class="line"> </span><br><span class="line">        if self.current_page &lt;= 1:</span><br><span class="line">            prev_page = &#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href=&quot;#&quot;&gt;上一页&lt;/a&gt;&lt;/li&gt;&#x27;</span><br><span class="line">        else:</span><br><span class="line">            prev_page = &#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;上一页&lt;/a&gt;&lt;/li&gt;&#x27; % (self.current_page - 1,)</span><br><span class="line"> </span><br><span class="line">        page_html_list.append(prev_page)</span><br><span class="line"> </span><br><span class="line">        for i in range(pager_start, pager_end):</span><br><span class="line">            if i == self.current_page:</span><br><span class="line">                temp = &#x27;&lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27; % (i, i,)</span><br><span class="line">            else:</span><br><span class="line">                temp = &#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27; % (i, i,)</span><br><span class="line">            page_html_list.append(temp)</span><br><span class="line"> </span><br><span class="line">        if self.current_page &gt;= self.all_pager:</span><br><span class="line">            next_page = &#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href=&quot;#&quot;&gt;下一页&lt;/a&gt;&lt;/li&gt;&#x27;</span><br><span class="line">        else:</span><br><span class="line">            next_page = &#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;下一页&lt;/a&gt;&lt;/li&gt;&#x27; % (self.current_page + 1,)</span><br><span class="line">        page_html_list.append(next_page)</span><br><span class="line"> </span><br><span class="line">        last_page = &#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;尾页&lt;/a&gt;&lt;/li&gt;&#x27; % (self.all_pager,)</span><br><span class="line">        page_html_list.append(last_page)</span><br><span class="line">        # 尾部添加标签</span><br><span class="line">        page_html_list.append(&#x27;&#x27;&#x27;</span><br><span class="line">                                           &lt;/nav&gt;</span><br><span class="line">                                           &lt;/ul&gt;</span><br><span class="line">                                       &#x27;&#x27;&#x27;)</span><br><span class="line">        return &#x27;&#x27;.join(page_html_list)</span><br></pre></td></tr></table></figure>

<ul>
<li>前端</li>
</ul>
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body>

<div class="container">
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            {% for user in page_queryset %}
            <p>{{ user.username }}</p>
            {% endfor %}
            {{ page_obj.page_html|safe }}
        </div>
    </div>
</div>

</body>
</html>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 后端</span><br><span class="line"></span><br><span class="line">  - 使用引入创建的py文件</span><br><span class="line"></span><br><span class="line">  - &#123;% raw %&#125;```python</span><br><span class="line">    from user.paginations import Pagination</span><br><span class="line">    ``````</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line">from user.paginations import Pagination</span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    # 拿到模型表里面的所有数据</span><br><span class="line">    user_list = UserInfo.objects.all()</span><br><span class="line">    # 从路径里面拿到页面,默认第一页</span><br><span class="line">    current_page = request.GET.get(&#x27;page&#x27;, 1)</span><br><span class="line">    # 拿到总页数</span><br><span class="line">    all_count = user_list.count()</span><br><span class="line">    # current_page 得到的页码数，all_count总页数，per_page_num每个页面只能展示多少条数据</span><br><span class="line">    page_obj = Pagination(current_page =current_page, all_count=all_count, per_page_num=10)</span><br><span class="line">    # 对象进行切分</span><br><span class="line">    page_queryset = user_list[page_obj.start:page_obj.end]</span><br><span class="line">    return render(request, &#x27;index.html&#x27;, locals())</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【5】总结</span><br><span class="line"></span><br><span class="line">- 创建一个py文件</span><br><span class="line"></span><br><span class="line">- 将分页器源码放进去</span><br><span class="line"></span><br><span class="line">- 在视图函数中使用</span><br><span class="line"></span><br><span class="line">  - 再导入分页器类</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line">      from user.paginations import Pagination</span><br><span class="line">      &#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line">  - 查询模型表所有数据</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line">      user_list = UserInfo.objects.all()</span><br><span class="line">      &#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line">  - 获取当前页面</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line">      current_page = request.GET.get(&quot;page&quot;, 1)</span><br><span class="line">      &#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line">  - 创建分页器对象</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line">      all_count = user_list.count()</span><br><span class="line">      &#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line">    - ````</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line">      page_obj = Pagination(current_page=current_page, all_count=all_count, per_page_num=10)</span><br><span class="line">      &#123;% raw %&#125;````</span><br><span class="line"></span><br><span class="line">  - 对原始数据进行切片</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line">      page_queryset = user_list[page_obj.start:page_obj.end]</span><br><span class="line">      &#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line">  - 返回前端进行渲染</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line">      return render(request,&#x27;index.html&#x27;, locals())</span><br><span class="line">      &#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line">- 前端使用</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line">html</span><br><span class="line">    &#123;# 遍历 切好的page_queryset进行渲染#&#125;</span><br><span class="line">    &#123;% raw %&#125;``````python</span><br><span class="line">&#123;% for user in page_queryset %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; user.username &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>添加分页器
<ul>
<li>在下面添加分页器</li>
</ul>
</li>
</ul>
```python
{{ page_obj.page_html|safe }}
```


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/14.0Django%E6%A1%86%E6%9E%B6%E4%B9%8BCookie%E5%92%8CSession.m/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/14.0Django%E6%A1%86%E6%9E%B6%E4%B9%8BCookie%E5%92%8CSession.m/" class="post-title-link" itemprop="url">14.0Django框架之Cookie和Session.m</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:15:49" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Django框架之Cookie和Session</h1>
<h2 id="【一】Cookie和Session的发展史">【一】Cookie和Session的发展史</h2>
<h3 id="【1】Cookie">【1】Cookie</h3>
<p>1994年，网景通信公司推出了第一个浏览器Cookie技术</p>
<ul>
<li>Cookie是储存在用户计算机上的小型文本文件，用于跟踪在网站上的活动</li>
<li>初始版的Cookie只能存储很少的数据，并且没有很强的加密机制，容易被人恶意修改和窃取</li>
</ul>
<h3 id="【2】Session">【2】Session</h3>
<p>1997年，Sun Microsystems提出了基于服务器的会话管理方案，即Session</p>
<ul>
<li>Cookie存在的局限性，Web开发人员开始寻找更安全、可靠的替代方案</li>
<li>Session是服务器存储用户会话数据的一种技术</li>
<li>每当访问数据时，服务器会为其创建一个唯一的Session标识符（Session ID），并将会话数据存储在服务器上</li>
<li>Session ID一般通过Cookie或URL参数传递给客户端，用于识别用户的会话状态</li>
</ul>
<h3 id="【3】Coookie和Session两者之间的关系">【3】Coookie和Session两者之间的关系</h3>
<ul>
<li>
<p>在实际应用中，Cookie和Session通常结合使用。当用户首次访问网站时，服务器会为其分配一个唯一的Session ID，并将其存储在Cookie中，发送给客户端保存</p>
</li>
<li>
<p>随后，客户端在每次请求中都会携带该Cookie，服务器通过解析Cookie中的Session ID，读取对应的会话数据，实现用户状态的跟踪和管理</p>
</li>
</ul>
<h3 id="【4】总结">【4】总结</h3>
<ul>
<li>Cookie和Session是Web应用程序中常用的用户会话跟踪技术。</li>
<li>Cookie通过在客户端存储小型文本文件，并将会话标识符传递给服务器，实现会话状态的保持。</li>
<li>而Session则是在服务器端存储会话数据，通过Session ID实现对用户会话的追踪。</li>
<li>它们的发展历程与互联网的发展紧密相关，为开发人员提供了更多的选择，以保障安全性和用户体验的提升</li>
</ul>
<h2 id="【二】Cookie和Session的介绍">【二】Cookie和Session的介绍</h2>
<h3 id="【1】Cookie-2">【1】Cookie</h3>
<ul>
<li>服务端保存在客户端浏览器上的信息都可以称之为Cookie</li>
<li>指代服务端让客户端保存的数据(存储在客户端上与用户信息相关的数据)</li>
<li>表现格式一般为k:v键值对，可以有多个</li>
</ul>
<h3 id="【2】Session-2">【2】Session</h3>
<ul>
<li>
<p>保存在服务端上的数据都可以叫做Session</p>
</li>
<li>
<p>指代服务端保存的跟用户信息相关的数据</p>
</li>
<li>
<p>表现格式一般为k:v键值对，可以有多个</p>
</li>
</ul>
<h3 id="【3】token">【3】token</h3>
<ul>
<li>
<p>session虽然数据是保存在服务端的，但是挡不住数据量大</p>
</li>
<li>
<p>解决办法：服务端不再保存数据</p>
</li>
<li>
<ul>
<li>登陆成功之后，将一段信息加密处理(用自己独特的加密方式进行加密)</li>
</ul>
</li>
<li>
<p>将加密之后的结果拼接在信息后面，整体返回给浏览器保存</p>
</li>
<li>
<p>浏览器下次访问的时候带着该信息，服务端自动切取前面的一段信息再次使用自己的加密算法进行加密</p>
</li>
<li>
<p>然后用这段密文与携带过来的密文进行比对</p>
</li>
</ul>
<h3 id="【4】总结-2">【4】总结</h3>
<ul>
<li>cookie就是保存在客户端浏览器上的信息</li>
<li>session就是保存在服务端的数据库中的</li>
<li>session是基于cookie工作的(其实大部分的保存用户状态的操作都需要使用cookie)</li>
</ul>
<h2 id="【三】Django操作Cookie">【三】Django操作Cookie</h2>
<h3 id="【1】操作Cookie返回的三板斧对象有所改变">【1】操作Cookie返回的三板斧对象有所改变</h3>
<ul>
<li>返回的三板斧数据要被赋值返回</li>
<li>操作Cookie就要</li>
</ul>
```python
obj1 = render()
return obj1

obj2 = HttpResponse()
return obj2

obj3 = redirect()
return obj3
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】设置Cookie</span><br><span class="line"></span><br><span class="line">#### （1）案例：用户登入以后才可以进入浏览器页面</span><br><span class="line"></span><br><span class="line">- 设置Cookie</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 设置coookie</span><br><span class="line">def login(request):</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        username = request.POST.get(&quot;username&quot;)</span><br><span class="line">        password = request.POST.get(&quot;password&quot;)</span><br><span class="line">        # 我们把值设置死的</span><br><span class="line">        if username != &quot;tom&quot; or password != &quot;710&quot;:</span><br><span class="line">            # 不对的话再次返回登入页面</span><br><span class="line">            return redirect(reverse(&#x27;home&#x27;))</span><br><span class="line">        # 如果登入成功，保存登入的Cookie状态</span><br><span class="line">        # 创建三板斧对象并赋值</span><br><span class="line">        login_obj = redirect(reverse(&#x27;home&#x27;))</span><br><span class="line">        # print(login_obj)</span><br><span class="line">        # 设置Cookie信息</span><br><span class="line">        # 里面的参数是k:v</span><br><span class="line">        # login_obj.set_cookie(&#x27;sign&#x27;, &#x27;555&#x27;)</span><br><span class="line">        print(login_obj.set_cookie(&#x27;sign&#x27;, &#x27;555&#x27;))</span><br><span class="line">        # 最后记得返回的是你将三板斧赋值的对象</span><br><span class="line">        return login_obj</span><br><span class="line">    obj = render(request, &#x27;login.html&#x27;, locals())</span><br><span class="line">    return obj</span><br></pre></td></tr></table></figure>

<ul>
<li>获取Cookie
<ul>
<li>能获得Cookie的信息，代表已经登入</li>
</ul>
</li>
</ul>
```python
# 获取cookie
def index(request):
    cookie = request.COOKIES.get('sign')
    if cookie == '555':
        return render(request, 'index.html', locals())
    else:
        return redirect(reverse('home'))
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 删除Cookie</span><br><span class="line">  - 电=点击退出按钮，进入到清除cookie的函数里，清除cookie信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 删除cookie</span><br><span class="line"># 清除电脑上刚签发的Cookie</span><br><span class="line">def logout(request):</span><br><span class="line">    # 退出之后</span><br><span class="line">    obj = redirect(reverse(&#x27;home&#x27;))</span><br><span class="line">    # 删除Cookie,把你定义的cookie信息删除</span><br><span class="line">    obj.delete_cookie(&#x27;sign&#x27;)</span><br><span class="line">    return obj</span><br></pre></td></tr></table></figure>

<ul>
<li>进入的主页面</li>
</ul>
```python
def home(request):
    return render(request, 'home.html', locals())
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 前端页面</span><br><span class="line">- 主页面home.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;a href=&quot;&#123;% url &#x27;login&#x27; %&#125;&quot;&gt;点击登入&lt;/a&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;a href=&quot;&#123;% url &#x27;index&#x27; %&#125;&quot;&gt;登入之后进入首页&lt;/a&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;a href=&quot;&#123;% url &#x27;logout&#x27; %&#125;&quot;&gt;点击退出登入&lt;/a&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>首页index.html</li>
</ul>
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<h1>这是首页index</h1>

</body>
</html>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 登入页面login.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;p&gt;username:&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;password:&lt;input type=&quot;text&quot; name=&quot;password&quot;&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;input type=&quot;submit&quot;&gt;&lt;/p&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="http://xn--urls-u65j293j.py">路由urls.py</a></li>
</ul>
```python
from django.contrib import admin
from django.urls import path
from user.views import index, login, home, logout

urlpatterns = [
    path('admin/', admin.site.urls),
    path('login/', login, name='login'),
    path('logout/', logout, name='logout'),
    path('index/', index, name='index'),
    path('', home, name='home')
]
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【3】Cookie的方法介绍</span><br><span class="line"></span><br><span class="line">#### （1）key:设置Cookie的键</span><br><span class="line"></span><br><span class="line">- sign就是键</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">login_obj.set_cookie(&#x27;sign&#x27;, &#x27;555&#x27;)</span><br></pre></td></tr></table></figure>

<h4 id="2-value：设置Cookie的值">(2)value：设置Cookie的值</h4>
<ul>
<li>555就是值</li>
</ul>
```python
login_obj.set_cookie('sign', '555')
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （3）max_age：Cookie设置的键值多久时间过期</span><br><span class="line"></span><br><span class="line">- max_age=5：5秒后过期，5秒后重新登入</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">login_obj.set_cookie(&#x27;sign&#x27;, &#x27;555&#x27;, max_age=5)</span><br></pre></td></tr></table></figure>

<h4 id="（4）expires：也是过期时间">（4）expires：也是过期时间</h4>
<ul>
<li>针对于IE浏览器</li>
<li>以秒为单位</li>
</ul>
<h4 id="（5）domain：域名">（5）domain：域名</h4>
<h4 id="（6）path：路径">（6）path：路径</h4>
<h4 id="（7）secure：安全组策略">（7）secure：安全组策略</h4>
<h4 id="（8）httponly：只限制于-HTTP-请求">（8）httponly：只限制于 HTTP 请求</h4>
<h3 id="【3】增加装饰器">【3】增加装饰器</h3>
```python
def login(request):
    if request.method == 'POST':
        username = request.POST.get("username")
        password = request.POST.get("password")
        # 我们把值设置死的
        if username != "tom" or password != "710":
            # 不对的话再次返回登入页面
            return redirect(reverse('home'))
        # 如果登入成功，保存登入的Cookie状态
        # 创建三板斧对象并赋值
        login_obj = redirect(reverse('home'))
        # print(login_obj)
        # 设置Cookie信息
        # 里面的参数是k:v
        # login_obj.set_cookie('sign', '555')
        print(login_obj.set_cookie('sign', '555'))
        # 最后记得返回的是你将三板斧赋值的对象
        return login_obj
    obj = render(request, 'login.html', locals())
    return obj


def outer(func):
    def inner(request, *args, **kwargs):
        # 校验是否已经的登入过
        # tag_url = request.get_full_path()
        print(request)  # <WSGIRequest: GET '/index/'>
        print(func)  # <function index at 0x000002359ACA7910>
        # print(f'outer装饰器----》{tag_url}')
        # outer装饰器----》/index/
        if request.COOKIES.get('sign') == '555':
            res = func(request, *args, **kwargs)
            return res
        else:
            return redirect(reverse('home'))

    return inner


# 获取cookie
@outer
def index(request):
    obj = render(request, 'index.html', locals())
    return obj
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【四】Django操作Session</span><br><span class="line"></span><br><span class="line">- session数据是保存在服务端的，就是保存到数据库中，给客户端返回的是一个随机字符串</span><br><span class="line"></span><br><span class="line">- sessionid：随机字符串</span><br><span class="line">- **首先，操作Session的前提是要迁移数据库**</span><br><span class="line"></span><br><span class="line">### 【1】设置Session，案例</span><br><span class="line"></span><br><span class="line">#### (1)案例：用户登入以后才可以进入浏览器页面</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.shortcuts import render, redirect, reverse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def home(request):</span><br><span class="line">    return render(request, &#x27;home.html&#x27;, locals())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 设置coookie</span><br><span class="line">def login(request):</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        username = request.POST.get(&quot;username&quot;)</span><br><span class="line">        password = request.POST.get(&quot;password&quot;)</span><br><span class="line">        # 我们把值设置死的</span><br><span class="line">        if username != &quot;tom&quot; or password != &quot;710&quot;:</span><br><span class="line">            # 不对的话再次返回登入页面</span><br><span class="line">            return redirect(reverse(&#x27;home&#x27;))</span><br><span class="line">        # 登入成功---》储存登入的状态</span><br><span class="line">        request.session[&#x27;sign&#x27;] = &#x27;555&#x27;</span><br><span class="line">        return redirect(reverse(&#x27;home&#x27;))</span><br><span class="line">    return render(request, &#x27;login.html&#x27;, locals())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    session = request.session.get(&#x27;sign&#x27;)</span><br><span class="line">    print(session)  # 555</span><br><span class="line">    if session == &#x27;555&#x27;:</span><br><span class="line">        return render(request, &#x27;index.html&#x27;, locals())</span><br><span class="line">    else:</span><br><span class="line">        return redirect(reverse(&#x27;home&#x27;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 删除cookie</span><br><span class="line"># 清除电脑上刚签发的Cookie</span><br><span class="line">def logout(request):</span><br><span class="line">    # 完全退出浏览器--清除掉你刚才签发的session</span><br><span class="line">    # Django会帮助你自动将 Django-session表中的 sessionid 对应的数据删除掉</span><br><span class="line">    # 但是浏览器还会就看到 session 串 但是那个串没有用</span><br><span class="line">    request.session.delete()</span><br><span class="line"></span><br><span class="line">    # 实现服务端和客户端都删除</span><br><span class="line">    request.session.flush()</span><br><span class="line">    return render(request, &#x27;home.html&#x27;, locals())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="【2】session的方法介绍">【2】session的方法介绍</h3>
<h4 id="（1）request-session-sign-555">（1）<code>request.session['sign'] = '555'</code></h4>
<ul>
<li>储存数据的状态</li>
<li>并且数据库的session会多一条数据，保存的数据是一串</li>
</ul>
<h4 id="（2）session-request-session-get-sign">（2）<code>session = request.session.get('sign')</code></h4>
<ul>
<li>获取到你签发的值</li>
</ul>
<h4 id="（3）request-session-delete">（3）<code>request.session.delete()</code></h4>
<ul>
<li>
<p>完全退出浏览器–清除掉你刚才签发的session</p>
</li>
<li>
<p>删除签发数据，并将数据库里面的数据一并删除</p>
</li>
</ul>
<h4 id="（4）request-session-flush">（4）<code>request.session.flush()</code></h4>
<ul>
<li>
<p>服务端和客户端都删除</p>
</li>
<li>
<p>该方法用于完全删除当前用户的Session，包括Session对象和所有相关数据</p>
</li>
</ul>
<h4 id="（5）request-session-set-expiry-value">（5）<code>request.session.set_expiry(value)</code></h4>
<ul>
<li>
<p>设置过期时间</p>
</li>
<li>
<p>如果value是个整数，session会在些秒数后失效</p>
</li>
<li>
<p>如果value是个datatime或timedelta，session就会在这个时间后失效</p>
</li>
<li>
<p>如果value是0,用户关闭浏览器session就会失效</p>
</li>
<li>
<p>如果value是None,session会依赖全局session失效策略</p>
</li>
<li>
<p>参数</p>
</li>
<li>
<ul>
<li>整数</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>多少秒过期</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>日期对象</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>到指定日期失效</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>0</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>一旦退出当前浏览器窗口就失效</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>不写</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>失效时间取决于Django内部全局session失效的时间</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Django默认的session失效时间是14天</p>
<h3 id="【session的装饰器】">【session的装饰器】</h3>
```python
from django.shortcuts import render, redirect, reverse


# Create your views here.
def home(request):
    return render(request, "home.html", locals())


def login_cookie(request):
    if request.method == "POST":
        username = request.POST.get("username")
        password = request.POST.get("password")
        if username == "admin" and password == "123456":
            # 【1】获取三板斧对象
            response = redirect(reverse("home"))
            # 【2】向三板斧对象中设置 Cookie
            # max_age : 过期时间 s
            response.set_cookie("sign", f"666")
            # 【3】将三板斧对象返回
            return response
    return render(request, "login_cookie.html", locals())


def login_session(request):
    if request.method == "POST":
        username = request.POST.get("username")
        password = request.POST.get("password")
        if username == "admin" and password == "123456":
            # 使用session的前提是先要迁移数据库 ---> django-session ---> 存session
            # 【1】设置 session
            request.session["sign"] = f"666"
            # 【2】重定向到首页
            return redirect(reverse("home"))
    return render(request, "login_session.html", locals())


def logout_cookie(request):
    # 删除cookie删除cookie
    response = redirect(reverse("home"))
    response.delete_cookie("sign")
    return response


def logout_session(request):
    # 删除session
    request.session.delete()  # 只能清除掉 数据库中的session 清除不掉前端的 session
    # 删除客户端和服务端的session
    request.session.flush()
    return redirect(reverse("home"))


# 做一个 Cookie的登录认证装饰器
def decorator_login(tag):
    if tag == "cookie":
        def outer(func):
            def inner(request, *args, **kwargs):
                cookie_data = request.COOKIES.get("sign")
                if cookie_data == "666":
                    response = func(request, *args, **kwargs)
                else:
                    response = redirect(reverse("home"))
                return response

            return inner

        return outer
    elif tag == "session":
        def outer(func):
            def inner(request, *args, **kwargs):
                session_data = request.session.get("sign")
                if session_data == "666":
                    response = func(request, *args, **kwargs)
                else:
                    response = redirect(reverse("home"))
                return response

            return inner

        return outer


@decorator_login(tag="cookie")
def index_cookie(request):
    return render(request, "index_cookie.html", locals())


@decorator_login(tag="session")
def index_session(request):
    return render(request, "index_session.html", locals())
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【源码解析】</span><br><span class="line"></span><br><span class="line">- *request*.session[&#x27;sign&#x27;] = &quot;555&quot;内部发生了哪些事</span><br><span class="line">  - Django内部会帮我们自动生成一个随机字符串</span><br><span class="line">  - Django内部会将随机字符串和对应的数据存储到django_sessoin表中</span><br><span class="line">  - - - 先在内存中产生操作数据的内存</span><br><span class="line">      - 在响应经过Django中间件的时候才去操作数据数据库</span><br><span class="line"></span><br><span class="line">- 将产生的随机字符串返回给和客户端浏览器保存</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>
<p>request.session.get(“sign”)内部发生了哪些事</p>
</li>
<li>
<ul>
<li>自动从浏览器请求中获取 sessionid 对应的随机字符串</li>
<li>根据该随机字符串去django_session表中查找对应的数据</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>如果匹配成功，则将对应的数据取出并以字典的形式封装到request.session中</li>
<li>如果匹配不成功，则request.session中的数据为None</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="【注意】">【注意】</h2>
<ul>
<li>
<p>使用session之前一定先迁移数据库</p>
<ul>
<li>因为使用session,Django会讲数据自动保存到数据库的django_sessoin表中</li>
</ul>
</li>
<li>
<p>设置多个同名的session</p>
<ul>
<li>
<p>使用的是最后一个session</p>
</li>
<li>
<p>得到的也是最后一个</p>
</li>
<li>
```python
    # 设置很多同名的 session ---> 拿到哪一个session
            # 拿到的是最后的一个 session值
             request.session["sign"] = "888"
             request.session["sign"] = "999"
    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  - 设置不同名的多个 session  ---&gt; 拿到哪一个session</span><br><span class="line"></span><br><span class="line">    &#123;% raw %&#125;```python</span><br><span class="line">        # 获取指定键的时候能够获取到指定的值</span><br><span class="line">         request.session[&quot;sign_one&quot;] = &quot;888&quot;</span><br><span class="line">         request.session[&quot;sign_two&quot;] = &quot;999&quot;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
<li>
<p>使用cookie：</p>
<ul>
<li>return 出去的一定不能是三板斧，讲三板斧赋值返回出去</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/15.0Django%E6%A1%86%E6%9E%B6%E4%B9%8BCBV%E6%B7%BB%E5%8A%A0%E8%A3%85%E9%A5%B0%E5%99%A8%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/15.0Django%E6%A1%86%E6%9E%B6%E4%B9%8BCBV%E6%B7%BB%E5%8A%A0%E8%A3%85%E9%A5%B0%E5%99%A8%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="post-title-link" itemprop="url">15.0Django框架之CBV添加装饰器的三种方式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:15:49" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Django框架之CBV添加装饰器的三种方式</h1>
<h2 id="【一】引入一个第三方模块">【一】引入一个第三方模块</h2>
<ul>
<li>给类定义需要引入一个第三方模块</li>
</ul>
```python
from django.utils.decorators import method_decorator
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【二】三种添加装饰器的方式</span><br><span class="line"></span><br><span class="line">### 【1】方式一：给类里面的指定的函数加</span><br><span class="line"></span><br><span class="line">- 视图文件</span><br><span class="line">- 给登入类里面的POST函数增加装饰器</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.shortcuts import render, redirect, reverse</span><br><span class="line">from django.utils.decorators import method_decorator</span><br><span class="line">from django.views import View</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    return render(request, &#x27;index.html&#x27;, locals())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def login_one(func):</span><br><span class="line">    def inner(request, *args, **kwargs):</span><br><span class="line">        if request.method == &quot;POST&quot;:</span><br><span class="line">            username = request.POST.get(&quot;username&quot;)</span><br><span class="line">            password = request.POST.get(&quot;password&quot;)</span><br><span class="line">            if username != &quot;tom&quot; or password != &quot;666&quot;:</span><br><span class="line">                return redirect(reverse(&#x27;home&#x27;))</span><br><span class="line">            else:</span><br><span class="line">                return func(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    return inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class LoginInfo(View):</span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        return render(request, &#x27;login.html&#x27;, locals())</span><br><span class="line"></span><br><span class="line">    @method_decorator(login_one)</span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return redirect(reverse(&#x27;index&#x27;))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>前端</li>
<li>login.html</li>
<li>登入首页，用户名和密码错误原地跳转</li>
<li>用户名密码正确，跳转到index.html</li>
</ul>
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<form action="" method="post">
    <p>username:<input type="text" name="username"></p>
    <p>password:<input type="text" name="password"></p>
    <p><input type="submit"></p>
</form>

</body>
</html>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- index.html</span><br><span class="line">- 登入以后成功自动跳转到的页面</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;这是首页index&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="http://urls.py">urls.py</a></li>
<li>配置路径</li>
</ul>
```python
from django.contrib import admin
from django.urls import path
from user.views import LoginInfo, index

urlpatterns = [
    path('admin/', admin.site.urls),
    path('index/', index, name='index'),
    path("", LoginInfo.as_view(), name='login_info')
]
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】方式二：把装饰器放在类上面</span><br><span class="line"></span><br><span class="line">- 就是在装饰器的头上加一个装饰器</span><br><span class="line">- 参数介绍</span><br><span class="line">  - 第一个参数是：装饰器的，名字</span><br><span class="line">  - 第二个参数是：类自己本身的函数的名字</span><br><span class="line">    - 写那个函数名就是给那个函数添加装饰器</span><br><span class="line">    - 实现的结果和方法一一样</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">@method_decorator(login_one, name=&#x27;post&#x27;)</span><br><span class="line">class LoginInfo(View):</span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        return render(request, &#x27;login.html&#x27;, locals())</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return redirect(reverse(&#x27;index&#x27;))</span><br></pre></td></tr></table></figure>

<h3 id="【3】方法三：重写dispatch方法">【3】方法三：重写dispatch方法</h3>
<ul>
<li>在类中定义dispatch方法（直接cv）
<ul>
<li>dispatch方法在哪<code>（类视图 ---&gt; as_view() ---&gt; 里面的 view() ---&gt; self.dispatch()）</code></li>
</ul>
</li>
</ul>
```python
    # 每个类视图函数都会走的函数，相当于给所有人都加了装饰器
    @method_decorator(login_one)
    def dispatch(self, request, *args, **kwargs):
        # Try to dispatch to the right method; if a method doesn't exist,
        # defer to the error handler. Also defer to the error handler if the
        # request method isn't on the approved list.
        if request.method.lower() in self.http_method_names:
            handler = getattr(self, request.method.lower(), self.http_method_not_allowed)
        else:
            handler = self.http_method_not_allowed
        return handler(request, *args, **kwargs)
```


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/10.0Django%E6%A1%86%E6%9E%B6%E4%B9%8B%E6%A8%A1%E5%9E%8B%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/10.0Django%E6%A1%86%E6%9E%B6%E4%B9%8B%E6%A8%A1%E5%9E%8B%E5%B1%82/" class="post-title-link" itemprop="url">10.0Django框架之模型层</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:15:49" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Django框架之模型层</h1>
<h2 id="【一】模型层引入（测试环境搭建）">【一】模型层引入（测试环境搭建）</h2>
<ul>
<li>Django的orm框架必须是在Django的启动状态下才能使用</li>
<li>Django为我们提供了测试环境</li>
<li>这个测试环境只是临时启动而不是持久化活动</li>
</ul>
<p>创建测试环境</p>
```python
import os

if __name__ == '__main__':
    # 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'Django_two.settings')
    # 导入模块
    import django
    # 启动方式只是临时启动，不是持久化
    django.setup()
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【二】Django的ORM的单表操作</span><br><span class="line"></span><br><span class="line">### 【1】数据库配置</span><br><span class="line"></span><br><span class="line">- 在setting.py文件中配置</span><br><span class="line">  - 将原来django自带的删掉</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    &#x27;default&#x27;: &#123;</span><br><span class="line">        &#x27;ENGINE&#x27;: &#x27;django.db.backends.mysql&#x27;,</span><br><span class="line">        # 手动创建一个新的数据库</span><br><span class="line">        &#x27;NAME&#x27;: &quot;django_two&quot;,</span><br><span class="line">        &quot;USER&quot;: &quot;root&quot;,</span><br><span class="line">        &quot;PASSWORD&quot;: &quot;1234567&quot;,</span><br><span class="line">        &quot;HOST&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">        &quot;PORT&quot;: 3306,</span><br><span class="line">        &quot;CHARSET&quot;: &quot;utf8mb4&quot;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>启动项目可能会报错</li>
<li>原因是没有下载mysqlclient</li>
</ul>
<p>解决方法一</p>
<ul>
<li>
<p>打猴子补丁</p>
</li>
<li>
<p>随便找一个文件，一般都会选择<code>__init__.py</code>文件</p>
</li>
<li>
<p>把下面的数据复制进去即可</p>
</li>
</ul>
```python
import pymysql

pymysql.install_as_MySQLdb()
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方法二</span><br><span class="line"></span><br><span class="line">- 下载mysqlclient</span><br><span class="line"></span><br><span class="line">### 【2】在APP下的models.py文件中定义模型表</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserInfo(models.Model):</span><br><span class="line">    # 名字</span><br><span class="line">    name = models.CharField(max_length=32, verbose_name=&quot;名字&quot;)</span><br><span class="line">    # 年龄</span><br><span class="line">    age = models.IntegerField(verbose_name=&quot;年龄&quot;)</span><br><span class="line">    # 显示注册时间</span><br><span class="line">    # auto_now_add=True</span><br><span class="line">    # Django会在对象第一次被创建时自动设置该字段的值为当前的日期和时间。之后，无论对象如何被保存或修改，这个字段的值都不会再自动更新</span><br><span class="line">    # DateTimeField类型</span><br><span class="line">    # 用于在数据库中存储日期和时间</span><br><span class="line">    register_time = models.DateTimeField(auto_now_add=True,</span><br><span class="line">                                         verbose_name=&quot;注册时间&quot;)</span><br><span class="line">    # auto_now：在创建数据库的时候会自动新增时间，每次修改都会刷新</span><br><span class="line">    update_time = models.DateTimeField(auto_now=True,</span><br><span class="line">                                       verbose_name=&quot;更新时间&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>
<p>迁移数据库</p>
<ul>
<li>执行两句话</li>
</ul>
```shell
  python manage.py makemigrations
  
  python manage.py migrate
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  - 执行完后就迁移成功了</span><br><span class="line"></span><br><span class="line">  ![image-20240625202154249](D:\pycharm\Temporary_notes\图片\image-20240625202154249.png)</span><br><span class="line"></span><br><span class="line">### 【3】对数据库的增删改查（必会N条）</span><br><span class="line"></span><br><span class="line">- 在你的测试环境下面写</span><br><span class="line"></span><br><span class="line">#### （1）增</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    # 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制</span><br><span class="line">    os.environ.setdefault(&#x27;DJANGO_SETTINGS_MODULE&#x27;, &#x27;Django_two.settings&#x27;)</span><br><span class="line">    # 导入模块</span><br><span class="line">    import django</span><br><span class="line"></span><br><span class="line">    # 启动方式只是临时启动，不是持久化</span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    from user.models import UserInfo</span><br><span class="line"></span><br><span class="line">    # 记住在django中pk就是mysql中的id</span><br><span class="line">    # 【1】对数据库增值</span><br><span class="line">    # 方式一 create()</span><br><span class="line">    # data = UserInfo.objects.create(name=&quot;jack&quot;, age=22)</span><br><span class="line">    # print(data) # UserInfo object (1)</span><br><span class="line">    # 方法二 先生成一个对象，然后在提交事务</span><br><span class="line">    # data = UserInfo(name=&quot;tom&quot;, age=710)</span><br><span class="line">    # print(data) # UserInfo object (None)</span><br><span class="line">    # 提交事务，不提交事务不会添加数据</span><br><span class="line">    # data.save()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="（2）删">（2）删</h4>
```python
 import os

if __name__ == '__main__':
    # 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'Django_two.settings')
    # 导入模块
    import django

    # 启动方式只是临时启动，不是持久化
    django.setup()

    from user.models import UserInfo

    # 记住在django中pk就是mysql中的id
    
    # 【4】删除数据
    # 方法一 获取到筛选的结果，然后对结果进行删除.delete()
    # 会把符合条件的全部删除
    # data = UserInfo.objects.filter(name="tom").delete()
    # print(data) # (2, {'user.UserInfo': 2})# 删除了两条数据
    # 方法二 直接删除对象
    # data = UserInfo.objects.get(name="dream").delete()
    # print(data)  # (1, {'user.UserInfo': 1}) #删除了一条数据
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （3）改</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    # 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制</span><br><span class="line">    os.environ.setdefault(&#x27;DJANGO_SETTINGS_MODULE&#x27;, &#x27;Django_two.settings&#x27;)</span><br><span class="line">    # 导入模块</span><br><span class="line">    import django</span><br><span class="line"></span><br><span class="line">    # 启动方式只是临时启动，不是持久化</span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    from user.models import UserInfo</span><br><span class="line"></span><br><span class="line">    # 记住在django中pk就是mysql中的id</span><br><span class="line"></span><br><span class="line"># 【3】对数据库修改数据</span><br><span class="line">    # 方法一 查完后直接修改</span><br><span class="line">    # data = UserInfo.objects.filter(name=&quot;jack&quot;).update(name=&quot;dream&quot;)</span><br><span class="line">    # print(data) # 2 # 代表修改了两条数据</span><br><span class="line">    # 方法二 先查对象，然后对象.属性名改值</span><br><span class="line">    # data = UserInfo.objects.get(pk=1)</span><br><span class="line">    # data.name = &quot;tom&quot;</span><br><span class="line">    # print(data)  # UserInfo object (1)</span><br><span class="line">    # # 一定要提交数据</span><br><span class="line">    # data.save()</span><br><span class="line">    # # 修改成功</span><br></pre></td></tr></table></figure>

<h4 id="（4）查">（4）查</h4>
```python
import os

if __name__ == '__main__':
    # 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'Django_two.settings')
    # 导入模块
    import django

    # 启动方式只是临时启动，不是持久化
    django.setup()

    from user.models import UserInfo

    # 记住在django中pk就是mysql中的id

# 【2】查询数据库里面的数据
    # 方式一 get和values取出所有符合条件的值，all取出所有的数据对象
    # data = UserInfo.objects.all()
    # # 得到的是所有数据的对象
    # print(data) # <QuerySet [<UserInfo: UserInfo object (1)>, <UserInfo: UserInfo object (2)>, <UserInfo: UserInfo object (3)>]>
    # data = UserInfo.objects.all().values("name")
    # # 取出所有人的名字
    # print(data)
    # # <QuerySet [{'name': 'jack'}, {'name': 'jack'}, {'name': 'tom'}]>
    # # 得到id为1的user对象
    # data = UserInfo.objects.get(pk=1)
    # print(data)
    # # UserInfo object (1)
    # # 得到数据
    # data = data.name
    # print(data)  # jack
    # 方法二 fileter过滤结果 结果是queryset对象
    # data = UserInfo.objects.filter(pk=1)
    # print(data)  # <QuerySet [<UserInfo: UserInfo object (1)>]>
    # 获得结果集的第一个结果
    # 因为就一个结果，都可以获得
    # data = data.first()
    # print(data) # UserInfo object (1)
    # 获得结果集的最后一个结果
    # 因为就一个结果，都可以获得
    # data = data.last()
    # print(data)  # UserInfo object (1)
    # 获得结果集中的所有符合条件的结果
    # data = UserInfo.objects.filter(name="jack")
    # print(data) # <QuerySet [<UserInfo: UserInfo object (1)>, <UserInfo: UserInfo object (2)>]>
    # data = data.all()
    # print(data) # <QuerySet [<UserInfo: UserInfo object (1)>, <UserInfo: UserInfo object (2)>]>
    # 获取结果集中的对应字段对应的数据,values得到的是字典
    # data = UserInfo.objects.filter(age=22).values("name", "age")
    # print(data)
    # <QuerySet [{'name': 'jack', 'age': 22}, {'name': 'jack', 'age': 22}]>
    # 获取结果集中的对应字段对应的数据,values_list得到的是字典
    # data = UserInfo.objects.filter(age=22).values_list("name", "age")
    # print(data) # <QuerySet [('jack', 22), ('jack', 22)]>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （5）其它方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    # 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制</span><br><span class="line">    os.environ.setdefault(&#x27;DJANGO_SETTINGS_MODULE&#x27;, &#x27;Django_two.settings&#x27;)</span><br><span class="line">    # 导入模块</span><br><span class="line">    import django</span><br><span class="line"></span><br><span class="line">    # 启动方式只是临时启动，不是持久化</span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    from user.models import UserInfo</span><br><span class="line"></span><br><span class="line">    # 记住在django中pk就是mysql中的id</span><br><span class="line"></span><br><span class="line"># 【5】去重</span><br><span class="line">	# 筛选数的第一条数据</span><br><span class="line">    # user = UserInfo.objects.values(&quot;age&quot;).distinct().first()</span><br><span class="line">    # print(user, type(user))</span><br><span class="line">    # &#123;&#x27;age&#x27;: 18&#125; &lt;class &#x27;dict&#x27;&gt;</span><br><span class="line"></span><br><span class="line">    # 【6】知道数据的结果量</span><br><span class="line">    # user = UserInfo.objects.count()</span><br><span class="line">    # print(user)</span><br><span class="line"></span><br><span class="line">    # 【7】排序</span><br><span class="line">    # 正序排 MySQL正序加 asc</span><br><span class="line">    # user = UserInfo.objects.order_by(&quot;age&quot;)</span><br><span class="line">    # print(user)</span><br><span class="line">    # 倒序排 MySQL倒序加 desc</span><br><span class="line">    # user = UserInfo.objects.order_by(&quot;-age&quot;)</span><br><span class="line">    # print(user)</span><br><span class="line">    # 将排序后的结果翻转</span><br><span class="line">    # user = UserInfo.objects.order_by(&quot;age&quot;).reverse()</span><br><span class="line">    # print(user)</span><br><span class="line">    # 在Django的ORM语句中只要不是确切的某个对象 就可以一直 . 触发其他方法</span><br><span class="line">    # user = UserInfo.objects.order_by(&quot;age&quot;).count()</span><br><span class="line">    # print(user)</span><br><span class="line"></span><br><span class="line">    # 【8】对某个条件以外的结果进行剔除</span><br><span class="line">    # 不会提出到你指定的这个年龄的结果</span><br><span class="line">    # user = UserInfo.objects.exclude(age=18)</span><br><span class="line">    # print(user)</span><br><span class="line"></span><br><span class="line">    # 【9】判断当前筛选到的结果是否存在</span><br><span class="line">    # user = UserInfo.objects.filter(name=&quot;dream_1&quot;).exists()</span><br><span class="line">    # print(user)</span><br><span class="line">``````</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line"># 【必知必会N条】</span><br><span class="line">	# model是models.py文件中定义模型表的类名，需要提前导入</span><br><span class="line">    # 【1】增加</span><br><span class="line">    # （1）model.objects.create(filed=value)</span><br><span class="line">    # （2）model(filed=value).save()</span><br><span class="line">    # 【2】删除</span><br><span class="line">    # （3）model.objects.filter(filed=value).delete()</span><br><span class="line">    # （4）model.objects.get(filed=value).delete()</span><br><span class="line">    # 【3】修改</span><br><span class="line">    # （5）model.objects.filter(filed=value).update(filed=new_value)</span><br><span class="line">    # （6）obj = model.objects.get(filed=value)</span><br><span class="line">    # obj.filed_name = value </span><br><span class="line">    # obj.save()</span><br><span class="line">    # 【4】查看</span><br><span class="line">    # (7) model.objects.filter(field=value)</span><br><span class="line">    # (8) model.objects.filter(field=value).first()</span><br><span class="line">    # (9) model.objects.filter(field=value).last()</span><br><span class="line">    # (10) model.objects.all() </span><br><span class="line">    # (11) model.objects.get(filed=value)</span><br><span class="line">    # 【5】扩展方法</span><br><span class="line">    # (12) model.objects.filter(field=value).count() 计数</span><br><span class="line">    # (13) model.objects.filter(field=value).values() 获取键值对结果</span><br><span class="line">    # (14) model.objects.filter(field=value).values_list() 获取值结果</span><br><span class="line">    # (15) model.objects.values(&quot;field&quot;).distinct() 对结果进行去重</span><br><span class="line">    # (16) model.objects.filter(field=value).order_by(&quot;-filed&quot;) 降序</span><br><span class="line">    # (17) model.objects.filter(field=value).order_by(&quot;filed&quot;) 升序</span><br><span class="line">    # (18) model.objects.filter(field=value).exists() 判断结果是否存在</span><br><span class="line">    # (19) model.objects.exclude(filed=value) 排除指定条件的数据</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 数据库信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>mysql<br>
4	jack	22	2024-06-25 13:02:38.766847	2024-06-25 13:02:38.766847<br>
5	jack	22	2024-06-25 13:02:43.551628	2024-06-25 13:02:43.551628<br>
6	tom	710	2024-06-25 13:03:09.526967	2024-06-25 13:03:09.526967<br>
7	tom	710	2024-06-25 13:03:11.030100	2024-06-25 13:03:11.030100</p>
```



![image-20240625213204352](D:\pycharm\Temporary_notes\图片\image-20240625213204352.png)

## 【三】神奇的双下划线查询



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    # 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制</span><br><span class="line">    os.environ.setdefault(&#x27;DJANGO_SETTINGS_MODULE&#x27;, &#x27;Django_two.settings&#x27;)</span><br><span class="line">    # 导入模块</span><br><span class="line">    import django</span><br><span class="line"></span><br><span class="line">    # 启动方式只是临时启动，不是持久化</span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    from user.models import UserInfo</span><br><span class="line"></span><br><span class="line">    # 神奇的双下划线</span><br><span class="line">    # 大于</span><br><span class="line">    # data = UserInfo.objects.filter(age__gt=22)</span><br><span class="line">    # # 两条数据符合</span><br><span class="line">    # print(data) # &lt;QuerySet [&lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 小于</span><br><span class="line">    # data = UserInfo.objects.filter(age__lt=22)</span><br><span class="line">    # # 没有符合条件的</span><br><span class="line">    # print(data) # &lt;QuerySet []&gt;</span><br><span class="line">    #</span><br><span class="line">    # # 大于等于</span><br><span class="line">    # data = UserInfo.objects.filter(age__gte=22)</span><br><span class="line">    # # 四条符合的数据</span><br><span class="line">    # print(data)</span><br><span class="line">    # &lt;QuerySet [&lt;UserInfo: UserInfo object (4)&gt;, &lt;UserInfo: UserInfo object (5)&gt;, &lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 小于等于</span><br><span class="line">    # data = UserInfo.objects.filter(age__lte=22)</span><br><span class="line">    # 两条条符合的数据</span><br><span class="line">    # print(data) # &lt;QuerySet [&lt;UserInfo: UserInfo object (4)&gt;, &lt;UserInfo: UserInfo object (5)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 或条件</span><br><span class="line">    # data = UserInfo.objects.filter(age__in=(18, 22))</span><br><span class="line">    # # 两条条符合的数据</span><br><span class="line">    # print(data) # &lt;QuerySet [&lt;UserInfo: UserInfo object (4)&gt;, &lt;UserInfo: UserInfo object (5)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 两个条件之间</span><br><span class="line">    # 也包含18，22</span><br><span class="line">    # data = UserInfo.objects.filter(age__range=(18, 22))</span><br><span class="line">    # #两条条符合的数据</span><br><span class="line">    # print(data)  # &lt;QuerySet [&lt;UserInfo: UserInfo object (4)&gt;, &lt;UserInfo: UserInfo object (5)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 模糊查询</span><br><span class="line">    # 查人名中带有 m 的人的名字</span><br><span class="line">    # 强约束 区分大小写</span><br><span class="line">    # data = UserInfo.objects.filter(name__contains=&quot;m&quot;)</span><br><span class="line">    # print(data)</span><br><span class="line">    # &lt;QuerySet [&lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 弱约束 不区分大小写</span><br><span class="line">    # data = UserInfo.objects.filter(name__icontains=&quot;M&quot;)</span><br><span class="line">    # print(data)</span><br><span class="line">    # &lt;QuerySet [&lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 以指定条件开头</span><br><span class="line">    # data = UserInfo.objects.filter(name__startswith=&quot;t&quot;)</span><br><span class="line">    # print(data)</span><br><span class="line">    # &lt;QuerySet [&lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 以指定条件结尾</span><br><span class="line">    # data = UserInfo.objects.filter(name__endswith=&quot;m&quot;)</span><br><span class="line">    # print(data)</span><br><span class="line">    # &lt;QuerySet [&lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 查询指定那一天</span><br><span class="line">    # data = UserInfo.objects.filter(register_time__day=&quot;20&quot;)</span><br><span class="line">    # print(data) # &lt;QuerySet []&gt;</span><br><span class="line"></span><br><span class="line">    #  查询指定那一年</span><br><span class="line">    # data = UserInfo.objects.filter(register_time__year=&quot;2024&quot;)</span><br><span class="line">    # print(data)</span><br><span class="line">    # &lt;QuerySet [&lt;UserInfo: UserInfo object (4)&gt;, &lt;UserInfo: UserInfo object (5)&gt;, &lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 查询指定那一月</span><br><span class="line">    data = UserInfo.objects.filter(register_time__month=&quot;5&quot;)</span><br><span class="line">    print(data) # &lt;QuerySet []&gt;</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 数据库信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>mysql<br>
4	jack	22	2024-06-25 13:02:38.766847	2024-06-25 13:02:38.766847<br>
5	jack	22	2024-06-25 13:02:43.551628	2024-06-25 13:02:43.551628<br>
6	tom	710	2024-06-25 13:03:09.526967	2024-06-25 13:03:09.526967<br>
7	tom	710	2024-06-25 13:03:11.030100	2024-06-25 13:03:11.030100</p>
```



![image-20240625213204352](D:\pycharm\Temporary_notes\图片\image-20240625213204352.png)

## 【四】创建多表关系

- 既然是多表查询，那就是不止一个表
- 在models.py文件中创建多个表
- 我们学过的表查询有
  - 一对一查询
  - 一对多查询
  - 多对多查询

### 【1】一对多的表

- ForeignKey方法创建一对多关系

创建图书表



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line"># 创建的是图书表</span><br><span class="line">class Book(models.Model):</span><br><span class="line">    # 标题</span><br><span class="line">    title = models.CharField(max_length=32)</span><br><span class="line">    # 价格</span><br><span class="line">    # max_digits：最多几位</span><br><span class="line">    # decimal_places：最多小数点后面几位</span><br><span class="line">    # DecimalField：小数类型</span><br><span class="line">    price = models.DecimalField(max_digits=8, decimal_places=2)</span><br><span class="line">    # 一对多关系，图书与出版社</span><br><span class="line">    publisher = models.ForeignKey(</span><br><span class="line">        # 目标建立关系的表</span><br><span class="line">        to=&quot;Publisher&quot;,</span><br><span class="line">        # 级联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建出版社表</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>python</p>
<h1>创建出版社表</h1>
<p>class Publisher(models.Model):<br>
# 名字<br>
name = models.CharField(max_length=32)<br>
# 地址<br>
addr = models.CharField(max_length=32)</p>
```



### 【2】一对一的表

- OneToOneField方法创建一对一关系

创建作者表



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line"># # 创建作者表</span><br><span class="line">class Author(models.Model):</span><br><span class="line">    # 名字</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    # 年龄</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line">    # 作者和作者详情表进行关联，一对一关系，一个作者只能有一个详情</span><br><span class="line">    # 一个详情对应一个作者</span><br><span class="line">    author_detail = models.OneToOneField(</span><br><span class="line">        # 目标建立关系的表,作者详情表</span><br><span class="line">        to=&quot;AuthorDetail&quot;,</span><br><span class="line">        # 联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建作者详情表</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>python</p>
<h1>创建作者详情表</h1>
<p>class AuthorDetail(models.Model):<br>
# 地址<br>
addr = models.CharField(max_length=32)<br>
# 电话<br>
phone = models.CharField(max_length=11)</p>
```



### 【3】多对多的表

- ManyToManyField方法创建多对多关系

- 需要第三张表存放两个表的关系

创建图书表



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line"># 创建的是图书表</span><br><span class="line">class Book(models.Model):</span><br><span class="line">    # 标题</span><br><span class="line">    title = models.CharField(max_length=32)</span><br><span class="line">    # 价格</span><br><span class="line">    # max_digits：最多几位</span><br><span class="line">    # decimal_places：最多小数点后面几位</span><br><span class="line">    # DecimalField：小数类型</span><br><span class="line">    price = models.DecimalField(max_digits=8, decimal_places=2)</span><br><span class="line"></span><br><span class="line">    # 一对多关系，图书与出版社</span><br><span class="line">    publisher = models.ForeignKey(</span><br><span class="line">        # 目标建立关系的表</span><br><span class="line">        to=&quot;Publisher&quot;,</span><br><span class="line">        # 级联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    # 多对多的关系</span><br><span class="line">    auther = models.ManyToManyField(</span><br><span class="line">        # 目标建立关系的表</span><br><span class="line">        to=&quot;Author&quot;,</span><br><span class="line">        # 级联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete = models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建作者表</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>python</p>
<h1>创建作者表</h1>
<p>class Author(models.Model):<br>
# 名字<br>
name = models.CharField(max_length=32)<br>
# 年龄<br>
age = models.IntegerField()<br>
# 作者和作者详情表进行关联，一对一关系，一个作者只能有一个详情<br>
# 一个详情对应一个作者<br>
author_detail = models.OneToOneField(<br>
# 目标建立关系的表,作者详情表<br>
to=“AuthorDetail”,<br>
# 联更新和级联删除，和并在一起了<br>
on_delete=models.CASCADE<br>
)<br>
# 与作者建立的第三张表<br>
book = models.ManyToManyField(<br>
# 跟那张表进行关联<br>
to=“Book”,<br>
# 联更新和级联删除，和并在一起了<br>
on_delete=models.CASCADE<br>
)</p>
```



创建图书和作者表关系表



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line"># 作者和书的关系表</span><br><span class="line">class BookToAuthor(models.Model):</span><br><span class="line">    # 字段关联作者表</span><br><span class="line">    author = models.ForeignKey(</span><br><span class="line">        # 关联作者的表</span><br><span class="line">        to=&quot;Author&quot;,</span><br><span class="line">        # 级联更新和级联删除</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line">    # 字段关联图书的表</span><br><span class="line">    book = models.ForeignKey(</span><br><span class="line">        # 关联图书的表</span><br><span class="line">        to=&quot;Book&quot;,</span><br><span class="line">        # 目标建立关系的表</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【4】多对多的表方法二</span><br><span class="line"></span><br><span class="line">- 直接在这两张表的其中一张上建立第三张表</span><br><span class="line"></span><br><span class="line">比如我们在Book上建立</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>python<br>
class Book(models.Model):<br>
# 标题<br>
title = models.CharField(max_length=32)<br>
# 价格<br>
# max_digits：最多几位<br>
# decimal_places：最多小数点后面几位<br>
# DecimalField：小数类型<br>
price = models.DecimalField(max_digits=8, decimal_places=2)<br>
# 一对多关系，图书与出版社<br>
publisher = models.ForeignKey(<br>
# 目标建立关系的表<br>
to=“Publisher”,<br>
# 级联更新和级联删除，和并在一起了<br>
on_delete=models.CASCADE<br>
)</p>
<pre><code># 多对多的关系
auther = models.ManyToManyField(
    to=&quot;Author&quot;
)
</code></pre>
``````python
  # 多对多的关系
    auther = models.ManyToManyField(
        to="Author"
    )
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- Django会自动创建第三张表</span><br><span class="line"></span><br><span class="line">### 【5】总的创建表代码</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line"># 创建出版社表</span><br><span class="line">class Publisher(models.Model):</span><br><span class="line">    # 名字</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    # 地址</span><br><span class="line">    addr = models.CharField(max_length=32)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建的是图书表</span><br><span class="line">class Book(models.Model):</span><br><span class="line">    # 标题</span><br><span class="line">    title = models.CharField(max_length=32)</span><br><span class="line">    # 价格</span><br><span class="line">    # max_digits：最多几位</span><br><span class="line">    # decimal_places：最多小数点后面几位</span><br><span class="line">    # DecimalField：小数类型</span><br><span class="line">    price = models.DecimalField(max_digits=8, decimal_places=2)</span><br><span class="line">    # 一对多关系，图书与出版社</span><br><span class="line">    publisher = models.ForeignKey(</span><br><span class="line">        # 目标建立关系的表</span><br><span class="line">        to=&quot;Publisher&quot;,</span><br><span class="line">        # 级联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    # 多对多的关系</span><br><span class="line">    auther = models.ManyToManyField(</span><br><span class="line">        to=&quot;Author&quot;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建作者详情表</span><br><span class="line">class AuthorDetail(models.Model):</span><br><span class="line">    # 地址</span><br><span class="line">    addr = models.CharField(max_length=32)</span><br><span class="line">    # 电话</span><br><span class="line">    phone = models.CharField(max_length=11)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># # 创建作者表</span><br><span class="line">class Author(models.Model):</span><br><span class="line">    # 名字</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    # 年龄</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line">    # 作者和作者详情表进行关联，一对一关系，一个作者只能有一个详情</span><br><span class="line">    # 一个详情对应一个作者</span><br><span class="line">    author_detail = models.OneToOneField(</span><br><span class="line">        # 目标建立关系的表,作者详情表</span><br><span class="line">        to=&quot;AuthorDetail&quot;,</span><br><span class="line">        # 联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"># 记得迁移数据库</span><br></pre></td></tr></table></figure>

<h2 id="【五】一对多的外键字段">【五】一对多的外键字段</h2>
<h3 id="【1】添加值">【1】添加值</h3>
<ul>
<li>create</li>
</ul>
```python
 # 【一】一对多表外键字段
    # 【1】添加数据  create
    #  Publish.objects.create(name="人民出版社", addr="北京")
    # Publish.objects.create(name="上海出版社", addr="上海")
    # Publish.objects.create(name="南京出版社", addr="南京")
    # Publish.objects.create(name="东京出版社", addr="东京")
    
    # 在创建图书数据的时候要进行出版社的关联
    # publish_obj = Publish.objects.get(pk=2)
    # 方式一 ： 直接在 字段 publish_id 值是指定出版社的id
    # Book.objects.create(title="西游记", price="99",publish_id=publish_obj.id)
    # 方式二 ： 在模型表中定义的字段是叫 publish 所以 直接将对象扔进去
    # Book.objects.create(title="红楼梦", price="88", publish=publish_obj)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】删除数据</span><br><span class="line"></span><br><span class="line">- delete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 【2】删除数据--删除外键关系  delete</span><br><span class="line">    # book中的publisher字段</span><br><span class="line">    # 因为你在创建的时候已经添加了级联更新和级联删除所以你删除信息和修改信息都会发生变化</span><br><span class="line">    # Book.objects.get(pk=&quot;1&quot;).delete()# 删除了book id为1的数据</span><br><span class="line">    # Publisher.objects.get(pk=&quot;1&quot;).delete()# 删除了出版社的id，对应的图书也一并被删掉了</span><br><span class="line">    # 删除外键数据 出版社表中的数据 在图书表中 预支相关联的数据也会被删除</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="【3】修改外键字段">【3】修改外键字段</h3>
<ul>
<li>update</li>
</ul>
```python
 # 【3】修改外键字段 update
    # 我们将红楼梦从1出版社转到3出版社该怎么做
    # 方法一
    # 我们先获得出版社的一个id
    # publisher_obj = Publisher.objects.get(pk="4")

    # Book.objects.filter(title="红楼梦").update(publisher=publisher_obj)
    
    # 方法二
    # 直接替换,指定书的id，替换指定印刷厂的id
    # id不存在就会报错
    # books = Book.objects.filter(pk=6).update(publisher_id=6)
	# 也可以放对象
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【六】多对多的外键字段</span><br><span class="line"></span><br><span class="line">### 【1】添加数据</span><br><span class="line"></span><br><span class="line">- 一定要保证两个表里面有值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 图书和作者表</span><br><span class="line">    # for i in range(1, 6):</span><br><span class="line">    #     detail_obj = AuthorDetail.objects.create(addr=f&quot;上海_&#123;i&#125;&quot;, phone=f&quot;1&#123;i&#125;0&quot;)</span><br><span class="line">    #     # print(detail_obj) # AuthorDetail object (1)</span><br><span class="line">    #     Author.objects.create(name=f&quot;dream_&#123;i&#125;&quot;, age=18 * i, author_detail=detail_obj)</span><br><span class="line"></span><br><span class="line">    # for i in range(1, 6):</span><br><span class="line">    #     Book.objects.create(</span><br><span class="line">    #         title=f&quot;第 &#123;i&#125; 本书&quot;,</span><br><span class="line">    #         price=str(60 * i),</span><br><span class="line">    #         publish_id=random.randint(2, 6)</span><br><span class="line">    #     )</span><br></pre></td></tr></table></figure>

<ul>
<li>要使用Django自带的机制自动生成的第三张表，models不会有第三张表</li>
<li>需要跨表建立关系</li>
</ul>
```python
# 获得书籍对象
    data = book_obj = Book.objects.get(pk=16)

    # 获得作者对象
    data = auther_obj = Author.objects.get(pk=3)

     # 【1】添加多对多外键关系---关键字add
    # 方式一
    # 给book_obj书籍添加一个作者
    # 获得书籍对象，在获得作者对象，书籍对象在跨到作者身上
    # 你的第三章表建立建立谁的身上了就得到谁的对象然后在把和你建立多对多关系的表添加进去
    # data = book_obj.auther.add(auther_obj)
    # print(data)
    # 方式二 直接放作者的id号
    # book_obj.auther.add(1, 3,6,4,5)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】删除数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 获得书籍对象</span><br><span class="line">    data = book_obj = Book.objects.get(pk=16)</span><br><span class="line"></span><br><span class="line">    # 获得作者对象</span><br><span class="line">    data = auther_obj = Author.objects.get(pk=3)</span><br><span class="line"></span><br><span class="line"># 【2】删除多对多外键关系 remove</span><br><span class="line">    # book_obj.auther.remove(auther_obj)</span><br><span class="line">    # 删除多个，直接给作者的id</span><br><span class="line">    # book_obj.auther.remove(3, 1)</span><br></pre></td></tr></table></figure>

<h3 id="【3】修改外键关系">【3】修改外键关系</h3>
```python
 # 获得书籍对象
    data = book_obj = Book.objects.get(pk=16)

    # 获得作者对象
    data = auther_obj = Author.objects.get(pk=3)

    # 【3】修改外键关系---》set
    # 方式一 用set方法，弊端就是会清空其他的外键关系
    # set关键字是一个列表
    # 修改了数据，保留了book_obj是16对应的3，其他的book_obj对应的书籍被清空，
    # book_obj.auther.set([3])
    # 方式二 先用 remove 移除外键关系 再用 add 添加外键关系
    # book_obj.auther.remove(auther_obj)
    # book_obj.auther.add(auther_obj)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 多表查询（正反向查询）</span><br><span class="line"></span><br><span class="line">## 【一】什么是正反向查询</span><br><span class="line"></span><br><span class="line">### 【1】正向查询</span><br><span class="line"></span><br><span class="line">- 外键字段在自己身上就叫正向查询</span><br><span class="line">  - 有外键关系的两张表 从有外检字段的表向另一张无外键字段的表查询数据的时候就是正向</span><br><span class="line">- 正向查询的时候，直接按照字段查询</span><br><span class="line"></span><br><span class="line">### 【2】反向查询</span><br><span class="line"></span><br><span class="line">- 外键字段不在自己身上，我查你就叫反向查询</span><br><span class="line">  - 有外键关系的两张表 从无外键字段的表向另一张有外键字段表查询数据的时候就是反向</span><br><span class="line">- 反向查询的时候，要使用关键字_set</span><br><span class="line"></span><br><span class="line">## 【二】多表查询案例</span><br><span class="line"></span><br><span class="line">### 【1】子查询（基于对象的跨表查询）</span><br><span class="line"></span><br><span class="line">#### （1）查询书籍主键为14的出版社</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">	#查询书籍主键为1的出版社</span><br><span class="line">    #得到图书对象</span><br><span class="line">    book_obj = Book.objects.get(pk=14)</span><br><span class="line">    #图书与出版社是一对多关系</span><br><span class="line">    print(book_obj)  # Book object (14)</span><br><span class="line">    #不要带_id</span><br><span class="line">    publisher_id = book_obj.publisher_id</span><br><span class="line">    print(publisher_id)  # 6</span><br><span class="line">    #得到出版社对象</span><br><span class="line">    publisher_obj = book_obj.publisher</span><br><span class="line">    print(publisher_obj)  # Publisher object (6)</span><br><span class="line">    #对象.name得到出版社</span><br><span class="line">    publisher_name = book_obj.publisher.name</span><br><span class="line">    print(publisher_name)  # 4出版社</span><br></pre></td></tr></table></figure>

<h4 id="（2）查询数据主键为1的作者">（2）查询数据主键为1的作者</h4>
```python
 	# 查询书籍主键为1的作者
    # 书籍与作者是多对多关系
    # 得到主键id为1的对象
    book_obj = Book.objects.filter(pk=1).first()
    print(book_obj) # Book object (1)
    res = book_obj.auther
    print(res)  # user.Author.None
    auther_obj = book_obj.auther.all()
    print(auther_obj)  # <QuerySet [<Author: Author object (2)>]>
    author_obj = book_obj.auther.all().values("name")
    print(author_obj)  # <QuerySet [{'name': 'tom2'}]>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### (3)查询作者主键为3的电话号码</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">	# 查询作者主键为3的电话号码</span><br><span class="line">    # 得到作者对象</span><br><span class="line">    # 作者与作者详情是一对一关系</span><br><span class="line">    author_obj = Author.objects.filter(pk=3).first()</span><br><span class="line">    print(author_obj)  # Author object (3)</span><br><span class="line">    # 得到作者详情对象</span><br><span class="line">    author_detail_obj = author_obj.author_detail</span><br><span class="line">    print(author_detail_obj)  # AuthorDetail object (3)</span><br><span class="line">    # 对象.字段</span><br><span class="line">    phone = author_detail_obj.phone</span><br><span class="line">    print(phone)  # 130</span><br></pre></td></tr></table></figure>

<h4 id="4-查询出版社是-1出版社-的书">(4)查询出版社是  1出版社  的书</h4>
<ul>
<li>在下面<code>res</code>只是一个待执行的查询的“准备”状态</li>
</ul>
```python
	# 查询出版社是  1出版社  的书
    # 出版社与书是多对一关系
    # 没有外键关系的表要向有外键关系的表查，就是反向查询加_set
    # 得到出版社对象
    publisher_obj = Publisher.objects.filter(name="1出版社").first()
    print(publisher_obj)  # Publisher object (2)
    # 反向查询加_set
    # 只是一个执行状态的准备，并没有进行查询
    res = publisher_obj.book_set
    print(res)  # user.Book.None
    # 得到图书对象
    book_obj = publisher_obj.book_set.all()
    print(book_obj)  # <QuerySet [<Book: Book object (1)>]>
    # values得到想要的数据
    publisher_name = publisher_obj.book_set.all().values("title")
    print(publisher_name)  # <QuerySet [{'title': '第1本书'}]>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （5）查询作者是tom1写过的书</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">	# 查询作者是tom1写过的书</span><br><span class="line">    # 作者和图书是多对多关系</span><br><span class="line">    # 得到作者的对象</span><br><span class="line">    author_obj = Author.objects.filter(name=&quot;tom1&quot;).first()</span><br><span class="line">    print(author_obj)  # Author object (1)</span><br><span class="line">    # 得到图书对象</span><br><span class="line">    book_obj = author_obj.book_set</span><br><span class="line">    print(book_obj)  # user.Book.None</span><br><span class="line">    # 得到图书的名字</span><br><span class="line">    book_name = author_obj.book_set.all().values(&quot;title&quot;)</span><br><span class="line">    print(book_name)  # &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;第3本书&#x27;&#125;]&gt;</span><br></pre></td></tr></table></figure>

<h4 id="6-查询手机号是110的作者姓名">(6)查询手机号是110的作者姓名</h4>
```python
# 查询手机号是110的作者姓名
    # 作者和作者详情是一对一关系
    # 得到作者详情对象
    author_detail_obj = AuthorDetail.objects.filter(phone=110).first()
    print(author_detail_obj)
    # 主键在作者身上，反向查询，但是是一对一关系，不需要加_set
    author_obj = author_detail_obj.author
    print(author_obj)  # Author object (1)
    # 得到作者的名字
    author_name = author_obj.name
    print(author_name)  # tom1
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### (7)小结</span><br><span class="line"></span><br><span class="line">- 基于对象的反向查询</span><br><span class="line">- 什么时候需要加_set.all()</span><br><span class="line">  - 查询结果是多个的时候需要加</span><br><span class="line">- 一对一表关系不区分正反向 因为关系唯一</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 正向查询：有外键字段向没有外键字段的表查 查询方式是 .字段名</span><br><span class="line"># 反向查询：没有外键字段向有外键字段的表查 查询方式时 .有外键字段的表明_set</span><br></pre></td></tr></table></figure>

<h3 id="【2】联表查询">【2】联表查询</h3>
<ul>
<li>基于双下划线的跨表查询</li>
<li>联表查询就是将两张表合并在一起查询数据</li>
</ul>
<h4 id="（1）查询tom1的手机号和作者的名字">（1）查询tom1的手机号和作者的名字</h4>
<ul>
<li>
<p>正向查询</p>
</li>
<li>
<p>使用双下划线（查询信息的表明__字段）</p>
</li>
<li>
<p>查询到作者信息在.value.(需要查询信息的表__需要查询的字段,其他字段)</p>
</li>
</ul>
```python
	# 查询tom1的手机号和作者的名字
    # 正向查询
    # 作者和作者详情是一对一关系
    name_phone = Author.objects.filter(name="tom1").values(
        "name",
        "author_detail__phone"
    )
    print(name_phone)
    # <QuerySet [{'name': 'tom1', 'author_detail__phone': '110'}]>
    # first：取到单个数据
    author_dict = name_phone.first()
    print(author_dict)  # {'name': 'tom1', 'author_detail__phone': '110'}
    # 取到名字
    name = name_phone.first().get("name")
    print(name)  # tom1
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 反向查询</span><br><span class="line">- 先拿到详情，再用作者详情关联作者表，通过 __字段的方法 过滤出我们想要的指定数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 查询tom1的手机号和作者的名字</span><br><span class="line">    # 反向查询</span><br><span class="line">    phone_name = AuthorDetail.objects.filter(author__name=&quot;tom1&quot;).values(</span><br><span class="line">        &quot;phone&quot;,</span><br><span class="line">        &quot;author__name&quot;</span><br><span class="line">    )</span><br><span class="line">    print(phone_name)</span><br><span class="line">    # &lt;QuerySet [&#123;&#x27;phone&#x27;: &#x27;110&#x27;, &#x27;author__name&#x27;: &#x27;tom1&#x27;&#125;]&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（2）查询书籍主键为1的出版社的名字和书的名字">（2）查询书籍主键为1的出版社的名字和书的名字</h4>
<ul>
<li>正向查询</li>
<li>先过滤出书籍ID为1的书籍对象，再去关联出版者表，利用__字段取值</li>
</ul>
```python
# 查询书籍主键为1的出版社的名字和书的名字
    # 正向查询
    data = Book.objects.filter(pk=1).values(
        "title",
        "publisher__name"
    )
    print(data)
    # <QuerySet [{'title': '第1本书', 'publisher__name': '1出版社'}]>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 反向查询</span><br><span class="line">- 先查询到指定出版社，再从出版社反向找到书籍名字</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 查询书籍主键为1的出版社的名字和书的名字</span><br><span class="line">    # 反向查询</span><br><span class="line">    data = Publisher.objects.filter(book__id=1).values(</span><br><span class="line">        &quot;name&quot;,</span><br><span class="line">        &quot;book__title&quot;</span><br><span class="line">    )</span><br><span class="line">    print(data)</span><br><span class="line">    # &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;1出版社&#x27;, &#x27;book__title&#x27;: &#x27;第1本书&#x27;&#125;]&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-查询书籍主键为1的作者的名字">(3)查询书籍主键为1的作者的名字</h4>
<ul>
<li>正向</li>
<li>先拿到 书籍主键ID为1的对象，再关联作者信息表，通过__字段取值</li>
</ul>
```python
# 查询书籍主键为1的作者的名字
    data = Book.objects.filter(pk=1).values(
        "auther__name"
    )
    print(data)  # <QuerySet [{'auther__name': 'tom2'}]>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 反向</span><br><span class="line">- 先拿到 书籍ID为1的作者数据再去取作者的名字</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 查询书籍主键为1的作者的名字</span><br><span class="line">    data = Author.objects.filter(book__id=1).values(</span><br><span class="line">        &quot;name&quot;</span><br><span class="line">    )</span><br><span class="line">    print(data)  # &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;tom2&#x27;&#125;]&gt;</span><br></pre></td></tr></table></figure>

<h4 id="4-查询书籍主键为1的作者的手机号">(4)查询书籍主键为1的作者的手机号</h4>
<ul>
<li>跨越了三个表</li>
</ul>
```python
# 查询书籍主键为1的作者的手机号
    data = Author.objects.filter(book__id=1).values(
        "author_detail__phone"
    )
    print(data)  # <QuerySet [{'author_detail__phone': '120'}]>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （5）小结</span><br><span class="line"></span><br><span class="line">- 掌握了双下划线和正反向可以无限跨表</span><br><span class="line"></span><br><span class="line">## 【三】聚合函数（aggregate）</span><br><span class="line"></span><br><span class="line">- 正常情况下我们需要进行分组才能进行聚合函数的运算</span><br><span class="line"></span><br><span class="line">- 使用聚合函数时：利用关键字aggregate可以不分组进行某个字段的聚合函数</span><br><span class="line"></span><br><span class="line">### 【1】引入聚合函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.db.models import Max, Min, Sum, Count, Avg</span><br></pre></td></tr></table></figure>

<h3 id="【2】聚合函数案例">【2】聚合函数案例</h3>
<ul>
<li>第一步需要先导入聚合函数</li>
</ul>
```python
from django.db.models import Max, Min, Sum, Count, Avg
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### (1)求所有书的平均价格</span><br><span class="line"></span><br><span class="line">- 利用聚合函数不用分组就可以的到的结果的方法：aggregate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 求所有书的平均数</span><br><span class="line">    from django.db.models import Sum, Avg</span><br><span class="line">    book_avg_price = Book.objects.aggregate(Avg(&quot;price&quot;))</span><br><span class="line">    print(book_avg_price)</span><br><span class="line">    # &#123;&#x27;price__avg&#x27;: Decimal(&#x27;60.000000&#x27;)&#125;</span><br><span class="line">    from django.db.models import Sum, Avg</span><br><span class="line">    book_avg_price = Book.objects.aggregate(Avg(&quot;price&quot;))</span><br><span class="line">    print(book_avg_price)</span><br><span class="line">    # &#123;&#x27;price__avg&#x27;: Decimal(&#x27;60.000000&#x27;)&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-一次性用很多方法">(2)一次性用很多方法</h4>
<ul>
<li>利用聚合函数不用分组就可以的到的结果的方法：aggregate</li>
</ul>
```python
from django.db.models import Sum, Avg, Max, Min, Count

    book_avg_price = Book.objects.aggregate(Avg("price"), Max("price"), Min("price"), Sum("price"), Count("price"))
    print(book_avg_price)
    # {'price__avg': Decimal('60.000000'), 'price__max': Decimal('100.00'), 'price__min': Decimal('20.00'), 'price__sum': Decimal('300.00'), 'price__count': 5}
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【四】分组查询（关键字：annotate）</span><br><span class="line"></span><br><span class="line">### 【1】引入</span><br><span class="line"></span><br><span class="line">- 按照指定条件对数据进行分组</span><br><span class="line"></span><br><span class="line">### 【2】分组查询语法</span><br><span class="line"></span><br><span class="line">- models 后面跟的是什么，就是按什么分组</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">res = models.Book.objects.annotate()</span><br></pre></td></tr></table></figure>

<h3 id="【3】案例">【3】案例</h3>
<h4 id="（1）统计每一本书的作者个数">（1）统计每一本书的作者个数</h4>
<ul>
<li>Book分组，然后计算作者的个数</li>
</ul>
```python
 from django.db.models import Count, Avg, Max, Min, Sum
 from user.models import Book
    # 统计每一本书的作者个数
    # 一定要看你的字段名写错了没，错了就会找不到数据
    # 获得分组后的对象
    data = Book.objects.annotate(author_number=Count("auther"))
    print(data)  # <QuerySet [<Book: Book object (1)>, <Book: Book object (2)>, <Book: Book object (15)>, <Book: Book object (16)>, <Book: Book object (17)>]>
    
    # 获得分组后的数据
    data = Book.objects.annotate(author_number=Count("auther")).values(
        "title",
        "author_number"
    )
    print(data)
    # <QuerySet [{'title': '第1本书', 'author_number': 1}, {'title': '第2本书', 'author_number': 0}, {'title': '第3本书', 'author_number': 4}, {'title': '第4本书', 'author_number': 1}, {'title': '第5本书', 'author_number': 0}]>
    
    
    
    
    # 等价于
     data = Book.objects.annotate(author_number=Count("auther__pk")).values(
        "title",
        "author_number"
    )
    print(data)
    # <QuerySet [{'title': '第1本书', 'author_number': 1}, {'title': '第2本书', 'author_number': 0}, {'title': '第3本书', 'author_number': 4}, {'title': '第4本书', 'author_number': 1}, {'title': '第5本书', 'author_number': 0}]>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （2）统计每个出版社最便宜的书的价格</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">    from django.db.models import Count, Avg, Max, Min, Sum</span><br><span class="line">    from user.models import  Publisher</span><br><span class="line"></span><br><span class="line">    # 统计每个出版社最便宜的书的价格</span><br><span class="line">    data = Publisher.objects.annotate(min_book_price=Min(&#x27;book__price&#x27;)).values(</span><br><span class="line">        &#x27;name&#x27;,</span><br><span class="line">        &quot;min_book_price&quot;</span><br><span class="line">    )</span><br><span class="line">    print(data)</span><br><span class="line">    # &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;1出版社&#x27;, &#x27;min_book_price&#x27;: Decimal(&#x27;20.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;4出版社&#x27;, &#x27;min_book_price&#x27;: Decimal(&#x27;40.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;2出版社&#x27;, &#x27;min_book_price&#x27;: Decimal(&#x27;80.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;3出版社&#x27;, &#x27;min_book_price&#x27;: Decimal(&#x27;100.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;5出版社&#x27;, &#x27;min_book_price&#x27;: None&#125;]&gt;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h4 id="（3）统计不止一个作者的图书">（3）统计不止一个作者的图书</h4>
```python
from django.db.models import Count, Avg, Max, Min, Sum
    from user.models import Book
    # 统计不止一个作者的图书
    # 先按图书分组
    # 再筛选不止一个作者的图书
    data = Book.objects.annotate(one_author=Count("auther")).filter(one_author__gt=1).values(
        "title",
        "one_author"
    )
    print(data)  # <QuerySet [{'title': '第3本书', 'one_author': 4}]>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### (4)查询每个作者出的书总价格</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.db.models import Count, Avg, Max, Min, Sum</span><br><span class="line">    from user.models import Author</span><br><span class="line"></span><br><span class="line">    # 查询每个作者出的书总价格</span><br><span class="line">    data = Author.objects.annotate(sum_book_price=Sum(&quot;book__price&quot;)).values(</span><br><span class="line">        &quot;name&quot;,</span><br><span class="line">        &quot;sum_book_price&quot;</span><br><span class="line">    )</span><br><span class="line">    print(data)</span><br><span class="line">    # &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;tom2&#x27;, &#x27;sum_book_price&#x27;: Decimal(&#x27;80.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;tom1&#x27;, &#x27;sum_book_price&#x27;: Decimal(&#x27;60.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;tom3&#x27;, &#x27;sum_book_price&#x27;: Decimal(&#x27;140.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;tom4&#x27;, &#x27;sum_book_price&#x27;: Decimal(&#x27;60.00&#x27;)&#125;]&gt;</span><br></pre></td></tr></table></figure>

<h4 id="5-小结">(5)小结</h4>
<ul>
<li>
<p>下面这个语法</p>
</li>
<li>
```python
  Book.objects.values('price').annotate()
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 如果annotate前面没东西，则会按照Book进行分组,如果前面有参数就会按照前面的参数&#x27;price&#x27;进行分组</span><br><span class="line"></span><br><span class="line">## 【五】F和Q查询</span><br><span class="line"></span><br><span class="line">### 【1】引入</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from from django.db.models import F, Q</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="【2】F查询">【2】F查询</h3>
<ul>
<li>能够帮你获取到列表中的某个字段对应的数据</li>
<li>注意：在操作字符串类型的时候，F查询不能够直接做到字符串的拼接</li>
</ul>
<h4 id="（1）查询库存数大于销量的书籍">（1）查询库存数大于销量的书籍</h4>
```python
# F 查询 : 帮助我们直接获取到表中的某个字段对应的数据
res = models.Book.objects.filter(sales__gt=F('stock'))
print(res)  # <QuerySet [<Book: 水浒传>]>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （2）将所有的书籍价格提升100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">	from user.models import Book</span><br><span class="line">    from django.db.models import F</span><br><span class="line"></span><br><span class="line">    # 将所有的书籍价格提升100</span><br><span class="line">    data = Book.objects.update(price=F(&quot;price&quot;) + 100)</span><br><span class="line">    print(data)</span><br><span class="line">    # 5</span><br><span class="line">    # 代表更新了5条数据</span><br></pre></td></tr></table></figure>

<h4 id="3-将所有的数据后面添加-nb">(3)将所有的数据后面添加_nb</h4>
<ul>
<li>
<p>Value 是一个用于在查询中插入静态值的类，这个值可以是任何Django支持的数据库数据类型</p>
<ul>
<li>
```python
    from django.db.models import Value
    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- Concat:在操作字符串的时候F查询不能直接操作字符串，需要引入这个方法</span><br><span class="line"></span><br><span class="line">  - &#123;% raw %&#125;````python</span><br><span class="line">    from django.db.models.functions import Concat</span><br><span class="line">    ````</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from user.models import Book</span><br><span class="line">    from django.db.models import F</span><br><span class="line">    from django.db.models import Value</span><br><span class="line">    from django.db.models.functions import Concat</span><br><span class="line">    # 将所有的书籍后面添加_nb</span><br><span class="line">    # 在操作字符串的时候F查询不能直接操作字符串，需要引入一个方法，Concat</span><br><span class="line">    # Value：Value 是一个用于在查询中插入静态值的类，这个值可以是任何Django支持的数据库数据类型</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    data = Book.objects.update(title=Concat(F(&quot;title&quot;),Value(&#x27;_nb&#x27;)))</span><br><span class="line">    print(data)</span><br><span class="line">    # 5</span><br><span class="line">    # 更新了5条数据</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="【3】Q查询">【3】Q查询</h3>
<ul>
<li>关键字filter()方法中的关键字参数查询都是一起进行’and’</li>
<li>如果你需要执行更复杂的查询(列如ORM语句)，你可以使用Q对象</li>
</ul>
<h4 id="1-查询卖出数大于100或者价格小于500的书籍">(1)查询卖出数大于100或者价格小于500的书籍</h4>
<ul>
<li>直接使用 filter 查询数据，逗号隔开,里面放的参数是 and 关系</li>
<li>两个条件都必须符合</li>
</ul>
```python
# 查询卖出数大于100或者价格小于500的书籍
    data = Book.objects.filter(sales__gt=100, price__lt=500)
    print(data)
    # <QuerySet [<Book: Book object (1)>]>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 直接使用 Q 查询数据，逗号隔开,里面放的参数还是 and 关系</span><br><span class="line">  - 两个条件都必须成立</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">data = Book.objects.filter(Q(sales__gt=100), Q(price__lt=500))</span><br><span class="line">    print(data)  # &lt;QuerySet [&lt;Book: Book object (1)&gt;]&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>
<p>直接使用 Q 查询数据，逗号可以换成其他连接符达到效果</p>
<ul>
<li>
<p>or：任一个条件符合即可</p>
</li>
<li>
<p>关键字作为连接符，会阉割条件</p>
```python
    data = Book.objects.filter(Q(sales__gt=100) or Q(price__lt=500))
        print(data)  # <QuerySet [<Book: Book object (1)>]>
    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">  - |：或关系</span><br><span class="line"></span><br><span class="line">    - 有一个成立就可以</span><br><span class="line"></span><br><span class="line">  &#123;% raw %&#125;```python</span><br><span class="line">  data = Book.objects.filter(Q(sales__gt=100) | Q(price__lt=500))</span><br><span class="line">      print(data) # &lt;QuerySet [&lt;Book: Book object (1)&gt;]&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="（2）Q的高阶用法">（2）Q的高阶用法</h4>
<ul>
<li>
<p>能够将查询条件的左边也变成 字符串形式</p>
</li>
<li>
<p>自己创造查询条件</p>
</li>
</ul>
```python
from django.db.models import Q

    # 查询卖出数大于100或者价格小于500的书籍

    # 生成Q对象
    q = Q()
    # 创建Q对象的连接条件
    # or：满足一个条件即可
    # and: 两个条件都要满足
    # 默认是and关系
    q.connector = "or"
    # 添加第一个加条件-->左边
    q.children.append(("sales__gt", 100))
    # 添加第二个加条件-->右边
    q.children.append(("price__lt", 500))
    # 查询
    # filter 除了可以放条件 还可以放对象
    data = Book.objects.filter(q)
    print(data)  # <QuerySet [<Book: Book object (1)>]>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 可以在去对象内 children里面 无限制的添加元素 添加元组，元组里两个元素</span><br><span class="line"></span><br><span class="line">- 而且还支持修改 or 、and</span><br><span class="line">- 默认是and</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 或查询</span><br><span class="line">q = Q()</span><br><span class="line">q |= Q(条件一)</span><br><span class="line">q |= Q(条件二)</span><br><span class="line">qs = Model.objects.filter(q)</span><br><span class="line"></span><br><span class="line"># 并查询</span><br><span class="line">q = Q()</span><br><span class="line">q &amp;= Q(条件一)</span><br><span class="line">q &amp;= Q(条件二)</span><br><span class="line">qs = Model.objects.filter(q)</span><br></pre></td></tr></table></figure>

<h1>Django中开启事务</h1>
<h2 id="【一】ACID特性">【一】ACID特性</h2>
<ul>
<li>原子性（Atomicity）
<ul>
<li>事务被称为一个不可再分隔的原子操作单位</li>
<li>要么全部操作成功并永久保存，要么全部操作失败并回滚到事务开始前的状态，不存在部分成功或部分失败的情况</li>
</ul>
</li>
<li>一致性（Consistency）
<ul>
<li>事务执行前后，数据库应保持一致的状态</li>
<li>在事务开始之前和结束之后，数据库必须满足所有的完整性约束，如列级别的约束、外键关系等</li>
</ul>
</li>
<li>隔离性（Isolation）
<ul>
<li>事务的执行结果对其他并发执行的事务是隔离的</li>
<li>一个事务的执行不应受到其他事务的干扰，各个事务之间应该相互独立工作，从而避免数据的不一致性</li>
</ul>
</li>
<li>持久性（Durability）
<ul>
<li>一旦事务被提交，其结果应该永久保存在数据库中，并且可以被系统故障恢复</li>
<li>即使系统发生宕机或崩溃，事务提交后的更改也应该是永久性的</li>
</ul>
</li>
</ul>
<h2 id="【二】事务名词">【二】事务名词</h2>
<ul>
<li>开启事务：Start Transaction</li>
<li>事务结束：End Transaction</li>
<li>提交事务：Commit Transaction</li>
<li>回滚事务：Rollback Transaction</li>
</ul>
<h2 id="【三】默认事务行为">【三】默认事务行为</h2>
<ul>
<li>Django是支持事务操作的，它的默认事务行为是自动提交</li>
<li>具体表现形式为：每次数据库操作(比如调用save()方法)会立即被提交到数据库中</li>
<li>如果你希望把连续的SQL操作包裹在一个事务里，就需要手动开启事务</li>
</ul>
<h2 id="【四】开启事务">【四】开启事务</h2>
<h3 id="【1】开启全局事务">【1】开启全局事务</h3>
<ul>
<li>在settings.py中的数据库中配置</li>
</ul>
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        # 手动创建数据库
        'NAME': "django_two",
        "USER": "root",
        "PASSWORD": "1234567",
        "HOST": "127.0.0.1",
        "PORT": 3306,
        "CHARSET": "utf8mb4",
        # 开启全局事务，绑定的是http请求响应整个过程
        "ATOMIC_REQUESTS": True
    }
}
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 解析</span><br><span class="line">  - 每当有请求过来时，Django会在调用视图方法前开启一个事务。</span><br><span class="line">  - 如果完成了请求处理并正确返回了结果，Django就会提交该事务。</span><br><span class="line">  - 否则，Django会回滚该事务</span><br><span class="line"></span><br><span class="line">### 【2】取消局部的事务</span><br><span class="line"></span><br><span class="line">- 方法就是，在你要取消事务的视图函数上写一个添加一个装饰器</span><br><span class="line">- 首先导入一个方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.db import transaction</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>@transactionnon_atomic_requests</code>装饰器让某些视图函数方法不受事务的控制</li>
</ul>
```python
@transaction.non_atomic_requests
def longin(request):
    return render(request, "login.html", locals())
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 如有多个数据库，让使用otherdb的视图不受事务控制</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">@transaction.non_atomic_requests(using=&quot;otherdb&quot;)</span><br><span class="line">def longin(request):</span><br><span class="line">    return render(request, &quot;login.html&quot;, locals())</span><br></pre></td></tr></table></figure>

<ul>
<li>虽然全局开启事务很简单，但Django并不推荐开启全局事务。</li>
<li>因为一旦将事务跟 HTTP 请求绑定到一起时，每一个请求都会开启事务，当访问量增长到一定的时候会造成很大的性能损耗</li>
<li>推荐使用局部开启事务</li>
</ul>
<h3 id="【3】局部开启事务">【3】局部开启事务</h3>
<ul>
<li>借助一个方法</li>
</ul>
```python
from django.db import transaction
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 给视图函数添加装饰器</span><br><span class="line"></span><br><span class="line">#### （1）在函数头上增加装饰器</span><br><span class="line"></span><br><span class="line">- 第一步：引入Django内部的事务模块</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.db import transaction</span><br></pre></td></tr></table></figure>

<ul>
<li>第二部：在视图函数上添加装饰器</li>
</ul>
```python
# 添加局部开启事务装饰器
@transaction.non_atomic_requests
def longin(request):
    return render(request, "login.html", locals())
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （2）在类内部的函数头上增加装饰器</span><br><span class="line"></span><br><span class="line">- 第一步：引入模块</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.db import transaction</span><br></pre></td></tr></table></figure>

<ul>
<li>第二部:添加在类里面的函数头上</li>
</ul>
```python
class UserInfo(View):
    # 添加局部开启事务装饰器
    @transaction.atomic
    def get(self, request):
        ...

    def post(self, request):
        ...
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （3）自定义事务点---&gt;**Savepoint回滚**</span><br><span class="line"></span><br><span class="line">- 自己设定开启事务的点</span><br><span class="line">- 一旦发生异常或错误，我们使用savepoint_rollback方法让程序回滚到指定的保存点</span><br><span class="line">- 如果没有问题，就使用savepoint_commit方法提交事务</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.shortcuts import render</span><br><span class="line">from django.db import transaction</span><br><span class="line"></span><br><span class="line">def longin(request):</span><br><span class="line">    # 开启事务</span><br><span class="line">    with transaction.atomic():</span><br><span class="line">        # 记录事务起点</span><br><span class="line">        sid = transaction.savepoint()</span><br><span class="line">        # 异常捕获</span><br><span class="line">        try:</span><br><span class="line">            #执行你的代码</span><br><span class="line">            ...</span><br><span class="line">        except Exception as e:</span><br><span class="line">            # 进行事务的回滚</span><br><span class="line">            transaction.savepoint_rollback(sid)</span><br><span class="line">        # 没有发生错误就提交事务</span><br><span class="line">        transaction.savepoint_commit(sid)</span><br><span class="line">    return render(request, &quot;login.html&quot;, locals())</span><br></pre></td></tr></table></figure>

<h4 id="4-事务提交后回调函数">(4)事务提交后回调函数</h4>
<ul>
<li>意思就是：当前事务提交后立即执行额外的任务</li>
</ul>
```python
# 例1
from django.db import transaction

def do_something():
  pass  # send a mail, invalidate a cache, fire off a Celery task, etc.


transaction.on_commit(do_something)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 字段及字段参数的补充</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line"># 【一】CharField 字符串类型</span><br><span class="line"># max_length 规定字符串的长度</span><br><span class="line"># models.CharField(max_length=25)</span><br><span class="line"></span><br><span class="line"># 【二】IntegerField 整数类型</span><br><span class="line"># 只能放数字类型</span><br><span class="line"># 用数字表示 支付方式 微信 支付宝 花呗 ...</span><br><span class="line"># 用数字代表字符串</span><br><span class="line"># models.IntegerField(choices=((1, &quot;微信&quot;), (2, &quot;支付宝&quot;), (3, &quot;花呗&quot;)))</span><br><span class="line"></span><br><span class="line"># 【三】BooleanField 布尔值类型</span><br><span class="line"># 可以放 0 / 1 也可以放 True / False</span><br><span class="line"># models.BooleanField()</span><br><span class="line"></span><br><span class="line"># 【四】EmailField 邮箱</span><br><span class="line"># 必须符合邮箱格式才能被存进去</span><br><span class="line"># models.EmailField()</span><br><span class="line"></span><br><span class="line"># 【五】TextField 大文本字段</span><br><span class="line"># 大量的文本</span><br><span class="line"># models.TextField()</span><br><span class="line"></span><br><span class="line"># 【六】AutoField 自动生成id</span><br><span class="line"># models.AutoField()</span><br><span class="line"></span><br><span class="line"># 【七】DateTimeField 时间日期</span><br><span class="line"># auto_now 第一次创建的时候的时间</span><br><span class="line"># auto_now_add 以后每次更新的时候的时间</span><br><span class="line"># models.DateTimeField(</span><br><span class="line">#     auto_now=True,</span><br><span class="line">#     auto_now_add=True</span><br><span class="line"># )</span><br><span class="line"># models.DateField()</span><br><span class="line"># models.TimeField()</span><br><span class="line"></span><br><span class="line"># 【8】FileField 文件数据</span><br><span class="line"># models.FileField()</span><br><span class="line"></span><br><span class="line"># 【9】ImageField 图片数据</span><br><span class="line"># models.ImageField()</span><br><span class="line"></span><br><span class="line"># 【10】外键关系字段</span><br><span class="line"># 一对多关系</span><br><span class="line"># models.ForeignKey()</span><br><span class="line"># 一对一关系</span><br><span class="line"># models.OneToOneField()</span><br><span class="line"># 多对多关系</span><br><span class="line"># models.ManyToManyField()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 【二】字段参数</span><br><span class="line"># default 默认值</span><br><span class="line"># null 是否为空</span><br><span class="line"># blank 是否为空 从admin后台插入数据逇时候是否可以为空</span><br><span class="line"># unique 是否唯一</span><br><span class="line"></span><br><span class="line"># 【三】自己看 数据库字段优化 defer / only</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/12.0Django%E6%A1%86%E6%9E%B6%E4%B9%8BForm%E7%BB%84%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/12.0Django%E6%A1%86%E6%9E%B6%E4%B9%8BForm%E7%BB%84%E4%BB%B6/" class="post-title-link" itemprop="url">12.0Django框架之Form组件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:15:49" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Django框架之Form组件</h1>
<h2 id="【一】Django的表单系统">【一】Django的表单系统</h2>
<h3 id="【1】原始的form表单">【1】原始的form表单</h3>
```html
{#action路径：代表你要提交数据的目的地，不填默认本地#}
<form action="" method="post">
    {#说明标签<label>#}
    <p><label for="username">username:</label>
    <input type="text" id="username" name="username"></p>
     <p><label for="password">password:</label>
    <input type="text" id="password" name="password"></p>
    {#按钮#}
    <p><input type="submit"></p>
</form>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 同时我们在好多场景下都需要对用户的输入做校验 </span><br><span class="line"></span><br><span class="line">- - 比如校验用户是否输入</span><br><span class="line">  - 输入的长度和格式等正不正确。</span><br><span class="line"></span><br><span class="line">- 如果用户输入的内容有错误就需要在页面上相应的位置显示对应的错误信息.。</span><br><span class="line"></span><br><span class="line">### 【2】Django的表单系统</span><br><span class="line"></span><br><span class="line">- Django的Form表单类与Django模型描述对象的逻辑结构、行为以及它呈现给我们内容的形式的方式大致相同</span><br><span class="line">- 为什么还要创建表单类</span><br><span class="line">- 原因之一是模型中有一些字段你不需要用户从前端输入数据，或者需要用户额外输入一些非模型字段的数据</span><br><span class="line"></span><br><span class="line">- Form表单精确控制了这些行为，相当于你在用户HTML表单输入框和Django模型之间的中间件</span><br><span class="line"></span><br><span class="line">### 【3】form表单的主要功能</span><br><span class="line"></span><br><span class="line">- 生成页面主要的HTML标签</span><br><span class="line">- 对用户提交的数据进行校验</span><br><span class="line">- 保留上次输入的内容</span><br><span class="line"></span><br><span class="line">## 【二】需求介绍</span><br><span class="line"></span><br><span class="line">- 写一个注册功能 </span><br><span class="line">  - 获取用户名和密码，利用form表单提交数据</span><br><span class="line">  - 在后端判断用户名和密码是否符合一定的条件 </span><br><span class="line">    - 用户名中不能包含nb_</span><br><span class="line">    - 密码不能少于三位</span><br><span class="line">  - 如果符合条件需要你将提示信息展示到前端页面</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【三】form表单实现</span><br><span class="line"></span><br><span class="line">### 【1】点击按钮返回比对信息</span><br><span class="line"></span><br><span class="line">#### （1）前端页面</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;p&gt;&lt;label for=&quot;username&quot;&gt;username:&lt;/label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; class=&quot;form-control&quot;&gt;</span><br><span class="line">    &lt;span style=&quot;color: red&quot;&gt;&#123;&#123; back_dict.username &#125;&#125;&lt;/span&gt;</span><br><span class="line">    &#123;#   这是一个动态内容展示区域 #&#125;</span><br><span class="line">    &#123;#  &#123;&#123; back_dict.username &#125;&#125;会被解析为从后台返回的错误提示信息#&#125;</span><br><span class="line">    &#123;#  如果用户名有误，这里会显示红色的错误提示#&#125;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">     &lt;p&gt;&lt;label for=&quot;password&quot;&gt;password:&lt;/label&gt;</span><br><span class="line">    &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; class=&quot;form-control&quot;&gt;</span><br><span class="line">     &lt;span style=&quot;color: red&quot;&gt;&#123;&#123; back_dict.password &#125;&#125;&lt;/span&gt;</span><br><span class="line">         &#123;#   这是一个动态内容展示区域 #&#125;</span><br><span class="line">    &#123;#  &#123;&#123; back_dict.password &#125;&#125;会被解析为从后台返回的错误提示信息#&#125;</span><br><span class="line">    &#123;#  如果用户名有误，这里会显示红色的错误提示#&#125;</span><br><span class="line">     &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;input type=&quot;submit&quot; class=&quot;btn btn-danger&quot;&gt;&lt;/p&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>下面是对表格的解析</p>
<ul>
<li>
<p><code>&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</code>：</p>
</li>
<li>
<ul>
<li>定义一个表单，其中action属性为空字符串，这意味着表单默认提交到当前页面（或者在后端路由处理时会指定一个具体URL）。</li>
<li>method属性设置为&quot;post&quot;，表示表单数据将以POST方式发送，这种方式可以更好地保护敏感信息，如密码，因为它不会在URL中显示。</li>
</ul>
</li>
<li>
<p><code>&lt;p&gt;username: &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;username&quot;&gt;&lt;/p&gt;</code>：</p>
</li>
<li>
<ul>
<li>这部分创建了一个文本输入框，用户在此输入其用户名。</li>
<li>class属性值为&quot;form-control&quot;，这是Bootstrap框架提供的CSS类，用来设定输入框的样式。</li>
<li>name属性值为&quot;username&quot;，这个名称在服务器端接收表单数据时作为键名使用。</li>
</ul>
</li>
<li>
<p><code>&lt;span style=&quot;color: red&quot;&gt;{{ back_dict.username }}&lt;/span&gt;</code>：</p>
</li>
<li>
<ul>
<li>这是一个动态内容展示区域</li>
<li>根据所使用的模板引擎（如Jinja2、Vue.js等），{{ back_dict.username }}会被解析为从后台返回的错误提示信息</li>
<li>如果用户名有误，这里会显示红色的错误提示。</li>
</ul>
</li>
<li>
<p><code>&lt;p&gt;password: &lt;input type=&quot;password&quot; class=&quot;form-control&quot; name=&quot;password&quot;&gt;&lt;/p&gt;</code>：</p>
</li>
<li>
<ul>
<li>这部分创建了一个密码输入框，用户在此输入其密码。</li>
<li>type属性值为&quot;password&quot;，这样输入的内容会以星号或其他符号代替显示，保护用户密码不被他人窥视。</li>
<li>同样具有form-control样式和name属性。</li>
</ul>
</li>
<li>
<p><code>&lt;span style=&quot;color: red&quot;&gt;{{ back_dict.password }}&lt;/span&gt;</code>：</p>
</li>
<li>
<ul>
<li>与用户名输入框下方的span元素类似</li>
<li>此处用于显示密码输入的错误提示信息。</li>
</ul>
</li>
<li>
<p><code>&lt;input type=&quot;submit&quot; class=&quot;btn btn-danger&quot;&gt;</code>：</p>
</li>
<li>
<ul>
<li>定义一个提交按钮，点击该按钮时，表单数据将会被发送至服务器。</li>
<li>class属性值为&quot;btn btn-danger&quot;，这是Bootstrap中用于创建危险主题样式的按钮</li>
</ul>
</li>
</ul>
<h4 id="2-后端">(2)后端</h4>
```python
from django.shortcuts import render

def form_one(request):
    # 存储错误信息
    back_dict = {}
    if request.method == 'POST':
        username = request.POST.get('username')
        print(username)
        password = request.POST.get('password')
        print(password)
        # 判断用户名
        if "nb_" in username:
            # 保存错误信息
            back_dict["username"] = '用户名不符合格式！'
        # 判断密码
        if len(password) < 3:
            # 保存错误信息
            back_dict['password'] = '密码长度不可以低于3'
        '''
        无论是 get 请求 还是 post 请求，页面都能获取到字典
            get 请求时，字典是空的，没有值
            post 请求时 ，字典可能是非空的
        '''
    return render(request, 'form_one.html', locals())
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （3）用到了什么</span><br><span class="line"></span><br><span class="line">- 手动书写前端HTML页面代码 </span><br><span class="line"></span><br><span class="line">- - 渲染HTML页面</span><br><span class="line"></span><br><span class="line">- 后端对用户数据进行校验 </span><br><span class="line"></span><br><span class="line">- - 校验数据</span><br><span class="line"></span><br><span class="line">- 对不符合要求的数据进行前端提示 </span><br><span class="line"></span><br><span class="line">- - 展示提示信息</span><br><span class="line"></span><br><span class="line">### 【2】Form组件校验数据</span><br><span class="line"></span><br><span class="line">- form组件可以帮我们完成</span><br><span class="line"></span><br><span class="line">- - 渲染HTML页面</span><br><span class="line">  - 校验数据</span><br><span class="line">  - 展示提示信息</span><br><span class="line"></span><br><span class="line">- 为什么数据校验要在后端执行，而不是前端在JS完成？</span><br><span class="line"></span><br><span class="line">- - 数据校验前端可有可无</span><br><span class="line">  - 但是后端必须有！</span><br><span class="line"></span><br><span class="line">- 原因</span><br><span class="line"></span><br><span class="line">- - 前端的校验存在实时被修改的风险，可以在前端直接修改输入的数据</span><br><span class="line">  - 利用爬虫程序可以绕过前端页面直接向后端提交数据</span><br><span class="line"></span><br><span class="line">## 【四】Form组件如何校验数据</span><br><span class="line"></span><br><span class="line">### 【1】编写表达类</span><br><span class="line"></span><br><span class="line">- 我们可以通过Django提供的Form类来自用生成上面的表单，不再需要手动在HTML中编写</span><br><span class="line"></span><br><span class="line">#### （1）创建文件</span><br><span class="line"></span><br><span class="line">- 在APP内新建一个.py文件（这个套路是Django的惯用手法，就像views.py，models.py等等）</span><br><span class="line"></span><br><span class="line">#### （2）书写form表单类</span><br><span class="line"></span><br><span class="line">- 在App内创建一个userForms.py文件，文件内容如下</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 引入Django的forms组件</span><br><span class="line">from django import forms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建一个form的组件类</span><br><span class="line"># 继承form组件类 form.Form</span><br><span class="line">class LoginForm(forms.Form):</span><br><span class="line">    # 定义组件类属性</span><br><span class="line">    # 用户名：名字不能以nb_开头</span><br><span class="line">    username = forms.CharField(</span><br><span class="line">        # 最大长度</span><br><span class="line">        max_length=8,</span><br><span class="line">        # 最小长度</span><br><span class="line">        min_length=3</span><br><span class="line">    )</span><br><span class="line">    # 密码</span><br><span class="line">    password = forms.CharField(</span><br><span class="line">        # 长度不能小于3</span><br><span class="line">        min_length=3</span><br><span class="line">    )</span><br><span class="line">    # 邮箱</span><br><span class="line">    email = forms.EmailField()</span><br></pre></td></tr></table></figure>

<h4 id="（3）书写后端数据">（3）书写后端数据</h4>
```python
from django.shortcuts import render

# 导入自定义组件类（自己写的）
from user.userForms import LoginForm


def login(request):
    # 实例化组件类得到一个组件类
    login_form = LoginForm()
    # 在前端渲染上面的form对象
    # {{ login_form }}
    if request.method == 'POST':
        # form组件帮我们校验数据
        data = request.POST
        # 给一个错误的数据，用来校验
        data = {'username': 'dream', 'password': '1', "email": "123@qq.com"}
        form_obj = LoginForm(data=data)

        # 触发校验
        # 返回的值是bool值，收的数据不合规就是False，True
        # 必须有这个步骤，不然不校验
        # print(form_obj.is_valid())  # False
        # 校验步骤
        if not form_obj.is_valid():
            # 信息不合规进来
            # 查看错误的信息
            print(form_obj.errors)
            # 错误信息的格式
            # <ul class="errorlist"><li>password<ul class="errorlist"><li>Ensure this value has at least 3 characters (it has 1).</li></ul></li></ul>

            # 查看通过的信息
            print(form_obj.cleaned_data)
            # {'username': 'dream', 'email': '123@qq.com'}

            # 查看当前那些字段进行过校验
            print(form_obj.changed_data)
            # ['username', 'password', 'email']

            # 传入的参数没有：定义了但是没有传，就会报错，提示了参数必须穿
            # 传入的参数多了：没定义但是传了，就会不管，没被定义的参数不会被校验

    return render(request, 'form_one.html', locals())

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### (4)书写前端数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &#123;&#123; login_form &#125;&#125;</span><br><span class="line">    &lt;p&gt;&lt;input type=&quot;submit&quot; class=&quot;btn btn-danger&quot;&gt;&lt;/p&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="【五】Form组件的字段参数">【五】Form组件的字段参数</h2>
<h3 id="【1】总的参数案例">【1】总的参数案例</h3>
```python
from django import forms
from django.shortcuts import render

def login_one(request):
    # 定义form表单类
    class UserForm(forms.Form):
        username = forms.CharField(
            # 定义初始值
            initial='tom'
            # 最大长度
            max_length=8,
            # 最小长度
            min_length=3,
            # 非必须为空字段
            # required=False,
            # label是显示在输入框之前的提示文本
            label='用户名',
            # input框内的提示信息
            # initial='请输入用户名',
            # 提示文本与input框之间的提示文本呢
            label_suffix="￥",
            # 控制前端的样式
            widget=forms.widgets.TextInput(
                # 可以放前端的键值属性
                attrs={
                    'class': 'form-control',
                    # 如果不写id的话，浏览器检查给默认的id=id_username
                    'id': 'username',
                    # input框提示符
                    'placeholder': '请输入用户名'
                }
            ),
            # input框下面的文本
            help_text='用户名注解文本信息',
            # 存放错误信息
            error_messages={
                "required": '用户名必须传',
                "min_length": "你传的数据太短了",
                "max_length": "你传的数据太长了",

            },
            # input不可选中的状态
            disabled=True
        )
        password = forms.CharField(
            # 输入的额信息是保密的
            widget=forms.PasswordInput(

            )
        )
        # Select单选框
        hobby = forms.ChoiceField(
            choices=((1, '旅游'), (2, '爬山')),
            # 提示信息
            label='爱好',
            # 默认值
            initial='2',
            # Select单选框
            widget=forms.widgets.Select()
        )
        # 多选框SelectMultiple
        hobby_one = forms.MultipleChoiceField(
            choices=((1, '羽毛球'), (2, '乒乓球'), (3, '排球')),
            # 提示信息
            label='爱好',
            # 默认值
            initial=[2, 3],
            # SelectMultiple多选框
            widget=forms.widgets.SelectMultiple()
        )
        # 单选框CheckboxInput
        keep = forms.ChoiceField(
            label="是否记住密码",
            initial="checked",
            widget=forms.widgets.CheckboxInput()
        )
        #多选框
        hobby_two = forms.MultipleChoiceField(
            choices=((1, "篮球"), (2, "足球"), (3, "双色球"),),
            label="爱好",
            initial=[1, 3],
            widget=forms.widgets.CheckboxSelectMultiple()
        )
        # 选择框RadioSelect
        gender = forms.ChoiceField(
            choices=((1, "男"), (2, "女"), (3, "保密")),
            label="性别",
            initial=3,
            widget=forms.widgets.RadioSelect()
        )

    form_obj = UserForm({
        'username': '1222'
    })
    form_obj.is_valid()
    # 打印错误信息
    print(form_obj.errors)
    # 获取校验成功的数据
    print(form_obj.cleaned_data)

    return render(request, 'form_one.html', locals())

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】参数max_length</span><br><span class="line"></span><br><span class="line">- 字段的最大长度</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"> # 最大长度</span><br><span class="line">            max_length=8,</span><br></pre></td></tr></table></figure>

<h3 id="【3】参数min-length">【3】参数min_length</h3>
<ul>
<li>字段的最小长度</li>
</ul>
```python
# 最小长度
            min_length=3,
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【4】参数label</span><br><span class="line"></span><br><span class="line">- 输入框之前的提示文本</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"> # label是显示在输入框之前的提示文本</span><br><span class="line">            label=&#x27;用户名&#x27;,</span><br></pre></td></tr></table></figure>

<h3 id="【5】参数label-suffix">【5】参数label_suffix</h3>
<ul>
<li>提示文本与input框之间的提示文本呢</li>
</ul>
```python
# 提示文本与input框之间的提示文本呢
            label_suffix="￥",
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【6】参数widget</span><br><span class="line"></span><br><span class="line">- 控制前端的样式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 控制前端的样式</span><br><span class="line">            widget=forms.widgets.TextInput(</span><br><span class="line">                # 可以放前端的键值属性</span><br><span class="line">                attrs=&#123;</span><br><span class="line">                    &#x27;class&#x27;: &#x27;form-control&#x27;,</span><br><span class="line">                    # 如果不写id的话，浏览器检查给默认的id=id_username</span><br><span class="line">                    &#x27;id&#x27;: &#x27;username&#x27;,</span><br><span class="line">                    # input框提示符</span><br><span class="line">                    &#x27;placeholder&#x27;: &#x27;请输入用户名&#x27;</span><br><span class="line">                &#125;</span><br><span class="line">            ),</span><br></pre></td></tr></table></figure>

<h3 id="【7】参数help-text">【7】参数help_text</h3>
<ul>
<li>input框下面的文本</li>
</ul>
```python
 # input框下面的文本
  help_text='用户名注解文本信息',
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【8】参数error_messages</span><br><span class="line"></span><br><span class="line">- 存放错误信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 存放错误信息</span><br><span class="line">error_messages=&#123;</span><br><span class="line">   &quot;required&quot;: &#x27;用户名必须传&#x27;,</span><br><span class="line">   &quot;min_length&quot;: &quot;你传的数据太短了&quot;,</span><br><span class="line">   &quot;max_length&quot;: &quot;你传的数据太长了&quot;,</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line"># 也可以说是改变错误</span><br></pre></td></tr></table></figure>

<h3 id="【9】参数disabled">【9】参数disabled</h3>
<ul>
<li>input框不可选中的状态</li>
</ul>
```python
# input不可选中的状态
disabled=True
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【10】参数required</span><br><span class="line"></span><br><span class="line">- 非必须为空字段</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 非必须为空字段</span><br><span class="line"> required=False,</span><br></pre></td></tr></table></figure>

<h3 id="【11】参数initial">【11】参数initial</h3>
<ul>
<li>定义初始值</li>
</ul>
```python
# 定义初始值
 initial='tom'
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【12】参数validators</span><br><span class="line"></span><br><span class="line">- 指定一个列表，其中包含了为字段进行验证的函数。</span><br><span class="line">- 也就是说，如果你自定义了验证方法，不用Django内置的验证功能，那么要通过这个参数，将字段和自定义的验证方法链接起来。</span><br><span class="line">- 参考前面的章节，学习如何编写验证器</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django import forms  </span><br><span class="line">from django.core.exceptions import ValidationError  </span><br><span class="line">import re  </span><br><span class="line">  </span><br><span class="line">def validate_email(value):  </span><br><span class="line">    if not re.match(r&#x27;[^@]+@[^@]+\.[^@]+&#x27;, value):  </span><br><span class="line">        raise ValidationError(&quot;请输入一个有效的电子邮件地址&quot;)  </span><br><span class="line">  </span><br><span class="line">class EmailForm(forms.Form):  </span><br><span class="line">    email = forms.EmailField(validators=[validate_email])</span><br></pre></td></tr></table></figure>

<h3 id="【13】localize">【13】localize</h3>
<ul>
<li>localize参数帮助实现表单数据输入的本地化。</li>
<li><code>localize</code> 参数用于控制表单字段的本地化，特别是日期和时间字段。当设置为<code>True</code>时，Django会根据用户的地区设置来格式化输入和输出</li>
</ul>
```python
from django import forms  
  
class DateForm(forms.Form):  
    my_date = forms.DateField(localize=True)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【14】has_changed()方法</span><br><span class="line"></span><br><span class="line">- `has_changed()` 方法用于检查表单字段的值是否自表单实例化以来已被更改。这对于在表单提交时决定是否需要重新验证或更新数据非常有用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">form = UserProfileForm(request.POST, instance=user)  </span><br><span class="line">if form.is_valid():  </span><br><span class="line">    if form.fields[&#x27;email&#x27;].has_changed():  </span><br><span class="line">        # 执行与电子邮件更改相关的操作  </span><br><span class="line">        pass  </span><br><span class="line">    form.save()</span><br></pre></td></tr></table></figure>

<h3 id="【15】输入框password">【15】输入框password</h3>
<ul>
<li>PasswordInput：输入的密码保密</li>
</ul>
```python
password = forms.CharField(
   			min_length=6,
        	label="密码",
            # 输入的额信息是保密的
            widget=forms.PasswordInput(
				attrs={'class': 'c1'},
                render_value=True
            )
        )
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【16】选择框radioSelect</span><br><span class="line"></span><br><span class="line">- </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 选择框RadioSelect</span><br><span class="line">        gender = forms.ChoiceField(</span><br><span class="line">            choices=((1, &quot;男&quot;), (2, &quot;女&quot;), (3, &quot;保密&quot;)),</span><br><span class="line">            label=&quot;性别&quot;,</span><br><span class="line">            initial=3,</span><br><span class="line">            widget=forms.widgets.RadioSelect()</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240701220913512.png" alt="image-20240701220913512"></p>
<h3 id="【17】单选框Select">【17】单选框Select</h3>
```python
# Select单选框
        hobby = forms.ChoiceField(
            choices=((1, '旅游'), (2, '爬山')),
            # 提示信息
            label='爱好',
            # 默认值
            initial='2',
            # Select单选框
            widget=forms.widgets.Select()
        )
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240701220830767](D:\pycharm\Temporary_notes\图片\image-20240701220830767.png)</span><br><span class="line"></span><br><span class="line">### 【18】多选框SelectMultiple</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line"># 多选框SelectMultiple</span><br><span class="line">        hobby_one = forms.MultipleChoiceField(</span><br><span class="line">            choices=((1, &#x27;羽毛球&#x27;), (2, &#x27;乒乓球&#x27;), (3, &#x27;排球&#x27;)),</span><br><span class="line">            # 提示信息</span><br><span class="line">            label=&#x27;爱好&#x27;,</span><br><span class="line">            # 默认值</span><br><span class="line">            initial=[2, 3],</span><br><span class="line">            # SelectMultiple多选框</span><br><span class="line">            widget=forms.widgets.SelectMultiple()</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240701220838816.png" alt="image-20240701220838816"></p>
<h3 id="【19】单选框CheckboxInput">【19】单选框CheckboxInput</h3>
```python
# 单选框CheckboxInput
        keep = forms.ChoiceField(
            label="是否记住密码",
            initial="checked",
            widget=forms.widgets.CheckboxInput()
        )
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240701220855178](D:\pycharm\Temporary_notes\图片\image-20240701220855178.png)</span><br><span class="line"></span><br><span class="line">### 【20】多选框CheckboxSelectMultiple</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">#多选框</span><br><span class="line">        hobby_two = forms.MultipleChoiceField(</span><br><span class="line">            choices=((1, &quot;篮球&quot;), (2, &quot;足球&quot;), (3, &quot;双色球&quot;),),</span><br><span class="line">            label=&quot;爱好&quot;,</span><br><span class="line">            initial=[1, 3],</span><br><span class="line">            widget=forms.widgets.CheckboxSelectMultiple()</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240701220932862.png" alt="image-20240701220932862"></p>
<h2 id="【六】choice字段的注意事项">【六】choice字段的注意事项</h2>
<ul>
<li>
<p>在使用选择标签时</p>
</li>
<li>
<ul>
<li>需要注意choices的选项可以配置从数据库中获取</li>
</ul>
</li>
<li>
<p>但是由于是静态字段</p>
</li>
<li>
<ul>
<li>获取的值无法实时更新</li>
<li>需要重写构造方法从而实现choice实时更新。</li>
</ul>
</li>
</ul>
<h3 id="【1】方法一">【1】方法一</h3>
```python
from django.forms import Form
from django.forms import widgets
from django.forms import fields

 
class MyForm(Form):
 
    user = fields.ChoiceField(
        # choices=((1, '上海'), (2, '北京'),),
        initial=2,
        widget=widgets.Select
    )
 
    def __init__(self, *args, **kwargs):
        super(MyForm,self).__init__(*args, **kwargs)
        # self.fields['user'].choices = ((1, '上海'), (2, '北京'),)
        # 或
        self.fields['user'].choices = models.Classes.objects.all().values_list('id','caption')
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】方法二</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django import forms</span><br><span class="line">from django.forms import fields</span><br><span class="line">from django.forms import models as form_model</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">class FInfo(forms.Form):</span><br><span class="line">    authors = form_model.ModelMultipleChoiceField(queryset=models.NNewType.objects.all())  # 多选</span><br><span class="line">    # authors = form_model.ModelChoiceField(queryset=models.NNewType.objects.all())  # 单选</span><br></pre></td></tr></table></figure>

<h2 id="【七】自定义字段校验">【七】自定义字段校验</h2>
<h3 id="【1】自定义验函数">【1】自定义验函数</h3>
<ul>
<li>在内部创建了一个验证器函数</li>
<li>并把这个函数给你的form表单里面需要创建的字段</li>
<li><code>validators=[phone_validators]</code></li>
<li>抛出异常后被 forms_obj = UserInfo接收到</li>
</ul>
```python
from django import forms
from django.core.exceptions import ValidationError
from django.shortcuts import render


def login_one(request, *args, **kwargs):
    # 创建一个验证器函数
    def phone_validators(value):
        print(value)
        # 在这里面校验
        # 用正则校验
        mobile_re = re.compile(r'^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$')
        # 通过正则表达式对象匹配输入的内容
        if not mobile_re.match(value):
            # 主动抛出异常
            raise ValidationError('手机号的格式输入错误')

    class UserInfo(forms.Form):
        phone = forms.CharField(
            # max_length=11,
            # min_length=11,
            validators=[phone_validators]
        )

    forms_obj = UserInfo({
        'phone': '145745625'
    })
    forms_obj.is_valid()
    # 打印错误信息
    print(forms_obj.errors)
    # <ul class="errorlist"><li>phone<ul class="errorlist"><li>手机号的格式输入错误</li></ul></li></ul>
    # 获取校验成功的数据
    print(forms_obj.cleaned_data)
    # {}
    return render(request, 'form_one.html', locals())
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】总的说一下步骤</span><br><span class="line"></span><br><span class="line">- 首先定义一个form组件类</span><br><span class="line"></span><br><span class="line">- form组件继承forms.Form</span><br><span class="line"></span><br><span class="line">- &#123;% raw %&#125;```python</span><br><span class="line">  class UserInfo(forms.Form):</span><br></pre></td></tr></table></figure>

<ul>
<li>
<p>定义字段的验证规则<code>forms.CharField()</code></p>
</li>
<li>
```python
  class UserInfo(forms.Form):
          phone = forms.CharField(
              # max_length=11,
              # min_length=11,
              validators=[phone_validators]
          )
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">- 定义一个验证字段的函数</span><br><span class="line"></span><br><span class="line">- &#123;% raw %&#125;```python</span><br><span class="line">  def phone_validators(value):</span><br><span class="line">          print(value)</span><br><span class="line">          # 在这里面校验</span><br><span class="line">          # 用正则校验</span><br><span class="line">          mobile_re = re.compile(r&#x27;^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]&#123;8&#125;$&#x27;)</span><br><span class="line">          # 通过正则表达式对象匹配输入的内容</span><br><span class="line">          if not mobile_re.match(value):</span><br><span class="line">              # 主动抛出异常</span><br><span class="line">              raise ValidationError(&#x27;手机号的格式输入错误&#x27;)</span><br></pre></td></tr></table></figure>

</li>
<li>
<p>将验证函数添加到验证的规则里面</p>
</li>
<li>
```python
  phone.CharField(
      validators=[phone_validators]
  )
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【八】Form组件字段参数</span><br><span class="line"></span><br><span class="line">### 【1】内置字段</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">Field</span><br><span class="line">    required=True,               是否允许为空</span><br><span class="line">    widget=None,                 HTML插件</span><br><span class="line">    label=None,                  用于生成Label标签或显示内容</span><br><span class="line">    initial=None,                初始值</span><br><span class="line">    help_text=&#x27;&#x27;,                帮助信息(在标签旁边显示)</span><br><span class="line">    error_messages=None,         错误信息 &#123;&#x27;required&#x27;: &#x27;不能为空&#x27;, &#x27;invalid&#x27;: &#x27;格式错误&#x27;&#125;</span><br><span class="line">    validators=[],               自定义验证规则</span><br><span class="line">    localize=False,              是否支持本地化</span><br><span class="line">    disabled=False,              是否可以编辑</span><br><span class="line">    label_suffix=None            Label内容后缀</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">CharField(Field)</span><br><span class="line">    max_length=None,             最大长度</span><br><span class="line">    min_length=None,             最小长度</span><br><span class="line">    strip=True                   是否移除用户输入空白</span><br><span class="line"> </span><br><span class="line">IntegerField(Field)</span><br><span class="line">    max_value=None,              最大值</span><br><span class="line">    min_value=None,              最小值</span><br><span class="line"> </span><br><span class="line">FloatField(IntegerField)</span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">DecimalField(IntegerField)</span><br><span class="line">    max_value=None,              最大值</span><br><span class="line">    min_value=None,              最小值</span><br><span class="line">    max_digits=None,             总长度</span><br><span class="line">    decimal_places=None,         小数位长度</span><br><span class="line"> </span><br><span class="line">BaseTemporalField(Field)</span><br><span class="line">    input_formats=None          时间格式化   </span><br><span class="line"> </span><br><span class="line">DateField(BaseTemporalField)    格式：2015-09-01</span><br><span class="line">TimeField(BaseTemporalField)    格式：11:12</span><br><span class="line">DateTimeField(BaseTemporalField)格式：2015-09-01 11:12</span><br><span class="line"> </span><br><span class="line">DurationField(Field)            时间间隔：%d %H:%M:%S.%f</span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">RegexField(CharField)</span><br><span class="line">    regex,                      自定制正则表达式</span><br><span class="line">    max_length=None,            最大长度</span><br><span class="line">    min_length=None,            最小长度</span><br><span class="line">    error_message=None,         忽略，错误信息使用 error_messages=&#123;&#x27;invalid&#x27;: &#x27;...&#x27;&#125;</span><br><span class="line"> </span><br><span class="line">EmailField(CharField)      </span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">FileField(Field)</span><br><span class="line">    allow_empty_file=False     是否允许空文件</span><br><span class="line"> </span><br><span class="line">ImageField(FileField)      </span><br><span class="line">    ...</span><br><span class="line">    注：需要PIL模块，pip3 install Pillow</span><br><span class="line">    以上两个字典使用时，需要注意两点：</span><br><span class="line">        - form表单中 enctype=&quot;multipart/form-data&quot;</span><br><span class="line">        - view函数中 obj = MyForm(request.POST, request.FILES)</span><br><span class="line"> </span><br><span class="line">URLField(Field)</span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">BooleanField(Field)  </span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">NullBooleanField(BooleanField)</span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">ChoiceField(Field)</span><br><span class="line">    ...</span><br><span class="line">    choices=(),                选项，如：choices = ((0,&#x27;上海&#x27;),(1,&#x27;北京&#x27;),)</span><br><span class="line">    required=True,             是否必填</span><br><span class="line">    widget=None,               插件，默认select插件</span><br><span class="line">    label=None,                Label内容</span><br><span class="line">    initial=None,              初始值</span><br><span class="line">    help_text=&#x27;&#x27;,              帮助提示</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">ModelChoiceField(ChoiceField)</span><br><span class="line">    ...                        django.forms.models.ModelChoiceField</span><br><span class="line">    queryset,                  # 查询数据库中的数据</span><br><span class="line">    empty_label=&quot;---------&quot;,   # 默认空显示内容</span><br><span class="line">    to_field_name=None,        # HTML中value的值对应的字段</span><br><span class="line">    limit_choices_to=None      # ModelForm中对queryset二次筛选</span><br><span class="line">     </span><br><span class="line">ModelMultipleChoiceField(ModelChoiceField)</span><br><span class="line">    ...                        django.forms.models.ModelMultipleChoiceField</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">     </span><br><span class="line">TypedChoiceField(ChoiceField)</span><br><span class="line">    coerce = lambda val: val   对选中的值进行一次转换</span><br><span class="line">    empty_value= &#x27;&#x27;            空值的默认值</span><br><span class="line"> </span><br><span class="line">MultipleChoiceField(ChoiceField)</span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">TypedMultipleChoiceField(MultipleChoiceField)</span><br><span class="line">    coerce = lambda val: val   对选中的每一个值进行一次转换</span><br><span class="line">    empty_value= &#x27;&#x27;            空值的默认值</span><br><span class="line"> </span><br><span class="line">ComboField(Field)</span><br><span class="line">    fields=()                  使用多个验证，如下：即验证最大长度20，又验证邮箱格式</span><br><span class="line">                               fields.ComboField(fields=[fields.CharField(max_length=20), fields.EmailField(),])</span><br><span class="line"> </span><br><span class="line">MultiValueField(Field)</span><br><span class="line">    PS: 抽象类，子类中可以实现聚合多个字典去匹配一个值，要配合MultiWidget使用</span><br><span class="line"> </span><br><span class="line">SplitDateTimeField(MultiValueField)</span><br><span class="line">    input_date_formats=None,   格式列表：[&#x27;%Y--%m--%d&#x27;, &#x27;%m%d/%Y&#x27;, &#x27;%m/%d/%y&#x27;]</span><br><span class="line">    input_time_formats=None    格式列表：[&#x27;%H:%M:%S&#x27;, &#x27;%H:%M:%S.%f&#x27;, &#x27;%H:%M&#x27;]</span><br><span class="line"> </span><br><span class="line">FilePathField(ChoiceField)     文件选项，目录下文件显示在页面中</span><br><span class="line">    path,                      文件夹路径</span><br><span class="line">    match=None,                正则匹配</span><br><span class="line">    recursive=False,           递归下面的文件夹</span><br><span class="line">    allow_files=True,          允许文件</span><br><span class="line">    allow_folders=False,       允许文件夹</span><br><span class="line">    required=True,</span><br><span class="line">    widget=None,</span><br><span class="line">    label=None,</span><br><span class="line">    initial=None,</span><br><span class="line">    help_text=&#x27;&#x27;</span><br><span class="line"> </span><br><span class="line">GenericIPAddressField</span><br><span class="line">    protocol=&#x27;both&#x27;,           both,ipv4,ipv6支持的IP格式</span><br><span class="line">    unpack_ipv4=False          解析ipv4地址，如果是::ffff:192.0.2.1时候，可解析为192.0.2.1， PS：protocol必须为both才能启用</span><br><span class="line"> </span><br><span class="line">SlugField(CharField)           数字，字母，下划线，减号（连字符）</span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">UUIDField(CharField)           uuid类型</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="【2】概述">【2】概述</h3>
<h4 id="（1）BooleanField">（1）BooleanField</h4>
<ul>
<li>默认的Widget：CheckboxInput</li>
<li>空值：False</li>
<li>规范化为：Python的True或者False</li>
<li>可用的错误信息键：required</li>
</ul>
<h4 id="（2）CharField">（2）CharField</h4>
<ul>
<li>默认的Widget：TextInput</li>
<li>空值：与empty_value给出的任何值。</li>
<li>规范化为：一个Unicode 对象。</li>
<li>验证max_length或min_length，如果设置了这两个参数。 否则，所有的输入都是合法的。</li>
<li>可用的错误信息键：min_length, max_length, required</li>
</ul>
<p>有四个可选参数：</p>
<ul>
<li>max_length，min_length：设置字符串的最大和最小长度。</li>
<li>strip：如果True（默认），去除输入的前导和尾随空格。</li>
<li>empty_value：用来表示“空”的值。 默认为空字符串。</li>
</ul>
<h4 id="（3）ChoiceField">（3）ChoiceField</h4>
<ul>
<li>默认的Widget：Select</li>
<li>空值：‘’（一个空字符串）</li>
<li>规范化为：一个Unicode 对象。</li>
<li>验证给定的值是否在选项列表中。</li>
<li>可用的错误信息键：required, invalid_choice</li>
</ul>
<p>参数choices：</p>
<p>用来作为该字段选项的一个二元组组成的可迭代对象（例如，列表或元组）或者一个可调用对象。</p>
<p>格式与用于和ORM模型字段的choices参数相同。</p>
<h4 id="（4）TypedChoiceField">（4）TypedChoiceField</h4>
<p>像ChoiceField一样，只是还有两个额外的参数：coerce和empty_value。</p>
<ul>
<li>默认的Widget：Select</li>
<li>空值：empty_value参数设置的值。</li>
<li>规范化为：coerce参数类型的值。</li>
<li>验证给定的值在选项列表中存在并且可以被强制转换。</li>
<li>可用的错误信息的键：required, invalid_choice</li>
</ul>
<h4 id="（5）DateField">（5）DateField</h4>
<ul>
<li>默认的Widget：DateInput</li>
<li>空值：None</li>
<li>规范化为：datetime.date对象。</li>
<li>验证给出的值是一个datetime.date、datetime.datetime 或指定日期格式的字符串。</li>
<li>错误信息的键：required, invalid</li>
</ul>
<p>接收一个可选的参数：input_formats。</p>
<p>一个格式的列表，用于转换字符串为datetime.date对象。</p>
<p>如果没有提供input_formats，默认的输入格式为：</p>
```plain
['%Y-%m-%d',      # '2006-10-25'
 '%m/%d/%Y',      # '10/25/2006'
 '%m/%d/%y']      # '10/25/06'
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">另外，如果你在设置中指定USE_L10N=False，以下的格式也将包含在默认的输入格式中：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```plain</span><br><span class="line">[&#x27;%b %d %Y&#x27;,      # &#x27;Oct 25 2006&#x27;</span><br><span class="line"> &#x27;%b %d, %Y&#x27;,     # &#x27;Oct 25, 2006&#x27;</span><br><span class="line"> &#x27;%d %b %Y&#x27;,      # &#x27;25 Oct 2006&#x27;</span><br><span class="line"> &#x27;%d %b, %Y&#x27;,     # &#x27;25 Oct, 2006&#x27;</span><br><span class="line"> &#x27;%B %d %Y&#x27;,      # &#x27;October 25 2006&#x27;</span><br><span class="line"> &#x27;%B %d, %Y&#x27;,     # &#x27;October 25, 2006&#x27;</span><br><span class="line"> &#x27;%d %B %Y&#x27;,      # &#x27;25 October 2006&#x27;</span><br><span class="line"> &#x27;%d %B, %Y&#x27;]     # &#x27;25 October, 2006&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="（6）DateTimeField">（6）DateTimeField</h4>
<ul>
<li>默认的Widget：DateTimeInput</li>
<li>空值：None</li>
<li>规范化为：Python的datetime.datetime对象。</li>
<li>验证给出的值是一个datetime.datetime、datetime.date或指定日期格式的字符串。</li>
<li>错误信息的键：required, invalid</li>
</ul>
<p>接收一个可选的参数：input_formats</p>
<p>如果没有提供input_formats，默认的输入格式为：</p>
```plain
['%Y-%m-%d %H:%M:%S',    # '2006-10-25 14:30:59'
 '%Y-%m-%d %H:%M',       # '2006-10-25 14:30'
 '%Y-%m-%d',             # '2006-10-25'
 '%m/%d/%Y %H:%M:%S',    # '10/25/2006 14:30:59'
 '%m/%d/%Y %H:%M',       # '10/25/2006 14:30'
 '%m/%d/%Y',             # '10/25/2006'
 '%m/%d/%y %H:%M:%S',    # '10/25/06 14:30:59'
 '%m/%d/%y %H:%M',       # '10/25/06 14:30'
 '%m/%d/%y']             # '10/25/06'
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （7）DecimalField</span><br><span class="line"></span><br><span class="line">- 默认的Widget：当Field.localize是False时为NumberInput，否则为TextInput。</span><br><span class="line">- 空值：None</span><br><span class="line">- 规范化为：Python decimal对象。</span><br><span class="line">- 验证给定的值为一个十进制数。 忽略前导和尾随的空白。</span><br><span class="line">- 错误信息的键：max_whole_digits, max_digits, max_decimal_places,max_value, invalid, required,min_value</span><br><span class="line"></span><br><span class="line">接收四个可选的参数：</span><br><span class="line"></span><br><span class="line">max_value,min_value:允许的值的范围，需要赋值decimal.Decimal对象，不能直接给个整数类型。</span><br><span class="line"></span><br><span class="line">max_digits：值允许的最大位数（小数点之前和之后的数字总共的位数，前导的零将被删除）。</span><br><span class="line"></span><br><span class="line">decimal_places：允许的最大小数位。</span><br><span class="line"></span><br><span class="line">#### （8）DurationField</span><br><span class="line"></span><br><span class="line">- 默认的Widget：TextInput</span><br><span class="line">- 空值：None</span><br><span class="line">- 规范化为：Python timedelta。</span><br><span class="line">- 验证给出的值是一个字符串，而且可以转换为timedelta对象。</span><br><span class="line">- 错误信息的键：required, invalid.</span><br><span class="line"></span><br><span class="line">#### （9）EmailField</span><br><span class="line"></span><br><span class="line">- 默认的Widget：EmailInput</span><br><span class="line">- 空值：&#x27;&#x27;（一个空字符串）</span><br><span class="line">- 规范化为：Unicode 对象。</span><br><span class="line">- 使用正则表达式验证给出的值是一个合法的邮件地址。</span><br><span class="line">- 错误信息的键：required, invalid</span><br><span class="line"></span><br><span class="line">两个可选的参数用于验证，max_length 和min_length。</span><br><span class="line"></span><br><span class="line">#### （10）FileField</span><br><span class="line"></span><br><span class="line">- 默认的Widget：ClearableFileInput</span><br><span class="line">- 空值：None</span><br><span class="line">- 规范化为：一个UploadedFile对象，它封装文件内容和文件名到一个对象内。</span><br><span class="line">- 验证非空的文件数据已经绑定到表单。</span><br><span class="line">- 错误信息的键：missing, invalid, required, empty, max_length</span><br><span class="line"></span><br><span class="line">具有两个可选的参数用于验证：max_length 和 allow_empty_file。</span><br><span class="line"></span><br><span class="line">#### （11）FilePathField</span><br><span class="line"></span><br><span class="line">- 默认的Widget：Select</span><br><span class="line">- 空值：None</span><br><span class="line">- 规范化为：Unicode 对象。</span><br><span class="line">- 验证选择的选项在选项列表中存在。</span><br><span class="line">- 错误信息的键：required, invalid_choice</span><br><span class="line"></span><br><span class="line">这个字段允许从一个特定的目录选择文件。 它有五个额外的参数，其中的path是必须的：</span><br><span class="line"></span><br><span class="line">path：要列出的目录的绝对路径。 这个目录必须存在。</span><br><span class="line"></span><br><span class="line">recursive：如果为False（默认值），只用直接位于path下的文件或目录作为选项。如果为True，将递归访问这个目录，其内所有的子目录和文件都将作为选项。</span><br><span class="line"></span><br><span class="line">match：正则表达模式；只有具有与此表达式匹配的文件名称才被允许作为选项。</span><br><span class="line"></span><br><span class="line">allow_files：可选。默认为True。表示是否应该包含指定位置的文件。它和allow_folders必须有一个为True。</span><br><span class="line"></span><br><span class="line">allow_folders可选。默认为False。表示是否应该包含指定位置的目录。</span><br><span class="line"></span><br><span class="line">#### （12）FloatField</span><br><span class="line"></span><br><span class="line">- 默认的Widget：当Field.localize是False时为NumberInput，否则为TextInput。</span><br><span class="line">- 空值：None</span><br><span class="line">- 规范化为：Float 对象。</span><br><span class="line">- 验证给定的值是一个浮点数。</span><br><span class="line">- 错误信息的键：max_value, invalid, required, min_value</span><br><span class="line"></span><br><span class="line">接收两个可选的参数用于验证，max_value和min_value，控制允许的值的范围。</span><br><span class="line"></span><br><span class="line">#### （13）ImageField</span><br><span class="line"></span><br><span class="line">- 默认的Widget：ClearableFileInput</span><br><span class="line">- 空值：None</span><br><span class="line">- 规范化为：一个UploadedFile 象，它封装文件内容和文件名为一个单独的对象。</span><br><span class="line">- 验证文件数据已绑定到表单，并且该文件是Pillow可以解析的图像格式。</span><br><span class="line">- 错误信息的键：missing, invalid, required, empty, invalid_image</span><br><span class="line"></span><br><span class="line">使用ImageField需要安装Pillow（pip install pillow）。如果在上传图片时遇到图像损坏错误，通常意味着使用了Pillow不支持的格式。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">&gt;&gt;&gt; from PIL import Image</span><br><span class="line">&gt;&gt;&gt; from django import forms</span><br><span class="line">&gt;&gt;&gt; from django.core.files.uploadedfile import SimpleUploadedFile</span><br><span class="line">&gt;&gt;&gt; class ImageForm(forms.Form):</span><br><span class="line">...     img = forms.ImageField()</span><br><span class="line">&gt;&gt;&gt; file_data = &#123;&#x27;img&#x27;: SimpleUploadedFile(&#x27;test.png&#x27;, &lt;file data&gt;)&#125;</span><br><span class="line">&gt;&gt;&gt; form = ImageForm(&#123;&#125;, file_data)</span><br><span class="line"># Pillow closes the underlying file descriptor.</span><br><span class="line">&gt;&gt;&gt; form.is_valid()</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; image_field = form.cleaned_data[&#x27;img&#x27;]</span><br><span class="line">&gt;&gt;&gt; image_field.image</span><br><span class="line">&lt;PIL.PngImagePlugin.PngImageFile image mode=RGBA size=191x287 at 0x7F5985045C18&gt;</span><br><span class="line">&gt;&gt;&gt; image_field.image.width</span><br><span class="line">191</span><br><span class="line">&gt;&gt;&gt; image_field.image.height</span><br><span class="line">287</span><br><span class="line">&gt;&gt;&gt; image_field.image.format</span><br><span class="line">&#x27;PNG&#x27;</span><br><span class="line">&gt;&gt;&gt; image_field.image.getdata()</span><br><span class="line"># Raises AttributeError: &#x27;NoneType&#x27; object has no attribute &#x27;seek&#x27;.</span><br><span class="line">&gt;&gt;&gt; image = Image.open(image_field)</span><br><span class="line">&gt;&gt;&gt; image.getdata()</span><br><span class="line">&lt;ImagingCore object at 0x7f5984f874b0&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（14）IntegerField">（14）IntegerField</h4>
<ul>
<li>默认的Widget：当Field.localize是False时为NumberInput，否则为TextInput。</li>
<li>空值：None</li>
<li>规范化为：Python 整数或长整数。</li>
<li>验证给定值是一个整数。 允许前导和尾随空格，类似Python的int()函数。</li>
<li>错误信息的键：max_value, invalid, required, min_value</li>
</ul>
<p>两个可选参数：max_value和min_value，控制允许的值的范围。</p>
<h4 id="（15）JSONField">（15）JSONField</h4>
<p>Django3.1新增。</p>
<p>接收JSON编码的字段。</p>
<ul>
<li>默认的Widget：Textarea</li>
<li>空值：None</li>
<li>规范化为：一个JSON对象。</li>
<li>验证给定值是否合法的JSON。</li>
<li>错误信息的键：required, invalid</li>
<li>可接受两个参数：encoder和decoder，编码器和解码器</li>
</ul>
<h4 id="（16）GenericIPAddressField">（16）GenericIPAddressField</h4>
<p>包含IPv4或IPv6地址的字段。</p>
<ul>
<li>默认的Widget：TextInput</li>
<li>空值：‘’（一个空字符串）</li>
<li>规范化为：一个Unicode对象。</li>
<li>验证给定值是有效的IP地址。</li>
<li>错误信息的键：required, invalid</li>
</ul>
<p>有两个可选参数：protocol和unpack_ipv4</p>
<h4 id="（17）MultipleChoiceField">（17）MultipleChoiceField</h4>
<ul>
<li>默认的Widget：SelectMultiple</li>
<li>空值：[]（一个空列表）</li>
<li>规范化为：一个Unicode 对象列表。</li>
<li>验证给定值列表中的每个值都存在于选择列表中。</li>
<li>错误信息的键：invalid_list, invalid_choice, required</li>
</ul>
<h4 id="（18）TypedMultipleChoiceField">（18）TypedMultipleChoiceField</h4>
<p>类似MultipleChoiceField，除了需要两个额外的参数，coerce和empty_value。</p>
<ul>
<li>默认的Widget：SelectMultiple</li>
<li>空值：empty_value</li>
<li>规范化为：coerce参数提供的类型值列表。</li>
<li>验证给定值存在于选项列表中并且可以强制。</li>
<li>错误信息的键：required, invalid_choice</li>
</ul>
<h4 id="（19）NullBooleanField">（19）NullBooleanField</h4>
<ul>
<li>默认的Widget：NullBooleanSelect</li>
<li>空值：None</li>
<li>规范化为：Python None, False 或True 值。</li>
<li>不验证任何内容（即，它从不引发ValidationError）。</li>
</ul>
<h4 id="（20）RegexField">（20）RegexField</h4>
<ul>
<li>默认的Widget：TextInput</li>
<li>空值：‘’（一个空字符串）</li>
<li>规范化为：一个Unicode 对象。</li>
<li>验证给定值与某个正则表达式匹配。</li>
<li>错误信息的键：required, invalid</li>
</ul>
<p>需要一个必需的参数：regex，需要匹配的正则表达式。</p>
<p>还可以接收max_length，min_length和strip参数，类似CharField。</p>
<h4 id="（21）SlugField">（21）SlugField</h4>
<ul>
<li>默认的Widget：TextInput</li>
<li>空值：‘’（一个空字符串）</li>
<li>规范化为：一个Unicode 对象。</li>
<li>验证给定的字符串只包括字母、数字、下划线及连字符。</li>
<li>错误信息的键：required, invalid</li>
</ul>
<p>此字段用于在表单中表示模型的SlugField。</p>
<h4 id="（22）TimeField">（22）TimeField</h4>
<ul>
<li>默认的Widget：TextInput</li>
<li>空值：None</li>
<li>规范化为：一个Python 的datetime.time 对象。</li>
<li>验证给定值是datetime.time或以特定时间格式格式化的字符串。</li>
<li>错误信息的键：required, invalid</li>
</ul>
<p>接收一个可选的参数：input_formats，用于尝试将字符串转换为有效的datetime.time对象的格式列表。</p>
<p>如果没有提供input_formats，默认的输入格式为：</p>
```plain
'%H:%M:%S',     # '14:30:59'
'%H:%M',        # '14:30'
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （23）URLField</span><br><span class="line"></span><br><span class="line">- 默认的Widget：URLInput</span><br><span class="line">- 空值：&#x27;&#x27;（一个空字符串）</span><br><span class="line">- 规范化为：一个Unicode 对象。</span><br><span class="line">- 验证给定值是个有效的URL。</span><br><span class="line">- 错误信息的键：required, invalid</span><br><span class="line"></span><br><span class="line">可选参数：max_length和min_length</span><br><span class="line"></span><br><span class="line">#### （24）UUIDField</span><br><span class="line"></span><br><span class="line">- 默认的Widget：TextInput</span><br><span class="line">- 空值：&#x27;&#x27;（一个空字符串）</span><br><span class="line">- 规范化为：UUID对象。</span><br><span class="line">- 错误信息的键：required, invalid</span><br><span class="line"></span><br><span class="line">#### （25） ComboField</span><br><span class="line"></span><br><span class="line">- 默认的Widget：TextInput</span><br><span class="line">- 空值：&#x27;&#x27;（一个空字符串）</span><br><span class="line">- 规范化为：Unicode 对象。</span><br><span class="line">- 根据指定为ComboField的参数的每个字段验证给定值。</span><br><span class="line">- 错误信息的键：required, invalid</span><br><span class="line"></span><br><span class="line">接收一个额外的必选参数：fields，用于验证字段值的字段列表（按提供它们的顺序）。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```plain</span><br><span class="line">&gt;&gt;&gt; from django.forms import ComboField</span><br><span class="line">&gt;&gt;&gt; f = ComboField(fields=[CharField(max_length=20), EmailField()])</span><br><span class="line">&gt;&gt;&gt; f.clean(&#x27;test@example.com&#x27;)</span><br><span class="line">&#x27;test@example.com&#x27;</span><br><span class="line">&gt;&gt;&gt; f.clean(&#x27;longemailaddress@example.com&#x27;)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">...</span><br><span class="line">ValidationError: [&#x27;Ensure this value has at most 20 characters (it has 28).&#x27;]</span><br></pre></td></tr></table></figure>

<h4 id="（26）MultiValueField">（26）MultiValueField</h4>
<ul>
<li>默认的Widget：TextInput</li>
<li>空值：‘’（一个空字符串）</li>
<li>规范化为：子类的compress方法返回的类型。</li>
<li>根据指定为MultiValueField的参数的每个字段验证给定值。</li>
<li>错误信息的键：incomplete, invalid, required</li>
</ul>
<h4 id="（27）SplitDateTimeField">（27）SplitDateTimeField</h4>
<ul>
<li>默认的Widget：SplitDateTimeWidget</li>
<li>空值：None</li>
<li>规范化为：Python datetime.datetime 对象。</li>
<li>验证给定的值是datetime.datetime或以特定日期时间格式格式化的字符串。</li>
<li>错误信息的键：invalid_date, invalid, required, invalid_time</li>
</ul>
<h3 id="【3】创建自定义字段">【3】创建自定义字段</h3>
<ul>
<li>如果内置的Field真的不能满足你的需求，还可以自定义Field。</li>
<li>只需要创建一个django.forms.Field的子类，并实现clean()和__init__()构造方法。<code>__init__</code>()构造方法需要接收前面提过的那些核心参数，比如widget、required,、label、help_text、initial。</li>
<li>还可以通过覆盖get_bound_field()方法来自定义访问字段的方式</li>
</ul>
<h2 id="【九】forms组件参数总结，补充">【九】forms组件参数总结，补充</h2>
<h3 id="【1】基本参数">【1】基本参数</h3>
<h4 id="【1】autocomplete">【1】autocomplete</h4>
<ul>
<li>设置是否启用自动填充功能，可以使用以下值：</li>
<li>on：浏览器自动填充表单项。</li>
<li>off：禁用浏览器自动填充。</li>
</ul>
<h4 id="【2】disabled">【2】disabled</h4>
<ul>
<li>设置表单项是否禁用，禁用后用户无法编辑或选择该项的值。</li>
</ul>
<h4 id="【3】readonly">【3】readonly</h4>
<ul>
<li>设置表单项是否只读，只读的表单项可以显示但不允许用户修改。</li>
</ul>
<h4 id="【4】max-和-min">【4】max 和 min</h4>
<ul>
<li>用于限制数字或日期类型的输入值的最大和最小值。</li>
</ul>
<h4 id="【5】-maxlength-和-minlength">【5】***maxlength 和 minlength</h4>
<ul>
<li>设置输入值的最大长度和最小长度，超过或低于长度限制时将触发验证错误。</li>
</ul>
<h4 id="【6】pattern">【6】pattern</h4>
<ul>
<li>使用正则表达式指定输入值的格式验证规则。</li>
</ul>
<h4 id="【7】required">【7】required</h4>
<ul>
<li>设置表单项是否为必填项，如果未填写必填项，提交表单时将触发验证错误。</li>
</ul>
<h4 id="【8】step">【8】step</h4>
<ul>
<li>用于数字类型的输入值，指定允许的增量或减量范围。</li>
</ul>
<h4 id="【9】aria-describedby">【9】aria-describedby</h4>
<ul>
<li>指定与表单项关联的描述性文本的id，辅助技术可以使用此信息提供更好的可访问性。</li>
</ul>
<h4 id="【10】aria-invalid">【10】aria-invalid</h4>
<ul>
<li>设置是否将表单项标记为无效，如果表单项的值不符合验证规则，可以将其设置为&quot;true&quot;。</li>
</ul>
<h3 id="【2】参数详解">【2】参数详解</h3>
<h4 id="（1）-widget：添加标签属性">（1）***widget：添加标签属性</h4>
<ul>
<li>指定字段的控件显示方式。</li>
<li>可以使用各种预定义的小部件（widgets）或自定义的小部件类。</li>
<li>例如，可以使用 forms.TextInput 将字段以文本框的形式显示出来：</li>
</ul>
```python
from django import forms

class MyForm(forms.Form):
    username = forms.CharField(
        max_length=8,
        min_length=3,
        label="用户名",
        widget=forms.TextInput(attrs={"class": "form-control"})
    )
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 在Django的表单中 </span><br><span class="line"></span><br><span class="line">- - widget参数用于设置表单字段的展示方式或使用自定义的HTML元素来呈现字段。</span><br><span class="line"></span><br><span class="line">- widget参数 </span><br><span class="line"></span><br><span class="line">- - 可以接受一个Django提供的内置的小部件类（widget class）</span><br><span class="line">  - 也可以使用自定义的小部件类。</span><br><span class="line"></span><br><span class="line">- 以下是几个常用的小部件类及其作用：</span><br><span class="line"></span><br><span class="line">1. forms.TextInput：默认的文本输入框小部件。</span><br><span class="line">2. forms.Textarea：多行文本输入框小部件。</span><br><span class="line">3. forms.CheckboxInput：复选框小部件。</span><br><span class="line">4. forms.Select：下拉选择框小部件。</span><br><span class="line">5. forms.RadioSelect：单选按钮小部件。</span><br><span class="line">6. forms.FileInput：文件上传小部件。</span><br><span class="line">7. forms.HiddenInput：隐藏输入框小部件。</span><br><span class="line"></span><br><span class="line">- 下面是一个示例代码片段 </span><br><span class="line"></span><br><span class="line">- - 演示如何使用widget参数定义一个表单字段的小部件：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django import forms</span><br><span class="line"></span><br><span class="line">class MyForm(forms.Form):</span><br><span class="line">    username = forms.CharField(</span><br><span class="line">        max_length=100,</span><br><span class="line">        widget=forms.TextInput(attrs=&#123;&#x27;class&#x27;: &#x27;my-custom-class&#x27;&#125;)</span><br><span class="line">    )</span><br><span class="line">    password = forms.CharField(</span><br><span class="line">        max_length=100,</span><br><span class="line">        widget=forms.PasswordInput()</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<ul>
<li>
<p>上述代码中</p>
</li>
<li>
<ul>
<li>username 字段使用自定义的CSS类样式，并将其应用到一个文本输入框小部件中。</li>
<li>password 字段则使用了密码输入框小部件。</li>
</ul>
</li>
<li>
<p>需要注意的是</p>
</li>
<li>
<ul>
<li>可以通过attrs参数传递其他的HTML属性给小部件。</li>
<li>例如，在上面的示例中，我们为username字段定义了class属性。</li>
</ul>
</li>
<li>
<p>另外</p>
</li>
<li>
<ul>
<li>如果想要使用自定义的小部件类</li>
<li>可以定义一个继承自Django小部件类的类，并将其传递给widget参数。例如</li>
</ul>
</li>
</ul>
```python
from django import forms

class MyCustomWidget(forms.widgets.TextInput):
    # 自定义的小部件类

class MyForm(forms.Form):
    my_field = forms.CharField(
        widget=MyCustomWidget()
    )
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 上述代码中 </span><br><span class="line"></span><br><span class="line">- - 我们创建了一个名为MyCustomWidget的自定义小部件类，</span><br><span class="line">  - 并将其用于my_field字段。</span><br><span class="line"></span><br><span class="line">- 通过使用widget参数 </span><br><span class="line"></span><br><span class="line">- - 我们可以对Django表单字段的展示方式进行灵活的定制</span><br><span class="line">  - 以满足具体项目的需求。</span><br><span class="line"></span><br><span class="line">#### (2)***required：是否为必填字段</span><br><span class="line"></span><br><span class="line">- 设置字段是否为必填项，默认为 True。</span><br><span class="line">- 如果设置为 False，则允许用户提交空值。例如：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">class MyForm(forms.Form):</span><br><span class="line">    username = forms.CharField(</span><br><span class="line">        max_length=8,</span><br><span class="line">        min_length=3,</span><br><span class="line">        label=&quot;用户名&quot;,</span><br><span class="line">        required=False</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h4 id="（3）-label：自定义标签文本">（3）***label：自定义标签文本</h4>
<ul>
<li>指定字段的标签显示文本。</li>
<li>可以使用该参数自定义字段在表单中的标签文本。例如：</li>
</ul>
```python
class MyForm(forms.Form):
    username = forms.CharField(
        max_length=8,
        min_length=3,
        label="Your Username"
    )
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （4）***error_messages：标签不合法的提示信息</span><br><span class="line"></span><br><span class="line">- 用于自定义错误消息。</span><br><span class="line">- 可以通过该参数自定义字段验证失败时显示的错误消息。例如：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">class MyForm(forms.Form):</span><br><span class="line">    username = forms.CharField(</span><br><span class="line">        max_length=8,</span><br><span class="line">        min_length=3,</span><br><span class="line">        label=&quot;用户名&quot;,</span><br><span class="line">        error_messages=&#123;</span><br><span class="line">            &quot;max_length&quot;: &quot;用户名最多为8个字符&quot;,</span><br><span class="line">            &quot;min_length&quot;: &quot;用户名至少为3个字符&quot;,</span><br><span class="line">            &quot;required&quot;: &quot;请填写用户名&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h4 id="（5）help-text：描述提醒信息">（5）help_text：描述提醒信息</h4>
<ul>
<li>为字段提供帮助文本。</li>
<li>可以使用该参数为字段添加描述性的帮助文本，以向用户解释该字段的用途或提供输入建议。例如：</li>
</ul>
```python
class MyForm(forms.Form):
    username = forms.CharField(
        max_length=8,
        min_length=3,
        label="用户名",
        help_text="请输入3-8个字符的用户名"
    )
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### （6）***validators：正则表达式</span><br><span class="line"></span><br><span class="line">- 用于自定义字段验证器。</span><br><span class="line">- 可以使用该参数添加额外的验证函数来对字段进行更复杂的验证。例如：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.core.validators import RegexValidator</span><br><span class="line"></span><br><span class="line">class MyForm(forms.Form):</span><br><span class="line">    username = forms.CharField(</span><br><span class="line">        max_length=8,</span><br><span class="line">        min_length=3,</span><br><span class="line">        label=&quot;用户名&quot;,</span><br><span class="line">        validators=[</span><br><span class="line">            RegexValidator(</span><br><span class="line">                regex=r&quot;^[a-zA-Z]+$&quot;,</span><br><span class="line">                message=&quot;只允许字母字符&quot;</span><br><span class="line">            )</span><br><span class="line">        ]</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h3 id="（7）-initial：默认值">（7）***initial：默认值</h3>
<ul>
<li>可以通过 initial 参数为表单字段设置默认值。</li>
<li>该参数指定了在表单加载时显示的初始值。以下是示例代码：</li>
</ul>
```python
from django import forms

class MyForm(forms.Form):
    username = forms.CharField(
        max_length=8,
        min_length=3,
        label="用户名",
        initial="JohnDoe"
    )
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 在上述示例中 </span><br><span class="line"></span><br><span class="line">- - username 字段将显示一个文本框</span><br><span class="line">  - 并且默认值为 &quot;JohnDoe&quot;。</span><br><span class="line"></span><br><span class="line">- 另外 </span><br><span class="line"></span><br><span class="line">- - 如果要为多个字段设置默认值</span><br><span class="line">  - 可以通过使用 initial 字典来一次性设置多个字段的初始值。例如：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django import forms</span><br><span class="line"></span><br><span class="line">class MyForm(forms.Form):</span><br><span class="line">    username = forms.CharField(</span><br><span class="line">        max_length=8,</span><br><span class="line">        min_length=3,</span><br><span class="line">        label=&quot;用户名&quot;</span><br><span class="line">    )</span><br><span class="line">    email = forms.EmailField(</span><br><span class="line">        label=&quot;邮箱&quot;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    initial = &#123;</span><br><span class="line">        &#x27;username&#x27;: &#x27;JohnDoe&#x27;,</span><br><span class="line">        &#x27;email&#x27;: &#x27;johndoe@example.com&#x27;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>可以在实例化表单对象时传递 initial 字典来设置这两个字段的默认值：</li>
</ul>
```python
form = MyForm(initial={
    'username': 'JohnSmith',
    'email': 'johnsmith@example.com'
})
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 当表单加载时 </span><br><span class="line"></span><br><span class="line">- - username 字段将显示为 &quot;JohnSmith&quot;</span><br><span class="line">  - email 字段将显示为 &quot;[johnsmith@example.com](mailto:johnsmith@example.com)&quot;。</span><br><span class="line"></span><br><span class="line">- 这样 </span><br><span class="line"></span><br><span class="line">- - 通过使用 initial 参数</span><br><span class="line">  - 可以方便地为表单字段设置默认值，提供更好的用户体验。</span><br><span class="line"></span><br><span class="line">### 【3】其他字段渲染</span><br><span class="line"></span><br><span class="line">#### （1）radioSelect（单选）</span><br><span class="line"></span><br><span class="line">- 您可以在表单类中使用forms.RadioSelect字段来渲染radioSelect字段。下面是一个案例演示：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;````python</span><br><span class="line">from django import forms</span><br><span class="line"></span><br><span class="line">class GenderForm(forms.Form):</span><br><span class="line">    gender_choices = [</span><br><span class="line">        (&#x27;male&#x27;, &#x27;Male&#x27;),</span><br><span class="line">        (&#x27;female&#x27;, &#x27;Female&#x27;),</span><br><span class="line">    ]</span><br><span class="line">    gender = forms.ChoiceField(choices=gender_choices, widget=forms.RadioSelect)</span><br><span class="line">````</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 在这个案例中，我们定义了一个名为GenderForm的表单类，其中包含了一个gender字段用于选择性别。</span><br><span class="line">- 通过设置widget=forms.RadioSelect，我们将该字段渲染为单选按钮。</span><br><span class="line"></span><br><span class="line">#### （2）单选Select</span><br><span class="line"></span><br><span class="line">- 您可以使用forms.Select字段来呈现下拉菜单形式的单选选项。以下是一个案例演示：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django import forms</span><br><span class="line"></span><br><span class="line">class CityForm(forms.Form):</span><br><span class="line">    city_choices = [</span><br><span class="line">        (&#x27;1&#x27;, &#x27;New York&#x27;),</span><br><span class="line">        (&#x27;2&#x27;, &#x27;London&#x27;),</span><br><span class="line">        (&#x27;3&#x27;, &#x27;Tokyo&#x27;),</span><br><span class="line">    ]</span><br><span class="line">    city = forms.ChoiceField(choices=city_choices, widget=forms.Select)</span><br></pre></td></tr></table></figure>

<ul>
<li>在这个案例中，我们定义了一个名为CityForm的表单类，其中包含了一个city字段用于选择城市。通过设置widget=forms.Select，我们将该字段渲染为下拉菜单。</li>
</ul>
<h4 id="（3）多选Select">（3）多选Select</h4>
<ul>
<li>使用forms.SelectMultiple字段可以渲染多选Select组件。以下是一个案例演示：</li>
</ul>
```python
from django import forms

class InterestsForm(forms.Form):
    interest_choices = [
        ('coding', 'Coding'),
        ('gaming', 'Gaming'),
        ('reading', 'Reading'),
    ]
    interests = forms.MultipleChoiceField(choices=interest_choices, widget=forms.SelectMultiple)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 在这个案例中，我们定义了一个名为InterestsForm的表单类</span><br><span class="line">- 其中包含了一个interests字段用于选择兴趣。</span><br><span class="line">- 通过设置widget=forms.SelectMultiple，我们将该字段渲染为支持多选的下拉菜单。</span><br><span class="line"></span><br><span class="line">#### （4）单选checkbox</span><br><span class="line"></span><br><span class="line">- 要渲染单选checkbox字段，您可以使用forms.CheckboxInput字段。</span><br><span class="line">- 以下是一个案例演示：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django import forms</span><br><span class="line"></span><br><span class="line">class AgreeForm(forms.Form):</span><br><span class="line">    agree = forms.BooleanField(widget=forms.CheckboxInput)</span><br></pre></td></tr></table></figure>

<ul>
<li>在这个案例中，我们定义了一个名为AgreeForm的表单类</li>
<li>其中包含了一个agree字段用于接受条款。</li>
<li>通过设置widget=forms.CheckboxInput，我们将该字段渲染为单选复选框。</li>
</ul>
<h4 id="（5）多选checkbox">（5）多选checkbox</h4>
<ul>
<li>要渲染多选checkbox字段</li>
<li>可以使用forms.CheckboxSelectMultiple字段。</li>
<li>以下是一个案例演示</li>
</ul>
```python
from django import forms

class ColorsForm(forms.Form):
    color_choices = [
        ('red', 'Red'),
        ('green', 'Green'),
        ('blue', 'Blue'),
    ]
    colors = forms.MultipleChoiceField(choices=color_choices, widget=forms.CheckboxSelectMultiple)
```

<ul>
<li>在这个案例中，我们定义了一个名为ColorsForm的表单类，其中包含了一个colors字段用于选择颜色。</li>
<li>通过设置widget=forms.CheckboxSelectMultiple，我们将该字段渲染为多个复选框供用户选择。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/13.0Django%E6%A1%86%E6%9E%B6Form%E7%BB%84%E4%BB%B6%E4%B9%8B%E6%B8%B2%E6%9F%93HTML%E4%BB%A3%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/13.0Django%E6%A1%86%E6%9E%B6Form%E7%BB%84%E4%BB%B6%E4%B9%8B%E6%B8%B2%E6%9F%93HTML%E4%BB%A3%E7%A0%81/" class="post-title-link" itemprop="url">13.0Django框架Form组件之渲染HTML代码</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:15:49" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Django框架Form组件之渲染HTML代码</h1>
<h2 id="【一】渲染方式">【一】渲染方式</h2>
<h3 id="【1】直接渲染">【1】直接渲染</h3>
<ul>
<li>直接渲染form组件对象</li>
</ul>
```html
<h1>form登入页面</h1>
<form action="" method="post">
    {{ form_obj }}
<p><input type="submit"></p>
</form>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240701231854916](D:\pycharm\Temporary_notes\图片\image-20240701231854916.png)</span><br><span class="line"></span><br><span class="line">### 【2】渲染成无序列表as_ul</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```html</span><br><span class="line">&lt;h1&gt;form登入页面&lt;/h1&gt;</span><br><span class="line">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &#123;&#123; form_obj.as_ul &#125;&#125;</span><br><span class="line">&lt;p&gt;&lt;input type=&quot;submit&quot;&gt;&lt;/p&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240701232027825.png" alt="image-20240701232027825"></p>
<h3 id="【3】渲染成p标签as-p">【3】渲染成p标签as_p</h3>
```html
<h1>form登入页面</h1>
<form action="" method="post">
    {{ form_obj.as_p }}
<p><input type="submit"></p>
</form>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240702155528712](D:\pycharm\Temporary_notes\图片\image-20240702155528712.png)</span><br><span class="line"></span><br><span class="line">### 【4】渲染成表格</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```html</span><br><span class="line">&lt;h1&gt;form登入页面&lt;/h1&gt;</span><br><span class="line">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &#123;&#123; form_obj.as_table &#125;&#125;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;input type=&quot;submit&quot;&gt;&lt;/p&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240701232500428.png" alt="image-20240701232500428"></p>
<h3 id="【5】后端的代码">【5】后端的代码</h3>
```python
from django import forms
from django.shortcuts import render


def login_one(request):
    class UserForm(forms.Form):
        username = forms.CharField(
            # 最大长度
            max_length=8,
            # 最小长度
            min_length=3,
            # label是显示在输入框之前的提示文本
            label='用户名',
        )
        password = forms.CharField(
            # 输入的额信息是保密的
            widget=forms.PasswordInput(
                attrs={'class': 'c1'}, render_value=True
            )
        )
    # 得到的是处理好的input标签
    form_obj = UserForm()
    print(form_obj)
    # <tr><th><label for="id_username">用户名:</label></th><td><input type="text" name="username" maxlength="8" minlength="3" required id="id_username"></td></tr>
	#<tr><th><label for="id_password">Password:</label></th><td><input type="password" name="password" class="c1" required id="id_password"></td></tr>
    # 返回的是bool值，校验你数据是否有效
    # 如果所有校验都通过，返回 True；如果任何校验失败，返回 False
    form_obj.is_valid()
    # 打印错误信息
    print(form_obj.errors)
    # 获取校验成功的数据
    # print(form_obj.cleaned_data)
    # print(request.POST)

    return render(request, 'form_one.html', locals())

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【6】form表单里面的label属性</span><br><span class="line"></span><br><span class="line">- obj.label  找到 的是定义的字段名字</span><br><span class="line">- form.errors 提取当前form组件验证当前字段数据对应的错误信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">&lt;h1&gt;form登入页面&lt;/h1&gt;</span><br><span class="line">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &#123;% for obj in form_obj %&#125;</span><br><span class="line">        &#123;&#123; obj.label &#125;&#125;</span><br><span class="line">    	&#123;&#123; obj &#125;&#125;</span><br><span class="line">        &#123;&#123; obj.errors &#125;&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;p&gt;&lt;input type=&quot;submit&quot;&gt;&lt;/p&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

```python
from django import forms
from django.shortcuts import render


def login_one(request):
    class UserForm(forms.Form):
        username = forms.CharField(
            # 最大长度
            max_length=8,
            # 最小长度
            min_length=3,
            # label是显示在输入框之前的提示文本
            label='用户名',
        )
        password = forms.CharField(
            min_length=3,
            # 输入的额信息是保密的
            widget=forms.PasswordInput(

                attrs={'class': 'c1'}, render_value=True
            )
        )
    data = {"username": "admin", "password": "11"}
    form_obj = UserForm(data)
    print(form_obj)
    # <tr><th><label for="id_username">用户名:</label></th><td><input type="text" name="username" maxlength="8" minlength="3" required id="id_username"></td></tr>
    # <tr><th><label for="id_password">Password:</label></th><td><input type="password" name="password" class="c1" required id="id_password"></td></tr>
    form_obj.is_valid()
    # 打印错误信息
    print(form_obj.errors)
    # 获取校验成功的数据
    print(form_obj.cleaned_data)
    # print(request.POST)


    return render(request, 'form_one.html', locals())
```


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/3.0Django%E4%B8%89%E6%9D%BF%E6%96%A7%EF%BC%8C%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%EF%BC%8Cshortcuts,request%E5%AF%B9%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/3.0Django%E4%B8%89%E6%9D%BF%E6%96%A7%EF%BC%8C%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%EF%BC%8Cshortcuts,request%E5%AF%B9%E8%B1%A1/" class="post-title-link" itemprop="url">3.0Django三板斧，静态文件，shortcuts,request对象</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:15:50" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Django三板斧</h1>
<ul>
<li>三板斧都是从</li>
</ul>
```python
from django.shortcuts import HttpResponse,render,redirect
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 返回http响应，渲染HTML和重定向</span><br><span class="line"></span><br><span class="line">## 【一】HttpResponse</span><br><span class="line"></span><br><span class="line">- HttpResponse：是django自带的类，由于构建基本的HTTP响应</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.shortcuts import HttpResponse</span><br></pre></td></tr></table></figure>

<ul>
<li>例子,在django的view.py文件下使用
<ul>
<li>有三个参数：</li>
</ul>
</li>
<li>字符串渲染到页面上还是字符串</li>
<li>字典格式的数据，渲染到页面的是字典所有的键</li>
<li>前提是已经在urls.py里面渲染了这个函数</li>
</ul>
```python
from django.shortcuts import HttpResponse


def index(request):
    data = {"username": "tom", "password": "1234567"}
    return HttpResponse(data)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240618165334099](D:\pycharm\Temporary_notes\图片\image-20240618165334099.png)</span><br><span class="line"></span><br><span class="line">## 【二】render</span><br><span class="line"></span><br><span class="line">- 前端模板文件一点要放在`app`文件夹下的`templates`目录下</span><br><span class="line"></span><br><span class="line">- 参数介绍，render(request --&gt; 必须传的参数, &quot;index.html&quot;---HTML文件名，locals()--&gt; 局部名称空间)</span><br><span class="line">  - 要想的到字典里面的数据，利用jinjia2方法，HTML界面通过 模板语法&#123;% raw %&#125;&#123;&#123;  &#125;&#125;&#123;% endraw %&#125; 使用变量</span><br><span class="line">  - locals()：可以写，不写不会执行函数里面的代码块，直接运行的就是HTML文件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from django.shortcuts import render</span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    data = &#123;&quot;username&quot;: &quot;tom&quot;, &quot;password&quot;: &quot;1234567&quot;&#125;</span><br><span class="line">    return render(request, &quot;index.html&quot;, locals())</span><br></pre></td></tr></table></figure>

<ul>
<li>index.html</li>
</ul>
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>这是主页面</h1>
{{ data }}
{{ data.username }}
{{ data.password }}
</body>
</html>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240618171144263](D:\pycharm\Temporary_notes\图片\image-20240618171144263.png)</span><br><span class="line"></span><br><span class="line">## 【三】redirect</span><br><span class="line"></span><br><span class="line">- 主要用重定向，括号里可以写其他网站的全程，可以写自己网站的后缀</span><br><span class="line">- redirect：重定向路由请求地址 在状态码里面有是3xx状态码</span><br><span class="line"></span><br><span class="line"> &#123;% raw %&#125;```python</span><br><span class="line"> def login(request):</span><br><span class="line">     data = &#123;&quot;username&quot;: &quot;tom&quot;, &quot;password&quot;: &quot;1234567&quot;&#125;</span><br><span class="line">     return render(request, &quot;index.html&quot;, locals())</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> def index(request):</span><br><span class="line">     data = &#123;&quot;username&quot;: &quot;tom&quot;, &quot;password&quot;: &quot;1234567&quot;&#125;</span><br><span class="line">     # 左边的反斜杠代表：从根目录开始找路由</span><br><span class="line">     # login路由映射</span><br><span class="line">     </span><br><span class="line">     # 将访问的指定路由的请求进行转发重定向至新的地址</span><br><span class="line">     return redirect(to=&quot;/login/&quot;)</span><br></pre></td></tr></table></figure>

<h2 id="【补充】">【补充】</h2>
<ul>
<li>
<p>只是对于前端来说</p>
</li>
<li>
<p>django自带了重启功能，ctrl + s 保存，保存以后不需要重启django直接刷新页面即可</p>
</li>
</ul>
<h1>Django静态文件–&gt;static</h1>
<ul>
<li>Django有两个静态文件语法，static和media</li>
</ul>
<h2 id="【一】静态文件">【一】静态文件</h2>
<h3 id="【1】什么是静态文件">【1】什么是静态文件</h3>
<ul>
<li>静态文件就是我们在开发过程中基本上不会更改的文件</li>
</ul>
<h3 id="【2】Django静态文件结构树">【2】Django静态文件结构树</h3>
<ul>
<li>静态文件夹都叫–&gt;static</li>
<li>对static文件夹进行划分
<ul>
<li>js文件夹</li>
<li>css文件夹</li>
<li>img文件夹</li>
<li>plugins文件夹</li>
</ul>
</li>
</ul>
<h2 id="【二】静态文件配置">【二】静态文件配置</h2>
<ul>
<li>静态文件配置官网：<code>https://docs.djangoproject.com/en/3.2/howto/static-files/</code></li>
</ul>
<h3 id="【1】配置文件增加配置">【1】配置文件增加配置</h3>
<h4 id="1-后端">(1)后端</h4>
<ul>
<li>在settings.py配置文件中增加如下配置</li>
</ul>
```python
STATIC_URL = '/static/'  # 类似于访问静态文件的令牌

# 静态文件配置
# 默认查找位置是当前APP的目录下
# 这个配置定义了静态文件应用在启用 FileSystemFinder 查找器时将穿越的额外位置
STATICFILES_DIRS  = [
    os.path.join(BASE_DIR, 'static')
]
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### （2）前端</span><br><span class="line"></span><br><span class="line">- 在页面上增加如下配置即可使用静态文件模块语法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">&#123;% load static %&#125;</span><br><span class="line">&lt;img src=&quot;&#123;% static &#x27;my_app/example.jpg&#x27; %&#125;&quot; alt=&quot;My image&quot;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="【2】配置文件说明">【2】配置文件说明</h3>
<ul>
<li>如果想用static静态文件，就必须以static开头
<ul>
<li>如：<code>&lt;img src=&quot;../static/pic10.jpg&quot; alt=&quot;...&quot;&gt;</code></li>
<li><code>&lt;script src=&quot;../static/jquery.min.js&quot;&gt;&lt;/script&gt;</code></li>
</ul>
</li>
</ul>
<h2 id="【三】在Django中使用静态文件">【三】在Django中使用静态文件</h2>
<h3 id="【1】在前端页面使用jQuery文件">【1】在前端页面使用jQuery文件</h3>
<ul>
<li>cdn链接引入</li>
</ul>
```html
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 引入本地的文件不能用</span><br><span class="line">  - 发现页面上的js时间不生效</span><br><span class="line">  - 打开检查，网络 404</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```html</span><br><span class="line">&lt;script src=&quot;jquery.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="【2】静态文件加载">【2】静态文件加载</h3>
<ul>
<li>
<p>方式一</p>
<ul>
<li>
<p>前提是你已经在settings.py文件中配置好了路径,有了静态文件目录你才能够用</p>
</li>
<li>
```python
    STATIC_URL = '/static/'
    STATICFILES_DIRS = [
        os.path.join(BASE_DIR, 'user/static')
    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```html</span><br><span class="line">&lt;script src=&quot;../../static/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
<li>
<p>方式二</p>
<ul>
<li>
<p>前提是你已经在settings.py文件中配置好了路径,有了静态文件目录你才能够用</p>
</li>
<li>
```python
    STATIC_URL = '/static/'
    STATICFILES_DIRS = [
        os.path.join(BASE_DIR, 'user/static')
    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【四】使用static静态文件的步骤</span><br><span class="line"></span><br><span class="line">### 【1】确认你的地址</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">STATIC_URL = &#x27;/static/&#x27;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="【2】你确认你有一个static文件夹">【2】你确认你有一个static文件夹</h3>
<ul>
<li>将static放在APP文件目录下</li>
<li>Django项目在加载环境变量的时候，因为你已经注册了APP，所以你就能找到APP目录下的static文件夹</li>
<li>如果放在根目录同级的目录下，会发生错误，因为Django的自身权限原因，加载不到除了当前APP以外的区域</li>
<li>放在APP里面正常用，以外就不可以用</li>
</ul>
<p>创建一的参数项-----以外需要在配置环境配置</p>
```python
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, 'user/static')
]
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【3】在前端使用静态页面</span><br><span class="line"></span><br><span class="line">- 在前端使用静态文件</span><br><span class="line">- 在整个文档最上面 加载`static`文件夹</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">&#123;% load static %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>
<p>在指定的标签上使用静态文件</p>
<ul>
<li>
<p>比如：</p>
</li>
<li>
```html
    a href
    img src
    script src
    link href
    background-img : url("{% static "地址" %}")

### 【4】内部的原理

- 你配置了`STATIC_URL`
- 可以找到以`http://127.0.0.1:8899/static/ ...`

- 访问静态文件的时候可以挨个检测资源目录 默认的资源目录就是APP下的目录
- 将当前资源自动转换为指定的地址发出请求`http://127.0.0.1:8899/static/ ...`

### 【5】将当前APP的view源码文件放在了static目录下

- 不可以，会导致数据泄露，你会赔死
- 这样的话黑客随时可以看你的后端代码

# request对象

## 【一】什么是request

- 每个视图函数都会有一个request参数

## 【二】获取当前请求的请求方式

### 【1】从GET请求中获取数据

- 第一次 GET 请求是你访问页面在地址栏回车的那个请求-->render 渲染
- 第二次 GET请求发生在你点击提交的时候，返回客户端提交数据

获取数据



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python </span><br><span class="line">print(request.GET)</span><br><span class="line"># 就会的到你输入框输入之后提交得到的数据</span><br><span class="line"># 是一个字典</span><br><span class="line"># 比如：&lt; QueryDict: &#123;&#x27;username&#x27;: [&#x27;tom&#x27;], &#x27;password&#x27;: [&#x27;123456&#x27;]&#125; &gt;</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<p>python<br>
from django.shortcuts import render</p>
<h1>GET请求获取数据</h1>
<p>def register(request):<br>
# 第一个GET请求是你访问页面点击地址栏的那个请求–&gt;render 渲染了<br>
# 第二次 GET请求发生在你点击提交的时候，返回客户端提交数据<br>
print(request.method)<br>
# post请求这样用报错了，无法访问<br>
# 现在的解决办法就是–&gt;进入settings.py文件中，找到MIDDLEWARE里面的数据把它注释掉’django.middleware.csrf.CsrfViewMiddleware’<br>
# 这样的话就会继续执行，并返回POST请求</p>
<pre><code># 我们获得了请求
# 再从请求中获得数据
print(request.GET)
# &lt; QueryDict: &#123;'username': ['tom'], 'password': ['123456']&#125; &gt;
# 获得里面的单个值
username = request.GET.get(&quot;username&quot;)
password = request.GET.get(&quot;password&quot;)
print(username, password)
# tom 123456
# 们在form标签中在添加几个checkbox选项
# hobby = request.GET.get(&quot;hobby&quot;)
# &lt;QueryDict: &#123;'username': ['tom'], 'password': ['666'], 'hobby': ['running', 'music']&#125;&gt;
# 我们用get取值只能取到一个值，所以引入一个新的方法，把所有的值都取出来getlist
# print(username, password, hobby)
# tom 666 music
hobby = request.GET.getlist(&quot;hobby&quot;)
# &lt; QueryDict: &#123;'username': ['tom'], 'password': ['666'], 'hobby': ['running', 'music', 'listen']&#125; &gt;
print(username, password, hobby)
# tom 666 ['running', 'music', 'listen']
return render(request, &quot;register.html&quot;)
</code></pre>
```



register.html



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line">html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;注册页面&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&#123;#from 表单#&#125;</span><br><span class="line">&#123;#参数介绍 action：用来定义你提交数据的路径 ，不写就是当前请求路径#&#125;</span><br><span class="line">&#123;#参数介绍 method：get请求 get提交 post请求 post提交#&#125;</span><br><span class="line">&lt;form action=&quot;&quot; method=&quot;get&quot;&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">    &lt;label for=&quot;usernameInput&quot;&gt;username:&lt;/label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;usernameInput&quot; name=&quot;username&quot;&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">    &lt;label for=&quot;passwordInput&quot;&gt;password:&lt;/label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;passwordInput&quot; name=&quot;password&quot;&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;label for=&quot;usernameInput&quot;&gt;&lt;/label&gt;</span><br><span class="line">        running &lt;input type=&quot;checkbox&quot; id=&quot;usernameInput&quot; name=&quot;hobby&quot; value=&quot;running&quot;&gt;</span><br><span class="line">        music &lt;input type=&quot;checkbox&quot; id=&quot;usernameInput&quot; name=&quot;hobby&quot; value=&quot;music&quot;&gt;</span><br><span class="line">        listen &lt;input type=&quot;checkbox&quot; id=&quot;usernameInput&quot; name=&quot;hobby&quot; value=&quot;listen&quot;&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;input type=&quot;submit&quot;&gt;&lt;/p&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】从POST请求中获取数据</span><br><span class="line"></span><br><span class="line">- print(request.method)</span><br><span class="line">  - 只有 post 请求才会走的方式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>python<br>
return render(request, ‘register.html’)def register(request):<br>
print(request.method)<br>
# 进行预处理<br>
# 只有post的请求才会走的方式<br>
if request.method == ‘POST’:<br>
return HttpResponse(‘ok’)<br>
return render(request, ‘register.html’)</p>
```



- 比如得到的数据是一个键对应多个值的话，就不能用get了，用getlist取全部

views.py



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line">from django.http import HttpResponse</span><br><span class="line"></span><br><span class="line"># post请求获取数据</span><br><span class="line">def register(request):</span><br><span class="line">    print(request.method)</span><br><span class="line">    # 进行预处理</span><br><span class="line">    # 只有post的请求才会走的方式</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        # 拿去数据</span><br><span class="line">        # POST一定要大写</span><br><span class="line">        print(request.POST)</span><br><span class="line">        # &lt;QueryDict: &#123;&#x27;username&#x27;: [&#x27;tom&#x27;], &#x27;password&#x27;: [&#x27;666&#x27;], &#x27;hobby&#x27;: [&#x27;music&#x27;, &#x27;listen&#x27;]&#125;&gt;</span><br><span class="line">        # 单个取值</span><br><span class="line">        username = request.POST.get(&#x27;username&#x27;)</span><br><span class="line">        password = request.POST.get(&#x27;password&#x27;)</span><br><span class="line">        # hobby = request.POST.get(&#x27;hobby&#x27;)</span><br><span class="line">        # 在POST请求中get方法还是取不完值，还是要用getlist</span><br><span class="line">        # print(username, password, hobby)</span><br><span class="line">        # tom 666 listen</span><br><span class="line">        hobby = request.POST.getlist(&#x27;hobby&#x27;)</span><br><span class="line">        # &lt;QueryDict: &#123;&#x27;username&#x27;: [&#x27;tom&#x27;], &#x27;password&#x27;: [&#x27;666&#x27;], &#x27;hobby&#x27;: [&#x27;running&#x27;, &#x27;music&#x27;]&#125;&gt;</span><br><span class="line">        print(username, password, hobby)</span><br><span class="line">        # tom 666 [&#x27;running&#x27;, &#x27;music&#x27;]</span><br><span class="line">        return HttpResponse(&#x27;ok&#x27;)</span><br><span class="line">        # 提交数据后会跳转一个新页面上面写着ok</span><br><span class="line">    return render(request, &#x27;register.html&#x27;)</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">register.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>html</p>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>注册页面</h1>
<form action="" method="post">
    <p>
    <label for="usernameInput">username:</label>
    <input type="text" id="usernameInput" name="username">
</p>
<p>
    <label for="passwordInput">password:</label>
    <input type="text" id="passwordInput" name="password">
</p>
    <p>
        <label for="usernameInput"></label>
        running <input type="checkbox" id="usernameInput" name="hobby" value="running">
        music <input type="checkbox" id="usernameInput" name="hobby" value="music">
        listen <input type="checkbox" id="usernameInput" name="hobby" value="listen">
    </p>
    <p><input type="submit"></p>
</form>
</body>
</html>
```



### 【3】取数据的两种方式

- get---->获取单一键值对的方法



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line">python</span><br><span class="line">request.GET.get(&quot;key&quot;)</span><br><span class="line">&#123;% raw %&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- getlist--&gt;获取一个键对应的多个值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

python
request.GET.getlist("key")
```

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/2.9%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/2.9%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B/" class="post-title-link" itemprop="url">2.9守护线程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:15:50" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>守护线程</h1>
<h2 id="【一】什么是守护线程">【一】什么是守护线程</h2>
<ul>
<li>python中主线程是程序的起始线程，既程序启动创建的第一个线程就是主线程，他执行程序的主体逻辑</li>
<li>守护线程则是在后台运行并依赖于主线程或非守护线程的存在</li>
</ul>
<h2 id="【二】主线程死亡，子线程未死亡">【二】主线程死亡，子线程未死亡</h2>
<ul>
<li>主线程结束运行后不会马上结束，而是等待其它非守护线程结束之后才会结束</li>
<li>主线程死亡就代表主进程死亡，随后就是所有的子线程的死亡</li>
</ul>
```python
from threading import Thread
import time

#创建一个子进程
def worker(name):
    print(f"son thread {name} is starting")
    time.sleep(2)
    print("son tread {name} is ending")

def main():
    print("this is main process starting")
    task = Thread(target=worker,args=("tom",))
    task.start()
    print("this is main process ending")

if __name__ == '__main__':
    main()
    # 输出
    # this is main process starting
    # son thread tom is starting
    # this is main process ending
    # son tread {name} is ending
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【三】主线程死亡，子线程也死亡</span><br><span class="line"></span><br><span class="line">- 利用的就是，守护线程、</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from threading import Thread</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">#创建一个子进程</span><br><span class="line">def worker(name):</span><br><span class="line">    print(f&quot;son thread &#123;name&#125; is starting&quot;)</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    print(&quot;son tread &#123;name&#125; is ending&quot;)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    print(&quot;this is main process starting&quot;)</span><br><span class="line">    #创建线程 task ，目标函数为workwer</span><br><span class="line">    task = Thread(target=worker,args=(&quot;tom&quot;,))</span><br><span class="line">    task.daemon = True</span><br><span class="line">    task.start()</span><br><span class="line">    print(&quot;this is main process ending&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line">    # 输出</span><br><span class="line">    # this is main process starting</span><br><span class="line">    # son thread tom is starting</span><br><span class="line">    # this is main process ending#主进程死亡，子线程也跟着死亡啦</span><br></pre></td></tr></table></figure>

<h2 id="【四】例子">【四】例子</h2>
<ul>
<li>被守护的子线程会根据主线程的死亡而死亡</li>
</ul>
```python
from threading import Thread
import time

def tread_one(name):
    print(f"son tread {name} is starting")
    # 睡一会
    time.sleep(2)
    print(f"son tread {name} is ending")


def tread_two(name):
    print(f"son tread {name} is starting")
    # 睡一会
    time.sleep(1)
    print(f"son tread {name} is ending")


def main():
    print("this is main process starting")
    task_one = Thread(target=tread_one, args=("tom",))
    task_two = Thread(target=tread_two, args=("dream",))
    # 守护task_one
    task_one.daemon = True
    # 启动子进程
    task_one.start()
    task_two.start()
    print("this is main process ending")


if __name__ == '__main__':
    main()
    # 输出
    # this is main process starting
    # son tread tom is starting
    # son tread dream is starting
    # this is main process ending
    # son tread dream is ending#不守护的会继续打印，不跟着主进程结束而结束
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 在执行thread tom时大意了第一句，睡了两秒，开始执行thread dream，dream只睡了一秒，打印进程结束，所以同跟着结束，最后打印dream结束（因为dream不被守护）</span><br><span class="line"></span><br><span class="line">## 【五】例子--》奇葩</span><br><span class="line"></span><br><span class="line">- 主线程会等待最长的那个线程结束，才结束</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from threading import Thread</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def tread_one(name):</span><br><span class="line">    print(f&quot;son tread &#123;name&#125; is starting&quot;)</span><br><span class="line">    # 睡一会</span><br><span class="line">    time.sleep(1)</span><br><span class="line">    print(f&quot;son tread &#123;name&#125; is ending&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def tread_two(name):</span><br><span class="line">    print(f&quot;son tread &#123;name&#125; is starting&quot;)</span><br><span class="line">    # 睡一会</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    print(f&quot;son tread &#123;name&#125; is ending&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    print(&quot;this is main process starting&quot;)</span><br><span class="line">    for i in range(5):</span><br><span class="line">        task_one = Thread(target=tread_one, args=(f&quot;tom&#123;i&#125;&quot;,))</span><br><span class="line">        task_one.daemon = True</span><br><span class="line">        task_one.start()</span><br><span class="line">    task_two = Thread(target=tread_two, args=(&quot;dream&quot;,))</span><br><span class="line">    # 守护task_one</span><br><span class="line"></span><br><span class="line">    # 启动子进程</span><br><span class="line"></span><br><span class="line">    task_two.start()</span><br><span class="line">    print(&quot;this is main process ending&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line">    # 输出</span><br><span class="line">    # this is main process starting</span><br><span class="line">    # son tread tom0 is starting</span><br><span class="line">    # son tread tom1 is starting</span><br><span class="line">    # son tread tom2 is starting</span><br><span class="line">    # son tread tom3 is starting</span><br><span class="line">    # son tread tom4 is starting</span><br><span class="line">    # son tread dream is starting</span><br><span class="line">    # this is main process ending</span><br><span class="line">    # son tread tom0 is ending</span><br><span class="line">    # son tread tom2 is ending</span><br><span class="line">    # son tread tom1 is ending</span><br><span class="line">    # son tread tom4 is ending</span><br><span class="line">    # son tread tom3 is ending</span><br><span class="line">    # son tread dream is ending</span><br></pre></td></tr></table></figure>

<h1>线程的互斥锁</h1>
<ul>
<li>线程的共享一个进程下的数据</li>
</ul>
<h2 id="【一】不加锁线程">【一】不加锁线程</h2>
```python
import time
from threading import Thread

money = 100


def worker():
    # 修改全局变量
    global money
    temp = money
    # 睡一会
    time.sleep(1)
    money = temp - 1


def main():
    task_list = [Thread(target=worker) for i in range(100)]
    [task.start() for task in task_list]
    [task.join() for task in task_list]


if __name__ == '__main__':
    main()
    print(money)  # 99
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 【二】加锁</span><br><span class="line"></span><br><span class="line">- 生成的方法一定是threading模块中的Lock方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">import time</span><br><span class="line">from threading import Thread,Lock</span><br><span class="line"></span><br><span class="line">money = 100</span><br><span class="line"></span><br><span class="line">#生成一把锁</span><br><span class="line">lock = Lock()</span><br><span class="line"></span><br><span class="line">def worker():</span><br><span class="line">    # 修改全局变量</span><br><span class="line">    global money</span><br><span class="line">    lock.acquire()</span><br><span class="line">    temp = money</span><br><span class="line">    # 睡一会</span><br><span class="line">    time.sleep(0.1)</span><br><span class="line">    money = temp - 1</span><br><span class="line">    #千万要记住结束之要解锁</span><br><span class="line">    lock.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    task_list = [Thread(target=worker) for i in range(100)]</span><br><span class="line">    [task.start() for task in task_list]</span><br><span class="line">    [task.join() for task in task_list]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line">    print(money)  # 0</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/3.0GIL%E5%85%A8%E5%B1%80%E8%A7%A3%E9%87%8A%E5%99%A8%E9%94%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="坤">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="坤博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/15/3.0GIL%E5%85%A8%E5%B1%80%E8%A7%A3%E9%87%8A%E5%99%A8%E9%94%81/" class="post-title-link" itemprop="url">3.0GIL全局解释器锁</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：16:15:50" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>GIL全局解释器锁</h1>
<ul>
<li>什么是GIL锁：
<ul>
<li>全称Global Interpreter Lock（全局解释器锁）</li>
<li>GIL锁是CPython解释器中的一种机制，用于确保同一时间只有一个线程可以执行Python字节码。</li>
</ul>
</li>
</ul>
<h2 id="【一】介绍">【一】介绍</h2>
<h3 id="【1】官方介绍">【1】官方介绍</h3>
```python
In CPython, the global interpreter lock, or GIL, is a mutex that prevents multiple
native threads from executing Python bytecodes at once. This lock is necessary mainly

because CPython’s memory management is not thread-safe. (However, since the GIL
exists, other features have grown to depend on the guarantees that it enforces.)
#翻译
#在CPython中，全局解释器锁(GIL)是一个互斥锁，用于防止乘法线程同时执行Python字节码。
#这个锁是必要的，主要是因为CPython的内存管理不是线程安全的。
#(然而，自从gilp存在以来，其他功能已经发展到依赖于它所实施的保证。)

结论：在Cpython解释器中，同一个进程下开启的多线程，同一时刻只能有一个线程执行，无法利用多核优势
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【2】Python解释器版本</span><br><span class="line"></span><br><span class="line">- `Cpython`--》c语言</span><br><span class="line">- `Jpython`--》java语言</span><br><span class="line">- `Pypypython`</span><br><span class="line">- 但是普遍使用的都是`Cpython`解释器</span><br><span class="line"></span><br><span class="line">## 【二】GIL锁和普通互斥锁的区别</span><br><span class="line"></span><br><span class="line">### 【1】第一代</span><br><span class="line"></span><br><span class="line">- 睡了`0.1s`，这个期间所有的线程抢的就是money=100。</span><br><span class="line">- 所有线程都去抢那把GIL锁住的数据，睡了`0.1s`，当所有线程都抢到后，再去修改数据就变成了 99。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from threading import Thread,Lock</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">#全局数据</span><br><span class="line">money = 100</span><br><span class="line"></span><br><span class="line">def worker():</span><br><span class="line">    #修改全局数据</span><br><span class="line">    global money</span><br><span class="line">    temp = money</span><br><span class="line">    #谁0.1s</span><br><span class="line">    time.sleep(0.1)</span><br><span class="line">    money = temp - 1</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    #获得子线程</span><br><span class="line">    task_list = [Thread(target=worker) for i in range(100)]</span><br><span class="line">    #启动</span><br><span class="line">    [task.start() for task in task_list]</span><br><span class="line">    #结束</span><br><span class="line">    [task.join() for task in task_list]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line">    print(money) # 99</span><br></pre></td></tr></table></figure>

<h3 id="【2】第二代">【2】第二代</h3>
<ul>
<li>子线程不睡</li>
<li>谁线抢到谁就先处理数据</li>
</ul>
```python
from threading import Thread

#全局数据
money = 100

def worker():
    #修改全局数据
    global money
    temp = money
    money = temp - 1

def main():
    #得到子线程
    task_list = [Thread(target=worker) for i in range(100)]
    #启动子线程
    [task.start() for task in task_list]
    #关闭子线程
    [task.join() for task in task_list]


if __name__ == '__main__':
    main()
    print(money)#0
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 【3】第三代---&gt;加锁</span><br><span class="line"></span><br><span class="line">- 自动执行加锁，在自动执行解锁</span><br><span class="line">- 子线程启动，先去抢GIL锁，进入到到IO自动释放GIL锁，但是自己加的锁还没解开 ，其他线程资源能抢到 GIL 锁，但是抢不到互斥锁</span><br><span class="line">- 最终 GIL 回到 互斥锁的那个进程上，处理数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from threading import Thread,Lock</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">#全局数据</span><br><span class="line">money = 100</span><br><span class="line">#获得锁对象</span><br><span class="line">lock = Lock()</span><br><span class="line"></span><br><span class="line">def worker():</span><br><span class="line">    #修改全局数据</span><br><span class="line">    global money</span><br><span class="line">    #这一步实行，自动加锁，自动解锁</span><br><span class="line">    with lock:</span><br><span class="line">        temp = money</span><br><span class="line">        #只要进入 IO 会自动释放 GIL 锁</span><br><span class="line">        time.sleep(0.1)</span><br><span class="line">        money = temp - 1</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    task_list = [Thread(target=worker) for i in range(100)]</span><br><span class="line">    [task.start() for task in task_list]</span><br><span class="line">    [task.join() for task in task_list]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line">    print(money) # 0</span><br></pre></td></tr></table></figure>

<h2 id="【三】GIL导致多线程利用多核优势">【三】GIL导致多线程利用多核优势</h2>
<h3 id="【1】Cpython-解释器中-GIL">【1】Cpython 解释器中 GIL</h3>
<ul>
<li>
<p>在 Cpython 解释器中 GIL 是一把互斥锁，用来阻止同一个进程下的多个线程的同时进行</p>
</li>
<li>
<p>因为在 Cpython 中的内存管理不是线程安全的</p>
<ul>
<li>ps:内存管理（垃圾回收机制）</li>
<li>应用计数</li>
<li>标记清除</li>
<li>分代回收</li>
</ul>
</li>
</ul>
<h3 id="【2】python多线程的用处">【2】python多线程的用处</h3>
<ul>
<li>python时候有没有用要看情况
<ul>
<li>单核
<ul>
<li>四个任务（IO密集型/计算密集型）</li>
</ul>
</li>
<li>多核
<ul>
<li>四个任务（IO密集型/计算密集型）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="（1）计算密集型—-算">（1）计算密集型—&gt;算</h4>
<ul>
<li>
<p><strong>计算密集型</strong> : 一直处在计算运行中</p>
</li>
<li>
<p>每个任务都需要 10s</p>
<ul>
<li>
<p>单核</p>
<ul>
<li>多进程：额外消耗资源</li>
<li>多线程：减少资源消耗</li>
</ul>
</li>
<li>
<p>多核</p>
<ul>
<li>对进程：总耗时10s</li>
<li>多线程：总耗时40s（一个任务10s，四个就是40s）</li>
</ul>
</li>
</ul>
```python
  from threading import Thread
  from multiprocessing import Process
  import time
  
  def worker():
      res = 0
      for i in range(100000000):
          res *= i
  
  def main(cls):
      task_list = []
      #获得当前cpu运行的个数
      print(os.cpu_count())
      #起始时间
      start_time = time.time()
      for i in range(10):
          task = cls(target=worker)
          task.start()
          task_list.append(task)
      for task in task_list:
          task.join()
      #打印总耗时
      print(f"总耗时:----{time.time() - start_time}")
  
  if __name__ == '__main__':
      # 线程
      # main(Thread)
      # 输出
      # 12
      # 总耗时:----25.036433219909668
  
      # 进程
      main(Process)
      # 12
      # 总耗时:----4.833950042724609
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 计算密集型一定是多进程快</span><br><span class="line"></span><br><span class="line">- 计算密集型是一条到走到黑</span><br><span class="line"></span><br><span class="line">#### （2）IO密集型----&gt;频繁的切换</span><br><span class="line"></span><br><span class="line">存在多个IO阻塞切换操作</span><br><span class="line"></span><br><span class="line">- 每个任务都需要10s</span><br><span class="line">  - 多核</span><br><span class="line">    - 多进程：浪费资源</span><br><span class="line">    - 多线程：节省资源</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% raw %&#125;```python</span><br><span class="line">from multiprocessing import Process</span><br><span class="line">from threading import Thread</span><br><span class="line">import time, os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def work():</span><br><span class="line">    time.sleep(2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main(cls):</span><br><span class="line">    p_list = [ ]</span><br><span class="line">    # 获取当前CPU运行的个数</span><br><span class="line">    print(os.cpu_count())</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    for i in range(400):</span><br><span class="line">        p = cls(target=work)</span><br><span class="line">        p.start()</span><br><span class="line">        p_list.append(p)</span><br><span class="line"></span><br><span class="line">    for p in p_list:</span><br><span class="line">        p.join()</span><br><span class="line"></span><br><span class="line">    print(f&#x27;总耗时:&gt;&gt;&gt;&#123;time.time() - start_time&#125;&#x27;)</span><br><span class="line">    # 8</span><br><span class="line">    # 总耗时:&gt;&gt;&gt;36.23059678077698</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    # main(Process)</span><br><span class="line">    # 输出</span><br><span class="line">    # 12</span><br><span class="line">    # 总耗时:&gt;&gt;&gt;14.086674451828003</span><br><span class="line">    main(Thread)</span><br><span class="line">    # 输出</span><br><span class="line">    # 12</span><br><span class="line">    # 总耗时:&gt;&gt;&gt;2.061268329620361</span><br></pre></td></tr></table></figure>

</li>
<li>
<p>IO密集型一定是线程快</p>
</li>
<li>
<p>因为总是被阻塞，对于进程来说开设多个进程消耗了太多的资源</p>
</li>
</ul>
<h4 id="（3）总结">（3）总结</h4>
<ul>
<li>
<p>计算消耗cpu</p>
<ul>
<li>代码执行，算数，for都是计算、</li>
</ul>
</li>
<li>
<p>IO不消耗cpu</p>
<ul>
<li>打开文件，写入文件，网络操作都是IO</li>
<li>如果遇到IO，该线程会释放cpu的执行权限，cpu转而去执行别的线程</li>
</ul>
</li>
<li>
<p>由于python是GIL锁，开启多线程，同一时刻，只有一条线程在执行</p>
</li>
<li>
<p>计算密集型也是一样，开启多线程，同一时刻，也只有一条线程在执行</p>
</li>
<li>
<p>多核cpu，就会浪费多核优势</p>
</li>
<li>
<p>如果是计算密集型，我们希望，多个核(cpu)都干活，同一个进程下绕不过gil锁</p>
</li>
<li>
<p>所以我们开启多进程，gil锁只能锁住某个进程中得线程，开启多个进程，就能利用多核优势</p>
</li>
<li>
<p>io密集型—》只要遇到io，就会释放cpu执行权限</p>
</li>
<li>
<p>进程内开了多个io线程，线程多半都在等待，开启多进程是不能提高效率的，反而开启进程很耗费资源，所以使用多线程即可</p>
</li>
</ul>
<h5 id="【1】计算密集型任务-多进程">【1】计算密集型任务(多进程)</h5>
<ul>
<li>
<p>计算密集型任务主要是指需要大量的CPU计算资源的任务，其中包括执行代码、进行算术运算、循环等。</p>
</li>
<li>
<ul>
<li>在这种情况下，使用多线程并没有太大的优势。</li>
<li>由于Python具有全局解释器锁（Global Interpreter Lock，GIL），在同一时刻只能有一条线程执行代码，这意味着在多线程的情况下，同一时刻只有一个线程在执行计算密集型任务。</li>
</ul>
</li>
<li>
<p>但是，如果使用多进程，则可以充分利用多核CPU的优势。</p>
</li>
<li>
<ul>
<li>每个进程都有自己独立的GIL锁，因此多个进程可以同时执行计算密集型任务，充分发挥多核CPU的能力。</li>
<li>通过开启多个进程，我们可以将计算密集的任务分配给每个进程，让每个进程都独自执行任务，从而提高整体的计算效率</li>
</ul>
</li>
</ul>
<h5 id="【2】IO密集型任务-多线程">【2】IO密集型任务(多线程)</h5>
<ul>
<li>
<p>IO密集型任务主要是指涉及大量输入输出操作（如打开文件、写入文件、网络操作等）的任务。</p>
</li>
<li>
<ul>
<li>在这种情况下，线程往往会因为等待IO操作而释放CPU执行权限，不会造成太多的CPU资源浪费。</li>
<li>因此，使用多线程能够更好地处理IO密集型任务，避免了频繁切换进程的开销。</li>
</ul>
</li>
<li>
<p>当我们在一个进程中开启多个IO密集型线程时，大部分线程都处于等待状态，开启多个进程却不能提高效率，反而会消耗更多的系统资源。</p>
</li>
<li>
<ul>
<li>因此，在IO密集型任务中，使用多线程即可满足需求，无需开启多个进程。</li>
</ul>
</li>
</ul>
<h5 id="【3】总结">【3】总结</h5>
<ul>
<li>计算密集型任务使用多进程可以充分利用多核CPU的优势，而IO密集型任务使用多线程能够更好地处理IO操作，避免频繁的进程切换开销。</li>
<li>根据任务的特性选择合适的并发方式可以有效提高任务的执行效率</li>
</ul>
<h2 id="【四】GIL特点总结">【四】GIL特点总结</h2>
<ul>
<li>GIL锁不是python的特点是cpython解释器的特点</li>
<li>GIL保证解释器级别的数据安全</li>
<li>GIL会导致同一个进程下的多个线程的无法同时进行即无法利用多核优势</li>
<li>针对不同的数据还是需要加不同的锁处理</li>
<li>解释型语言的通病：同一个进程下的多个线程无法利用多核优势</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">坤</p>
  <div class="site-description" itemprop="description">选择有时候比努力更重要，但是你不努力，选择就只是空谈</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">194</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">坤</span>
</div>
  <div class="powered-by">由 <a href="https://github.com/lsk-0912" class="theme-link" rel="noopener" target="_blank">lsk-0912</a> & <a href="https://github.com/lsk-0912" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
