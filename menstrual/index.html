<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aurora-lsk.asia","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"remove","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="记录上次来潮日期与平均周期，帮助我们预测下次来潮、排卵日与易孕期。数据仅保存在你的浏览器本地。">
<meta property="og:type" content="website">
<meta property="og:title" content="姨妈期小助手">
<meta property="og:url" content="https://aurora-lsk.asia/menstrual/index.html">
<meta property="og:site_name" content="小影公主の专属花园">
<meta property="og:description" content="记录上次来潮日期与平均周期，帮助我们预测下次来潮、排卵日与易孕期。数据仅保存在你的浏览器本地。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-11-03T16:00:00.000Z">
<meta property="article:modified_time" content="2025-11-04T08:14:28.797Z">
<meta property="article:author" content="阿坤 ❤ 小影">
<meta property="article:tag" content="公主">
<meta property="article:tag" content="小影">
<meta property="article:tag" content="摄影">
<meta property="article:tag" content="旅行">
<meta property="article:tag" content="日记">
<meta property="article:tag" content="爱情">
<meta property="article:tag" content="生活">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://aurora-lsk.asia/menstrual/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title></title>
  <style id="unify-theme">
    :root{
      --brand-1:#ff7bd5; /* pink */
      --brand-2:#7c3aed; /* purple */
      --text-strong:#111827;
      --muted:#6b7280;
      --card-bg:#ffffff;
      --card-border:#ebe9f5;
      --pill-bg:#f7f5ff;
    }
    /* 顶部主菜单：更紧凑、中文不换行、统一高度 */
    .site-nav .main-menu.menu{ display:flex; flex-wrap:wrap; gap:14px; }
    .site-nav .main-menu.menu > li{ list-style:none; }
    .site-nav .main-menu.menu > li > a{
      display:inline-flex; align-items:center; gap:8px;
      min-height:44px; padding:8px 16px; border-radius:14px;
      background:var(--pill-bg); border:1px solid var(--card-border);
      color:var(--text-strong); text-decoration:none; white-space:nowrap; font-size:15px; font-weight:600;
      transition:all .18s ease; box-shadow:0 6px 16px rgba(124,58,237,.08);
    }
    .site-nav .main-menu.menu > li > a:hover{
      color:#fff; border-color:transparent;
      background:linear-gradient(180deg,var(--brand-1),var(--brand-2));
      box-shadow:0 12px 26px rgba(124,58,237,.25); transform: translateY(-1px);
    }
    /* 统一按钮 */
    .btn, .btn-main, .btn-read{
      display:inline-flex; align-items:center; justify-content:center;
      height:42px; padding:0 18px; border-radius:12px;
      border:1px solid var(--brand-2);
      color:#fff; text-decoration:none;
      background:linear-gradient(180deg,var(--brand-1),var(--brand-2));
      box-shadow:0 10px 22px rgba(124,58,237,.22);
      transition:transform .06s ease, box-shadow .2s ease, opacity .2s ease;
    }
    .btn:hover, .btn-main:hover, .btn-read:hover{ opacity:.95; transform:translateY(-1px); }
    .btn-main.btn-alt{ background:linear-gradient(180deg,#ffffff,#fafaff); color:var(--text-strong); border:1px solid var(--card-border); }
    .btn-main.btn-alt:hover{ background:#ffffff; box-shadow:0 10px 22px rgba(0,0,0,.06); }

    /* 统一卡片/区块视觉 */
    .login-card, .quick-card, .metric-card, .album-card, .feed-item, .landing-hero{
      background:var(--card-bg); border:1px solid var(--card-border); border-radius:16px;
      box-shadow:0 14px 28px rgba(0,0,0,.06);
    }
    /* 首页英雄与快捷按钮统一 */
    .landing-hero{ padding:24px; }
    .quick-card{ display:flex; gap:14px; padding:14px; }
    .quick-card .quick-item{ flex:1; display:flex; align-items:center; justify-content:center; gap:8px; height:54px;
      background:var(--pill-bg); border:1px solid var(--card-border); border-radius:12px; color:var(--text-strong); text-decoration:none; transition:all .2s ease; }
    .quick-card .quick-item:hover{ color:#fff; background:linear-gradient(180deg,var(--brand-1),var(--brand-2)); border-color:transparent; box-shadow:0 10px 22px rgba(124,58,237,.22); }
    .metric-card-wrap{ display:flex; gap:16px; margin-top:14px; }
    .metric-card{ padding:16px; text-align:center; }
    .metric-card .metric-count{ font-size:28px; font-weight:700; background:linear-gradient(180deg,var(--brand-1),var(--brand-2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .metric-card .metric-label{ color:var(--muted); }
    /* 列表阅读按钮统一 */
    .feed-item{ display:flex; align-items:flex-start; justify-content:space-between; padding:16px; }
    .feed-item .btn-read{ height:36px; padding:0 14px; }
    /* 二级子菜单统一（去掉大背景，改胶囊项） */
    ul.sub-menu.menu{ display:flex; gap:12px; align-items:center; justify-content:center; padding:10px; margin:10px 0 20px; border-radius:16px; background:transparent; border:none; box-shadow:none; }
    ul.sub-menu.menu .menu-item-banner{ display:none; }
    /* 首页头部与标签页统一为胶囊 */
    .feed-header{ display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border:1px solid var(--card-border); border-radius:16px; background:var(--card-bg); box-shadow:0 12px 26px rgba(0,0,0,.06); }
    .feed-header .feed-title{ font-weight:700; }
    .feed-tabs{ display:flex; gap:10px; }
    .feed-tabs .tab{ display:inline-flex; padding:8px 12px; border-radius:12px; background:var(--pill-bg); border:1px solid var(--card-border); color:var(--text-strong); text-decoration:none; }
    .feed-tabs .tab:hover, .feed-tabs .tab.active{ color:#fff; border-color:transparent; background:linear-gradient(180deg,var(--brand-1),var(--brand-2)); }
  </style>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">小影公主の专属花园</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">爱与记录的小宇宙</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/page-about/" rel="section"><i class="fa fa-heart fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-经期">

    <a href="/menstrual/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>经期</a>

  </li>
        <li class="menu-item menu-item-工具">

    <a href="/tools/" rel="section"><i class="fa fa-wrench fa-fw"></i>工具</a>

  </li>
        <li class="menu-item menu-item-隐私">

    <a href="/privacy/" rel="section"><i class="fa fa-user-shield fa-fw"></i>隐私</a>

  </li>
        <li class="menu-item menu-item-反馈">

    <a href="/feedback/" rel="section"><i class="fa fa-paper-plane fa-fw"></i>反馈</a>

  </li>
        <li class="menu-item menu-item-登录">

    <a href="/login/" rel="section"><i class="fa fa-sign-in-alt fa-fw"></i>登录</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
  
  

          <div class="content page posts-expand">
            
<style>
  .menstrual-page {
    max-width: 860px;
    margin: 0 auto;
    padding-bottom: 120px; /* 预留空间给右下角悬浮助手，避免遮挡内容 */
  }
  .menstrual-hero h1 {
    margin-bottom: 6px;
  }
  .menstrual-hero p {
    color: var(--text-color, #666);
    margin: 0 0 12px;
  }
  .menstrual-form {
    display: grid;
    grid-template-columns: 260px 180px 180px auto; /* 让输入框更短更紧凑 */
    gap: 12px;
    align-items: end;
    background: var(--card-bg, #ffffff);
    border: 1px solid var(--border-color, #e5e7eb);
    border-radius: 12px;
    padding: 14px;
    box-shadow: 0 6px 14px rgba(0,0,0,0.05);
  }
  .menstrual-form .field label {
    display: block;
    font-size: 0.9em;
    margin-bottom: 6px;
  }
  .menstrual-form .field input[type="date"],
  .menstrual-form .field input[type="number"] {
    width: 100%;
    padding: 10px 12px;
    height: 40px;
    font-size: 16px;
    border: 1.5px solid var(--border-color, #e5e7eb);
    border-radius: 10px;
    background: #ffffff;
    box-shadow: 0 2px 10px rgba(17, 24, 39, 0.04);
    transition: box-shadow .2s ease, border-color .2s ease, background-color .2s ease;
    box-sizing: border-box;
  }
  /* 修复数字输入在不同内核下的边框/微调按钮造成的怪异圆角与对齐问题 */
  .menstrual-form .field input[type="number"] {
    -moz-appearance: textfield;
    appearance: textfield;
  }
  .menstrual-form .field input[type="number"]::-webkit-outer-spin-button,
  .menstrual-form .field input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  /* 统一 date 外观，避免聚焦高亮在容器内产生长条 */
  .menstrual-form .field input[type="date"] {
    -webkit-appearance: none;
    appearance: none;
    background-clip: padding-box;
  }
  .menstrual-form .field input:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 1px 6px rgba(17,24,39,.06);
    outline: 2px solid rgba(99,102,241,.25); /* 使用 outline，避免外扩阴影造成容器被迫隐藏溢出 */
    outline-offset: 1px;
    background: #fcfdff;
  }
  .menstrual-form .field input:hover { border-color: #a5b4fc; }
  .menstrual-actions .btn {
    padding: 10px 18px;
    height: 40px;
    border-radius: 14px;
    border: 1px solid #7c3aed;
    background: linear-gradient(180deg, #8b5cf6, #7c3aed);
    color: #fff;
    cursor: pointer;
    box-shadow: 0 8px 18px rgba(124,58,237,.25);
    transition: transform .08s ease, box-shadow .2s ease, filter .2s ease;
  }
  .menstrual-actions .btn:hover { filter: brightness(1.05); box-shadow: 0 10px 22px rgba(124,58,237,.3); }
  .menstrual-actions .btn:active { transform: translateY(1px); }
  .menstrual-summary {
    margin-top: 16px;
    padding: 14px;
    border: 1px solid var(--border-color, #e5e7eb);
    border-radius: 12px;
    background: var(--card-bg, #ffffff);
    box-shadow: 0 6px 14px rgba(0,0,0,0.05);
  }
  .summary-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
  }
  .summary-item {
    background: var(--card-bg, #fafafa);
    border: 1px solid var(--border-color, #eee);
    border-radius: 10px;
    padding: 12px;
  }
  .summary-item .label {
    font-size: 12px;
    color: #777;
  }
  .summary-item .value {
    font-size: 20px;
    font-weight: 600;
  }
  .calendar {
    margin-top: 16px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
  }
  .month {
    border: 1px solid var(--border-color, #eee);
    border-radius: 12px;
    padding: 10px;
    background: var(--card-bg, #ffffff);
    box-shadow: 0 6px 14px rgba(0,0,0,0.05);
  }
  .month h4 {
    margin: 4px 0 6px;
    font-size: 14px;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
    font-size: 12px;
  }
  .cell {
    text-align: center;
    padding: 6px 0;
    border-radius: 8px;
  }
  .cell.heading {
    color: #888;
  }
  .cell.period {
    background: #fecaca;
  }
  .cell.ovulation {
    background: #fde68a;
  }
  .cell.fertile {
    background: #ffe8a3;
  }
  .cell.today {
    outline: 2px solid #6366f1;
    outline-offset: 1px;
    background: #eef2ff;
  }
  .legend {
    margin-top: 8px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    font-size: 12px;
    color: #666;
  }
  .legend span { display: inline-flex; gap: 6px; align-items: center; }
  .dot { width: 12px; height: 12px; border-radius: 2px; display: inline-block; }
  .dot.period { background: #fecaca; }
  .dot.ovulation { background: #fde68a; }
  .dot.fertile { background: #ffe8a3; }
  @media (max-width: 900px) {
    .menstrual-form { grid-template-columns: 1fr 1fr; }
    .calendar { grid-template-columns: 1fr; }
    .summary-grid { grid-template-columns: repeat(2, 1fr); }
  }
  /* 更激进的移动端适配：在小屏上表单竖排、按钮占满 */
  @media (max-width: 560px) {
    .menstrual-form { grid-template-columns: 1fr; gap: 10px; }
    .menstrual-actions .btn { width: 100%; }
  }

  /* 左下角视图筛选小组件 */
  .view-filter { position: fixed; left: 14px; bottom: 84px; z-index: 29; display:flex; gap: 10px; align-items:center; }
  .vf-chip { display:inline-flex; align-items:center; gap:8px; height: 36px; padding: 0 12px; border-radius: 999px; border:1px solid #e5e7eb; background: rgba(255,255,255,.85); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); box-shadow: 0 8px 18px rgba(0,0,0,.06); color:#444; cursor:pointer; transition: background .2s ease, box-shadow .2s ease, transform .08s ease; }
  .vf-chip .dot { border-radius: 999px; }
  .vf-chip[aria-pressed="true"] { border-color:#c7d2fe; background: linear-gradient(180deg,#ffffff,#f5f7ff); box-shadow:0 10px 22px rgba(99,102,241,.18); }
  .vf-chip:active { transform: translateY(1px); }

  /* 根据日历容器的隐藏类控制显示 */
  #calendar.hide-ovulation .cell.ovulation { display:none; }
  #calendar.hide-fertile .cell.fertile { display:none; }
</style>
<div class="page posts-expand menstrual-page">
  <section class="menstrual-hero">
    <h1>姨妈期小助手</h1>
    <p>记录上次来潮日期与周期，帮我们计算下次时间与提示。</p>
    <a class="album-back" href="/">← 返回首页</a>
  </section>

  <section class="menstrual-form" aria-label="period form">
    <div class="field">
      <label for="lastDate">上次来潮日期</label>
      <input id="lastDate" type="date" />
    </div>
    <div class="field">
      <label for="cycleDays">平均周期（天）</label>
      <input id="cycleDays" type="number" min="20" max="60" placeholder="28" />
    </div>
    <div class="field">
      <label for="periodLen">经期时长（天）</label>
      <input id="periodLen" type="number" min="1" max="10" placeholder="5" />
    </div>
    <div class="menstrual-actions">
      <button id="saveBtn" class="btn">保存并计算</button>
    </div>
  </section>

  <section class="menstrual-summary">
    <div class="summary-grid">
      <div class="summary-item">
        <div class="label">预计下次来潮</div>
        <div id="nextDate" class="value">—</div>
      </div>
      <div class="summary-item">
        <div class="label">排卵日（估算）</div>
        <div id="ovulationDate" class="value">—</div>
      </div>
      <div class="summary-item">
        <div class="label">易孕期范围</div>
        <div id="fertileRange" class="value">—</div>
      </div>
      <div class="summary-item">
        <div class="label">距离下次（天）</div>
        <div id="daysLeft" class="value">—</div>
      </div>
    </div>
    <div class="legend">
      <span><i class="dot period"></i> 经期</span>
      <span><i class="dot ovulation"></i> 排卵日</span>
      <span><i class="dot fertile"></i> 易孕期</span>
    </div>
  </section>

  <section id="calendar" class="calendar" aria-live="polite"></section>

  <!-- 视图筛选：排卵日/易孕期 开关 -->
  <div class="view-filter" role="group" aria-label="视图筛选">
    <button id="vf-ovulation" class="vf-chip" aria-pressed="true">
      <i class="dot ovulation" style="width:10px;height:10px"></i>
      <span>排卵日</span>
    </button>
    <button id="vf-fertile" class="vf-chip" aria-pressed="true">
      <i class="dot fertile" style="width:10px;height:10px"></i>
      <span>易孕期</span>
    </button>
  </div>

  <section class="ai-assistant" aria-label="女性健康顾问">
    <button id="ai-toggle" class="ai-toggle" aria-label="打开女性健康顾问">
      <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path fill="currentColor" d="M12 3c-4.97 0-9 3.582-9 8 0 2.52 1.33 4.77 3.42 6.23-.05.63-.27 1.94-1.22 3.39 0 0 2.04-.39 3.77-1.86.96.27 1.99.41 3.03.41 4.97 0 9-3.58 9-8s-4.03-8-9-8z"/></svg>
    </button>
    <div id="ai-panel" class="ai-panel" hidden>
      <div class="ai-head">
        <strong>女性健康顾问</strong>
        <span class="ai-sub">仅回答女性生理相关问题</span>
      </div>
      <div class="ai-key">
        <input id="ai-key-input" type="password" placeholder="已内置密钥，无需填写" disabled />
        <button id="ai-save-key" class="btn" style="display:none">保存</button>
      </div>
      <div id="ai-messages" class="ai-messages" aria-live="polite"></div>
      <div class="ai-input">
        <textarea id="ai-text" rows="2" placeholder="问：经期肚子痛怎么缓解？"></textarea>
        <button id="ai-send" class="btn">发送</button>
      </div>
      <div class="ai-tip">温馨提示：该助手仅作健康科普与关怀建议，不能替代专业医疗诊断。</div>
    </div>
  </section>
</div>

<script>
(function () {
  var $ = function (id) { return document.getElementById(id); };
  var lastDateInput = $('lastDate');
  var cycleInput = $('cycleDays');
  var lenInput = $('periodLen');
  var saveBtn = $('saveBtn');
  var nextDateEl = $('nextDate');
  var ovulationEl = $('ovulationDate');
  var fertileRangeEl = $('fertileRange');
  var daysLeftEl = $('daysLeft');
  var calendarEl = document.getElementById('calendar');
  var vfOvu = document.getElementById('vf-ovulation');
  var vfFer = document.getElementById('vf-fertile');

  var KEY = 'menstrual_prefs_v1';
  var FILTER_KEY = 'menstrual_view_filter_v1';

  function fmt(d) {
    var y = d.getFullYear();
    var m = String(d.getMonth() + 1).padStart(2, '0');
    var day = String(d.getDate()).padStart(2, '0');
    return y + '-' + m + '-' + day;
  }
  function parseDate(str) {
    var t = new Date(str);
    return isNaN(t.getTime()) ? null : t;
  }
  function addDays(date, n) {
    var d = new Date(date.getTime());
    d.setDate(d.getDate() + n);
    return d;
  }
  function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

  function save() {
    var payload = {
      last: lastDateInput.value,
      cycle: clamp(parseInt(cycleInput.value || '28', 10) || 28, 20, 60),
      len: clamp(parseInt(lenInput.value || '5', 10) || 5, 1, 10)
    };
    localStorage.setItem(KEY, JSON.stringify(payload));
    computeAndRender(payload);
  }
  function load() {
    try {
      var raw = localStorage.getItem(KEY);
      if (!raw) return null;
      var p = JSON.parse(raw);
      return p && p.last ? p : null;
    } catch (_) { return null; }
  }

  function computeWindows(lastDate, cycleDays, periodLen) {
    // 预计下次来潮 = 上次 + 周期
    var next = addDays(lastDate, cycleDays);
    // 排卵日约在下次来潮前 14 天
    var ovulation = addDays(next, -14);
    // 易孕期：排卵日前 4 天到排卵日后 1 天（经验范围）
    var fertileStart = addDays(ovulation, -4);
    var fertileEnd = addDays(ovulation, 1);
    // 经期窗口：从上次来潮开始，持续 periodLen 天
    var periodStart = new Date(lastDate.getTime());
    var periodEnd = addDays(periodStart, periodLen - 1);
    return { next: next, ovulation: ovulation, fertileStart: fertileStart, fertileEnd: fertileEnd, periodStart: periodStart, periodEnd: periodEnd };
  }

  function renderSummary(windows) {
    nextDateEl.textContent = fmt(windows.next);
    ovulationEl.textContent = fmt(windows.ovulation);
    fertileRangeEl.textContent = fmt(windows.fertileStart) + ' ~ ' + fmt(windows.fertileEnd);
    var today = new Date();
    var daysLeft = Math.ceil((windows.next - new Date(today.getFullYear(), today.getMonth(), today.getDate())) / 86400000);
    daysLeftEl.textContent = daysLeft >= 0 ? String(daysLeft) : '0';
  }

  function inRange(d, a, b) { return d >= a && d <= b; }

  function renderCalendar(lastDate, cycleDays, periodLen) {
    if (!calendarEl) return;
    calendarEl.innerHTML = '';

    var windows = computeWindows(lastDate, cycleDays, periodLen);
    renderSummary(windows);

    var base = new Date();
    for (var i = 0; i < 3; i++) {
      var first = new Date(base.getFullYear(), base.getMonth() + i, 1);
      var month = first.getMonth();
      var year = first.getFullYear();
      var lastDay = new Date(year, month + 1, 0).getDate();
      var startWeekday = first.getDay();

      var wrap = document.createElement('div');
      wrap.className = 'month';
      var h = document.createElement('h4');
      h.textContent = year + '年' + (month + 1) + '月';
      wrap.appendChild(h);

      var grid = document.createElement('div');
      grid.className = 'grid';
      var heads = ['日','一','二','三','四','五','六'];
      for (var hi = 0; hi < 7; hi++) {
        var ch = document.createElement('div');
        ch.className = 'cell heading';
        ch.textContent = heads[hi];
        grid.appendChild(ch);
      }
      for (var e = 0; e < startWeekday; e++) {
        var empty = document.createElement('div');
        empty.className = 'cell';
        empty.textContent = '';
        grid.appendChild(empty);
      }
      var today = new Date();
      var todayKey = fmt(new Date(today.getFullYear(), today.getMonth(), today.getDate()));
      for (var d = 1; d <= lastDay; d++) {
        var cellDate = new Date(year, month, d);
        var cell = document.createElement('div');
        cell.className = 'cell';
        cell.textContent = String(d);
        // 标记窗口
        if (inRange(cellDate, windows.periodStart, windows.periodEnd)) cell.classList.add('period');
        if (fmt(cellDate) === fmt(windows.ovulation)) cell.classList.add('ovulation');
        if (inRange(cellDate, windows.fertileStart, windows.fertileEnd)) cell.classList.add('fertile');
        if (fmt(cellDate) === todayKey) cell.classList.add('today');
        grid.appendChild(cell);
      }
      wrap.appendChild(grid);
      calendarEl.appendChild(wrap);
    }
  }

  function computeAndRender(prefs) {
    var last = parseDate(prefs.last);
    if (!last) return;
    renderCalendar(last, prefs.cycle, prefs.len);
  }

  function init() {
    var prefs = load();
    if (prefs) {
      lastDateInput.value = prefs.last;
      cycleInput.value = String(prefs.cycle);
      lenInput.value = String(prefs.len);
      computeAndRender(prefs);
    } else {
      // 默认值：今日为上次日期（用户可修改）
      lastDateInput.value = fmt(new Date());
      cycleInput.value = '28';
      lenInput.value = '5';
    }

    // 读取视图筛选偏好
    try {
      var raw = localStorage.getItem(FILTER_KEY);
      var v = raw ? JSON.parse(raw) : { ovulation: true, fertile: true };
      if (vfOvu) vfOvu.setAttribute('aria-pressed', v.ovulation ? 'true' : 'false');
      if (vfFer) vfFer.setAttribute('aria-pressed', v.fertile ? 'true' : 'false');
      if (calendarEl) {
        calendarEl.classList.toggle('hide-ovulation', !v.ovulation);
        calendarEl.classList.toggle('hide-fertile', !v.fertile);
      }
    } catch(_) {}
  }

  saveBtn && saveBtn.addEventListener('click', function () {
    if (!lastDateInput.value) {
      alert('请先选择上次来潮日期');
      return;
    }
    save();
  });

  init();
  // 视图筛选交互
  function saveFilter(){
    if(!vfOvu || !vfFer) return;
    var v = { ovulation: vfOvu.getAttribute('aria-pressed') === 'true', fertile: vfFer.getAttribute('aria-pressed') === 'true' };
    try { localStorage.setItem(FILTER_KEY, JSON.stringify(v)); } catch(_) {}
  }
  vfOvu && vfOvu.addEventListener('click', function(){
    var cur = vfOvu.getAttribute('aria-pressed') === 'true';
    vfOvu.setAttribute('aria-pressed', cur ? 'false' : 'true');
    calendarEl && calendarEl.classList.toggle('hide-ovulation', cur);
    saveFilter();
  });
  vfFer && vfFer.addEventListener('click', function(){
    var cur = vfFer.getAttribute('aria-pressed') === 'true';
    vfFer.setAttribute('aria-pressed', cur ? 'false' : 'true');
    calendarEl && calendarEl.classList.toggle('hide-fertile', cur);
    saveFilter();
  });
})();
</script>

<style>
  .ai-assistant { position: fixed; right: 20px; bottom: 20px; z-index: 30; }
  .ai-toggle { width: 52px; height: 52px; display:flex; align-items:center; justify-content:center; border-radius: 50%; border: 1px solid rgba(124,58,237,.8); background: radial-gradient(120% 120% at 30% 20%, #a78bfa 0%, #7c3aed 70%); color:#fff; box-shadow:0 14px 28px rgba(124,58,237,.35); cursor:pointer; transition: transform .08s ease, filter .2s ease, box-shadow .2s ease; }
  .ai-toggle:hover { filter: brightness(1.05); box-shadow:0 18px 34px rgba(124,58,237,.42); }
  .ai-toggle:active { transform: translateY(1px) scale(.98); }
  .ai-panel { width: 380px; max-height: 72vh; background: rgba(255,255,255,.7); border:1px solid rgba(255,255,255,.6); border-radius: 16px; box-shadow:0 20px 44px rgba(24,24,27,.18); overflow:hidden; display:flex; flex-direction:column; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); animation: rise .18s ease both; }
  @keyframes rise { from { transform: translateY(8px); opacity: .0; } to { transform: translateY(0); opacity: 1; } }
  .ai-head { padding: 12px 14px; border-bottom:1px solid rgba(241,245,249,.8); background: linear-gradient(180deg, rgba(167,139,250,.18), rgba(167,139,250,.06)); display:flex; align-items:center; gap:8px; }
  .ai-head:before { content:""; width: 22px; height: 22px; border-radius:6px; background: linear-gradient(180deg,#8b5cf6,#7c3aed); box-shadow: 0 6px 14px rgba(124,58,237,.3); }
  .ai-sub { color:#6b7280; font-size:12px; margin-left:2px; }
  .ai-key { display:flex; gap:8px; padding:10px 12px; border-bottom:1px dashed #f1f5f9; }
  .ai-key input { flex:1; padding:8px 10px; border:1px solid #e5e7eb; border-radius:8px; }
  .ai-messages { padding: 12px 14px; overflow:auto; flex:1; background: linear-gradient(180deg,#fafafa,#ffffff); }
  .ai-row { display:flex; gap:8px; margin-bottom:10px; }
  .ai-row.me { justify-content:flex-end; }
  .ai-avatar { width:26px; height:26px; border-radius:8px; background:#eef2ff; display:flex; align-items:center; justify-content:center; color:#6366f1; box-shadow: inset 0 0 0 1px #dbe3ff; }
  .ai-avatar.bot { background:#f5f3ff; color:#7c3aed; box-shadow: inset 0 0 0 1px #e9e1ff; }
  .ai-msg { background:#fff; border:1px solid #eee; border-radius:14px; padding:10px 12px; max-width: 78%; box-shadow:0 2px 6px rgba(0,0,0,.04); line-height:1.6; }
  .ai-row.me .ai-msg { background:linear-gradient(180deg,#eef2ff,#e4e9ff); border-color:#dbe3ff; }
  .ai-typing { display:inline-flex; gap:4px; }
  .ai-typing i { width:6px; height:6px; background:#a78bfa; border-radius:50%; opacity:.6; animation: blink 1s infinite; }
  .ai-typing i:nth-child(2){ animation-delay:.15s; }
  .ai-typing i:nth-child(3){ animation-delay:.3s; }
  @keyframes blink { 0%,80%,100% { opacity:.25; transform: translateY(0); } 40% { opacity:1; transform: translateY(-2px); } }
  .ai-input { display:flex; gap:8px; padding:10px 12px; border-top:1px solid rgba(241,245,249,.8); background: rgba(255,255,255,.5); }
  .ai-input textarea { flex:1; resize:vertical; padding:10px 12px; border:1px solid #e5e7eb; border-radius:10px; background:#fff; transition: box-shadow .2s ease, border-color .2s ease; }
  .ai-input textarea:focus { outline:none; border-color:#818cf8; box-shadow:0 0 0 3px rgba(129,140,248,.18); }
  .ai-input .btn { min-width: 90px; display:inline-flex; align-items:center; justify-content:center; gap:6px; }
  .ai-input .btn svg { width:16px; height:16px; }
  .ai-tip { padding: 4px 12px 10px; font-size:12px; color:#888; }
  @media (max-width: 900px) {
    .menstrual-page { padding-bottom: 140px; }
  }
  @media (max-width: 600px) {
    .ai-panel { width: min(92vw, 380px); right: 4vw; }
    .ai-assistant { right: 14px; bottom: 14px; }
  }
</style>

<script>
(function(){
  var toggle = document.getElementById('ai-toggle');
  var panel = document.getElementById('ai-panel');
  var keyInput = document.getElementById('ai-key-input');
  var saveKeyBtn = document.getElementById('ai-save-key');
  var msgBox = document.getElementById('ai-messages');
  var input = document.getElementById('ai-text');
  var sendBtn = document.getElementById('ai-send');
  var KEY = 'zhipu_api_key_local';
  var HARDCODED_KEY = '4c25685fd58342b6a56ebb5917f4109e.rSftjTMMtPeWZXhA';

  function row(me){
    var wrap = document.createElement('div');
    wrap.className = 'ai-row' + (me ? ' me' : '');
    var avatar = document.createElement('div');
    avatar.className = 'ai-avatar ' + (me ? 'me' : 'bot');
    avatar.textContent = me ? '我' : 'AI';
    var bubble = document.createElement('div');
    bubble.className = 'ai-msg';
    if(me){ wrap.appendChild(bubble); wrap.appendChild(avatar); } else { wrap.appendChild(avatar); wrap.appendChild(bubble); }
    msgBox.appendChild(wrap);
    return bubble;
  }
  function addMsg(text, me){
    var bubble = row(me);
    bubble.textContent = text;
    msgBox.scrollTop = msgBox.scrollHeight;
  }
  function addTyping(){
    var bubble = row(false);
    var box = document.createElement('div');
    box.className = 'ai-typing';
    box.innerHTML = '<i></i><i></i><i></i>';
    bubble.appendChild(box);
    msgBox.scrollTop = msgBox.scrollHeight;
    return bubble.parentElement; // 返回行容器，便于替换
  }

  function sysPrompt(){
    return [
      { role: 'system', content: `我是您的女性生理健康顾问，专注为您提供关于女性生理、经期、排卵等相关常识的帮助与建议。我会用温柔、体贴的话语来安慰您，陪伴您度过任何生理上的不适和情绪上的低谷。

我将解答：

经期护理、排卵期管理与常识

健康的运动与饮食建议（根据23岁，身高169cm，体重140斤的身体状况提供个性化建议）

如何识别就医时机与安慰鼓励

心情不开心或情绪低落时，给您温暖的关心与鼓励

我严格避免：

与女性生理健康无关的问题（如编程、政治、八卦等）

任何医疗诊断、处方、药品剂量等具体建议

超出我专业范围的回答

安全指引：
若出现剧烈腹痛、异常大量出血、长期闭经、发热、昏厥等症状，请尽快就医。

无论何时，如果您感觉情绪低落或不开心，请记住，我在这里，随时为您提供甜蜜的安慰和支持。生活有时候会有些波动，但相信自己，一切都会过去的。你值得拥有幸福与健康，每一天都是新的开始。`
      }
    ];
  }

  function loadKey(){
    try { return localStorage.getItem(KEY) || ''; } catch(_) { return ''; }
  }
  function saveKey(v){
    try { localStorage.setItem(KEY, v || ''); } catch(_) {}
  }

  function send(){
    var text = (input.value || '').trim();
    if(!text) return;
    var apiKey = HARDCODED_KEY;
    // 展开面板（若未展开）
    if(panel && panel.hasAttribute('hidden')) panel.removeAttribute('hidden');
    addMsg(text, true);
    input.value='';
    var thinkingRow = addTyping();

    var payload = {
      model: 'glm-4',
      messages: sysPrompt().concat([{ role:'user', content: text }])
    };

    fetch('https://open.bigmodel.cn/api/paas/v4/chat/completions',{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'Authorization':'Bearer ' + apiKey
      },
      body: JSON.stringify(payload)
    }).then(function(res){
      if(!res.ok) throw new Error('请求失败：' + res.status);
      return res.json();
    }).then(function(json){
      var content = (json && json.choices && json.choices[0] && json.choices[0].message && json.choices[0].message.content) || '抱歉，暂时没有得到回答。';
      if(thinkingRow && thinkingRow.parentNode){ thinkingRow.parentNode.removeChild(thinkingRow); }
      addMsg(content, false);
    }).catch(function(err){
      if(thinkingRow && thinkingRow.parentNode){ thinkingRow.parentNode.removeChild(thinkingRow); }
      addMsg('请求出错：' + (err && err.message ? err.message : err), false);
    });
  }

  toggle && toggle.addEventListener('click', function(){
    var hidden = panel.hasAttribute('hidden');
    if(hidden) panel.removeAttribute('hidden'); else panel.setAttribute('hidden','');
  });
  // 保存按钮被隐藏，不再需要保存
  sendBtn && sendBtn.addEventListener('click', send);
  input && input.addEventListener('keydown', function(e){ if((e.ctrlKey || e.metaKey) && e.key==='Enter'){ send(); }});

  // init
  keyInput.value = '******** 已内置 ********';
})();
</script>

          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿坤 ❤ 小影</span>
</div>
  <div class="powered-by">由 <a href="https://github.com/lsk-0912" class="theme-link" rel="noopener" target="_blank">lsk-0912</a> & <a href="https://github.com/lsk-0912" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
<script>
// 未完成页面拦截：同域链接点击时先探测是否存在
(function () {
  function isSameOrigin(href) {
    try {
      var url = new URL(href, window.location.href);
      return url.origin === window.location.origin;
    } catch (e) {
      return false;
    }
  }

  function isHashLink(href) {
    return href && href.trim().charAt(0) === '#';
  }

  function showPendingDialog() {
    window.alert('此功能还没有开发，敬请期待呀~');
  }

  document.addEventListener('click', function (e) {
    var target = e.target;
    while (target && target.tagName !== 'A') {
      target = target.parentElement;
    }
    if (!target) return;

    var href = target.getAttribute('href');
    if (!href || isHashLink(href) || target.hasAttribute('download') || target.getAttribute('target') === '_blank') {
      return;
    }
    if (!isSameOrigin(href)) {
      return; // 外链不拦截
    }

    // 允许开发者跳过拦截
    if (target.dataset && target.dataset.skipPending === 'true') {
      return;
    }

    e.preventDefault();

    var url = new URL(href, window.location.href);
    var timeoutId = null;
    var timedOut = false;

    function navigate() {
      window.location.href = url.href;
    }

    // 超时兜底：2.5s 内未得到成功响应则视为未就绪
    timeoutId = setTimeout(function () {
      timedOut = true;
      showPendingDialog();
    }, 2500);

    fetch(url.href, { method: 'HEAD', cache: 'no-cache' })
      .then(function (res) {
        if (timeoutId) clearTimeout(timeoutId);
        if (res && res.ok) {
          navigate();
        } else {
          showPendingDialog();
        }
      })
      .catch(function () {
        if (timeoutId) clearTimeout(timeoutId);
        showPendingDialog();
      });
  }, false);
})();
</script>

<script>
(function(){
  // 轻量鉴权工具：可在任意页面脚本中调用 window.AuthGuard
  var SESS_KEY = 'auth_session_v1';
  function now(){ return Math.floor(Date.now()/1000); }
  function getSession(){ try{ var raw = localStorage.getItem(SESS_KEY); if(!raw) return null; var s = JSON.parse(raw); if(s && s.exp && s.exp>0 && now()>s.exp){ localStorage.removeItem(SESS_KEY); return null; } return s; }catch(_){ return null; } }
  function isAuthed(){ return !!getSession(); }
  function logout(){ try{ localStorage.removeItem(SESS_KEY); }catch(_){} }
  function requireOrRedirect(){ if(!isAuthed()){ location.href = '/login/?from='+ encodeURIComponent(location.pathname+location.search); return false; } return true; }
  window.AuthGuard = { isAuthed:isAuthed, logout:logout, require: requireOrRedirect };
})();
</script>


  <script>
  (function(){
    var LOGIN_PATH = '/login/';
    var TOKEN_KEY = 'site_auth_token_v1';
    function isAuthed(){ try{ return localStorage.getItem(TOKEN_KEY) === '1'; }catch(_){ return false; } }
    function onLogout(){ try{ localStorage.removeItem(TOKEN_KEY); }catch(_){ } location.href = LOGIN_PATH; }

    // 路由拦截：未登录则只能访问登录页
    var path = location.pathname;
    if (path.indexOf(LOGIN_PATH) !== 0 && !isAuthed()) {
      location.replace(LOGIN_PATH);
      return;
    }
    if (path.indexOf(LOGIN_PATH) === 0 && isAuthed()) {
      // 已登录访问登录页时跳回首页
      location.replace('/');
      return;
    }

    // 顶部添加登出按钮（仅非登录页显示）
    if (path.indexOf(LOGIN_PATH) !== 0) {
      var menu = document.querySelector('.site-nav ul.main-menu.menu');
      if (menu) {
        var li = document.createElement('li');
        li.className = 'menu-item';
        var a = document.createElement('a');
        a.href = 'javascript:void(0)';
        a.textContent = '退出';
        a.addEventListener('click', onLogout);
        li.appendChild(a);
        menu.appendChild(li);
      }
    }
  })();
  </script>
</body>
</html>
