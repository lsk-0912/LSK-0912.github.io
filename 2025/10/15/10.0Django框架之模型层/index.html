<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aurora-lsk.asia","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Django框架之模型层 【一】模型层引入（测试环境搭建）  Django的orm框架必须是在Django的启动状态下才能使用 Django为我们提供了测试环境 这个测试环境只是临时启动而不是持久化活动  创建测试环境 123456789import osif __name__ &#x3D;&#x3D; &#x27;__main__&#x27;:    # 在main入口下面复制manage.py文件中main入口下">
<meta property="og:type" content="article">
<meta property="og:title" content="10.0Django框架之模型层">
<meta property="og:url" content="https://aurora-lsk.asia/2025/10/15/10.0Django%E6%A1%86%E6%9E%B6%E4%B9%8B%E6%A8%A1%E5%9E%8B%E5%B1%82/index.html">
<meta property="og:site_name" content="Aurora博客">
<meta property="og:description" content="Django框架之模型层 【一】模型层引入（测试环境搭建）  Django的orm框架必须是在Django的启动状态下才能使用 Django为我们提供了测试环境 这个测试环境只是临时启动而不是持久化活动  创建测试环境 123456789import osif __name__ &#x3D;&#x3D; &#x27;__main__&#x27;:    # 在main入口下面复制manage.py文件中main入口下">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="d:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240625202154249.png">
<meta property="og:image" content="d:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240625213204352.png">
<meta property="og:image" content="d:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240625213204352.png">
<meta property="article:published_time" content="2025-10-15T03:34:55.000Z">
<meta property="article:modified_time" content="2025-10-15T09:06:32.206Z">
<meta property="article:author" content="Aurora">
<meta property="article:tag" content="Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="d:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240625202154249.png">

<link rel="canonical" href="https://aurora-lsk.asia/2025/10/15/10.0Django%E6%A1%86%E6%9E%B6%E4%B9%8B%E6%A8%A1%E5%9E%8B%E5%B1%82/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>10.0Django框架之模型层 | Aurora博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Aurora博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aurora-lsk.asia/2025/10/15/10.0Django%E6%A1%86%E6%9E%B6%E4%B9%8B%E6%A8%A1%E5%9E%8B%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Aurora">
      <meta itemprop="description" content="选择有时候比努力更重要，但是你不努力，选择就只是空谈">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aurora博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          10.0Django框架之模型层
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-15 11:34:55 / 修改时间：17:06:32" itemprop="dateCreated datePublished" datetime="2025-10-15T11:34:55+08:00">2025-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1>Django框架之模型层</h1>
<h2 id="【一】模型层引入（测试环境搭建）">【一】模型层引入（测试环境搭建）</h2>
<ul>
<li>Django的orm框架必须是在Django的启动状态下才能使用</li>
<li>Django为我们提供了测试环境</li>
<li>这个测试环境只是临时启动而不是持久化活动</li>
</ul>
<p>创建测试环境</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制</span></span><br><span class="line">    os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;Django_two.settings&#x27;</span>)</span><br><span class="line">    <span class="comment"># 导入模块</span></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    <span class="comment"># 启动方式只是临时启动，不是持久化</span></span><br><span class="line">    django.setup()</span><br></pre></td></tr></table></figure>
<h2 id="【二】Django的ORM的单表操作">【二】Django的ORM的单表操作</h2>
<h3 id="【1】数据库配置">【1】数据库配置</h3>
<ul>
<li>在setting.py文件中配置
<ul>
<li>将原来django自带的删掉</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="comment"># 手动创建一个新的数据库</span></span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&quot;django_two&quot;</span>,</span><br><span class="line">        <span class="string">&quot;USER&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">        <span class="string">&quot;PASSWORD&quot;</span>: <span class="string">&quot;1234567&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HOST&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;PORT&quot;</span>: <span class="number">3306</span>,</span><br><span class="line">        <span class="string">&quot;CHARSET&quot;</span>: <span class="string">&quot;utf8mb4&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>启动项目可能会报错</li>
<li>原因是没有下载mysqlclient</li>
</ul>
<p>解决方法一</p>
<ul>
<li>
<p>打猴子补丁</p>
</li>
<li>
<p>随便找一个文件，一般都会选择<code>__init__.py</code>文件</p>
</li>
<li>
<p>把下面的数据复制进去即可</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>
<p>方法二</p>
<ul>
<li>下载mysqlclient</li>
</ul>
<h3 id="【2】在APP下的models-py文件中定义模型表">【2】在APP下的models.py文件中定义模型表</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span>(models.Model):</span><br><span class="line">    <span class="comment"># 名字</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>, verbose_name=<span class="string">&quot;名字&quot;</span>)</span><br><span class="line">    <span class="comment"># 年龄</span></span><br><span class="line">    age = models.IntegerField(verbose_name=<span class="string">&quot;年龄&quot;</span>)</span><br><span class="line">    <span class="comment"># 显示注册时间</span></span><br><span class="line">    <span class="comment"># auto_now_add=True</span></span><br><span class="line">    <span class="comment"># Django会在对象第一次被创建时自动设置该字段的值为当前的日期和时间。之后，无论对象如何被保存或修改，这个字段的值都不会再自动更新</span></span><br><span class="line">    <span class="comment"># DateTimeField类型</span></span><br><span class="line">    <span class="comment"># 用于在数据库中存储日期和时间</span></span><br><span class="line">    register_time = models.DateTimeField(auto_now_add=<span class="literal">True</span>,</span><br><span class="line">                                         verbose_name=<span class="string">&quot;注册时间&quot;</span>)</span><br><span class="line">    <span class="comment"># auto_now：在创建数据库的时候会自动新增时间，每次修改都会刷新</span></span><br><span class="line">    update_time = models.DateTimeField(auto_now=<span class="literal">True</span>,</span><br><span class="line">                                       verbose_name=<span class="string">&quot;更新时间&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>迁移数据库</p>
<ul>
<li>执行两句话</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line"></span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>
<ul>
<li>执行完后就迁移成功了</li>
</ul>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240625202154249.png" alt="image-20240625202154249"></p>
</li>
</ul>
<h3 id="【3】对数据库的增删改查（必会N条）">【3】对数据库的增删改查（必会N条）</h3>
<ul>
<li>在你的测试环境下面写</li>
</ul>
<h4 id="（1）增">（1）增</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制</span></span><br><span class="line">    os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;Django_two.settings&#x27;</span>)</span><br><span class="line">    <span class="comment"># 导入模块</span></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 启动方式只是临时启动，不是持久化</span></span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 记住在django中pk就是mysql中的id</span></span><br><span class="line">    <span class="comment"># 【1】对数据库增值</span></span><br><span class="line">    <span class="comment"># 方式一 create()</span></span><br><span class="line">    <span class="comment"># data = UserInfo.objects.create(name=&quot;jack&quot;, age=22)</span></span><br><span class="line">    <span class="comment"># print(data) # UserInfo object (1)</span></span><br><span class="line">    <span class="comment"># 方法二 先生成一个对象，然后在提交事务</span></span><br><span class="line">    <span class="comment"># data = UserInfo(name=&quot;tom&quot;, age=710)</span></span><br><span class="line">    <span class="comment"># print(data) # UserInfo object (None)</span></span><br><span class="line">    <span class="comment"># 提交事务，不提交事务不会添加数据</span></span><br><span class="line">    <span class="comment"># data.save()</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="（2）删">（2）删</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制</span></span><br><span class="line">    os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;Django_two.settings&#x27;</span>)</span><br><span class="line">    <span class="comment"># 导入模块</span></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 启动方式只是临时启动，不是持久化</span></span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 记住在django中pk就是mysql中的id</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 【4】删除数据</span></span><br><span class="line">    <span class="comment"># 方法一 获取到筛选的结果，然后对结果进行删除.delete()</span></span><br><span class="line">    <span class="comment"># 会把符合条件的全部删除</span></span><br><span class="line">    <span class="comment"># data = UserInfo.objects.filter(name=&quot;tom&quot;).delete()</span></span><br><span class="line">    <span class="comment"># print(data) # (2, &#123;&#x27;user.UserInfo&#x27;: 2&#125;)# 删除了两条数据</span></span><br><span class="line">    <span class="comment"># 方法二 直接删除对象</span></span><br><span class="line">    <span class="comment"># data = UserInfo.objects.get(name=&quot;dream&quot;).delete()</span></span><br><span class="line">    <span class="comment"># print(data)  # (1, &#123;&#x27;user.UserInfo&#x27;: 1&#125;) #删除了一条数据</span></span><br></pre></td></tr></table></figure>
<h4 id="（3）改">（3）改</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制</span></span><br><span class="line">    os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;Django_two.settings&#x27;</span>)</span><br><span class="line">    <span class="comment"># 导入模块</span></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 启动方式只是临时启动，不是持久化</span></span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 记住在django中pk就是mysql中的id</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【3】对数据库修改数据</span></span><br><span class="line">    <span class="comment"># 方法一 查完后直接修改</span></span><br><span class="line">    <span class="comment"># data = UserInfo.objects.filter(name=&quot;jack&quot;).update(name=&quot;dream&quot;)</span></span><br><span class="line">    <span class="comment"># print(data) # 2 # 代表修改了两条数据</span></span><br><span class="line">    <span class="comment"># 方法二 先查对象，然后对象.属性名改值</span></span><br><span class="line">    <span class="comment"># data = UserInfo.objects.get(pk=1)</span></span><br><span class="line">    <span class="comment"># data.name = &quot;tom&quot;</span></span><br><span class="line">    <span class="comment"># print(data)  # UserInfo object (1)</span></span><br><span class="line">    <span class="comment"># # 一定要提交数据</span></span><br><span class="line">    <span class="comment"># data.save()</span></span><br><span class="line">    <span class="comment"># # 修改成功</span></span><br></pre></td></tr></table></figure>
<h4 id="（4）查">（4）查</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制</span></span><br><span class="line">    os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;Django_two.settings&#x27;</span>)</span><br><span class="line">    <span class="comment"># 导入模块</span></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 启动方式只是临时启动，不是持久化</span></span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 记住在django中pk就是mysql中的id</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【2】查询数据库里面的数据</span></span><br><span class="line">    <span class="comment"># 方式一 get和values取出所有符合条件的值，all取出所有的数据对象</span></span><br><span class="line">    <span class="comment"># data = UserInfo.objects.all()</span></span><br><span class="line">    <span class="comment"># # 得到的是所有数据的对象</span></span><br><span class="line">    <span class="comment"># print(data) # &lt;QuerySet [&lt;UserInfo: UserInfo object (1)&gt;, &lt;UserInfo: UserInfo object (2)&gt;, &lt;UserInfo: UserInfo object (3)&gt;]&gt;</span></span><br><span class="line">    <span class="comment"># data = UserInfo.objects.all().values(&quot;name&quot;)</span></span><br><span class="line">    <span class="comment"># # 取出所有人的名字</span></span><br><span class="line">    <span class="comment"># print(data)</span></span><br><span class="line">    <span class="comment"># # &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;jack&#x27;&#125;, &#123;&#x27;name&#x27;: &#x27;jack&#x27;&#125;, &#123;&#x27;name&#x27;: &#x27;tom&#x27;&#125;]&gt;</span></span><br><span class="line">    <span class="comment"># # 得到id为1的user对象</span></span><br><span class="line">    <span class="comment"># data = UserInfo.objects.get(pk=1)</span></span><br><span class="line">    <span class="comment"># print(data)</span></span><br><span class="line">    <span class="comment"># # UserInfo object (1)</span></span><br><span class="line">    <span class="comment"># # 得到数据</span></span><br><span class="line">    <span class="comment"># data = data.name</span></span><br><span class="line">    <span class="comment"># print(data)  # jack</span></span><br><span class="line">    <span class="comment"># 方法二 fileter过滤结果 结果是queryset对象</span></span><br><span class="line">    <span class="comment"># data = UserInfo.objects.filter(pk=1)</span></span><br><span class="line">    <span class="comment"># print(data)  # &lt;QuerySet [&lt;UserInfo: UserInfo object (1)&gt;]&gt;</span></span><br><span class="line">    <span class="comment"># 获得结果集的第一个结果</span></span><br><span class="line">    <span class="comment"># 因为就一个结果，都可以获得</span></span><br><span class="line">    <span class="comment"># data = data.first()</span></span><br><span class="line">    <span class="comment"># print(data) # UserInfo object (1)</span></span><br><span class="line">    <span class="comment"># 获得结果集的最后一个结果</span></span><br><span class="line">    <span class="comment"># 因为就一个结果，都可以获得</span></span><br><span class="line">    <span class="comment"># data = data.last()</span></span><br><span class="line">    <span class="comment"># print(data)  # UserInfo object (1)</span></span><br><span class="line">    <span class="comment"># 获得结果集中的所有符合条件的结果</span></span><br><span class="line">    <span class="comment"># data = UserInfo.objects.filter(name=&quot;jack&quot;)</span></span><br><span class="line">    <span class="comment"># print(data) # &lt;QuerySet [&lt;UserInfo: UserInfo object (1)&gt;, &lt;UserInfo: UserInfo object (2)&gt;]&gt;</span></span><br><span class="line">    <span class="comment"># data = data.all()</span></span><br><span class="line">    <span class="comment"># print(data) # &lt;QuerySet [&lt;UserInfo: UserInfo object (1)&gt;, &lt;UserInfo: UserInfo object (2)&gt;]&gt;</span></span><br><span class="line">    <span class="comment"># 获取结果集中的对应字段对应的数据,values得到的是字典</span></span><br><span class="line">    <span class="comment"># data = UserInfo.objects.filter(age=22).values(&quot;name&quot;, &quot;age&quot;)</span></span><br><span class="line">    <span class="comment"># print(data)</span></span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;jack&#x27;, &#x27;age&#x27;: 22&#125;, &#123;&#x27;name&#x27;: &#x27;jack&#x27;, &#x27;age&#x27;: 22&#125;]&gt;</span></span><br><span class="line">    <span class="comment"># 获取结果集中的对应字段对应的数据,values_list得到的是字典</span></span><br><span class="line">    <span class="comment"># data = UserInfo.objects.filter(age=22).values_list(&quot;name&quot;, &quot;age&quot;)</span></span><br><span class="line">    <span class="comment"># print(data) # &lt;QuerySet [(&#x27;jack&#x27;, 22), (&#x27;jack&#x27;, 22)]&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="（5）其它方法">（5）其它方法</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制</span></span><br><span class="line">    os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;Django_two.settings&#x27;</span>)</span><br><span class="line">    <span class="comment"># 导入模块</span></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 启动方式只是临时启动，不是持久化</span></span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 记住在django中pk就是mysql中的id</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【5】去重</span></span><br><span class="line">	<span class="comment"># 筛选数的第一条数据</span></span><br><span class="line">    <span class="comment"># user = UserInfo.objects.values(&quot;age&quot;).distinct().first()</span></span><br><span class="line">    <span class="comment"># print(user, type(user))</span></span><br><span class="line">    <span class="comment"># &#123;&#x27;age&#x27;: 18&#125; &lt;class &#x27;dict&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 【6】知道数据的结果量</span></span><br><span class="line">    <span class="comment"># user = UserInfo.objects.count()</span></span><br><span class="line">    <span class="comment"># print(user)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 【7】排序</span></span><br><span class="line">    <span class="comment"># 正序排 MySQL正序加 asc</span></span><br><span class="line">    <span class="comment"># user = UserInfo.objects.order_by(&quot;age&quot;)</span></span><br><span class="line">    <span class="comment"># print(user)</span></span><br><span class="line">    <span class="comment"># 倒序排 MySQL倒序加 desc</span></span><br><span class="line">    <span class="comment"># user = UserInfo.objects.order_by(&quot;-age&quot;)</span></span><br><span class="line">    <span class="comment"># print(user)</span></span><br><span class="line">    <span class="comment"># 将排序后的结果翻转</span></span><br><span class="line">    <span class="comment"># user = UserInfo.objects.order_by(&quot;age&quot;).reverse()</span></span><br><span class="line">    <span class="comment"># print(user)</span></span><br><span class="line">    <span class="comment"># 在Django的ORM语句中只要不是确切的某个对象 就可以一直 . 触发其他方法</span></span><br><span class="line">    <span class="comment"># user = UserInfo.objects.order_by(&quot;age&quot;).count()</span></span><br><span class="line">    <span class="comment"># print(user)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 【8】对某个条件以外的结果进行剔除</span></span><br><span class="line">    <span class="comment"># 不会提出到你指定的这个年龄的结果</span></span><br><span class="line">    <span class="comment"># user = UserInfo.objects.exclude(age=18)</span></span><br><span class="line">    <span class="comment"># print(user)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 【9】判断当前筛选到的结果是否存在</span></span><br><span class="line">    <span class="comment"># user = UserInfo.objects.filter(name=&quot;dream_1&quot;).exists()</span></span><br><span class="line">    <span class="comment"># print(user)</span></span><br><span class="line">``````</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python</span><br><span class="line"><span class="comment"># 【必知必会N条】</span></span><br><span class="line">	<span class="comment"># model是models.py文件中定义模型表的类名，需要提前导入</span></span><br><span class="line">    <span class="comment"># 【1】增加</span></span><br><span class="line">    <span class="comment"># （1）model.objects.create(filed=value)</span></span><br><span class="line">    <span class="comment"># （2）model(filed=value).save()</span></span><br><span class="line">    <span class="comment"># 【2】删除</span></span><br><span class="line">    <span class="comment"># （3）model.objects.filter(filed=value).delete()</span></span><br><span class="line">    <span class="comment"># （4）model.objects.get(filed=value).delete()</span></span><br><span class="line">    <span class="comment"># 【3】修改</span></span><br><span class="line">    <span class="comment"># （5）model.objects.filter(filed=value).update(filed=new_value)</span></span><br><span class="line">    <span class="comment"># （6）obj = model.objects.get(filed=value)</span></span><br><span class="line">    <span class="comment"># obj.filed_name = value </span></span><br><span class="line">    <span class="comment"># obj.save()</span></span><br><span class="line">    <span class="comment"># 【4】查看</span></span><br><span class="line">    <span class="comment"># (7) model.objects.filter(field=value)</span></span><br><span class="line">    <span class="comment"># (8) model.objects.filter(field=value).first()</span></span><br><span class="line">    <span class="comment"># (9) model.objects.filter(field=value).last()</span></span><br><span class="line">    <span class="comment"># (10) model.objects.all() </span></span><br><span class="line">    <span class="comment"># (11) model.objects.get(filed=value)</span></span><br><span class="line">    <span class="comment"># 【5】扩展方法</span></span><br><span class="line">    <span class="comment"># (12) model.objects.filter(field=value).count() 计数</span></span><br><span class="line">    <span class="comment"># (13) model.objects.filter(field=value).values() 获取键值对结果</span></span><br><span class="line">    <span class="comment"># (14) model.objects.filter(field=value).values_list() 获取值结果</span></span><br><span class="line">    <span class="comment"># (15) model.objects.values(&quot;field&quot;).distinct() 对结果进行去重</span></span><br><span class="line">    <span class="comment"># (16) model.objects.filter(field=value).order_by(&quot;-filed&quot;) 降序</span></span><br><span class="line">    <span class="comment"># (17) model.objects.filter(field=value).order_by(&quot;filed&quot;) 升序</span></span><br><span class="line">    <span class="comment"># (18) model.objects.filter(field=value).exists() 判断结果是否存在</span></span><br><span class="line">    <span class="comment"># (19) model.objects.exclude(filed=value) 排除指定条件的数据</span></span><br></pre></td></tr></table></figure>
<ul>
<li>数据库信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql</span><br><span class="line">4	jack	22	2024-06-25 13:02:38.766847	2024-06-25 13:02:38.766847</span><br><span class="line">5	jack	22	2024-06-25 13:02:43.551628	2024-06-25 13:02:43.551628</span><br><span class="line">6	tom	710	2024-06-25 13:03:09.526967	2024-06-25 13:03:09.526967</span><br><span class="line">7	tom	710	2024-06-25 13:03:11.030100	2024-06-25 13:03:11.030100</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240625213204352.png" alt="image-20240625213204352"></p>
<h2 id="【三】神奇的双下划线查询">【三】神奇的双下划线查询</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    # 在main入口下面复制manage.py文件中main入口下面的第一行代码每一个Django项目都要自己去找 自己去复制</span><br><span class="line">    os.environ.setdefault(&#x27;DJANGO_SETTINGS_MODULE&#x27;, &#x27;Django_two.settings&#x27;)</span><br><span class="line">    # 导入模块</span><br><span class="line">    import django</span><br><span class="line"></span><br><span class="line">    # 启动方式只是临时启动，不是持久化</span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    from user.models import UserInfo</span><br><span class="line"></span><br><span class="line">    # 神奇的双下划线</span><br><span class="line">    # 大于</span><br><span class="line">    # data = UserInfo.objects.filter(age__gt=22)</span><br><span class="line">    # # 两条数据符合</span><br><span class="line">    # print(data) # &lt;QuerySet [&lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 小于</span><br><span class="line">    # data = UserInfo.objects.filter(age__lt=22)</span><br><span class="line">    # # 没有符合条件的</span><br><span class="line">    # print(data) # &lt;QuerySet []&gt;</span><br><span class="line">    #</span><br><span class="line">    # # 大于等于</span><br><span class="line">    # data = UserInfo.objects.filter(age__gte=22)</span><br><span class="line">    # # 四条符合的数据</span><br><span class="line">    # print(data)</span><br><span class="line">    # &lt;QuerySet [&lt;UserInfo: UserInfo object (4)&gt;, &lt;UserInfo: UserInfo object (5)&gt;, &lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 小于等于</span><br><span class="line">    # data = UserInfo.objects.filter(age__lte=22)</span><br><span class="line">    # 两条条符合的数据</span><br><span class="line">    # print(data) # &lt;QuerySet [&lt;UserInfo: UserInfo object (4)&gt;, &lt;UserInfo: UserInfo object (5)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 或条件</span><br><span class="line">    # data = UserInfo.objects.filter(age__in=(18, 22))</span><br><span class="line">    # # 两条条符合的数据</span><br><span class="line">    # print(data) # &lt;QuerySet [&lt;UserInfo: UserInfo object (4)&gt;, &lt;UserInfo: UserInfo object (5)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 两个条件之间</span><br><span class="line">    # 也包含18，22</span><br><span class="line">    # data = UserInfo.objects.filter(age__range=(18, 22))</span><br><span class="line">    # #两条条符合的数据</span><br><span class="line">    # print(data)  # &lt;QuerySet [&lt;UserInfo: UserInfo object (4)&gt;, &lt;UserInfo: UserInfo object (5)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 模糊查询</span><br><span class="line">    # 查人名中带有 m 的人的名字</span><br><span class="line">    # 强约束 区分大小写</span><br><span class="line">    # data = UserInfo.objects.filter(name__contains=&quot;m&quot;)</span><br><span class="line">    # print(data)</span><br><span class="line">    # &lt;QuerySet [&lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 弱约束 不区分大小写</span><br><span class="line">    # data = UserInfo.objects.filter(name__icontains=&quot;M&quot;)</span><br><span class="line">    # print(data)</span><br><span class="line">    # &lt;QuerySet [&lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 以指定条件开头</span><br><span class="line">    # data = UserInfo.objects.filter(name__startswith=&quot;t&quot;)</span><br><span class="line">    # print(data)</span><br><span class="line">    # &lt;QuerySet [&lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 以指定条件结尾</span><br><span class="line">    # data = UserInfo.objects.filter(name__endswith=&quot;m&quot;)</span><br><span class="line">    # print(data)</span><br><span class="line">    # &lt;QuerySet [&lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 查询指定那一天</span><br><span class="line">    # data = UserInfo.objects.filter(register_time__day=&quot;20&quot;)</span><br><span class="line">    # print(data) # &lt;QuerySet []&gt;</span><br><span class="line"></span><br><span class="line">    #  查询指定那一年</span><br><span class="line">    # data = UserInfo.objects.filter(register_time__year=&quot;2024&quot;)</span><br><span class="line">    # print(data)</span><br><span class="line">    # &lt;QuerySet [&lt;UserInfo: UserInfo object (4)&gt;, &lt;UserInfo: UserInfo object (5)&gt;, &lt;UserInfo: UserInfo object (6)&gt;, &lt;UserInfo: UserInfo object (7)&gt;]&gt;</span><br><span class="line"></span><br><span class="line">    # 查询指定那一月</span><br><span class="line">    data = UserInfo.objects.filter(register_time__month=&quot;5&quot;)</span><br><span class="line">    print(data) # &lt;QuerySet []&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>数据库信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql</span><br><span class="line">4	jack	22	2024-06-25 13:02:38.766847	2024-06-25 13:02:38.766847</span><br><span class="line">5	jack	22	2024-06-25 13:02:43.551628	2024-06-25 13:02:43.551628</span><br><span class="line">6	tom	710	2024-06-25 13:03:09.526967	2024-06-25 13:03:09.526967</span><br><span class="line">7	tom	710	2024-06-25 13:03:11.030100	2024-06-25 13:03:11.030100</span><br></pre></td></tr></table></figure>
<p><img src="D:%5Cpycharm%5CTemporary_notes%5C%E5%9B%BE%E7%89%87%5Cimage-20240625213204352.png" alt="image-20240625213204352"></p>
<h2 id="【四】创建多表关系">【四】创建多表关系</h2>
<ul>
<li>既然是多表查询，那就是不止一个表</li>
<li>在models.py文件中创建多个表</li>
<li>我们学过的表查询有
<ul>
<li>一对一查询</li>
<li>一对多查询</li>
<li>多对多查询</li>
</ul>
</li>
</ul>
<h3 id="【1】一对多的表">【1】一对多的表</h3>
<ul>
<li>ForeignKey方法创建一对多关系</li>
</ul>
<p>创建图书表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python</span><br><span class="line"># 创建的是图书表</span><br><span class="line">class Book(models.Model):</span><br><span class="line">    # 标题</span><br><span class="line">    title = models.CharField(max_length=32)</span><br><span class="line">    # 价格</span><br><span class="line">    # max_digits：最多几位</span><br><span class="line">    # decimal_places：最多小数点后面几位</span><br><span class="line">    # DecimalField：小数类型</span><br><span class="line">    price = models.DecimalField(max_digits=8, decimal_places=2)</span><br><span class="line">    # 一对多关系，图书与出版社</span><br><span class="line">    publisher = models.ForeignKey(</span><br><span class="line">        # 目标建立关系的表</span><br><span class="line">        to=&quot;Publisher&quot;,</span><br><span class="line">        # 级联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>创建出版社表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python</span><br><span class="line"># 创建出版社表</span><br><span class="line">class Publisher(models.Model):</span><br><span class="line">    # 名字</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    # 地址</span><br><span class="line">    addr = models.CharField(max_length=32)</span><br></pre></td></tr></table></figure>
<h3 id="【2】一对一的表">【2】一对一的表</h3>
<ul>
<li>OneToOneField方法创建一对一关系</li>
</ul>
<p>创建作者表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python</span><br><span class="line"># # 创建作者表</span><br><span class="line">class Author(models.Model):</span><br><span class="line">    # 名字</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    # 年龄</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line">    # 作者和作者详情表进行关联，一对一关系，一个作者只能有一个详情</span><br><span class="line">    # 一个详情对应一个作者</span><br><span class="line">    author_detail = models.OneToOneField(</span><br><span class="line">        # 目标建立关系的表,作者详情表</span><br><span class="line">        to=&quot;AuthorDetail&quot;,</span><br><span class="line">        # 联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>创建作者详情表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python</span><br><span class="line"># 创建作者详情表</span><br><span class="line">class AuthorDetail(models.Model):</span><br><span class="line">    # 地址</span><br><span class="line">    addr = models.CharField(max_length=32)</span><br><span class="line">    # 电话</span><br><span class="line">    phone = models.CharField(max_length=11)</span><br></pre></td></tr></table></figure>
<h3 id="【3】多对多的表">【3】多对多的表</h3>
<ul>
<li>
<p>ManyToManyField方法创建多对多关系</p>
</li>
<li>
<p>需要第三张表存放两个表的关系</p>
</li>
</ul>
<p>创建图书表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python</span><br><span class="line"># 创建的是图书表</span><br><span class="line">class Book(models.Model):</span><br><span class="line">    # 标题</span><br><span class="line">    title = models.CharField(max_length=32)</span><br><span class="line">    # 价格</span><br><span class="line">    # max_digits：最多几位</span><br><span class="line">    # decimal_places：最多小数点后面几位</span><br><span class="line">    # DecimalField：小数类型</span><br><span class="line">    price = models.DecimalField(max_digits=8, decimal_places=2)</span><br><span class="line"></span><br><span class="line">    # 一对多关系，图书与出版社</span><br><span class="line">    publisher = models.ForeignKey(</span><br><span class="line">        # 目标建立关系的表</span><br><span class="line">        to=&quot;Publisher&quot;,</span><br><span class="line">        # 级联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    # 多对多的关系</span><br><span class="line">    auther = models.ManyToManyField(</span><br><span class="line">        # 目标建立关系的表</span><br><span class="line">        to=&quot;Author&quot;,</span><br><span class="line">        # 级联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete = models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>创建作者表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python</span><br><span class="line"># 创建作者表</span><br><span class="line">class Author(models.Model):</span><br><span class="line">    # 名字</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    # 年龄</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line">    # 作者和作者详情表进行关联，一对一关系，一个作者只能有一个详情</span><br><span class="line">    # 一个详情对应一个作者</span><br><span class="line">    author_detail = models.OneToOneField(</span><br><span class="line">        # 目标建立关系的表,作者详情表</span><br><span class="line">        to=&quot;AuthorDetail&quot;,</span><br><span class="line">        # 联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line">    # 与作者建立的第三张表</span><br><span class="line">    book = models.ManyToManyField(</span><br><span class="line">        # 跟那张表进行关联</span><br><span class="line">        to=&quot;Book&quot;,</span><br><span class="line">        # 联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>创建图书和作者表关系表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python</span><br><span class="line"># 作者和书的关系表</span><br><span class="line">class BookToAuthor(models.Model):</span><br><span class="line">    # 字段关联作者表</span><br><span class="line">    author = models.ForeignKey(</span><br><span class="line">        # 关联作者的表</span><br><span class="line">        to=&quot;Author&quot;,</span><br><span class="line">        # 级联更新和级联删除</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line">    # 字段关联图书的表</span><br><span class="line">    book = models.ForeignKey(</span><br><span class="line">        # 关联图书的表</span><br><span class="line">        to=&quot;Book&quot;,</span><br><span class="line">        # 目标建立关系的表</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="【4】多对多的表方法二">【4】多对多的表方法二</h3>
<ul>
<li>直接在这两张表的其中一张上建立第三张表</li>
</ul>
<p>比如我们在Book上建立</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python</span><br><span class="line">class Book(models.Model):</span><br><span class="line">    # 标题</span><br><span class="line">    title = models.CharField(max_length=32)</span><br><span class="line">    # 价格</span><br><span class="line">    # max_digits：最多几位</span><br><span class="line">    # decimal_places：最多小数点后面几位</span><br><span class="line">    # DecimalField：小数类型</span><br><span class="line">    price = models.DecimalField(max_digits=8, decimal_places=2)</span><br><span class="line">    # 一对多关系，图书与出版社</span><br><span class="line">    publisher = models.ForeignKey(</span><br><span class="line">        # 目标建立关系的表</span><br><span class="line">        to=&quot;Publisher&quot;,</span><br><span class="line">        # 级联更新和级联删除，和并在一起了</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    # 多对多的关系</span><br><span class="line">    auther = models.ManyToManyField(</span><br><span class="line">        to=&quot;Author&quot;</span><br><span class="line">    )</span><br><span class="line">``````python</span><br><span class="line">  # 多对多的关系</span><br><span class="line">    auther = models.ManyToManyField(</span><br><span class="line">        to=&quot;Author&quot;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<ul>
<li>Django会自动创建第三张表</li>
</ul>
<h3 id="【5】总的创建表代码">【5】总的创建表代码</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建出版社表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Publisher</span>(models.Model):</span><br><span class="line">    <span class="comment"># 名字</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="comment"># 地址</span></span><br><span class="line">    addr = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建的是图书表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    <span class="comment"># 标题</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="comment"># 价格</span></span><br><span class="line">    <span class="comment"># max_digits：最多几位</span></span><br><span class="line">    <span class="comment"># decimal_places：最多小数点后面几位</span></span><br><span class="line">    <span class="comment"># DecimalField：小数类型</span></span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">8</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># 一对多关系，图书与出版社</span></span><br><span class="line">    publisher = models.ForeignKey(</span><br><span class="line">        <span class="comment"># 目标建立关系的表</span></span><br><span class="line">        to=<span class="string">&quot;Publisher&quot;</span>,</span><br><span class="line">        <span class="comment"># 级联更新和级联删除，和并在一起了</span></span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 多对多的关系</span></span><br><span class="line">    auther = models.ManyToManyField(</span><br><span class="line">        to=<span class="string">&quot;Author&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建作者详情表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AuthorDetail</span>(models.Model):</span><br><span class="line">    <span class="comment"># 地址</span></span><br><span class="line">    addr = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="comment"># 电话</span></span><br><span class="line">    phone = models.CharField(max_length=<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># # 创建作者表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Author</span>(models.Model):</span><br><span class="line">    <span class="comment"># 名字</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="comment"># 年龄</span></span><br><span class="line">    age = models.IntegerField()</span><br><span class="line">    <span class="comment"># 作者和作者详情表进行关联，一对一关系，一个作者只能有一个详情</span></span><br><span class="line">    <span class="comment"># 一个详情对应一个作者</span></span><br><span class="line">    author_detail = models.OneToOneField(</span><br><span class="line">        <span class="comment"># 目标建立关系的表,作者详情表</span></span><br><span class="line">        to=<span class="string">&quot;AuthorDetail&quot;</span>,</span><br><span class="line">        <span class="comment"># 联更新和级联删除，和并在一起了</span></span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记得迁移数据库</span></span><br></pre></td></tr></table></figure>
<h2 id="【五】一对多的外键字段">【五】一对多的外键字段</h2>
<h3 id="【1】添加值">【1】添加值</h3>
<ul>
<li>create</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 【一】一对多表外键字段</span></span><br><span class="line">   <span class="comment"># 【1】添加数据  create</span></span><br><span class="line">   <span class="comment">#  Publish.objects.create(name=&quot;人民出版社&quot;, addr=&quot;北京&quot;)</span></span><br><span class="line">   <span class="comment"># Publish.objects.create(name=&quot;上海出版社&quot;, addr=&quot;上海&quot;)</span></span><br><span class="line">   <span class="comment"># Publish.objects.create(name=&quot;南京出版社&quot;, addr=&quot;南京&quot;)</span></span><br><span class="line">   <span class="comment"># Publish.objects.create(name=&quot;东京出版社&quot;, addr=&quot;东京&quot;)</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 在创建图书数据的时候要进行出版社的关联</span></span><br><span class="line">   <span class="comment"># publish_obj = Publish.objects.get(pk=2)</span></span><br><span class="line">   <span class="comment"># 方式一 ： 直接在 字段 publish_id 值是指定出版社的id</span></span><br><span class="line">   <span class="comment"># Book.objects.create(title=&quot;西游记&quot;, price=&quot;99&quot;,publish_id=publish_obj.id)</span></span><br><span class="line">   <span class="comment"># 方式二 ： 在模型表中定义的字段是叫 publish 所以 直接将对象扔进去</span></span><br><span class="line">   <span class="comment"># Book.objects.create(title=&quot;红楼梦&quot;, price=&quot;88&quot;, publish=publish_obj)</span></span><br></pre></td></tr></table></figure>
<h3 id="【2】删除数据">【2】删除数据</h3>
<ul>
<li>delete</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 【2】删除数据--删除外键关系  delete</span></span><br><span class="line">    <span class="comment"># book中的publisher字段</span></span><br><span class="line">    <span class="comment"># 因为你在创建的时候已经添加了级联更新和级联删除所以你删除信息和修改信息都会发生变化</span></span><br><span class="line">    <span class="comment"># Book.objects.get(pk=&quot;1&quot;).delete()# 删除了book id为1的数据</span></span><br><span class="line">    <span class="comment"># Publisher.objects.get(pk=&quot;1&quot;).delete()# 删除了出版社的id，对应的图书也一并被删掉了</span></span><br><span class="line">    <span class="comment"># 删除外键数据 出版社表中的数据 在图书表中 预支相关联的数据也会被删除</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="【3】修改外键字段">【3】修改外键字段</h3>
<ul>
<li>update</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 【3】修改外键字段 update</span></span><br><span class="line">   <span class="comment"># 我们将红楼梦从1出版社转到3出版社该怎么做</span></span><br><span class="line">   <span class="comment"># 方法一</span></span><br><span class="line">   <span class="comment"># 我们先获得出版社的一个id</span></span><br><span class="line">   <span class="comment"># publisher_obj = Publisher.objects.get(pk=&quot;4&quot;)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Book.objects.filter(title=&quot;红楼梦&quot;).update(publisher=publisher_obj)</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 方法二</span></span><br><span class="line">   <span class="comment"># 直接替换,指定书的id，替换指定印刷厂的id</span></span><br><span class="line">   <span class="comment"># id不存在就会报错</span></span><br><span class="line">   <span class="comment"># books = Book.objects.filter(pk=6).update(publisher_id=6)</span></span><br><span class="line"><span class="comment"># 也可以放对象</span></span><br></pre></td></tr></table></figure>
<h2 id="【六】多对多的外键字段">【六】多对多的外键字段</h2>
<h3 id="【1】添加数据">【1】添加数据</h3>
<ul>
<li>一定要保证两个表里面有值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 图书和作者表</span></span><br><span class="line">    <span class="comment"># for i in range(1, 6):</span></span><br><span class="line">    <span class="comment">#     detail_obj = AuthorDetail.objects.create(addr=f&quot;上海_&#123;i&#125;&quot;, phone=f&quot;1&#123;i&#125;0&quot;)</span></span><br><span class="line">    <span class="comment">#     # print(detail_obj) # AuthorDetail object (1)</span></span><br><span class="line">    <span class="comment">#     Author.objects.create(name=f&quot;dream_&#123;i&#125;&quot;, age=18 * i, author_detail=detail_obj)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># for i in range(1, 6):</span></span><br><span class="line">    <span class="comment">#     Book.objects.create(</span></span><br><span class="line">    <span class="comment">#         title=f&quot;第 &#123;i&#125; 本书&quot;,</span></span><br><span class="line">    <span class="comment">#         price=str(60 * i),</span></span><br><span class="line">    <span class="comment">#         publish_id=random.randint(2, 6)</span></span><br><span class="line">    <span class="comment">#     )</span></span><br></pre></td></tr></table></figure>
<ul>
<li>要使用Django自带的机制自动生成的第三张表，models不会有第三张表</li>
<li>需要跨表建立关系</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获得书籍对象</span></span><br><span class="line">    data = book_obj = Book.objects.get(pk=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获得作者对象</span></span><br><span class="line">    data = auther_obj = Author.objects.get(pk=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">     <span class="comment"># 【1】添加多对多外键关系---关键字add</span></span><br><span class="line">    <span class="comment"># 方式一</span></span><br><span class="line">    <span class="comment"># 给book_obj书籍添加一个作者</span></span><br><span class="line">    <span class="comment"># 获得书籍对象，在获得作者对象，书籍对象在跨到作者身上</span></span><br><span class="line">    <span class="comment"># 你的第三章表建立建立谁的身上了就得到谁的对象然后在把和你建立多对多关系的表添加进去</span></span><br><span class="line">    <span class="comment"># data = book_obj.auther.add(auther_obj)</span></span><br><span class="line">    <span class="comment"># print(data)</span></span><br><span class="line">    <span class="comment"># 方式二 直接放作者的id号</span></span><br><span class="line">    <span class="comment"># book_obj.auther.add(1, 3,6,4,5)</span></span><br></pre></td></tr></table></figure>
<h3 id="【2】删除数据-2">【2】删除数据</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获得书籍对象</span></span><br><span class="line">    data = book_obj = Book.objects.get(pk=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获得作者对象</span></span><br><span class="line">    data = auther_obj = Author.objects.get(pk=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 【2】删除多对多外键关系 remove</span></span><br><span class="line">    <span class="comment"># book_obj.auther.remove(auther_obj)</span></span><br><span class="line">    <span class="comment"># 删除多个，直接给作者的id</span></span><br><span class="line">    <span class="comment"># book_obj.auther.remove(3, 1)</span></span><br></pre></td></tr></table></figure>
<h3 id="【3】修改外键关系">【3】修改外键关系</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获得书籍对象</span></span><br><span class="line">   data = book_obj = Book.objects.get(pk=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">   <span class="comment"># 获得作者对象</span></span><br><span class="line">   data = auther_obj = Author.objects.get(pk=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">   <span class="comment"># 【3】修改外键关系---》set</span></span><br><span class="line">   <span class="comment"># 方式一 用set方法，弊端就是会清空其他的外键关系</span></span><br><span class="line">   <span class="comment"># set关键字是一个列表</span></span><br><span class="line">   <span class="comment"># 修改了数据，保留了book_obj是16对应的3，其他的book_obj对应的书籍被清空，</span></span><br><span class="line">   <span class="comment"># book_obj.auther.set([3])</span></span><br><span class="line">   <span class="comment"># 方式二 先用 remove 移除外键关系 再用 add 添加外键关系</span></span><br><span class="line">   <span class="comment"># book_obj.auther.remove(auther_obj)</span></span><br><span class="line">   <span class="comment"># book_obj.auther.add(auther_obj)</span></span><br></pre></td></tr></table></figure>
<h1>多表查询（正反向查询）</h1>
<h2 id="【一】什么是正反向查询">【一】什么是正反向查询</h2>
<h3 id="【1】正向查询">【1】正向查询</h3>
<ul>
<li>外键字段在自己身上就叫正向查询
<ul>
<li>有外键关系的两张表 从有外检字段的表向另一张无外键字段的表查询数据的时候就是正向</li>
</ul>
</li>
<li>正向查询的时候，直接按照字段查询</li>
</ul>
<h3 id="【2】反向查询">【2】反向查询</h3>
<ul>
<li>外键字段不在自己身上，我查你就叫反向查询
<ul>
<li>有外键关系的两张表 从无外键字段的表向另一张有外键字段表查询数据的时候就是反向</li>
</ul>
</li>
<li>反向查询的时候，要使用关键字_set</li>
</ul>
<h2 id="【二】多表查询案例">【二】多表查询案例</h2>
<h3 id="【1】子查询（基于对象的跨表查询）">【1】子查询（基于对象的跨表查询）</h3>
<h4 id="（1）查询书籍主键为14的出版社">（1）查询书籍主键为14的出版社</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询书籍主键为1的出版社</span></span><br><span class="line">   <span class="comment">#得到图书对象</span></span><br><span class="line">   book_obj = Book.objects.get(pk=<span class="number">14</span>)</span><br><span class="line">   <span class="comment">#图书与出版社是一对多关系</span></span><br><span class="line">   <span class="built_in">print</span>(book_obj)  <span class="comment"># Book object (14)</span></span><br><span class="line">   <span class="comment">#不要带_id</span></span><br><span class="line">   publisher_id = book_obj.publisher_id</span><br><span class="line">   <span class="built_in">print</span>(publisher_id)  <span class="comment"># 6</span></span><br><span class="line">   <span class="comment">#得到出版社对象</span></span><br><span class="line">   publisher_obj = book_obj.publisher</span><br><span class="line">   <span class="built_in">print</span>(publisher_obj)  <span class="comment"># Publisher object (6)</span></span><br><span class="line">   <span class="comment">#对象.name得到出版社</span></span><br><span class="line">   publisher_name = book_obj.publisher.name</span><br><span class="line">   <span class="built_in">print</span>(publisher_name)  <span class="comment"># 4出版社</span></span><br></pre></td></tr></table></figure>
<h4 id="（2）查询数据主键为1的作者">（2）查询数据主键为1的作者</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询书籍主键为1的作者</span></span><br><span class="line">  <span class="comment"># 书籍与作者是多对多关系</span></span><br><span class="line">  <span class="comment"># 得到主键id为1的对象</span></span><br><span class="line">  book_obj = Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">  <span class="built_in">print</span>(book_obj) <span class="comment"># Book object (1)</span></span><br><span class="line">  res = book_obj.auther</span><br><span class="line">  <span class="built_in">print</span>(res)  <span class="comment"># user.Author.None</span></span><br><span class="line">  auther_obj = book_obj.auther.<span class="built_in">all</span>()</span><br><span class="line">  <span class="built_in">print</span>(auther_obj)  <span class="comment"># &lt;QuerySet [&lt;Author: Author object (2)&gt;]&gt;</span></span><br><span class="line">  author_obj = book_obj.auther.<span class="built_in">all</span>().values(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">  <span class="built_in">print</span>(author_obj)  <span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;tom2&#x27;&#125;]&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-查询作者主键为3的电话号码">(3)查询作者主键为3的电话号码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询作者主键为3的电话号码</span></span><br><span class="line">   <span class="comment"># 得到作者对象</span></span><br><span class="line">   <span class="comment"># 作者与作者详情是一对一关系</span></span><br><span class="line">   author_obj = Author.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">   <span class="built_in">print</span>(author_obj)  <span class="comment"># Author object (3)</span></span><br><span class="line">   <span class="comment"># 得到作者详情对象</span></span><br><span class="line">   author_detail_obj = author_obj.author_detail</span><br><span class="line">   <span class="built_in">print</span>(author_detail_obj)  <span class="comment"># AuthorDetail object (3)</span></span><br><span class="line">   <span class="comment"># 对象.字段</span></span><br><span class="line">   phone = author_detail_obj.phone</span><br><span class="line">   <span class="built_in">print</span>(phone)  <span class="comment"># 130</span></span><br></pre></td></tr></table></figure>
<h4 id="4-查询出版社是-1出版社-的书">(4)查询出版社是  1出版社  的书</h4>
<ul>
<li>在下面<code>res</code>只是一个待执行的查询的“准备”状态</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询出版社是  1出版社  的书</span></span><br><span class="line">   <span class="comment"># 出版社与书是多对一关系</span></span><br><span class="line">   <span class="comment"># 没有外键关系的表要向有外键关系的表查，就是反向查询加_set</span></span><br><span class="line">   <span class="comment"># 得到出版社对象</span></span><br><span class="line">   publisher_obj = Publisher.objects.<span class="built_in">filter</span>(name=<span class="string">&quot;1出版社&quot;</span>).first()</span><br><span class="line">   <span class="built_in">print</span>(publisher_obj)  <span class="comment"># Publisher object (2)</span></span><br><span class="line">   <span class="comment"># 反向查询加_set</span></span><br><span class="line">   <span class="comment"># 只是一个执行状态的准备，并没有进行查询</span></span><br><span class="line">   res = publisher_obj.book_set</span><br><span class="line">   <span class="built_in">print</span>(res)  <span class="comment"># user.Book.None</span></span><br><span class="line">   <span class="comment"># 得到图书对象</span></span><br><span class="line">   book_obj = publisher_obj.book_set.<span class="built_in">all</span>()</span><br><span class="line">   <span class="built_in">print</span>(book_obj)  <span class="comment"># &lt;QuerySet [&lt;Book: Book object (1)&gt;]&gt;</span></span><br><span class="line">   <span class="comment"># values得到想要的数据</span></span><br><span class="line">   publisher_name = publisher_obj.book_set.<span class="built_in">all</span>().values(<span class="string">&quot;title&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(publisher_name)  <span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;第1本书&#x27;&#125;]&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="（5）查询作者是tom1写过的书">（5）查询作者是tom1写过的书</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询作者是tom1写过的书</span></span><br><span class="line">   <span class="comment"># 作者和图书是多对多关系</span></span><br><span class="line">   <span class="comment"># 得到作者的对象</span></span><br><span class="line">   author_obj = Author.objects.<span class="built_in">filter</span>(name=<span class="string">&quot;tom1&quot;</span>).first()</span><br><span class="line">   <span class="built_in">print</span>(author_obj)  <span class="comment"># Author object (1)</span></span><br><span class="line">   <span class="comment"># 得到图书对象</span></span><br><span class="line">   book_obj = author_obj.book_set</span><br><span class="line">   <span class="built_in">print</span>(book_obj)  <span class="comment"># user.Book.None</span></span><br><span class="line">   <span class="comment"># 得到图书的名字</span></span><br><span class="line">   book_name = author_obj.book_set.<span class="built_in">all</span>().values(<span class="string">&quot;title&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(book_name)  <span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;第3本书&#x27;&#125;]&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="6-查询手机号是110的作者姓名">(6)查询手机号是110的作者姓名</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询手机号是110的作者姓名</span></span><br><span class="line">    <span class="comment"># 作者和作者详情是一对一关系</span></span><br><span class="line">    <span class="comment"># 得到作者详情对象</span></span><br><span class="line">    author_detail_obj = AuthorDetail.objects.<span class="built_in">filter</span>(phone=<span class="number">110</span>).first()</span><br><span class="line">    <span class="built_in">print</span>(author_detail_obj)</span><br><span class="line">    <span class="comment"># 主键在作者身上，反向查询，但是是一对一关系，不需要加_set</span></span><br><span class="line">    author_obj = author_detail_obj.author</span><br><span class="line">    <span class="built_in">print</span>(author_obj)  <span class="comment"># Author object (1)</span></span><br><span class="line">    <span class="comment"># 得到作者的名字</span></span><br><span class="line">    author_name = author_obj.name</span><br><span class="line">    <span class="built_in">print</span>(author_name)  <span class="comment"># tom1</span></span><br></pre></td></tr></table></figure>
<h4 id="7-小结">(7)小结</h4>
<ul>
<li>基于对象的反向查询</li>
<li>什么时候需要加_set.all()
<ul>
<li>查询结果是多个的时候需要加</li>
</ul>
</li>
<li>一对一表关系不区分正反向 因为关系唯一</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 正向查询：有外键字段向没有外键字段的表查 查询方式是 .字段名</span></span><br><span class="line"><span class="comment"># 反向查询：没有外键字段向有外键字段的表查 查询方式时 .有外键字段的表明_set</span></span><br></pre></td></tr></table></figure>
<h3 id="【2】联表查询">【2】联表查询</h3>
<ul>
<li>基于双下划线的跨表查询</li>
<li>联表查询就是将两张表合并在一起查询数据</li>
</ul>
<h4 id="（1）查询tom1的手机号和作者的名字">（1）查询tom1的手机号和作者的名字</h4>
<ul>
<li>
<p>正向查询</p>
</li>
<li>
<p>使用双下划线（查询信息的表明__字段）</p>
</li>
<li>
<p>查询到作者信息在.value.(需要查询信息的表__需要查询的字段,其他字段)</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询tom1的手机号和作者的名字</span></span><br><span class="line">   <span class="comment"># 正向查询</span></span><br><span class="line">   <span class="comment"># 作者和作者详情是一对一关系</span></span><br><span class="line">   name_phone = Author.objects.<span class="built_in">filter</span>(name=<span class="string">&quot;tom1&quot;</span>).values(</span><br><span class="line">       <span class="string">&quot;name&quot;</span>,</span><br><span class="line">       <span class="string">&quot;author_detail__phone&quot;</span></span><br><span class="line">   )</span><br><span class="line">   <span class="built_in">print</span>(name_phone)</span><br><span class="line">   <span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;tom1&#x27;, &#x27;author_detail__phone&#x27;: &#x27;110&#x27;&#125;]&gt;</span></span><br><span class="line">   <span class="comment"># first：取到单个数据</span></span><br><span class="line">   author_dict = name_phone.first()</span><br><span class="line">   <span class="built_in">print</span>(author_dict)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;tom1&#x27;, &#x27;author_detail__phone&#x27;: &#x27;110&#x27;&#125;</span></span><br><span class="line">   <span class="comment"># 取到名字</span></span><br><span class="line">   name = name_phone.first().get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(name)  <span class="comment"># tom1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>反向查询</li>
<li>先拿到详情，再用作者详情关联作者表，通过 __字段的方法 过滤出我们想要的指定数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询tom1的手机号和作者的名字</span></span><br><span class="line">    <span class="comment"># 反向查询</span></span><br><span class="line">    phone_name = AuthorDetail.objects.<span class="built_in">filter</span>(author__name=<span class="string">&quot;tom1&quot;</span>).values(</span><br><span class="line">        <span class="string">&quot;phone&quot;</span>,</span><br><span class="line">        <span class="string">&quot;author__name&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(phone_name)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;phone&#x27;: &#x27;110&#x27;, &#x27;author__name&#x27;: &#x27;tom1&#x27;&#125;]&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="（2）查询书籍主键为1的出版社的名字和书的名字">（2）查询书籍主键为1的出版社的名字和书的名字</h4>
<ul>
<li>正向查询</li>
<li>先过滤出书籍ID为1的书籍对象，再去关联出版者表，利用__字段取值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询书籍主键为1的出版社的名字和书的名字</span></span><br><span class="line">    <span class="comment"># 正向查询</span></span><br><span class="line">    data = Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).values(</span><br><span class="line">        <span class="string">&quot;title&quot;</span>,</span><br><span class="line">        <span class="string">&quot;publisher__name&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;第1本书&#x27;, &#x27;publisher__name&#x27;: &#x27;1出版社&#x27;&#125;]&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>反向查询</li>
<li>先查询到指定出版社，再从出版社反向找到书籍名字</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询书籍主键为1的出版社的名字和书的名字</span></span><br><span class="line">    <span class="comment"># 反向查询</span></span><br><span class="line">    data = Publisher.objects.<span class="built_in">filter</span>(book__id=<span class="number">1</span>).values(</span><br><span class="line">        <span class="string">&quot;name&quot;</span>,</span><br><span class="line">        <span class="string">&quot;book__title&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;1出版社&#x27;, &#x27;book__title&#x27;: &#x27;第1本书&#x27;&#125;]&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-查询书籍主键为1的作者的名字">(3)查询书籍主键为1的作者的名字</h4>
<ul>
<li>正向</li>
<li>先拿到 书籍主键ID为1的对象，再关联作者信息表，通过__字段取值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询书籍主键为1的作者的名字</span></span><br><span class="line">    data = Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).values(</span><br><span class="line">        <span class="string">&quot;auther__name&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(data)  <span class="comment"># &lt;QuerySet [&#123;&#x27;auther__name&#x27;: &#x27;tom2&#x27;&#125;]&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>反向</li>
<li>先拿到 书籍ID为1的作者数据再去取作者的名字</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询书籍主键为1的作者的名字</span></span><br><span class="line">    data = Author.objects.<span class="built_in">filter</span>(book__id=<span class="number">1</span>).values(</span><br><span class="line">        <span class="string">&quot;name&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(data)  <span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;tom2&#x27;&#125;]&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-查询书籍主键为1的作者的手机号">(4)查询书籍主键为1的作者的手机号</h4>
<ul>
<li>跨越了三个表</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询书籍主键为1的作者的手机号</span></span><br><span class="line">    data = Author.objects.<span class="built_in">filter</span>(book__id=<span class="number">1</span>).values(</span><br><span class="line">        <span class="string">&quot;author_detail__phone&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(data)  <span class="comment"># &lt;QuerySet [&#123;&#x27;author_detail__phone&#x27;: &#x27;120&#x27;&#125;]&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="（5）小结">（5）小结</h4>
<ul>
<li>掌握了双下划线和正反向可以无限跨表</li>
</ul>
<h2 id="【三】聚合函数（aggregate）">【三】聚合函数（aggregate）</h2>
<ul>
<li>
<p>正常情况下我们需要进行分组才能进行聚合函数的运算</p>
</li>
<li>
<p>使用聚合函数时：利用关键字aggregate可以不分组进行某个字段的聚合函数</p>
</li>
</ul>
<h3 id="【1】引入聚合函数">【1】引入聚合函数</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Max, Min, Sum, Count, Avg</span><br></pre></td></tr></table></figure>
<h3 id="【2】聚合函数案例">【2】聚合函数案例</h3>
<ul>
<li>第一步需要先导入聚合函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Max, Min, Sum, Count, Avg</span><br></pre></td></tr></table></figure>
<h4 id="1-求所有书的平均价格">(1)求所有书的平均价格</h4>
<ul>
<li>利用聚合函数不用分组就可以的到的结果的方法：aggregate</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 求所有书的平均数</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Sum, Avg</span><br><span class="line">    book_avg_price = Book.objects.aggregate(Avg(<span class="string">&quot;price&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(book_avg_price)</span><br><span class="line">    <span class="comment"># &#123;&#x27;price__avg&#x27;: Decimal(&#x27;60.000000&#x27;)&#125;</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Sum, Avg</span><br><span class="line">    book_avg_price = Book.objects.aggregate(Avg(<span class="string">&quot;price&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(book_avg_price)</span><br><span class="line">    <span class="comment"># &#123;&#x27;price__avg&#x27;: Decimal(&#x27;60.000000&#x27;)&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-一次性用很多方法">(2)一次性用很多方法</h4>
<ul>
<li>利用聚合函数不用分组就可以的到的结果的方法：aggregate</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Sum, Avg, Max, Min, Count</span><br><span class="line"></span><br><span class="line">    book_avg_price = Book.objects.aggregate(Avg(<span class="string">&quot;price&quot;</span>), Max(<span class="string">&quot;price&quot;</span>), Min(<span class="string">&quot;price&quot;</span>), Sum(<span class="string">&quot;price&quot;</span>), Count(<span class="string">&quot;price&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(book_avg_price)</span><br><span class="line">    <span class="comment"># &#123;&#x27;price__avg&#x27;: Decimal(&#x27;60.000000&#x27;), &#x27;price__max&#x27;: Decimal(&#x27;100.00&#x27;), &#x27;price__min&#x27;: Decimal(&#x27;20.00&#x27;), &#x27;price__sum&#x27;: Decimal(&#x27;300.00&#x27;), &#x27;price__count&#x27;: 5&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="【四】分组查询（关键字：annotate）">【四】分组查询（关键字：annotate）</h2>
<h3 id="【1】引入">【1】引入</h3>
<ul>
<li>按照指定条件对数据进行分组</li>
</ul>
<h3 id="【2】分组查询语法">【2】分组查询语法</h3>
<ul>
<li>models 后面跟的是什么，就是按什么分组</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.annotate()</span><br></pre></td></tr></table></figure>
<h3 id="【3】案例">【3】案例</h3>
<h4 id="（1）统计每一本书的作者个数">（1）统计每一本书的作者个数</h4>
<ul>
<li>Book分组，然后计算作者的个数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count, Avg, Max, Min, Sum</span><br><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span> Book</span><br><span class="line">   <span class="comment"># 统计每一本书的作者个数</span></span><br><span class="line">   <span class="comment"># 一定要看你的字段名写错了没，错了就会找不到数据</span></span><br><span class="line">   <span class="comment"># 获得分组后的对象</span></span><br><span class="line">   data = Book.objects.annotate(author_number=Count(<span class="string">&quot;auther&quot;</span>))</span><br><span class="line">   <span class="built_in">print</span>(data)  <span class="comment"># &lt;QuerySet [&lt;Book: Book object (1)&gt;, &lt;Book: Book object (2)&gt;, &lt;Book: Book object (15)&gt;, &lt;Book: Book object (16)&gt;, &lt;Book: Book object (17)&gt;]&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 获得分组后的数据</span></span><br><span class="line">   data = Book.objects.annotate(author_number=Count(<span class="string">&quot;auther&quot;</span>)).values(</span><br><span class="line">       <span class="string">&quot;title&quot;</span>,</span><br><span class="line">       <span class="string">&quot;author_number&quot;</span></span><br><span class="line">   )</span><br><span class="line">   <span class="built_in">print</span>(data)</span><br><span class="line">   <span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;第1本书&#x27;, &#x27;author_number&#x27;: 1&#125;, &#123;&#x27;title&#x27;: &#x27;第2本书&#x27;, &#x27;author_number&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;第3本书&#x27;, &#x27;author_number&#x27;: 4&#125;, &#123;&#x27;title&#x27;: &#x27;第4本书&#x27;, &#x27;author_number&#x27;: 1&#125;, &#123;&#x27;title&#x27;: &#x27;第5本书&#x27;, &#x27;author_number&#x27;: 0&#125;]&gt;</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 等价于</span></span><br><span class="line">    data = Book.objects.annotate(author_number=Count(<span class="string">&quot;auther__pk&quot;</span>)).values(</span><br><span class="line">       <span class="string">&quot;title&quot;</span>,</span><br><span class="line">       <span class="string">&quot;author_number&quot;</span></span><br><span class="line">   )</span><br><span class="line">   <span class="built_in">print</span>(data)</span><br><span class="line">   <span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;第1本书&#x27;, &#x27;author_number&#x27;: 1&#125;, &#123;&#x27;title&#x27;: &#x27;第2本书&#x27;, &#x27;author_number&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;第3本书&#x27;, &#x27;author_number&#x27;: 4&#125;, &#123;&#x27;title&#x27;: &#x27;第4本书&#x27;, &#x27;author_number&#x27;: 1&#125;, &#123;&#x27;title&#x27;: &#x27;第5本书&#x27;, &#x27;author_number&#x27;: 0&#125;]&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="（2）统计每个出版社最便宜的书的价格">（2）统计每个出版社最便宜的书的价格</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count, Avg, Max, Min, Sum</span><br><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span>  Publisher</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计每个出版社最便宜的书的价格</span></span><br><span class="line">data = Publisher.objects.annotate(min_book_price=Min(<span class="string">&#x27;book__price&#x27;</span>)).values(</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;min_book_price&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;1出版社&#x27;, &#x27;min_book_price&#x27;: Decimal(&#x27;20.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;4出版社&#x27;, &#x27;min_book_price&#x27;: Decimal(&#x27;40.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;2出版社&#x27;, &#x27;min_book_price&#x27;: Decimal(&#x27;80.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;3出版社&#x27;, &#x27;min_book_price&#x27;: Decimal(&#x27;100.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;5出版社&#x27;, &#x27;min_book_price&#x27;: None&#125;]&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="（3）统计不止一个作者的图书">（3）统计不止一个作者的图书</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count, Avg, Max, Min, Sum</span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> Book</span><br><span class="line">    <span class="comment"># 统计不止一个作者的图书</span></span><br><span class="line">    <span class="comment"># 先按图书分组</span></span><br><span class="line">    <span class="comment"># 再筛选不止一个作者的图书</span></span><br><span class="line">    data = Book.objects.annotate(one_author=Count(<span class="string">&quot;auther&quot;</span>)).<span class="built_in">filter</span>(one_author__gt=<span class="number">1</span>).values(</span><br><span class="line">        <span class="string">&quot;title&quot;</span>,</span><br><span class="line">        <span class="string">&quot;one_author&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(data)  <span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;第3本书&#x27;, &#x27;one_author&#x27;: 4&#125;]&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-查询每个作者出的书总价格">(4)查询每个作者出的书总价格</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count, Avg, Max, Min, Sum</span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> Author</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询每个作者出的书总价格</span></span><br><span class="line">    data = Author.objects.annotate(sum_book_price=Sum(<span class="string">&quot;book__price&quot;</span>)).values(</span><br><span class="line">        <span class="string">&quot;name&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sum_book_price&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;tom2&#x27;, &#x27;sum_book_price&#x27;: Decimal(&#x27;80.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;tom1&#x27;, &#x27;sum_book_price&#x27;: Decimal(&#x27;60.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;tom3&#x27;, &#x27;sum_book_price&#x27;: Decimal(&#x27;140.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;tom4&#x27;, &#x27;sum_book_price&#x27;: Decimal(&#x27;60.00&#x27;)&#125;]&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="5-小结">(5)小结</h4>
<ul>
<li>
<p>下面这个语法</p>
</li>
<li>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Book.objects.values(<span class="string">&#x27;price&#x27;</span>).annotate()</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>如果annotate前面没东西，则会按照Book进行分组,如果前面有参数就会按照前面的参数’price’进行分组</p>
</li>
</ul>
<h2 id="【五】F和Q查询">【五】F和Q查询</h2>
<h3 id="【1】引入-2">【1】引入</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> <span class="keyword">from</span> django.db.models <span class="keyword">import</span> F, Q</span><br></pre></td></tr></table></figure>
<h3 id="【2】F查询">【2】F查询</h3>
<ul>
<li>能够帮你获取到列表中的某个字段对应的数据</li>
<li>注意：在操作字符串类型的时候，F查询不能够直接做到字符串的拼接</li>
</ul>
<h4 id="（1）查询库存数大于销量的书籍">（1）查询库存数大于销量的书籍</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># F 查询 : 帮助我们直接获取到表中的某个字段对应的数据</span></span><br><span class="line">res = models.Book.objects.<span class="built_in">filter</span>(sales__gt=F(<span class="string">&#x27;stock&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(res)  <span class="comment"># &lt;QuerySet [&lt;Book: 水浒传&gt;]&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="（2）将所有的书籍价格提升100">（2）将所有的书籍价格提升100</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span> Book</span><br><span class="line">   <span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line"></span><br><span class="line">   <span class="comment"># 将所有的书籍价格提升100</span></span><br><span class="line">   data = Book.objects.update(price=F(<span class="string">&quot;price&quot;</span>) + <span class="number">100</span>)</span><br><span class="line">   <span class="built_in">print</span>(data)</span><br><span class="line">   <span class="comment"># 5</span></span><br><span class="line">   <span class="comment"># 代表更新了5条数据</span></span><br></pre></td></tr></table></figure>
<h4 id="3-将所有的数据后面添加-nb">(3)将所有的数据后面添加_nb</h4>
<ul>
<li>
<p>Value 是一个用于在查询中插入静态值的类，这个值可以是任何Django支持的数据库数据类型</p>
<ul>
<li>
<pre><code class="language-python">from django.db.models import Value
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- Concat:在操作字符串的时候F查询不能直接操作字符串，需要引入这个方法</span><br><span class="line"></span><br><span class="line">  - ````python</span><br><span class="line">    from django.db.models.functions import Concat</span><br><span class="line">    ````</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">from user.models import Book</span><br><span class="line">    from django.db.models import F</span><br><span class="line">    from django.db.models import Value</span><br><span class="line">    from django.db.models.functions import Concat</span><br><span class="line">    # 将所有的书籍后面添加_nb</span><br><span class="line">    # 在操作字符串的时候F查询不能直接操作字符串，需要引入一个方法，Concat</span><br><span class="line">    # Value：Value 是一个用于在查询中插入静态值的类，这个值可以是任何Django支持的数据库数据类型</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    data = Book.objects.update(title=Concat(F(&quot;title&quot;),Value(&#x27;_nb&#x27;)))</span><br><span class="line">    print(data)</span><br><span class="line">    # 5</span><br><span class="line">    # 更新了5条数据</span><br></pre></td></tr></table></figure>







</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="【3】Q查询">【3】Q查询</h3>
<ul>
<li>关键字filter()方法中的关键字参数查询都是一起进行’and’</li>
<li>如果你需要执行更复杂的查询(列如ORM语句)，你可以使用Q对象</li>
</ul>
<h4 id="1-查询卖出数大于100或者价格小于500的书籍">(1)查询卖出数大于100或者价格小于500的书籍</h4>
<ul>
<li>直接使用 filter 查询数据，逗号隔开,里面放的参数是 and 关系</li>
<li>两个条件都必须符合</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询卖出数大于100或者价格小于500的书籍</span></span><br><span class="line">    data = Book.objects.<span class="built_in">filter</span>(sales__gt=<span class="number">100</span>, price__lt=<span class="number">500</span>)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&lt;Book: Book object (1)&gt;]&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>直接使用 Q 查询数据，逗号隔开,里面放的参数还是 and 关系
<ul>
<li>两个条件都必须成立</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = Book.objects.<span class="built_in">filter</span>(Q(sales__gt=<span class="number">100</span>), Q(price__lt=<span class="number">500</span>))</span><br><span class="line">    <span class="built_in">print</span>(data)  <span class="comment"># &lt;QuerySet [&lt;Book: Book object (1)&gt;]&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>直接使用 Q 查询数据，逗号可以换成其他连接符达到效果</p>
<ul>
<li>
<p>or：任一个条件符合即可</p>
</li>
<li>
<p>关键字作为连接符，会阉割条件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = Book.objects.<span class="built_in">filter</span>(Q(sales__gt=<span class="number">100</span>) <span class="keyword">or</span> Q(price__lt=<span class="number">500</span>))</span><br><span class="line">    <span class="built_in">print</span>(data)  <span class="comment"># &lt;QuerySet [&lt;Book: Book object (1)&gt;]&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>|：或关系</p>
<ul>
<li>有一个成立就可以</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = Book.objects.<span class="built_in">filter</span>(Q(sales__gt=<span class="number">100</span>) | Q(price__lt=<span class="number">500</span>))</span><br><span class="line">    <span class="built_in">print</span>(data) <span class="comment"># &lt;QuerySet [&lt;Book: Book object (1)&gt;]&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="（2）Q的高阶用法">（2）Q的高阶用法</h4>
<ul>
<li>
<p>能够将查询条件的左边也变成 字符串形式</p>
</li>
<li>
<p>自己创造查询条件</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询卖出数大于100或者价格小于500的书籍</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成Q对象</span></span><br><span class="line">    q = Q()</span><br><span class="line">    <span class="comment"># 创建Q对象的连接条件</span></span><br><span class="line">    <span class="comment"># or：满足一个条件即可</span></span><br><span class="line">    <span class="comment"># and: 两个条件都要满足</span></span><br><span class="line">    <span class="comment"># 默认是and关系</span></span><br><span class="line">    q.connector = <span class="string">&quot;or&quot;</span></span><br><span class="line">    <span class="comment"># 添加第一个加条件--&gt;左边</span></span><br><span class="line">    q.children.append((<span class="string">&quot;sales__gt&quot;</span>, <span class="number">100</span>))</span><br><span class="line">    <span class="comment"># 添加第二个加条件--&gt;右边</span></span><br><span class="line">    q.children.append((<span class="string">&quot;price__lt&quot;</span>, <span class="number">500</span>))</span><br><span class="line">    <span class="comment"># 查询</span></span><br><span class="line">    <span class="comment"># filter 除了可以放条件 还可以放对象</span></span><br><span class="line">    data = Book.objects.<span class="built_in">filter</span>(q)</span><br><span class="line">    <span class="built_in">print</span>(data)  <span class="comment"># &lt;QuerySet [&lt;Book: Book object (1)&gt;]&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>可以在去对象内 children里面 无限制的添加元素 添加元组，元组里两个元素</p>
</li>
<li>
<p>而且还支持修改 or 、and</p>
</li>
<li>
<p>默认是and</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 或查询</span></span><br><span class="line">q = Q()</span><br><span class="line">q |= Q(条件一)</span><br><span class="line">q |= Q(条件二)</span><br><span class="line">qs = Model.objects.<span class="built_in">filter</span>(q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 并查询</span></span><br><span class="line">q = Q()</span><br><span class="line">q &amp;= Q(条件一)</span><br><span class="line">q &amp;= Q(条件二)</span><br><span class="line">qs = Model.objects.<span class="built_in">filter</span>(q)</span><br></pre></td></tr></table></figure>
<h1>Django中开启事务</h1>
<h2 id="【一】ACID特性">【一】ACID特性</h2>
<ul>
<li>原子性（Atomicity）
<ul>
<li>事务被称为一个不可再分隔的原子操作单位</li>
<li>要么全部操作成功并永久保存，要么全部操作失败并回滚到事务开始前的状态，不存在部分成功或部分失败的情况</li>
</ul>
</li>
<li>一致性（Consistency）
<ul>
<li>事务执行前后，数据库应保持一致的状态</li>
<li>在事务开始之前和结束之后，数据库必须满足所有的完整性约束，如列级别的约束、外键关系等</li>
</ul>
</li>
<li>隔离性（Isolation）
<ul>
<li>事务的执行结果对其他并发执行的事务是隔离的</li>
<li>一个事务的执行不应受到其他事务的干扰，各个事务之间应该相互独立工作，从而避免数据的不一致性</li>
</ul>
</li>
<li>持久性（Durability）
<ul>
<li>一旦事务被提交，其结果应该永久保存在数据库中，并且可以被系统故障恢复</li>
<li>即使系统发生宕机或崩溃，事务提交后的更改也应该是永久性的</li>
</ul>
</li>
</ul>
<h2 id="【二】事务名词">【二】事务名词</h2>
<ul>
<li>开启事务：Start Transaction</li>
<li>事务结束：End Transaction</li>
<li>提交事务：Commit Transaction</li>
<li>回滚事务：Rollback Transaction</li>
</ul>
<h2 id="【三】默认事务行为">【三】默认事务行为</h2>
<ul>
<li>Django是支持事务操作的，它的默认事务行为是自动提交</li>
<li>具体表现形式为：每次数据库操作(比如调用save()方法)会立即被提交到数据库中</li>
<li>如果你希望把连续的SQL操作包裹在一个事务里，就需要手动开启事务</li>
</ul>
<h2 id="【四】开启事务">【四】开启事务</h2>
<h3 id="【1】开启全局事务">【1】开启全局事务</h3>
<ul>
<li>在settings.py中的数据库中配置</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="comment"># 手动创建数据库</span></span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&quot;django_two&quot;</span>,</span><br><span class="line">        <span class="string">&quot;USER&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">        <span class="string">&quot;PASSWORD&quot;</span>: <span class="string">&quot;1234567&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HOST&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;PORT&quot;</span>: <span class="number">3306</span>,</span><br><span class="line">        <span class="string">&quot;CHARSET&quot;</span>: <span class="string">&quot;utf8mb4&quot;</span>,</span><br><span class="line">        <span class="comment"># 开启全局事务，绑定的是http请求响应整个过程</span></span><br><span class="line">        <span class="string">&quot;ATOMIC_REQUESTS&quot;</span>: <span class="literal">True</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>解析
<ul>
<li>每当有请求过来时，Django会在调用视图方法前开启一个事务。</li>
<li>如果完成了请求处理并正确返回了结果，Django就会提交该事务。</li>
<li>否则，Django会回滚该事务</li>
</ul>
</li>
</ul>
<h3 id="【2】取消局部的事务">【2】取消局部的事务</h3>
<ul>
<li>方法就是，在你要取消事务的视图函数上写一个添加一个装饰器</li>
<li>首先导入一个方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br></pre></td></tr></table></figure>
<ul>
<li>使用<code>@transactionnon_atomic_requests</code>装饰器让某些视图函数方法不受事务的控制</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@transaction.non_atomic_requests</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">longin</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>
<ul>
<li>如有多个数据库，让使用otherdb的视图不受事务控制</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@transaction.non_atomic_requests(<span class="params">using=<span class="string">&quot;otherdb&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">longin</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>
<ul>
<li>虽然全局开启事务很简单，但Django并不推荐开启全局事务。</li>
<li>因为一旦将事务跟 HTTP 请求绑定到一起时，每一个请求都会开启事务，当访问量增长到一定的时候会造成很大的性能损耗</li>
<li>推荐使用局部开启事务</li>
</ul>
<h3 id="【3】局部开启事务">【3】局部开启事务</h3>
<ul>
<li>借助一个方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br></pre></td></tr></table></figure>
<ul>
<li>给视图函数添加装饰器</li>
</ul>
<h4 id="（1）在函数头上增加装饰器">（1）在函数头上增加装饰器</h4>
<ul>
<li>第一步：引入Django内部的事务模块</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br></pre></td></tr></table></figure>
<ul>
<li>第二部：在视图函数上添加装饰器</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加局部开启事务装饰器</span></span><br><span class="line"><span class="meta">@transaction.non_atomic_requests</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">longin</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>
<h4 id="（2）在类内部的函数头上增加装饰器">（2）在类内部的函数头上增加装饰器</h4>
<ul>
<li>第一步：引入模块</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br></pre></td></tr></table></figure>
<ul>
<li>第二部:添加在类里面的函数头上</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="comment"># 添加局部开启事务装饰器</span></span><br><span class="line"><span class="meta">    @transaction.atomic</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
<h4 id="（3）自定义事务点—-Savepoint回滚">（3）自定义事务点—&gt;<strong>Savepoint回滚</strong></h4>
<ul>
<li>自己设定开启事务的点</li>
<li>一旦发生异常或错误，我们使用savepoint_rollback方法让程序回滚到指定的保存点</li>
<li>如果没有问题，就使用savepoint_commit方法提交事务</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">longin</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 开启事务</span></span><br><span class="line">    <span class="keyword">with</span> transaction.atomic():</span><br><span class="line">        <span class="comment"># 记录事务起点</span></span><br><span class="line">        sid = transaction.savepoint()</span><br><span class="line">        <span class="comment"># 异常捕获</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment">#执行你的代码</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># 进行事务的回滚</span></span><br><span class="line">            transaction.savepoint_rollback(sid)</span><br><span class="line">        <span class="comment"># 没有发生错误就提交事务</span></span><br><span class="line">        transaction.savepoint_commit(sid)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>
<h4 id="4-事务提交后回调函数">(4)事务提交后回调函数</h4>
<ul>
<li>意思就是：当前事务提交后立即执行额外的任务</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 例1</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_something</span>():</span><br><span class="line">  <span class="keyword">pass</span>  <span class="comment"># send a mail, invalidate a cache, fire off a Celery task, etc.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">transaction.on_commit(do_something)</span><br></pre></td></tr></table></figure>
<h1>字段及字段参数的补充</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># 【一】CharField 字符串类型</span></span><br><span class="line"><span class="comment"># max_length 规定字符串的长度</span></span><br><span class="line"><span class="comment"># models.CharField(max_length=25)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【二】IntegerField 整数类型</span></span><br><span class="line"><span class="comment"># 只能放数字类型</span></span><br><span class="line"><span class="comment"># 用数字表示 支付方式 微信 支付宝 花呗 ...</span></span><br><span class="line"><span class="comment"># 用数字代表字符串</span></span><br><span class="line"><span class="comment"># models.IntegerField(choices=((1, &quot;微信&quot;), (2, &quot;支付宝&quot;), (3, &quot;花呗&quot;)))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【三】BooleanField 布尔值类型</span></span><br><span class="line"><span class="comment"># 可以放 0 / 1 也可以放 True / False</span></span><br><span class="line"><span class="comment"># models.BooleanField()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【四】EmailField 邮箱</span></span><br><span class="line"><span class="comment"># 必须符合邮箱格式才能被存进去</span></span><br><span class="line"><span class="comment"># models.EmailField()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【五】TextField 大文本字段</span></span><br><span class="line"><span class="comment"># 大量的文本</span></span><br><span class="line"><span class="comment"># models.TextField()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【六】AutoField 自动生成id</span></span><br><span class="line"><span class="comment"># models.AutoField()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【七】DateTimeField 时间日期</span></span><br><span class="line"><span class="comment"># auto_now 第一次创建的时候的时间</span></span><br><span class="line"><span class="comment"># auto_now_add 以后每次更新的时候的时间</span></span><br><span class="line"><span class="comment"># models.DateTimeField(</span></span><br><span class="line"><span class="comment">#     auto_now=True,</span></span><br><span class="line"><span class="comment">#     auto_now_add=True</span></span><br><span class="line"><span class="comment"># )</span></span><br><span class="line"><span class="comment"># models.DateField()</span></span><br><span class="line"><span class="comment"># models.TimeField()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【8】FileField 文件数据</span></span><br><span class="line"><span class="comment"># models.FileField()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【9】ImageField 图片数据</span></span><br><span class="line"><span class="comment"># models.ImageField()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【10】外键关系字段</span></span><br><span class="line"><span class="comment"># 一对多关系</span></span><br><span class="line"><span class="comment"># models.ForeignKey()</span></span><br><span class="line"><span class="comment"># 一对一关系</span></span><br><span class="line"><span class="comment"># models.OneToOneField()</span></span><br><span class="line"><span class="comment"># 多对多关系</span></span><br><span class="line"><span class="comment"># models.ManyToManyField()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【二】字段参数</span></span><br><span class="line"><span class="comment"># default 默认值</span></span><br><span class="line"><span class="comment"># null 是否为空</span></span><br><span class="line"><span class="comment"># blank 是否为空 从admin后台插入数据逇时候是否可以为空</span></span><br><span class="line"><span class="comment"># unique 是否唯一</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 【三】自己看 数据库字段优化 defer / only</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Blog/" rel="tag"># Blog</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/10/15/3.0GIL%E5%85%A8%E5%B1%80%E8%A7%A3%E9%87%8A%E5%99%A8%E9%94%81/" rel="prev" title="3.0GIL全局解释器锁">
      <i class="fa fa-chevron-left"></i> 3.0GIL全局解释器锁
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/10/15/14.0Django%E6%A1%86%E6%9E%B6%E4%B9%8BCookie%E5%92%8CSession.m/" rel="next" title="14.0Django框架之Cookie和Session.m">
      14.0Django框架之Cookie和Session.m <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">Django框架之模型层</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E4%B8%80%E3%80%91%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%BC%95%E5%85%A5%EF%BC%88%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%89"><span class="nav-number">1.1.</span> <span class="nav-text">【一】模型层引入（测试环境搭建）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E4%BA%8C%E3%80%91Django%E7%9A%84ORM%E7%9A%84%E5%8D%95%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="nav-number">1.2.</span> <span class="nav-text">【二】Django的ORM的单表操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%901%E3%80%91%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="nav-number">1.2.1.</span> <span class="nav-text">【1】数据库配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%902%E3%80%91%E5%9C%A8APP%E4%B8%8B%E7%9A%84models-py%E6%96%87%E4%BB%B6%E4%B8%AD%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B%E8%A1%A8"><span class="nav-number">1.2.2.</span> <span class="nav-text">【2】在APP下的models.py文件中定义模型表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%903%E3%80%91%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%EF%BC%88%E5%BF%85%E4%BC%9AN%E6%9D%A1%EF%BC%89"><span class="nav-number">1.2.3.</span> <span class="nav-text">【3】对数据库的增删改查（必会N条）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%A2%9E"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">（1）增</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%88%A0"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">（2）删</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E6%94%B9"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">（3）改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E6%9F%A5"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">（4）查</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%885%EF%BC%89%E5%85%B6%E5%AE%83%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.3.5.</span> <span class="nav-text">（5）其它方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E4%B8%89%E3%80%91%E7%A5%9E%E5%A5%87%E7%9A%84%E5%8F%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.3.</span> <span class="nav-text">【三】神奇的双下划线查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E5%9B%9B%E3%80%91%E5%88%9B%E5%BB%BA%E5%A4%9A%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="nav-number">1.4.</span> <span class="nav-text">【四】创建多表关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%901%E3%80%91%E4%B8%80%E5%AF%B9%E5%A4%9A%E7%9A%84%E8%A1%A8"><span class="nav-number">1.4.1.</span> <span class="nav-text">【1】一对多的表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%902%E3%80%91%E4%B8%80%E5%AF%B9%E4%B8%80%E7%9A%84%E8%A1%A8"><span class="nav-number">1.4.2.</span> <span class="nav-text">【2】一对一的表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%903%E3%80%91%E5%A4%9A%E5%AF%B9%E5%A4%9A%E7%9A%84%E8%A1%A8"><span class="nav-number">1.4.3.</span> <span class="nav-text">【3】多对多的表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%904%E3%80%91%E5%A4%9A%E5%AF%B9%E5%A4%9A%E7%9A%84%E8%A1%A8%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="nav-number">1.4.4.</span> <span class="nav-text">【4】多对多的表方法二</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%905%E3%80%91%E6%80%BB%E7%9A%84%E5%88%9B%E5%BB%BA%E8%A1%A8%E4%BB%A3%E7%A0%81"><span class="nav-number">1.4.5.</span> <span class="nav-text">【5】总的创建表代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E4%BA%94%E3%80%91%E4%B8%80%E5%AF%B9%E5%A4%9A%E7%9A%84%E5%A4%96%E9%94%AE%E5%AD%97%E6%AE%B5"><span class="nav-number">1.5.</span> <span class="nav-text">【五】一对多的外键字段</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%901%E3%80%91%E6%B7%BB%E5%8A%A0%E5%80%BC"><span class="nav-number">1.5.1.</span> <span class="nav-text">【1】添加值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%902%E3%80%91%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">1.5.2.</span> <span class="nav-text">【2】删除数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%903%E3%80%91%E4%BF%AE%E6%94%B9%E5%A4%96%E9%94%AE%E5%AD%97%E6%AE%B5"><span class="nav-number">1.5.3.</span> <span class="nav-text">【3】修改外键字段</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E5%85%AD%E3%80%91%E5%A4%9A%E5%AF%B9%E5%A4%9A%E7%9A%84%E5%A4%96%E9%94%AE%E5%AD%97%E6%AE%B5"><span class="nav-number">1.6.</span> <span class="nav-text">【六】多对多的外键字段</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%901%E3%80%91%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="nav-number">1.6.1.</span> <span class="nav-text">【1】添加数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%902%E3%80%91%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE-2"><span class="nav-number">1.6.2.</span> <span class="nav-text">【2】删除数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%903%E3%80%91%E4%BF%AE%E6%94%B9%E5%A4%96%E9%94%AE%E5%85%B3%E7%B3%BB"><span class="nav-number">1.6.3.</span> <span class="nav-text">【3】修改外键关系</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">2.</span> <span class="nav-text">多表查询（正反向查询）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E4%B8%80%E3%80%91%E4%BB%80%E4%B9%88%E6%98%AF%E6%AD%A3%E5%8F%8D%E5%90%91%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.1.</span> <span class="nav-text">【一】什么是正反向查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%901%E3%80%91%E6%AD%A3%E5%90%91%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.1.1.</span> <span class="nav-text">【1】正向查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%902%E3%80%91%E5%8F%8D%E5%90%91%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.1.2.</span> <span class="nav-text">【2】反向查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E4%BA%8C%E3%80%91%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B"><span class="nav-number">2.2.</span> <span class="nav-text">【二】多表查询案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%901%E3%80%91%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%88%E5%9F%BA%E4%BA%8E%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%B7%A8%E8%A1%A8%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="nav-number">2.2.1.</span> <span class="nav-text">【1】子查询（基于对象的跨表查询）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E6%9F%A5%E8%AF%A2%E4%B9%A6%E7%B1%8D%E4%B8%BB%E9%94%AE%E4%B8%BA14%E7%9A%84%E5%87%BA%E7%89%88%E7%A4%BE"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">（1）查询书籍主键为14的出版社</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E4%B8%BB%E9%94%AE%E4%B8%BA1%E7%9A%84%E4%BD%9C%E8%80%85"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">（2）查询数据主键为1的作者</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E6%9F%A5%E8%AF%A2%E4%BD%9C%E8%80%85%E4%B8%BB%E9%94%AE%E4%B8%BA3%E7%9A%84%E7%94%B5%E8%AF%9D%E5%8F%B7%E7%A0%81"><span class="nav-number">2.2.1.3.</span> <span class="nav-text">(3)查询作者主键为3的电话号码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%9F%A5%E8%AF%A2%E5%87%BA%E7%89%88%E7%A4%BE%E6%98%AF-1%E5%87%BA%E7%89%88%E7%A4%BE-%E7%9A%84%E4%B9%A6"><span class="nav-number">2.2.1.4.</span> <span class="nav-text">(4)查询出版社是  1出版社  的书</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%885%EF%BC%89%E6%9F%A5%E8%AF%A2%E4%BD%9C%E8%80%85%E6%98%AFtom1%E5%86%99%E8%BF%87%E7%9A%84%E4%B9%A6"><span class="nav-number">2.2.1.5.</span> <span class="nav-text">（5）查询作者是tom1写过的书</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E6%9F%A5%E8%AF%A2%E6%89%8B%E6%9C%BA%E5%8F%B7%E6%98%AF110%E7%9A%84%E4%BD%9C%E8%80%85%E5%A7%93%E5%90%8D"><span class="nav-number">2.2.1.6.</span> <span class="nav-text">(6)查询手机号是110的作者姓名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-%E5%B0%8F%E7%BB%93"><span class="nav-number">2.2.1.7.</span> <span class="nav-text">(7)小结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%902%E3%80%91%E8%81%94%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.2.2.</span> <span class="nav-text">【2】联表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E6%9F%A5%E8%AF%A2tom1%E7%9A%84%E6%89%8B%E6%9C%BA%E5%8F%B7%E5%92%8C%E4%BD%9C%E8%80%85%E7%9A%84%E5%90%8D%E5%AD%97"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">（1）查询tom1的手机号和作者的名字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E6%9F%A5%E8%AF%A2%E4%B9%A6%E7%B1%8D%E4%B8%BB%E9%94%AE%E4%B8%BA1%E7%9A%84%E5%87%BA%E7%89%88%E7%A4%BE%E7%9A%84%E5%90%8D%E5%AD%97%E5%92%8C%E4%B9%A6%E7%9A%84%E5%90%8D%E5%AD%97"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">（2）查询书籍主键为1的出版社的名字和书的名字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E6%9F%A5%E8%AF%A2%E4%B9%A6%E7%B1%8D%E4%B8%BB%E9%94%AE%E4%B8%BA1%E7%9A%84%E4%BD%9C%E8%80%85%E7%9A%84%E5%90%8D%E5%AD%97"><span class="nav-number">2.2.2.3.</span> <span class="nav-text">(3)查询书籍主键为1的作者的名字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%9F%A5%E8%AF%A2%E4%B9%A6%E7%B1%8D%E4%B8%BB%E9%94%AE%E4%B8%BA1%E7%9A%84%E4%BD%9C%E8%80%85%E7%9A%84%E6%89%8B%E6%9C%BA%E5%8F%B7"><span class="nav-number">2.2.2.4.</span> <span class="nav-text">(4)查询书籍主键为1的作者的手机号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%885%EF%BC%89%E5%B0%8F%E7%BB%93"><span class="nav-number">2.2.2.5.</span> <span class="nav-text">（5）小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E4%B8%89%E3%80%91%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%EF%BC%88aggregate%EF%BC%89"><span class="nav-number">2.3.</span> <span class="nav-text">【三】聚合函数（aggregate）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%901%E3%80%91%E5%BC%95%E5%85%A5%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="nav-number">2.3.1.</span> <span class="nav-text">【1】引入聚合函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%902%E3%80%91%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%E6%A1%88%E4%BE%8B"><span class="nav-number">2.3.2.</span> <span class="nav-text">【2】聚合函数案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%B1%82%E6%89%80%E6%9C%89%E4%B9%A6%E7%9A%84%E5%B9%B3%E5%9D%87%E4%BB%B7%E6%A0%BC"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">(1)求所有书的平均价格</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E4%B8%80%E6%AC%A1%E6%80%A7%E7%94%A8%E5%BE%88%E5%A4%9A%E6%96%B9%E6%B3%95"><span class="nav-number">2.3.2.2.</span> <span class="nav-text">(2)一次性用很多方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E5%9B%9B%E3%80%91%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%EF%BC%88%E5%85%B3%E9%94%AE%E5%AD%97%EF%BC%9Aannotate%EF%BC%89"><span class="nav-number">2.4.</span> <span class="nav-text">【四】分组查询（关键字：annotate）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%901%E3%80%91%E5%BC%95%E5%85%A5"><span class="nav-number">2.4.1.</span> <span class="nav-text">【1】引入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%902%E3%80%91%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95"><span class="nav-number">2.4.2.</span> <span class="nav-text">【2】分组查询语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%903%E3%80%91%E6%A1%88%E4%BE%8B"><span class="nav-number">2.4.3.</span> <span class="nav-text">【3】案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E7%BB%9F%E8%AE%A1%E6%AF%8F%E4%B8%80%E6%9C%AC%E4%B9%A6%E7%9A%84%E4%BD%9C%E8%80%85%E4%B8%AA%E6%95%B0"><span class="nav-number">2.4.3.1.</span> <span class="nav-text">（1）统计每一本书的作者个数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E7%BB%9F%E8%AE%A1%E6%AF%8F%E4%B8%AA%E5%87%BA%E7%89%88%E7%A4%BE%E6%9C%80%E4%BE%BF%E5%AE%9C%E7%9A%84%E4%B9%A6%E7%9A%84%E4%BB%B7%E6%A0%BC"><span class="nav-number">2.4.3.2.</span> <span class="nav-text">（2）统计每个出版社最便宜的书的价格</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E7%BB%9F%E8%AE%A1%E4%B8%8D%E6%AD%A2%E4%B8%80%E4%B8%AA%E4%BD%9C%E8%80%85%E7%9A%84%E5%9B%BE%E4%B9%A6"><span class="nav-number">2.4.3.3.</span> <span class="nav-text">（3）统计不止一个作者的图书</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%9F%A5%E8%AF%A2%E6%AF%8F%E4%B8%AA%E4%BD%9C%E8%80%85%E5%87%BA%E7%9A%84%E4%B9%A6%E6%80%BB%E4%BB%B7%E6%A0%BC"><span class="nav-number">2.4.3.4.</span> <span class="nav-text">(4)查询每个作者出的书总价格</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E5%B0%8F%E7%BB%93"><span class="nav-number">2.4.3.5.</span> <span class="nav-text">(5)小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E4%BA%94%E3%80%91F%E5%92%8CQ%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.5.</span> <span class="nav-text">【五】F和Q查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%901%E3%80%91%E5%BC%95%E5%85%A5-2"><span class="nav-number">2.5.1.</span> <span class="nav-text">【1】引入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%902%E3%80%91F%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.5.2.</span> <span class="nav-text">【2】F查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E6%9F%A5%E8%AF%A2%E5%BA%93%E5%AD%98%E6%95%B0%E5%A4%A7%E4%BA%8E%E9%94%80%E9%87%8F%E7%9A%84%E4%B9%A6%E7%B1%8D"><span class="nav-number">2.5.2.1.</span> <span class="nav-text">（1）查询库存数大于销量的书籍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%B0%86%E6%89%80%E6%9C%89%E7%9A%84%E4%B9%A6%E7%B1%8D%E4%BB%B7%E6%A0%BC%E6%8F%90%E5%8D%87100"><span class="nav-number">2.5.2.2.</span> <span class="nav-text">（2）将所有的书籍价格提升100</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%B0%86%E6%89%80%E6%9C%89%E7%9A%84%E6%95%B0%E6%8D%AE%E5%90%8E%E9%9D%A2%E6%B7%BB%E5%8A%A0-nb"><span class="nav-number">2.5.2.3.</span> <span class="nav-text">(3)将所有的数据后面添加_nb</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%903%E3%80%91Q%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.5.3.</span> <span class="nav-text">【3】Q查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%9F%A5%E8%AF%A2%E5%8D%96%E5%87%BA%E6%95%B0%E5%A4%A7%E4%BA%8E100%E6%88%96%E8%80%85%E4%BB%B7%E6%A0%BC%E5%B0%8F%E4%BA%8E500%E7%9A%84%E4%B9%A6%E7%B1%8D"><span class="nav-number">2.5.3.1.</span> <span class="nav-text">(1)查询卖出数大于100或者价格小于500的书籍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89Q%E7%9A%84%E9%AB%98%E9%98%B6%E7%94%A8%E6%B3%95"><span class="nav-number">2.5.3.2.</span> <span class="nav-text">（2）Q的高阶用法</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">3.</span> <span class="nav-text">Django中开启事务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E4%B8%80%E3%80%91ACID%E7%89%B9%E6%80%A7"><span class="nav-number">3.1.</span> <span class="nav-text">【一】ACID特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E4%BA%8C%E3%80%91%E4%BA%8B%E5%8A%A1%E5%90%8D%E8%AF%8D"><span class="nav-number">3.2.</span> <span class="nav-text">【二】事务名词</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E4%B8%89%E3%80%91%E9%BB%98%E8%AE%A4%E4%BA%8B%E5%8A%A1%E8%A1%8C%E4%B8%BA"><span class="nav-number">3.3.</span> <span class="nav-text">【三】默认事务行为</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%90%E5%9B%9B%E3%80%91%E5%BC%80%E5%90%AF%E4%BA%8B%E5%8A%A1"><span class="nav-number">3.4.</span> <span class="nav-text">【四】开启事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%901%E3%80%91%E5%BC%80%E5%90%AF%E5%85%A8%E5%B1%80%E4%BA%8B%E5%8A%A1"><span class="nav-number">3.4.1.</span> <span class="nav-text">【1】开启全局事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%902%E3%80%91%E5%8F%96%E6%B6%88%E5%B1%80%E9%83%A8%E7%9A%84%E4%BA%8B%E5%8A%A1"><span class="nav-number">3.4.2.</span> <span class="nav-text">【2】取消局部的事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E3%80%903%E3%80%91%E5%B1%80%E9%83%A8%E5%BC%80%E5%90%AF%E4%BA%8B%E5%8A%A1"><span class="nav-number">3.4.3.</span> <span class="nav-text">【3】局部开启事务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%9C%A8%E5%87%BD%E6%95%B0%E5%A4%B4%E4%B8%8A%E5%A2%9E%E5%8A%A0%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="nav-number">3.4.3.1.</span> <span class="nav-text">（1）在函数头上增加装饰器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%9C%A8%E7%B1%BB%E5%86%85%E9%83%A8%E7%9A%84%E5%87%BD%E6%95%B0%E5%A4%B4%E4%B8%8A%E5%A2%9E%E5%8A%A0%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="nav-number">3.4.3.2.</span> <span class="nav-text">（2）在类内部的函数头上增加装饰器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E5%8A%A1%E7%82%B9%E2%80%94-Savepoint%E5%9B%9E%E6%BB%9A"><span class="nav-number">3.4.3.3.</span> <span class="nav-text">（3）自定义事务点—&gt;Savepoint回滚</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E4%BA%8B%E5%8A%A1%E6%8F%90%E4%BA%A4%E5%90%8E%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="nav-number">3.4.3.4.</span> <span class="nav-text">(4)事务提交后回调函数</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">4.</span> <span class="nav-text">字段及字段参数的补充</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Aurora</p>
  <div class="site-description" itemprop="description">选择有时候比努力更重要，但是你不努力，选择就只是空谈</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">194</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Aurora</span>
</div>
  <div class="powered-by">由 <a href="https://github.com/lsk-0912" class="theme-link" rel="noopener" target="_blank">lsk-0912</a> & <a href="https://github.com/lsk-0912" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
